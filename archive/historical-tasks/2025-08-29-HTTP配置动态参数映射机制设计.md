# HTTPé…ç½®åŠ¨æ€å‚æ•°æ˜ å°„æœºåˆ¶è®¾è®¡

*åˆ›å»ºæ—¶é—´: 2025-08-29*  
*åŸºäº: SUBTASK-008 HTTPé…ç½®éœ€æ±‚è®¾è®¡*  
*ç›®æ ‡: è®¾è®¡ç»„ä»¶å±æ€§ä¸HTTPåŠ¨æ€å‚æ•°çš„æ˜ å°„ç»‘å®šæœºåˆ¶*

## ğŸ¯ åœºæ™¯éœ€æ±‚åˆ†æ

### æ ¸å¿ƒåœºæ™¯
```
è®¾å¤‡ç›‘æ§ç»„ä»¶å®ä¾‹
â”œâ”€â”€ ç»„ä»¶å±æ€§: deviceId = "device_001"
â”œâ”€â”€ ç”¨æˆ·æ“ä½œ: åˆ‡æ¢è®¾å¤‡ â†’ deviceId = "device_002"  
â”œâ”€â”€ å±æ€§é…ç½®: ä¸ºæ–°å®ä¾‹é…ç½®ä¸åŒçš„deviceId
â””â”€â”€ æ•°æ®æº: HTTP â†’ /api/device/{{deviceId}}/status
```

### å…³é”®éœ€æ±‚
1. **å±æ€§æ˜ å°„ç»‘å®š**: ç»„ä»¶å±æ€§ â†” HTTPåŠ¨æ€å‚æ•°çš„åŒå‘ç»‘å®š
2. **å®æ—¶å“åº”**: å±æ€§å˜åŒ– â†’ HTTPå‚æ•°æ›´æ–° â†’ æ‰§è¡Œå™¨è§¦å‘
3. **å®ä¾‹éš”ç¦»**: ç›¸åŒæ¨¡æ¿çš„ä¸åŒå®ä¾‹å‚æ•°ç‹¬ç«‹
4. **æ— åç«¯ä¾èµ–**: å‰ç«¯å®Œæ•´çš„é…ç½®ç®¡ç†æœºåˆ¶

## ğŸ—ï¸ æ˜ å°„æœºåˆ¶æ¶æ„è®¾è®¡

### 1. å‚æ•°æ˜ å°„æ•°æ®ç»“æ„

```typescript
/**
 * åŠ¨æ€å‚æ•°æ˜ å°„é…ç½®
 * å®šä¹‰ç»„ä»¶å±æ€§å¦‚ä½•æ˜ å°„åˆ°HTTPå‚æ•°
 */
interface DynamicParameterMapping {
  /** æ˜ å°„å”¯ä¸€ID */
  mappingId: string
  /** ç»„ä»¶å±æ€§è·¯å¾„ (å¦‚: 'deviceId', 'config.apiKey') */
  componentPropertyPath: string
  /** HTTPå‚æ•°åç§° (å¦‚: 'deviceId', 'authToken') */
  httpParameterName: string
  /** æ˜ å°„ç±»å‹ */
  mappingType: 'direct' | 'computed' | 'template'
  /** æ•°æ®ç±»å‹è½¬æ¢ */
  dataType: 'string' | 'number' | 'boolean' | 'json'
  /** é»˜è®¤å€¼ */
  defaultValue?: any
  /** æ˜ å°„è¡¨è¾¾å¼ (for computed/template) */
  expression?: string
  /** æè¿° */
  description?: string
}

/**
 * ç»„ä»¶å®ä¾‹çš„å‚æ•°æ˜ å°„é…ç½®
 */
interface ComponentParameterMappings {
  /** ç»„ä»¶å®ä¾‹ID */
  componentId: string
  /** ç»„ä»¶ç±»å‹ */
  componentType: string
  /** æ˜ å°„é…ç½®åˆ—è¡¨ */
  mappings: DynamicParameterMapping[]
  /** åˆ›å»ºæ—¶é—´ */
  createdAt: number
  /** æ›´æ–°æ—¶é—´ */
  updatedAt: number
}
```

### 2. æ˜ å°„ç®¡ç†å™¨ (ParameterMappingManager)

```typescript
/**
 * åŠ¨æ€å‚æ•°æ˜ å°„ç®¡ç†å™¨
 * è´Ÿè´£ç»„ä»¶å±æ€§ä¸HTTPå‚æ•°çš„æ˜ å°„å…³ç³»ç®¡ç†
 */
class ParameterMappingManager {
  /** æ˜ å°„é…ç½®å­˜å‚¨ */
  private mappings = new Map<string, ComponentParameterMappings>()
  
  /** å±æ€§ç›‘å¬å™¨ */
  private propertyWatchers = new Map<string, (() => void)[]>()
  
  /**
   * æ³¨å†Œç»„ä»¶çš„å‚æ•°æ˜ å°„é…ç½®
   * @param componentId ç»„ä»¶å®ä¾‹ID
   * @param mappings æ˜ å°„é…ç½®
   */
  registerMappings(componentId: string, mappings: ComponentParameterMappings): void {
    this.mappings.set(componentId, mappings)
    
    // å»ºç«‹å±æ€§ç›‘å¬
    this.setupPropertyWatchers(componentId, mappings)
    
    console.log(`ğŸ”— æ³¨å†Œç»„ä»¶å‚æ•°æ˜ å°„: ${componentId}`, mappings)
  }
  
  /**
   * è·å–ç»„ä»¶çš„HTTPå‚æ•°å½“å‰å€¼
   * @param componentId ç»„ä»¶ID
   * @returns HTTPå‚æ•°é”®å€¼å¯¹
   */
  getHttpParameterValues(componentId: string): Record<string, any> {
    const mappingConfig = this.mappings.get(componentId)
    if (!mappingConfig) return {}
    
    const parameterValues: Record<string, any> = {}
    
    // è·å–ç»„ä»¶å®ä¾‹
    const component = this.getComponentInstance(componentId)
    if (!component) return {}
    
    // éå†æ˜ å°„é…ç½®ï¼Œæå–å‚æ•°å€¼
    mappingConfig.mappings.forEach(mapping => {
      const propertyValue = this.getPropertyValue(component, mapping.componentPropertyPath)
      const httpValue = this.transformValue(propertyValue, mapping)
      
      parameterValues[mapping.httpParameterName] = httpValue
    })
    
    return parameterValues
  }
  
  /**
   * æ›´æ–°ç»„ä»¶å±æ€§å€¼
   * @param componentId ç»„ä»¶ID  
   * @param propertyPath å±æ€§è·¯å¾„
   * @param newValue æ–°å€¼
   */
  updateComponentProperty(componentId: string, propertyPath: string, newValue: any): void {
    const component = this.getComponentInstance(componentId)
    if (!component) return
    
    // æ›´æ–°ç»„ä»¶å±æ€§
    this.setPropertyValue(component, propertyPath, newValue)
    
    // è§¦å‘HTTPå‚æ•°æ›´æ–°
    this.triggerParameterUpdate(componentId, propertyPath)
    
    console.log(`ğŸ”„ æ›´æ–°ç»„ä»¶å±æ€§: ${componentId}.${propertyPath} = ${newValue}`)
  }
  
  /**
   * å»ºç«‹å±æ€§ç›‘å¬å™¨
   */
  private setupPropertyWatchers(componentId: string, mappingConfig: ComponentParameterMappings): void {
    const component = this.getComponentInstance(componentId)
    if (!component) return
    
    // ä¸ºæ¯ä¸ªæ˜ å°„å»ºç«‹ç›‘å¬å™¨
    mappingConfig.mappings.forEach(mapping => {
      const unwatch = this.watchProperty(component, mapping.componentPropertyPath, (oldValue, newValue) => {
        console.log(`ğŸ‘€ å±æ€§å˜åŒ–ç›‘å¬: ${componentId}.${mapping.componentPropertyPath}`, { oldValue, newValue })
        
        // è§¦å‘HTTPå‚æ•°æ›´æ–°
        this.triggerParameterUpdate(componentId, mapping.componentPropertyPath)
      })
      
      // å­˜å‚¨æ¸…ç†å‡½æ•°
      if (!this.propertyWatchers.has(componentId)) {
        this.propertyWatchers.set(componentId, [])
      }
      this.propertyWatchers.get(componentId)!.push(unwatch)
    })
  }
  
  /**
   * è§¦å‘HTTPå‚æ•°æ›´æ–°
   */
  private triggerParameterUpdate(componentId: string, propertyPath: string): void {
    // è·å–æ›´æ–°åçš„æ‰€æœ‰HTTPå‚æ•°å€¼
    const httpParams = this.getHttpParameterValues(componentId)
    
    // é€šè¿‡DataWarehouseæ›´æ–°åŠ¨æ€å‚æ•°
    Object.entries(httpParams).forEach(([paramName, paramValue]) => {
      const globalParamName = `${componentId}_${paramName}` // å®ä¾‹çº§åˆ«éš”ç¦»
      dataWarehouse.updateDynamicParameter(globalParamName, paramValue)
    })
    
    console.log(`ğŸš€ è§¦å‘HTTPå‚æ•°æ›´æ–°: ${componentId}`, httpParams)
  }
  
  /**
   * è·å–ç»„ä»¶å®ä¾‹ (é›†æˆç°æœ‰ç»„ä»¶ç³»ç»Ÿ)
   */
  private getComponentInstance(componentId: string): any {
    // ä»ConfigurationPanelæˆ–VisualEditorè·å–ç»„ä»¶å®ä¾‹
    return visualEditor.getComponentById(componentId) || null
  }
  
  /**
   * ç›‘å¬å±æ€§å˜åŒ– (Vue3å“åº”å¼ç³»ç»Ÿ)
   */
  private watchProperty(component: any, propertyPath: string, callback: (oldValue: any, newValue: any) => void): () => void {
    // ä½¿ç”¨Vue3çš„watch APIç›‘å¬å±æ€§å˜åŒ–
    return watch(
      () => this.getPropertyValue(component, propertyPath),
      (newValue, oldValue) => callback(oldValue, newValue),
      { deep: true }
    )
  }
  
  /**
   * è·å–å±æ€§å€¼ (æ”¯æŒåµŒå¥—è·¯å¾„)
   */
  private getPropertyValue(component: any, propertyPath: string): any {
    return propertyPath.split('.').reduce((obj, key) => obj?.[key], component)
  }
  
  /**
   * è®¾ç½®å±æ€§å€¼ (æ”¯æŒåµŒå¥—è·¯å¾„)
   */
  private setPropertyValue(component: any, propertyPath: string, value: any): void {
    const keys = propertyPath.split('.')
    const lastKey = keys.pop()!
    const target = keys.reduce((obj, key) => obj[key], component)
    
    if (target && lastKey) {
      target[lastKey] = value
    }
  }
  
  /**
   * å€¼ç±»å‹è½¬æ¢
   */
  private transformValue(value: any, mapping: DynamicParameterMapping): any {
    if (value === undefined || value === null) {
      return mapping.defaultValue
    }
    
    switch (mapping.mappingType) {
      case 'direct':
        return this.convertDataType(value, mapping.dataType)
      
      case 'computed':
        // æ‰§è¡Œè®¡ç®—è¡¨è¾¾å¼
        return this.evaluateExpression(mapping.expression!, { value })
      
      case 'template':
        // æ¨¡æ¿å­—ç¬¦ä¸²æ›¿æ¢
        return mapping.expression!.replace(/\{\{value\}\}/g, String(value))
      
      default:
        return value
    }
  }
  
  /**
   * æ•°æ®ç±»å‹è½¬æ¢
   */
  private convertDataType(value: any, dataType: string): any {
    switch (dataType) {
      case 'string': return String(value)
      case 'number': return Number(value)
      case 'boolean': return Boolean(value)
      case 'json': return JSON.stringify(value)
      default: return value
    }
  }
  
  /**
   * è¡¨è¾¾å¼æ±‚å€¼ (ç®€å•å®ç°)
   */
  private evaluateExpression(expression: string, context: any): any {
    try {
      return new Function('context', `with(context) { return ${expression} }`)(context)
    } catch (error) {
      console.error('è¡¨è¾¾å¼æ±‚å€¼å¤±è´¥:', expression, error)
      return context.value
    }
  }
  
  /**
   * æ¸…ç†ç»„ä»¶æ˜ å°„
   */
  cleanup(componentId: string): void {
    // æ¸…ç†å±æ€§ç›‘å¬å™¨
    const watchers = this.propertyWatchers.get(componentId)
    if (watchers) {
      watchers.forEach(unwatch => unwatch())
      this.propertyWatchers.delete(componentId)
    }
    
    // åˆ é™¤æ˜ å°„é…ç½®
    this.mappings.delete(componentId)
    
    console.log(`ğŸ§¹ æ¸…ç†ç»„ä»¶æ˜ å°„: ${componentId}`)
  }
}

// åˆ›å»ºå…¨å±€å®ä¾‹
export const parameterMappingManager = new ParameterMappingManager()
```

### 3. HTTPé…ç½®æ¨¡æ¿ç³»ç»Ÿ

```typescript
/**
 * HTTPé…ç½®æ¨¡æ¿
 * æ”¯æŒåŠ¨æ€å‚æ•°å ä½ç¬¦
 */
interface HttpConfigTemplate {
  /** æ¨¡æ¿ID */
  templateId: string
  /** æ¨¡æ¿åç§° */
  name: string
  /** HTTPé…ç½®æ¨¡æ¿ */
  httpConfig: {
    url: string  // å¦‚: '/api/device/{{deviceId}}/status'
    method: string
    headers: HttpHeader[]  // æ”¯æŒåŠ¨æ€å‚æ•°
    params: HttpParam[]    // æ”¯æŒåŠ¨æ€å‚æ•°
  }
  /** å‚æ•°æ˜ å°„é…ç½® */
  parameterMappings: DynamicParameterMapping[]
  /** æè¿° */
  description?: string
}

/**
 * HTTPé…ç½®æ¨¡æ¿ç®¡ç†å™¨
 */
class HttpConfigTemplateManager {
  private templates = new Map<string, HttpConfigTemplate>()
  
  /**
   * æ³¨å†ŒHTTPé…ç½®æ¨¡æ¿
   */
  registerTemplate(template: HttpConfigTemplate): void {
    this.templates.set(template.templateId, template)
    console.log(`ğŸ“‹ æ³¨å†ŒHTTPé…ç½®æ¨¡æ¿: ${template.templateId}`)
  }
  
  /**
   * ä¸ºç»„ä»¶å®ä¾‹åº”ç”¨æ¨¡æ¿
   * @param componentId ç»„ä»¶å®ä¾‹ID
   * @param templateId æ¨¡æ¿ID
   * @param propertyBindings å±æ€§ç»‘å®šé…ç½®
   */
  applyTemplate(componentId: string, templateId: string, propertyBindings: Record<string, string>): void {
    const template = this.templates.get(templateId)
    if (!template) {
      console.error(`æ¨¡æ¿ä¸å­˜åœ¨: ${templateId}`)
      return
    }
    
    // åˆ›å»ºå®ä¾‹çº§åˆ«çš„æ˜ å°„é…ç½®
    const instanceMappings: ComponentParameterMappings = {
      componentId,
      componentType: 'http-data-component',
      mappings: template.parameterMappings.map(mapping => ({
        ...mapping,
        mappingId: `${componentId}_${mapping.mappingId}`,
        componentPropertyPath: propertyBindings[mapping.httpParameterName] || mapping.componentPropertyPath
      })),
      createdAt: Date.now(),
      updatedAt: Date.now()
    }
    
    // æ³¨å†Œåˆ°æ˜ å°„ç®¡ç†å™¨
    parameterMappingManager.registerMappings(componentId, instanceMappings)
    
    // ç”ŸæˆHTTPé…ç½®
    const httpConfig = this.generateHttpConfig(componentId, template)
    
    // ä¿å­˜åˆ°ConfigurationManager
    const dataSourceConfig = {
      type: 'http',
      enabled: true,
      config: httpConfig,
      metadata: {
        templateId,
        mappings: instanceMappings,
        updatedAt: Date.now()
      }
    }
    
    configurationManager.updateConfiguration(componentId, 'dataSource', dataSourceConfig)
    
    console.log(`âœ… ä¸ºç»„ä»¶åº”ç”¨HTTPæ¨¡æ¿: ${componentId} â†’ ${templateId}`)
  }
  
  /**
   * ç”Ÿæˆå®ä¾‹åŒ–çš„HTTPé…ç½®
   */
  private generateHttpConfig(componentId: string, template: HttpConfigTemplate): any {
    // è·å–å½“å‰å‚æ•°å€¼
    const parameterValues = parameterMappingManager.getHttpParameterValues(componentId)
    
    // æ›¿æ¢URLä¸­çš„å ä½ç¬¦
    let url = template.httpConfig.url
    Object.entries(parameterValues).forEach(([paramName, paramValue]) => {
      url = url.replace(new RegExp(`\\{\\{${paramName}\\}\\}`, 'g'), String(paramValue))
    })
    
    // ç”ŸæˆHeadersé…ç½®
    const headers = template.httpConfig.headers.map(header => ({
      ...header,
      value: header.isDynamic 
        ? (parameterValues[header.variableName] || header.value)
        : header.value
    }))
    
    // ç”ŸæˆParamsé…ç½®
    const params = template.httpConfig.params.map(param => ({
      ...param,
      value: param.isDynamic
        ? (parameterValues[param.variableName] || param.value)
        : param.value
    }))
    
    return {
      url,
      method: template.httpConfig.method,
      headers,
      params,
      timeout: 5000
    }
  }
}

export const httpConfigTemplateManager = new HttpConfigTemplateManager()
```

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

### 1. æ¨¡æ¿å®šä¹‰é˜¶æ®µ

```typescript
// å®šä¹‰è®¾å¤‡çŠ¶æ€æŸ¥è¯¢HTTPæ¨¡æ¿
const deviceStatusTemplate: HttpConfigTemplate = {
  templateId: 'device-status-query',
  name: 'è®¾å¤‡çŠ¶æ€æŸ¥è¯¢',
  httpConfig: {
    url: '/api/device/{{deviceId}}/status',
    method: 'GET',
    headers: [
      {
        key: 'Authorization',
        value: 'Bearer {{authToken}}',
        enabled: true,
        isDynamic: true,
        dataType: 'string',
        variableName: 'authToken',
        description: 'è®¤è¯ä»¤ç‰Œ'
      }
    ],
    params: [
      {
        key: 'includeMetrics',
        value: '{{includeMetrics}}',
        enabled: true,
        isDynamic: true,
        dataType: 'boolean',
        variableName: 'includeMetrics', 
        description: 'æ˜¯å¦åŒ…å«æŒ‡æ ‡æ•°æ®'
      }
    ]
  },
  parameterMappings: [
    {
      mappingId: 'deviceId-mapping',
      componentPropertyPath: 'deviceId',
      httpParameterName: 'deviceId',
      mappingType: 'direct',
      dataType: 'string',
      description: 'è®¾å¤‡IDç›´æ¥æ˜ å°„'
    },
    {
      mappingId: 'authToken-mapping', 
      componentPropertyPath: 'config.apiKey',
      httpParameterName: 'authToken',
      mappingType: 'template',
      dataType: 'string',
      expression: 'Bearer {{value}}',
      description: 'APIå¯†é’¥è½¬æ¢ä¸ºè®¤è¯ä»¤ç‰Œ'
    },
    {
      mappingId: 'includeMetrics-mapping',
      componentPropertyPath: 'showMetrics',
      httpParameterName: 'includeMetrics', 
      mappingType: 'direct',
      dataType: 'boolean',
      defaultValue: false,
      description: 'æ˜¾ç¤ºæŒ‡æ ‡å¼€å…³æ˜ å°„'
    }
  ]
}

// æ³¨å†Œæ¨¡æ¿
httpConfigTemplateManager.registerTemplate(deviceStatusTemplate)
```

### 2. ç»„ä»¶å®ä¾‹åˆ›å»ºé˜¶æ®µ

```typescript
// åˆ›å»ºè®¾å¤‡ç›‘æ§ç»„ä»¶å®ä¾‹A
const componentA = {
  id: 'device-monitor-001',
  type: 'device-status-widget',
  properties: {
    deviceId: 'device_001',
    config: {
      apiKey: 'abc123'
    },
    showMetrics: true
  }
}

// åº”ç”¨HTTPæ¨¡æ¿åˆ°ç»„ä»¶A
httpConfigTemplateManager.applyTemplate(
  'device-monitor-001',
  'device-status-query',
  {
    deviceId: 'deviceId',          // HTTPå‚æ•°å â†’ ç»„ä»¶å±æ€§è·¯å¾„
    authToken: 'config.apiKey',
    includeMetrics: 'showMetrics'
  }
)

// åˆ›å»ºç›¸åŒç±»å‹çš„ç»„ä»¶å®ä¾‹B
const componentB = {
  id: 'device-monitor-002', 
  type: 'device-status-widget',
  properties: {
    deviceId: 'device_002',
    config: {
      apiKey: 'xyz789'
    },
    showMetrics: false
  }
}

// åº”ç”¨ç›¸åŒæ¨¡æ¿åˆ°ç»„ä»¶B
httpConfigTemplateManager.applyTemplate(
  'device-monitor-002',
  'device-status-query',
  {
    deviceId: 'deviceId',
    authToken: 'config.apiKey', 
    includeMetrics: 'showMetrics'
  }
)
```

### 3. è¿è¡Œæ—¶åŠ¨æ€æ›´æ–°

```typescript
// ç”¨æˆ·æ“ä½œ: åˆ‡æ¢ç»„ä»¶Açš„è®¾å¤‡
function onDeviceSwitch(componentId: string, newDeviceId: string) {
  // æ›´æ–°ç»„ä»¶å±æ€§
  parameterMappingManager.updateComponentProperty(componentId, 'deviceId', newDeviceId)
  
  // è¿™å°†è‡ªåŠ¨è§¦å‘:
  // 1. å±æ€§ç›‘å¬å™¨æ„ŸçŸ¥å˜åŒ–
  // 2. HTTPå‚æ•°å€¼æ›´æ–°  
  // 3. DataWarehouseåŠ¨æ€å‚æ•°æ›´æ–°
  // 4. ConfigEventBusäº‹ä»¶è§¦å‘
  // 5. HttpExecutoré‡æ–°æ‰§è¡Œ
}

// ç”¨æˆ·æ“ä½œç¤ºä¾‹
onDeviceSwitch('device-monitor-001', 'device_003')

// å±æ€§é…ç½®: ä¸ºç»„ä»¶Bé…ç½®ä¸åŒçš„APIå¯†é’¥
parameterMappingManager.updateComponentProperty('device-monitor-002', 'config.apiKey', 'newkey456')
```

### 4. HTTPæ‰§è¡Œå™¨é›†æˆ

```typescript
// HTTPæ‰§è¡Œå™¨æ¥æ”¶åˆ°çš„æœ€ç»ˆé…ç½® (ç»„ä»¶A)
const resolvedConfigA = {
  url: '/api/device/device_003/status',  // deviceIdå·²æ›¿æ¢
  method: 'GET',
  headers: [
    {
      key: 'Authorization',
      value: 'Bearer abc123',           // authTokenå·²æ›¿æ¢
      enabled: true,
      isDynamic: false                  // æ‰§è¡Œæ—¶å·²æ˜¯é™æ€å€¼
    }
  ],
  params: [
    {
      key: 'includeMetrics', 
      value: true,                      // showMetricså·²è½¬æ¢
      enabled: true,
      isDynamic: false
    }
  ]
}

// HTTPæ‰§è¡Œå™¨æ¥æ”¶åˆ°çš„æœ€ç»ˆé…ç½® (ç»„ä»¶B)  
const resolvedConfigB = {
  url: '/api/device/device_002/status',  // ä¸åŒçš„deviceId
  method: 'GET',
  headers: [
    {
      key: 'Authorization',
      value: 'Bearer newkey456',         // ä¸åŒçš„authToken
      enabled: true,
      isDynamic: false
    }
  ],
  params: [
    {
      key: 'includeMetrics',
      value: false,                      // ä¸åŒçš„includeMetrics
      enabled: true, 
      isDynamic: false
    }
  ]
}
```

## ğŸ”— ä¸ç°æœ‰æ¶æ„çš„é›†æˆ

### DataWarehouseé›†æˆ

```typescript
// å‚æ•°å‘½åç©ºé—´éš”ç¦»
const parameterKey = `${componentId}_${httpParameterName}`

// æ›´æ–°åŠ¨æ€å‚æ•°
dataWarehouse.updateDynamicParameter(parameterKey, parameterValue)

// è®¢é˜…å‚æ•°å˜åŒ–
dataWarehouse.subscribeDynamicParameter(parameterKey, (oldValue, newValue) => {
  // è§¦å‘HTTPé…ç½®é‡æ–°ç”Ÿæˆ
  regenerateHttpConfig(componentId)
})
```

### ConfigurationManageré›†æˆ

```typescript
// ä¿å­˜æ˜ å°„å…³ç³»åˆ°é…ç½®
const dataSourceConfig = {
  type: 'http-dynamic',
  config: httpConfig,
  metadata: {
    templateId: 'device-status-query',
    parameterMappings: mappings,
    dynamicParameters: parameterValues
  }
}

configurationManager.updateConfiguration(componentId, 'dataSource', dataSourceConfig)
```

### ConfigEventBusé›†æˆ

```typescript
// å‚æ•°å˜åŒ–è§¦å‘é…ç½®äº‹ä»¶
configEventBus.emitConfigChange({
  componentId,
  section: 'dataSource',
  changeType: 'dynamic-parameter-changed',
  dynamicParameterName: parameterName,
  oldConfig: { [parameterName]: oldValue },
  newConfig: { [parameterName]: newValue }
})
```

## ğŸ¯ å…³é”®ç‰¹æ€§æ€»ç»“

### 1. å®ä¾‹çº§åˆ«éš”ç¦»
- ç›¸åŒæ¨¡æ¿çš„ä¸åŒå®ä¾‹æ‹¥æœ‰ç‹¬ç«‹çš„å‚æ•°ç©ºé—´
- å‚æ•°å‘½åè§„åˆ™: `${componentId}_${parameterName}`
- é¿å…ä¸åŒå®ä¾‹é—´çš„å‚æ•°å†²çª

### 2. å“åº”å¼æ˜ å°„
- Vue3å“åº”å¼ç³»ç»Ÿè‡ªåŠ¨ç›‘å¬å±æ€§å˜åŒ–
- å±æ€§å˜åŒ– â†’ HTTPå‚æ•°æ›´æ–° â†’ æ‰§è¡Œå™¨è§¦å‘
- æ”¯æŒæ·±å±‚åµŒå¥—å±æ€§ç›‘å¬

### 3. çµæ´»çš„æ˜ å°„ç±»å‹
- **direct**: ç›´æ¥å€¼æ˜ å°„
- **computed**: è¡¨è¾¾å¼è®¡ç®—  
- **template**: æ¨¡æ¿å­—ç¬¦ä¸²æ›¿æ¢

### 4. æ¨¡æ¿å¤ç”¨æœºåˆ¶
- å®šä¹‰ä¸€æ¬¡æ¨¡æ¿ï¼Œå¤šä¸ªå®ä¾‹å¤ç”¨
- æ”¯æŒä¸åŒçš„å±æ€§ç»‘å®šé…ç½®
- é™ä½é‡å¤é…ç½®å·¥ä½œé‡

### 5. æ— åç«¯ä¾èµ–
- å‰ç«¯å®Œæ•´çš„é…ç½®ç®¡ç†å’Œå­˜å‚¨
- åŸºäºç°æœ‰ConfigurationManager
- æ”¯æŒé…ç½®çš„å¯¼å…¥å¯¼å‡º

è¿™ä¸ªè®¾è®¡å®Œç¾è§£å†³äº†ä½ æåˆ°çš„åœºæ™¯éœ€æ±‚ï¼Œå®ç°äº†ç»„ä»¶å±æ€§ä¸HTTPåŠ¨æ€å‚æ•°çš„çµæ´»æ˜ å°„ç»‘å®šï¼
