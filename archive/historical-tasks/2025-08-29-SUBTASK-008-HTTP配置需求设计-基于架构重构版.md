# SUBTASK-008: HTTPé…ç½®éœ€æ±‚è®¾è®¡ï¼ˆå®Œæ•´ç‰ˆï¼‰

*åˆ›å»ºæ—¶é—´: 2025-08-29*  
*ä»»åŠ¡çŠ¶æ€: éœ€æ±‚è®¾è®¡å®Œæˆ*  
*æ–‡æ¡£ç‰ˆæœ¬: v2.0*  
*ä»»åŠ¡ç›®æ ‡: è®¾è®¡å®Œæ•´çš„HTTPæ•°æ®æºé…ç½®ç³»ç»Ÿï¼Œæ”¯æŒåŠ¨æ€å‚æ•°æ˜ å°„ã€è„šæœ¬å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–*

---

## ğŸ“‹ æ–‡æ¡£æ¦‚è§ˆ

æœ¬æ–‡æ¡£è®¾è®¡äº†ä¸€ä¸ªå®Œæ•´çš„HTTPé…ç½®ç³»ç»Ÿï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒéƒ¨åˆ†ï¼š

- **ğŸ”§ æŠ€æœ¯æ¶æ„è®¾è®¡** - HttpExecutorå¢å¼ºã€ç±»å‹ç³»ç»Ÿæ‰©å±•ã€æ€§èƒ½ä¼˜åŒ–æœºåˆ¶
- **ğŸ¨ UIè¡¨å•è®¾è®¡** - 5æ ‡ç­¾é¡µé…ç½®ç•Œé¢ï¼Œé›†æˆConfigurationPanel
- **ğŸ”— ç»„ä»¶æ˜ å°„æœºåˆ¶** - Card2.1åŒç›²æ˜ å°„ç³»ç»Ÿï¼Œæ”¯æŒç»„ä»¶å±æ€§ä¸HTTPå‚æ•°ç»‘å®š
- **ğŸ“Š å®æ–½è®¡åˆ’** - 10å¤©å®Œæ•´å¼€å‘å‘¨æœŸï¼Œåˆ†é˜¶æ®µå®æ–½æ–¹æ¡ˆ

## ğŸ¯ éœ€æ±‚æ¦‚è¿°

### æ ¸å¿ƒç›®æ ‡
åŸºäºç°æœ‰ThingsPanelæ¶æ„ï¼Œè®¾è®¡å¹¶å®ç°ä¸€ä¸ª**å®Œæ•´çš„HTTPæ•°æ®æºé…ç½®ç³»ç»Ÿ**ï¼Œæ”¯æŒï¼š

- **ğŸ”§ åŠ¨æ€å‚æ•°æ˜ å°„** - ç»„ä»¶å±æ€§ä¸HTTPå‚æ•°çš„å“åº”å¼ç»‘å®š
- **ğŸ“œ è„šæœ¬å¤„ç†èƒ½åŠ›** - è¯·æ±‚å‰é…ç½®è°ƒæ•´å’Œå“åº”åæ•°æ®è½¬æ¢  
- **âš¡ ä¼ä¸šçº§æ€§èƒ½** - å¤§è§„æ¨¡é…ç½®ä¸‹çš„é«˜æ•ˆåŠ¨æ€å‚æ•°æ›´æ–°
- **ğŸ¨ ç”¨æˆ·å‹å¥½ç•Œé¢** - åˆ†å±‚é…ç½®UIï¼Œé™ä½ä½¿ç”¨å¤æ‚åº¦
- **ğŸ”— æ— ç¼ç»„ä»¶é›†æˆ** - ä¸Card2.1ç»„ä»¶ç³»ç»Ÿå®Œç¾èåˆ

### è®¾è®¡åŸåˆ™
- **ğŸ“¦ æ¶æ„å¤ç”¨** - åŸºäºUnifiedDataExecutorã€DataWarehouseç­‰ç°æœ‰åŸºç¡€è®¾æ–½
- **ğŸ”§ èŒè´£åˆ†ç¦»** - HttpExecutorä¸“æ³¨é™æ€æ‰§è¡Œï¼ŒåŠ¨æ€è§£æç”±é…ç½®å±‚å¤„ç†
- **âš¡ æ€§èƒ½ä¼˜å…ˆ** - è®¢é˜…å¼æ›´æ–°æœºåˆ¶ï¼Œé¿å…å¤§é…ç½®é‡æ–°ç”Ÿæˆ
- **ğŸ”„ æ¸è¿›å…¼å®¹** - æ”¯æŒç°æœ‰HTTPé…ç½®æ ¼å¼ï¼Œå¹³æ»‘å‡çº§è·¯å¾„
- **ğŸ¯ ç”¨æˆ·å¯¼å‘** - é™ä½é…ç½®å¤æ‚åº¦ï¼Œæä¾›ç›´è§‚çš„æ˜ å°„ç•Œé¢

## ğŸ“Š ç°çŠ¶åˆ†æ

### å·²æœ‰åŸºç¡€è®¾æ–½
- **UnifiedDataExecutor.ts**: HTTPæ‰§è¡Œå™¨åŸºç¡€å®ç°ï¼Œä½¿ç”¨ `@/service/request`
- **@/service/request**: å®Œæ•´HTTPå®¢æˆ·ç«¯ï¼ˆè®¤è¯ã€å¤šè¯­è¨€ã€é”™è¯¯å¤„ç†ï¼‰  
- **@/core/script-engine**: è„šæœ¬æ‰§è¡Œç³»ç»Ÿ
- **DataWarehouse**: æ•°æ®ç¼“å­˜å’Œå­˜å‚¨ï¼Œé¢„ç•™åŠ¨æ€å‚æ•°æ¥å£
- **ConfigEventBus**: é…ç½®å˜æ›´äº‹ä»¶ç³»ç»Ÿ
- **types/enhanced-types.ts**: å·²æœ‰HttpHeaderå’ŒHttpParamåŸºç¡€ç±»å‹

### ä¸»è¦ç¼ºå¤±
1. **åŠ¨æ€å‚æ•°æ”¯æŒ** - ç°æœ‰é…ç½®åªæ”¯æŒé™æ€å€¼
2. **è„šæœ¬é›†æˆ** - ScriptEngineæœªé›†æˆåˆ°HTTPæ‰§è¡Œå™¨
3. **æ€§èƒ½ä¼˜åŒ–** - åŠ¨æ€å€¼å˜åŒ–æ—¶éœ€é‡æ–°ç”Ÿæˆæ•´ä¸ªé…ç½®

## ğŸ”§ æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

### 1. ç±»å‹ç³»ç»Ÿæ‰©å±•

#### æ‰©å±•ç°æœ‰HTTPç±»å‹ (types/enhanced-types.ts)

**HttpHeaderæ¥å£æ‰©å±•**:
```typescript
export interface HttpHeader {
  key: string
  value: string                    // é™æ€æ—¶ä¸ºå®é™…å€¼ï¼ŒåŠ¨æ€æ—¶ä¸ºç¤ºä¾‹å€¼
  enabled: boolean
  isDynamic: boolean              // æ”¹ä¸ºå¿…å¡«
  dataType: 'string' | 'number' | 'boolean' | 'json'  // ğŸ†• æ–°å¢
  variableName: string            // ğŸ†• è‡ªåŠ¨ç”Ÿæˆï¼ˆæ ¼å¼ï¼šhttp_${key}ï¼‰
  description?: string            // ğŸ†• å‚æ•°è¯´æ˜
}
```

**HttpParamæ¥å£æ‰©å±•**:
```typescript  
export interface HttpParam {
  key: string
  value: string                    // é™æ€æ—¶ä¸ºå®é™…å€¼ï¼ŒåŠ¨æ€æ—¶ä¸ºç¤ºä¾‹å€¼
  enabled: boolean
  isDynamic: boolean              // æ”¹ä¸ºå¿…å¡«
  dataType: 'string' | 'number' | 'boolean' | 'json'  // ğŸ†• æ–°å¢
  variableName: string            // ğŸ†• è‡ªåŠ¨ç”Ÿæˆï¼ˆæ ¼å¼ï¼šhttp_${key}ï¼‰
  description?: string            // ğŸ†• å‚æ•°è¯´æ˜
}
```

**UnifiedDataConfig HTTPé…ç½®**:
```typescript
export interface UnifiedDataConfig {
  config: {
    url?: string
    method?: 'GET' | 'POST' | 'PUT' | 'DELETE'
    timeout?: number
    headers?: HttpHeader[]          // ä½¿ç”¨æ‰©å±•åçš„æ•°ç»„ç±»å‹
    params?: HttpParam[]            // ä½¿ç”¨æ‰©å±•åçš„æ•°ç»„ç±»å‹
    preRequestScript?: string       // ğŸ†• è¯·æ±‚å‰è„šæœ¬
    postResponseScript?: string     // ğŸ†• å“åº”åè„šæœ¬
  }
}
```

### 2. HttpExecutorå¢å¼ºè®¾è®¡

#### æ ¸å¿ƒè®¾è®¡åŸåˆ™

**èŒè´£æ˜ç¡®**: HttpExecutoråªå¤„ç†**é™æ€é…ç½®çš„HTTPè¯·æ±‚æ‰§è¡Œ**ï¼Œä¸è´Ÿè´£åŠ¨æ€å‚æ•°è§£æ

**å…³é”®ç†å¿µ**: "å‚æ•°å€¼å˜åŒ–ç­‰äºé…ç½®å˜åŒ–" - HttpExecutoræ¥æ”¶çš„é…ç½®å·²ç»æ˜¯è§£æåçš„é™æ€å€¼

#### HttpExecutorå¢å¼ºæ¶æ„

**æ‰§è¡Œæµç¨‹**:
```
é™æ€é…ç½®è¾“å…¥ â†’ preRequestScript(è°ƒæ•´é…ç½®) â†’ HTTPè¯·æ±‚ â†’ å“åº”æ•°æ® â†’ postResponseScript(ä¿®æ”¹ç»“æœ) â†’ è¾“å‡º
```

**æ ¸å¿ƒåŠŸèƒ½æ¨¡å—**:

##### 1. å‚æ•°æ ¼å¼è½¬æ¢å™¨ (ParameterTransformer)

```typescript
class ParameterTransformer {
  /**
   * è½¬æ¢HttpHeader[]ä¸ºheaderså¯¹è±¡
   * @param headerConfigs HttpHeaderé…ç½®æ•°ç»„ï¼ˆå·²æ˜¯é™æ€å€¼ï¼‰
   */
  transformHeaders(headerConfigs: HttpHeader[]): Record<string, string> {
    const result: Record<string, string> = {}
    
    headerConfigs
      .filter(header => header.enabled)
      .forEach(header => {
        result[header.key] = this.convertValue(header.value, header.dataType)
      })
    
    return result
  }
  
  /**
   * è½¬æ¢HttpParam[]ä¸ºparamså¯¹è±¡
   * @param paramConfigs HttpParamé…ç½®æ•°ç»„ï¼ˆå·²æ˜¯é™æ€å€¼ï¼‰
   */
  transformParams(paramConfigs: HttpParam[]): Record<string, any> {
    const result: Record<string, any> = {}
    
    paramConfigs
      .filter(param => param.enabled)
      .forEach(param => {
        result[param.key] = this.convertValue(param.value, param.dataType)
      })
    
    return result
  }
  
  /**
   * æ ¹æ®æ•°æ®ç±»å‹è½¬æ¢å€¼
   */
  private convertValue(value: string, dataType: string): any {
    switch (dataType) {
      case 'number': return Number(value)
      case 'boolean': return value === 'true'
      case 'json': return JSON.parse(value)
      default: return value
    }
  }
}
```

##### 2. è„šæœ¬å¤„ç†ç³»ç»Ÿ

**preRequestScript**: è°ƒæ•´å¤´å’Œå‚æ•°çš„è„šæœ¬
- **èŒè´£**: ä¿®æ”¹è¯·æ±‚é…ç½®ï¼ˆurlã€headersã€paramsã€bodyç­‰ï¼‰
- **æ—¶æœº**: HTTPè¯·æ±‚å‰
- **è¾“å…¥**: å½“å‰HTTPé…ç½®å¯¹è±¡
- **è¾“å‡º**: ä¿®æ”¹åçš„HTTPé…ç½®å¯¹è±¡

**postResponseScript**: ä¿®æ”¹å“åº”ç»“æœçš„è„šæœ¬  
- **èŒè´£**: å¤„ç†å’Œè½¬æ¢HTTPå“åº”æ•°æ®
- **æ—¶æœº**: HTTPå“åº”åï¼Œæ•°æ®è½¬æ¢å‰
- **è¾“å…¥**: åŸå§‹å“åº”æ•°æ®
- **è¾“å‡º**: å¤„ç†åçš„å“åº”æ•°æ®

##### 3. HttpExecutoræ ¸å¿ƒå®ç°

```typescript
class EnhancedHttpExecutor implements DataSourceExecutor {
  private paramTransformer = new ParameterTransformer()

  async execute(config: UnifiedDataConfig): Promise<UnifiedDataResult> {
    try {
      // 1. è¯·æ±‚å‰è„šæœ¬å¤„ç†
      let processedConfig = config.config
      if (processedConfig.preRequestScript) {
        processedConfig = await this.executePreRequestScript(processedConfig)
      }
      
      // 2. å‚æ•°æ ¼å¼è½¬æ¢
      const headers = this.paramTransformer.transformHeaders(processedConfig.headers || [])
      const params = this.paramTransformer.transformParams(processedConfig.params || [])
      
      // 3. å‘èµ·HTTPè¯·æ±‚ï¼ˆå¤ç”¨ç°æœ‰@/service/requestï¼‰
      const response = await request({
        url: processedConfig.url,
        method: processedConfig.method?.toLowerCase() as any,
        headers,
        params,
        data: processedConfig.body,
        timeout: processedConfig.timeout || 5000
      })

      // 4. å“åº”åè„šæœ¬å¤„ç†
      let responseData = response.data
      if (processedConfig.postResponseScript) {
        responseData = await this.executePostResponseScript(responseData, processedConfig)
      }

      // 5. æ•°æ®è½¬æ¢ï¼ˆä¿æŒç°æœ‰é€»è¾‘ï¼‰
      const transformedData = this.applyTransform(responseData, processedConfig.transform)

      return {
        success: true,
        data: transformedData,
        timestamp: Date.now(),
        sourceId: config.id,
        metadata: { responseTime: Date.now() - startTime }
      }
    } catch (error: any) {
      return this.createErrorResult(config.id, 'HTTP_ERROR', error.message)
    }
  }
}
```

#### è„šæœ¬ä½¿ç”¨ç¤ºä¾‹

**preRequestScriptç¤ºä¾‹**:
```javascript
// åŠ¨æ€æ·»åŠ æ—¶é—´æˆ³å¤´
config.headers.push({
  key: 'X-Timestamp', 
  value: Date.now().toString(),
  enabled: true
})

// ä¿®æ”¹URLå‚æ•°
config.url = config.url + '?requestId=' + Math.random().toString(36)

return config
```

**postResponseScriptç¤ºä¾‹**:
```javascript
// å“åº”æ•°æ®æ ¼å¼åŒ–
if (responseData.code === 200) {
  return {
    success: true,
    data: responseData.data,
    timestamp: Date.now()
  }
}

throw new Error('APIå“åº”é”™è¯¯: ' + responseData.message)
```

### 3. å®æ–½æ–¹æ¡ˆæ€»ç»“

**æ ¸å¿ƒç‰¹æ€§**:
- ğŸ¯ **èŒè´£åˆ†ç¦»** - HttpExecutoråªå¤„ç†é™æ€é…ç½®æ‰§è¡Œ  
- ğŸ“ **è„šæœ¬é›†æˆ** - preRequestè°ƒæ•´é…ç½®ï¼ŒpostResponseä¿®æ”¹ç»“æœ
- ğŸ”„ **æ ¼å¼è½¬æ¢** - HttpHeader[]/HttpParam[] â†’ Record<string, any>
- ğŸ”™ **å‘ä¸‹å…¼å®¹** - æ”¯æŒç°æœ‰ç®€å•é…ç½®æ ¼å¼
- âš¡ **é«˜æ€§èƒ½** - å¤ç”¨ç°æœ‰@/service/requestå’ŒScriptEngine

**å®æ–½ä¼˜å…ˆçº§**:
- **é˜¶æ®µ1 (2å¤©)**: ParameterTransformer + è„šæœ¬å¤„ç† + HttpExecutorå¢å¼º
- **é˜¶æ®µ2 (1å¤©)**: å‘ä¸‹å…¼å®¹æµ‹è¯• + é›†æˆéªŒè¯

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### åŠ¨æ€é…ç½®æ›´æ–°æ€§èƒ½é—®é¢˜

**æ ¸å¿ƒçŸ›ç›¾**:
- ğŸ“ **é…ç½®åºå¤§** - UnifiedDataConfigç»“æ„å¤æ‚
- ğŸ¯ **å˜åŒ–å¾®å°** - åªæ˜¯HTTPå‚æ•°ä¸­çš„ä¸€ä¸ªå€¼ï¼ˆå¦‚deviceIdï¼‰
- ğŸ”„ **å¤–éƒ¨é©±åŠ¨** - åŠ¨æ€å€¼è·Ÿéšç”¨æˆ·é€‰æ‹©å˜åŒ–
- âš¡ **æ•ˆç‡ç“¶é¢ˆ** - æ¯æ¬¡é‡æ–°ç”Ÿæˆæ•´ä¸ªé…ç½®æˆæœ¬é«˜

### åŸºäºç°æœ‰æ¶æ„çš„ä¼˜åŒ–æ–¹æ¡ˆ

**ç°æœ‰åŸºç¡€è®¾æ–½ä¼˜åŠ¿**:
- âœ… **DataWarehouse** - é¢„ç•™DynamicParameterStorageæ¥å£
- âœ… **ConfigEventBus** - å®Œæ•´é…ç½®å˜æ›´äº‹ä»¶ç³»ç»Ÿ  
- âœ… **ConfigurationManager** - é…ç½®æ¨¡æ¿å’ŒéªŒè¯åŸºç¡€

**ä¼˜åŒ–ç­–ç•¥**:
- ğŸ¯ **é…ç½®æ¨¡æ¿ä¸åŠ¨æ€å€¼åˆ†ç¦»** - æ¨¡æ¿ç¼“å­˜ï¼Œåªæ›´æ–°å˜åŒ–å€¼
- ğŸ”” **è®¢é˜…æœºåˆ¶** - ç›‘å¬åŠ¨æ€å‚æ•°å˜åŒ–ï¼Œè§¦å‘å¢é‡æ›´æ–°
- âš¡ **æ‰¹é‡å¤„ç†** - åˆå¹¶å¤šä¸ªå‚æ•°å˜åŒ–ï¼Œå‡å°‘æ›´æ–°æ¬¡æ•°

### æ€§èƒ½ä¼˜åŒ–æ¶æ„è®¾è®¡

#### æ‰©å±•ç°æœ‰æ¥å£

```typescript
// æ‰©å±•DataWarehouseçš„åŠ¨æ€å‚æ•°å­˜å‚¨
interface EnhancedDynamicParameterStorage extends DynamicParameterStorage {
  name: string
  value: any
  type: 'string' | 'number' | 'boolean' | 'object' | 'array'
  scope: 'global' | 'component' | 'session'
  // ğŸ†• è®¢é˜…åŠŸèƒ½
  subscribers: Set<(oldValue: any, newValue: any) => void>
  dependentConfigs: Set<string>
}

// æ‰©å±•ConfigEventBusäº‹ä»¶ç±»å‹
export type ConfigEventType = 
  | 'config-changed'
  | 'data-source-changed'
  | 'dynamic-parameter-changed'  // ğŸ†• æ–°å¢

// é…ç½®æ¨¡æ¿å˜æ›´äº‹ä»¶
interface ConfigTemplateChangeEvent extends ConfigChangeEvent {
  changeType: 'template' | 'dynamic-value'
  dynamicParameterName?: string
  templateId?: string
}
```

#### æ€§èƒ½ä¼˜åŒ–æ•ˆæœ

| ä¼ ç»Ÿæ–¹æ¡ˆ | ä¼˜åŒ–æ–¹æ¡ˆ | æ€§èƒ½æå‡ |
|---------|----------|----------|
| é‡æ–°ç”Ÿæˆæ•´ä¸ªé…ç½® | åªæ›´æ–°å˜åŒ–å€¼ | **10-100å€** |
| å…¨é‡é…ç½®å¯¹æ¯” | ç²¾ç¡®å­—æ®µæ›´æ–° | **5-20å€** |
| æ— å…³å˜åŒ–ä¹Ÿè§¦å‘ | åªè®¢é˜…ç›¸å…³å‚æ•° | **é¿å…90%æ— æ•ˆæ›´æ–°** |

### æ ¸å¿ƒæ¶æ„å¢å¼ºè¦ç‚¹

#### DataWarehouseè®¢é˜…æœºåˆ¶å¢å¼º

```typescript
class EnhancedDataWarehouse {
  /**
   * è®¢é˜…åŠ¨æ€å‚æ•°å˜åŒ–
   * @param parameterName å‚æ•°å
   * @param callback å˜åŒ–å›è°ƒ
   */
  subscribeDynamicParameter(
    parameterName: string, 
    callback: (oldValue: any, newValue: any) => void
  ): string {
    // è·å–æˆ–åˆ›å»ºåŠ¨æ€å‚æ•°å­˜å‚¨
    let param = this.parameterStorage.get(parameterName)
    if (!param) {
      param = {
        name: parameterName,
        value: undefined,
        type: 'string',
        scope: 'global',
        subscribers: new Set(),
        dependentConfigs: new Set()
      }
      this.parameterStorage.set(parameterName, param)
    }
    
    param.subscribers.add(callback)
    return `sub_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
  }
  
  /**
   * æ›´æ–°åŠ¨æ€å‚æ•°å€¼å¹¶è§¦å‘è®¢é˜…å›è°ƒ
   */
  updateDynamicParameter(parameterName: string, newValue: any): void {
    const param = this.parameterStorage.get(parameterName)
    if (!param) return
    
    const oldValue = param.value
    param.value = newValue
    
    // è§¦å‘æ‰€æœ‰è®¢é˜…è€…
    param.subscribers.forEach(callback => {
      try {
        callback(oldValue, newValue)
      } catch (error) {
        console.error(`åŠ¨æ€å‚æ•°å›è°ƒæ‰§è¡Œå¤±è´¥: ${parameterName}`, error)
      }
    })
  }
  
  /**
   * æ‰¹é‡è·å–åŠ¨æ€å‚æ•°å€¼
   */
  getDynamicParameters(parameterNames: string[]): Record<string, any> {
    const result: Record<string, any> = {}
    parameterNames.forEach(name => {
      const param = this.parameterStorage.get(name)
      result[name] = param ? param.value : undefined
    })
    return result
  }
}
```

#### ConfigurationManagerä¾èµ–åˆ†æå¢å¼º

```typescript
class ConfigurationManager {
  /**
   * åˆ†æé…ç½®æ¨¡æ¿çš„åŠ¨æ€å‚æ•°ä¾èµ–
   */
  analyzeDynamicDependencies(template: ConfigurationTemplate): string[] {
    const dependencies = new Set<string>()
    this.extractPlaceholders(template.configuration, dependencies)
    return Array.from(dependencies)
  }
  
  /**
   * é€’å½’æå–{{paramName}}å ä½ç¬¦
   */
  private extractPlaceholders(obj: any, dependencies: Set<string>): void {
    if (typeof obj === 'string') {
      const matches = obj.match(/\{\{([^}]+)\}\}/g)
      if (matches) {
        matches.forEach(match => {
          const paramName = match.replace(/[{}]/g, '')
          dependencies.add(paramName)
        })
      }
    } else if (Array.isArray(obj)) {
      obj.forEach(item => this.extractPlaceholders(item, dependencies))
    } else if (typeof obj === 'object' && obj !== null) {
      Object.values(obj).forEach(value => this.extractPlaceholders(value, dependencies))
    }
  }
}
```

### ä¼˜åŒ–å·¥ä½œæµç¨‹ç¤ºä¾‹

#### é…ç½®æ¨¡æ¿è®¾ç½®
```typescript
// ä½¿ç”¨å ä½ç¬¦çš„HTTPé…ç½®æ¨¡æ¿
const httpTemplate = {
  id: 'device-status-api',
  configuration: {
    dataSources: [{
      item: {
        type: 'http',
        config: {
          url: '/api/device/{{currentDeviceId}}/status',
          method: 'GET',
          headers: [
            {key: 'Authorization', value: '{{authToken}}', isDynamic: true, variableName: 'authToken'},
            {key: 'Content-Type', value: 'application/json', isDynamic: false}
          ]
        }
      }
    }]
  }
}

// åˆ†æåŠ¨æ€å‚æ•°ä¾èµ–
const dependencies = configManager.analyzeDynamicDependencies(httpTemplate)
// ç»“æœ: ['currentDeviceId', 'authToken']
```

#### å»ºç«‹è®¢é˜…å…³ç³»
```typescript
// è®¢é˜…åŠ¨æ€å‚æ•°å˜åŒ–
dependencies.forEach(paramName => {
  dataWarehouse.subscribeDynamicParameter(paramName, (oldValue, newValue) => {
    // è§¦å‘é…ç½®æ›´æ–°äº‹ä»¶
    configEventBus.emitConfigChange({
      componentId: 'device-status-component',
      section: 'dataSource',
      changeType: 'dynamic-value',
      dynamicParameterName: paramName,
      oldConfig: { [paramName]: oldValue },
      newConfig: { [paramName]: newValue }
    })
  })
})
```

#### å¢é‡æ›´æ–°å¤„ç†
```typescript
// å¤„ç†åŠ¨æ€å‚æ•°å˜åŒ–
configEventBus.onConfigChange('dynamic-parameter-changed', async (event) => {
  // 1. è·å–æ¨¡æ¿ï¼ˆç¼“å­˜ï¼‰
  const template = configManager.getTemplate('device-status-api')
  
  // 2. æ‰¹é‡è·å–å½“å‰æ‰€æœ‰åŠ¨æ€å€¼
  const currentValues = dataWarehouse.getDynamicParameters(dependencies)
  
  // 3. åˆå¹¶ç”Ÿæˆé™æ€é…ç½®
  const staticConfig = mergeTemplateWithValues(template, currentValues)
  
  // 4. æ‰§è¡ŒHTTPè¯·æ±‚ï¼ˆé…ç½®å·²é™æ€åŒ–ï¼‰
  const executor = new EnhancedHttpExecutor()
  const result = await executor.execute(staticConfig)
  
  // 5. å­˜å‚¨ç»“æœ
  dataWarehouse.storeComponentData('device-status-component', result.data)
})
```

#### å¤–éƒ¨è§¦å‘æ›´æ–°
```typescript
// ç”¨æˆ·é€‰æ‹©è®¾å¤‡æ—¶
function onDeviceChange(deviceId: string) {
  // åªéœ€æ›´æ–°ä¸€ä¸ªå‚æ•°ï¼Œè‡ªåŠ¨è§¦å‘æ•´ä¸ªé“¾å¼ååº”
  dataWarehouse.updateDynamicParameter('currentDeviceId', deviceId)
}

// é“¾å¼ååº”: å‚æ•°æ›´æ–° â†’ è®¢é˜…å›è°ƒ â†’ äº‹ä»¶å‘é€ â†’ å¢é‡åˆå¹¶ â†’ æ‰§è¡Œå™¨è°ƒç”¨ â†’ ç»“æœå­˜å‚¨
```

### æ€§èƒ½ä¼˜åŠ¿å¯¹æ¯”

**ä¼ ç»Ÿæ–¹æ¡ˆ**:
```typescript
// âŒ é‡æ–°ç”Ÿæˆæ•´ä¸ªé…ç½®ï¼ˆè€—æ—¶ï¼‰
function traditionalUpdate(deviceId: string) {
  const bigConfig = generateEntireConfig(deviceId)
  executor.execute(bigConfig)
}
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```typescript
// âœ… åªæ›´æ–°å˜åŒ–å‚æ•°ï¼ˆé«˜æ•ˆï¼‰
function optimizedUpdate(deviceId: string) {
  dataWarehouse.updateDynamicParameter('currentDeviceId', deviceId)
  // è®¢é˜…æœºåˆ¶è‡ªåŠ¨å¤„ç†åç»­æµç¨‹
}
```

**æ ¸å¿ƒä¼˜åŠ¿**:
- ğŸ¯ **ç²¾ç¡®æ›´æ–°** - åªå¤„ç†å˜åŒ–çš„åŠ¨æ€å‚æ•°
- ğŸ—ï¸ **æ¶æ„å¤ç”¨** - åˆ©ç”¨ç°æœ‰DataWarehouseã€ConfigEventBusã€ConfigurationManager
- âš¡ **é«˜æ€§èƒ½** - æ¨¡æ¿ç¼“å­˜ã€æ‰¹é‡è·å–ã€å¢é‡åˆå¹¶
- ğŸ”§ **ä½ä¾µå…¥** - åŸºäºé¢„ç•™æ¥å£æ‰©å±•ï¼Œä¸ç ´åç°æœ‰åŠŸèƒ½

## ğŸ“‹ å®æ–½è®¡åˆ’

### å·²å®Œæˆéƒ¨åˆ†

#### ç±»å‹ç³»ç»Ÿæ‰©å±• âœ…

**æ›´æ–°ä½ç½®**: `src/core/data-architecture/types/enhanced-types.ts`

1. **HttpHeaderæ¥å£æ‰©å±•å®Œæˆ**:
```typescript
export interface HttpHeader {
  key: string
  value: string                    // é™æ€æ—¶ä¸ºå®é™…å€¼ï¼ŒåŠ¨æ€æ—¶ä¸ºç¤ºä¾‹å€¼
  enabled: boolean
  isDynamic: boolean              // æ”¹ä¸ºå¿…å¡«
  dataType: 'string' | 'number' | 'boolean' | 'json'  // ğŸ†• æ–°å¢
  variableName: string            // ğŸ†• è‡ªåŠ¨ç”Ÿæˆï¼ˆæ ¼å¼ï¼šhttp_${key}ï¼‰
  description?: string            // ğŸ†• å‚æ•°è¯´æ˜
}
```

2. **HttpParamæ¥å£æ‰©å±•å®Œæˆ**:
```typescript  
export interface HttpParam {
  key: string
  value: string                    
  enabled: boolean
  isDynamic: boolean              
  dataType: 'string' | 'number' | 'boolean' | 'json'  
  variableName: string            
  description?: string            
}
```

3. **UnifiedDataExecutor.tsé›†æˆå®Œæˆ**:
   - âœ… åˆ é™¤é‡å¤çš„HttpParamå®šä¹‰
   - âœ… å¯¼å…¥æ­£ç¡®çš„ç±»å‹
   - âœ… æ›´æ–°HTTPé…ç½®ä½¿ç”¨æ•°ç»„ç±»å‹

### å¾…å®æ–½ä»»åŠ¡

#### é˜¶æ®µ1: HttpExecutorå¢å¼º (2å¤©)
- [ ] ParameterTransformerå®ç°
- [ ] preRequestScriptè„šæœ¬é›†æˆ
- [ ] postResponseScriptè„šæœ¬é›†æˆ
- [ ] å‘ä¸‹å…¼å®¹æ”¯æŒ

#### é˜¶æ®µ2: æ€§èƒ½ä¼˜åŒ– (2å¤©)
- [ ] DataWarehouseè®¢é˜…æœºåˆ¶æ‰©å±•
- [ ] ConfigEventBusåŠ¨æ€å‚æ•°äº‹ä»¶æ”¯æŒ
- [ ] ConfigurationManagerä¾èµ–åˆ†æåŠŸèƒ½
- [ ] å¢é‡æ›´æ–°å·¥ä½œæµç¨‹

#### é˜¶æ®µ3: ç³»ç»Ÿé›†æˆæµ‹è¯• (1å¤©)
- [ ] ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–éªŒè¯
- [ ] æ–‡æ¡£æ›´æ–°

## ğŸ“± HTTPé…ç½®UIè¡¨å•è®¾è®¡

### UIè®¾è®¡æ¦‚è¿°

**æ ¸å¿ƒç›®æ ‡**: ä¸ºHTTPæ•°æ®æºé…ç½®è®¾è®¡ç”¨æˆ·å‹å¥½çš„å¯è§†åŒ–è¡¨å•ï¼Œæ”¯æŒåŠ¨æ€å‚æ•°ã€è„šæœ¬å¤„ç†å’Œå®æ—¶é¢„è§ˆ

**è®¾è®¡çº¦æŸ**:
- é›†æˆåˆ°ç°æœ‰ConfigurationPanelçš„dataSourceæ ‡ç­¾é¡µ
- å³ä¾§é¢æ¿ç©ºé—´é™åˆ¶ï¼ˆ300-400pxå®½åº¦ï¼‰
- éµå¾ªNaive UIè®¾è®¡è§„èŒƒå’Œä¸»é¢˜ç³»ç»Ÿ

### 5ä¸ªå­æ ‡ç­¾é¡µæ¶æ„

åŸºäºæŠ€æœ¯æ¶æ„ï¼ŒHTTPé…ç½®åˆ†ä¸º5ä¸ªåŠŸèƒ½æ¨¡å—ï¼š

```
dataSource æ ‡ç­¾é¡µ
â”œâ”€â”€ HTTPé…ç½®è¡¨å• (HttpDataSourceConfigForm.vue)
    â”œâ”€â”€ 1ï¸âƒ£ åŸºç¡€ (HttpBasicConfig.vue)
    â”‚   â”œâ”€â”€ URLé…ç½®ï¼ˆæ”¯æŒ{{å˜é‡}}å ä½ç¬¦ï¼‰
    â”‚   â”œâ”€â”€ HTTPæ–¹æ³•é€‰æ‹©
    â”‚   â”œâ”€â”€ è¶…æ—¶è®¾ç½®
    â”‚   â””â”€â”€ è¯·æ±‚ä½“é…ç½®ï¼ˆPOST/PUTæ˜¾ç¤ºï¼‰
    â”œâ”€â”€ 2ï¸âƒ£ è¯·æ±‚å¤´ (HttpHeadersConfig.vue)
    â”‚   â”œâ”€â”€ åŠ¨æ€åˆ—è¡¨ç®¡ç†
    â”‚   â”œâ”€â”€ é™æ€/åŠ¨æ€å‚æ•°åˆ‡æ¢
    â”‚   â”œâ”€â”€ æ•°æ®ç±»å‹é…ç½®
    â”‚   â””â”€â”€ å¸¸ç”¨è¯·æ±‚å¤´æ¨¡æ¿
    â”œâ”€â”€ 3ï¸âƒ£ å‚æ•° (HttpParamsConfig.vue)
    â”‚   â”œâ”€â”€ æŸ¥è¯¢å‚æ•° (?key=value)
    â”‚   â”œâ”€â”€ è·¯å¾„å‚æ•° (/api/{id})
    â”‚   â””â”€â”€ åŠ¨æ€å‚æ•°é…ç½®
    â”œâ”€â”€ 4ï¸âƒ£ è¯·æ±‚è„šæœ¬ (HttpRequestScriptConfig.vue)
    â”‚   â”œâ”€â”€ preRequestScriptç¼–è¾‘å™¨
    â”‚   â”œâ”€â”€ è„šæœ¬ç¤ºä¾‹å’Œæ¨¡æ¿
    â”‚   â””â”€â”€ è¯­æ³•é«˜äº®å’ŒéªŒè¯
    â””â”€â”€ 5ï¸âƒ£ å“åº”è„šæœ¬ (HttpResponseScriptConfig.vue)
        â”œâ”€â”€ postResponseScriptç¼–è¾‘å™¨
        â”œâ”€â”€ è„šæœ¬æµ‹è¯•åŠŸèƒ½
        â””â”€â”€ å“åº”é¢„è§ˆ
```

### å…³é”®UIè®¾è®¡è¦ç‚¹

#### 1. ç©ºé—´ä¼˜åŒ–è®¾è®¡

**å‚ç›´å¸ƒå±€ç­–ç•¥**:
- æ¯ä¸ªå­æ ‡ç­¾é¡µé«˜åº¦200-550px
- æ”¯æŒå‚ç›´æ»šåŠ¨
- ç´§å‡‘è¡¨å•æ ·å¼ï¼Œlabelä¸Šç½®
- åŠ¨æ€é«˜åº¦é€‚é…å†…å®¹

#### 2. åŠ¨æ€å‚æ•°äº¤äº’

**é™æ€/åŠ¨æ€åˆ‡æ¢**:
```vue
<!-- åŠ¨æ€å‚æ•°å¼€å…³è®¾è®¡ -->
<n-button 
  size="small"
  :type="header.isDynamic ? 'primary' : 'default'"
  @click="toggleDynamic(header)"
  style="width: 60px;"
>
  {{header.isDynamic ? 'åŠ¨æ€' : 'é™æ€'}}
</n-button>

<!-- åŠ¨æ€å‚æ•°é…ç½®å±•å¼€åŒºåŸŸ -->
<div v-if="header.isDynamic" class="dynamic-config">
  <n-space size="small">
    <n-select
      v-model:value="header.dataType"
      :options="dataTypeOptions"
      style="width: 100px;"
    />
    <n-input
      v-model:value="header.description"
      placeholder="å‚æ•°æè¿°"
      style="flex: 1;"
    />
  </n-space>
</div>
```

#### 3. è„šæœ¬ç¼–è¾‘å™¨é›†æˆ

**å¢å¼ºåŠŸèƒ½**:
- è¯­æ³•é«˜äº®ï¼ˆJavaScriptï¼‰
- ä»£ç ç¤ºä¾‹ä¸€é”®æ’å…¥
- è„šæœ¬æµ‹è¯•å’ŒéªŒè¯
- é”™è¯¯æç¤ºå‹å¥½æ˜¾ç¤º

```vue
<template>
  <div class="script-editor-container">
    <SimpleScriptEditor
      v-model:value="script"
      :height="200"
      language="javascript"
      :placeholder="scriptTemplate"
    />
    
    <!-- ç¤ºä¾‹ä»£ç æŠ˜å é¢æ¿ -->
    <n-collapse size="small" class="script-examples">
      <n-collapse-item title="å¸¸ç”¨ç¤ºä¾‹">
        <div v-for="example in scriptExamples" class="example-item">
          <div class="example-header">
            <span>{{ example.title }}</span>
            <n-button size="tiny" @click="insertExample(example.code)">
              æ’å…¥
            </n-button>
          </div>
          <n-code :code="example.code" language="javascript" />
        </div>
      </n-collapse-item>
    </n-collapse>
  </div>
</template>
```

#### 4. æ•°æ®ç»“æ„è®¾è®¡

**å®Œæ•´HTTPé…ç½®æ•°æ®ç»“æ„**:
```typescript
interface HttpDataSourceConfig {
  // åŸºç¡€é…ç½®
  url: string
  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH'
  timeout: number
  body?: string

  // è¯·æ±‚å¤´é…ç½®ï¼ˆä¸æŠ€æœ¯æ¶æ„ä¸€è‡´ï¼‰
  headers: HttpHeader[]

  // å‚æ•°é…ç½®  
  params: HttpParam[]

  // è„šæœ¬é…ç½®
  preRequestScript?: string
  postResponseScript?: string
}
```

### ConfigurationPanelé›†æˆæ–¹æ¡ˆ

**æ— ç¼é›†æˆç°æœ‰ç³»ç»Ÿ**:

```typescript
// ConfigurationPanel.vue æ•°æ®æºæ ‡ç­¾é¡µ
<template v-else-if="layer.name === 'dataSource'">
  <!-- æ£€æµ‹HTTPé…ç½®ç±»å‹ -->
  <HttpDataSourceConfigForm
    v-if="isHttpDataSource"
    v-model="dataSourceConfig"
    :data-sources="componentDataSources"
    :selected-widget-id="selectedWidget?.id"
    :component-id="selectedWidget?.id"
    :component-type="selectedWidget?.type"
    @request-current-data="handleCurrentDataRequest"
  />
  
  <!-- åŸæœ‰æ•°æ®æºé…ç½®ç»„ä»¶ -->
  <component v-else :is="layer.component" ... />
</template>
```

### äº¤äº’ä½“éªŒä¼˜åŒ–

#### æ™ºèƒ½åŒ–åŠŸèƒ½
- **å¸¸ç”¨è¯·æ±‚å¤´æ¨¡æ¿**: Authorizationã€Content-Typeã€Acceptç­‰
- **URLæ ¼å¼éªŒè¯**: å®æ—¶æ£€æŸ¥URLæœ‰æ•ˆæ€§
- **åŠ¨æ€å‚æ•°åç§°ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆhttp_${key}æ ¼å¼
- **è„šæœ¬è¯­æ³•æ£€æŸ¥**: JavaScriptè¯­æ³•å®æ—¶éªŒè¯
- **é…ç½®é¢„è§ˆ**: å®æ—¶æ˜¾ç¤ºæœ€ç»ˆHTTPè¯·æ±‚é…ç½®

#### å“åº”å¼é€‚é…
```css
/* ç´§å‡‘ç©ºé—´ä¼˜åŒ– */
.http-config-container {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.http-config-tabs {
  flex: 1;
  overflow: hidden;
}

.http-config-tabs :deep(.n-tabs-content) {
  height: calc(100% - 36px);
  overflow-y: auto;
  padding: 8px;
}

/* åŠ¨æ€å‚æ•°è§†è§‰æŒ‡ç¤º */
.dynamic-indicator::after {
  content: '{{}}';
  color: var(--primary-color);
  font-size: 10px;
}
```

### å®æ–½ä¼˜å…ˆçº§æ•´åˆ

#### Phase 1: åŸºç¡€æ¡†æ¶ (1å¤©)
- HttpDataSourceConfigForm.vue ä¸»ç»„ä»¶
- HttpBasicConfig.vue åŸºç¡€é…ç½®
- ConfigurationPanelé›†æˆç‚¹

#### Phase 2: åŠ¨æ€å‚æ•°ç³»ç»Ÿ (1.5å¤©)
- HttpHeadersConfig.vue è¯·æ±‚å¤´é…ç½®
- HttpParamsConfig.vue å‚æ•°é…ç½®
- é™æ€/åŠ¨æ€åˆ‡æ¢é€»è¾‘

#### Phase 3: è„šæœ¬ç¼–è¾‘å™¨ (1å¤©)
- HttpRequestScriptConfig.vue è¯·æ±‚è„šæœ¬
- HttpResponseScriptConfig.vue å“åº”è„šæœ¬
- è„šæœ¬æµ‹è¯•å’ŒéªŒè¯

#### Phase 4: é›†æˆä¼˜åŒ– (0.5å¤©)
- é…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†
- UIä¼˜åŒ–å’Œå“åº”å¼è°ƒæ•´
- ä¸HttpExecutoræ•°æ®äº¤äº’æµ‹è¯•

### è´¨é‡ä¿è¯

**æµ‹è¯•ç­–ç•¥**:
- **åŠŸèƒ½æµ‹è¯•**: HTTPé…ç½®åœºæ™¯ã€åŠ¨æ€å‚æ•°è§£æã€è„šæœ¬æ‰§è¡Œ
- **UIæµ‹è¯•**: å“åº”å¼å¸ƒå±€ã€ä¸»é¢˜é€‚é…ã€ç”¨æˆ·äº¤äº’æµç¨‹
- **é›†æˆæµ‹è¯•**: ConfigurationPanelé›†æˆã€æ•°æ®æŒä¹…åŒ–ã€æ‰§è¡Œå™¨å¯¹æ¥

### äº¤ä»˜æ¸…å•

**æ ¸å¿ƒç»„ä»¶** (6ä¸ª):
- HttpDataSourceConfigForm.vue (ä¸»ç»„ä»¶)
- HttpBasicConfig.vue (åŸºç¡€é…ç½®)
- HttpHeadersConfig.vue (è¯·æ±‚å¤´)
- HttpParamsConfig.vue (å‚æ•°)
- HttpRequestScriptConfig.vue (è¯·æ±‚è„šæœ¬)
- HttpResponseScriptConfig.vue (å“åº”è„šæœ¬)

**æ”¯æŒæ–‡ä»¶**:
- http-config-utils.ts (å·¥å…·å‡½æ•°)
- http-config-templates.ts (æ¨¡æ¿å’Œç¤ºä¾‹)
- http-config-validators.ts (éªŒè¯è§„åˆ™)
- http-config-styles.css (ä¸“ç”¨æ ·å¼)

---

## ğŸ“‹ è¯¦ç»†å¼€å‘è®¡åˆ’

### åˆ†é˜¶æ®µå®æ–½æ–¹æ¡ˆ

| é˜¶æ®µ | å†…å®¹ | é¢„ä¼°æ—¶é—´ | çŠ¶æ€ | å…³é”®äº¤ä»˜ç‰© |
|------|------|---------|------|-----------|
| **Phase 1** | ç±»å‹ç³»ç»Ÿæ‰©å±• + HttpExecutorå¢å¼º | 3å¤© | â³ | å¢å¼ºçš„HTTPæ‰§è¡Œå™¨ |
| **Phase 2** | æ€§èƒ½ä¼˜åŒ–æœºåˆ¶å®ç° | 2å¤© | â³ | è®¢é˜…å¼åŠ¨æ€å‚æ•°ç³»ç»Ÿ |
| **Phase 3** | UIè¡¨å•ç»„ä»¶å¼€å‘ | 3å¤© | â³ | 5æ ‡ç­¾é¡µHTTPé…ç½®ç•Œé¢ |
| **Phase 4** | Card2.1æ˜ å°„ç³»ç»Ÿé›†æˆ | 2å¤© | â³ | åŒç›²æ˜ å°„ç»„ä»¶ |
| **Phase 5** | ç³»ç»Ÿé›†æˆæµ‹è¯• + ä¼˜åŒ– | 1å¤© | â³ | å®Œæ•´å¯ç”¨ç³»ç»Ÿ |
| **æ€»è®¡** | **å®Œæ•´HTTPé…ç½®ç³»ç»Ÿ** | **11å¤©** | | **ç”Ÿäº§å°±ç»ªç³»ç»Ÿ** |

### ğŸ“‹ ä¸‹ä¸€æ­¥è¡ŒåŠ¨é¡¹

#### ç«‹å³å¯å¼€å§‹çš„ä»»åŠ¡
1. **ç±»å‹ç³»ç»Ÿæ‰©å±•** - ä¿®æ”¹ `src/core/data-architecture/types/enhanced-types.ts`
2. **HttpExecutorå¢å¼º** - å®ç° ParameterTransformer å’Œè„šæœ¬å¤„ç†ç³»ç»Ÿ
3. **UIç»„ä»¶å¼€å‘** - åˆ›å»º 5 ä¸ªå­æ ‡ç­¾é¡µç»„ä»¶

#### ä¾èµ–æ€§ä»»åŠ¡
1. **æ€§èƒ½ä¼˜åŒ–** - éœ€è¦ HttpExecutor åŸºç¡€å®Œæˆåå¼€å§‹
2. **Card2.1é›†æˆ** - éœ€è¦ç±»å‹ç³»ç»Ÿå’ŒUIç»„ä»¶å®Œæˆåå¼€å§‹
3. **ç«¯åˆ°ç«¯æµ‹è¯•** - éœ€è¦æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å®Œæˆåå¼€å§‹

#### å…³é”®å†³ç­–ç‚¹
- **Day 3**: HttpExecutor æ˜¯å¦æ»¡è¶³è„šæœ¬æ‰§è¡Œéœ€æ±‚ï¼Ÿ
- **Day 8**: UI é…ç½®ç•Œé¢æ˜¯å¦æ»¡è¶³ç”¨æˆ·ä½“éªŒè¦æ±‚ï¼Ÿ  
- **Day 10**: Card2.1 æ˜ å°„æ˜¯å¦èƒ½æ­£ç¡®å“åº”å±æ€§å˜åŒ–ï¼Ÿ

## ğŸ”— Card2.1æ¶æ„é›†æˆï¼šç»„ä»¶å±æ€§æ˜ å°„æ”¯æŒ

### Card2.1ç»„ä»¶ç³»ç»Ÿè°ƒæ•´

ä¸ºäº†æ”¯æŒæ˜ å°„ç»„ä»¶æ–¹æ¡ˆï¼Œéœ€è¦å¯¹ç°æœ‰Card2.1ç»„ä»¶ç³»ç»Ÿè¿›è¡Œä»¥ä¸‹æ‰©å±•ï¼š

#### 1. ComponentDefinitionæ¥å£æ‰©å±•

```typescript
// åœ¨ src/card2.1/core/types.ts ä¸­æ‰©å±•
export interface ComponentDefinition {
  // ... ç°æœ‰å±æ€§ ...
  
  // ğŸ†• HTTPå‚æ•°æ˜ å°„æ”¯æŒ
  httpParameterMapping?: {
    /** å£°æ˜ç»„ä»¶å“ªäº›å±æ€§å¯ä»¥ç”¨äºHTTPå‚æ•°æ˜ å°„ */
    mappableProperties: Array<{
      propertyName: string      // å±æ€§åç§° (å¦‚: deviceId)
      propertyPath: string      // å±æ€§è·¯å¾„ (å¦‚: config.deviceId)
      dataType: 'string' | 'number' | 'boolean' | 'object'
      displayName: string       // æ˜¾ç¤ºåç§° (å¦‚: "è®¾å¤‡ID")
      description?: string      // å±æ€§è¯´æ˜
      mappingHint?: string      // æ˜ å°„æç¤º (å¦‚: "ç”¨äºAPIè¯·æ±‚ä¸­çš„è®¾å¤‡æ ‡è¯†")
      isRecommended?: boolean   // æ˜¯å¦æ¨èæ˜ å°„
      group?: string            // å±æ€§åˆ†ç»„
    }>
    
    /** æ˜ å°„èƒ½åŠ›å£°æ˜ */
    capability?: {
      supportAutoMapping: boolean        // æ˜¯å¦æ”¯æŒè‡ªåŠ¨æ˜ å°„
      maxMappingCount: number           // æœ€å¤§æ˜ å°„æ•°é‡é™åˆ¶
      supportedMappingTypes: Array<'direct' | 'computed' | 'template'>
    }
  }
}
```

#### 2. å±æ€§æš´éœ²ç³»ç»Ÿå¢å¼º

```typescript
// åœ¨ src/card2.1/core/property-exposure.ts ä¸­æ‰©å±•
export interface ListenableProperty {
  // ... ç°æœ‰å±æ€§ ...
  
  // ğŸ†• HTTPæ˜ å°„æ”¯æŒæ ‡è®°
  httpMappingSupported?: boolean        // æ˜¯å¦æ”¯æŒHTTPå‚æ•°æ˜ å°„
  httpMappingType?: 'url' | 'header' | 'query' | 'body'  // å»ºè®®æ˜ å°„åˆ°çš„HTTPéƒ¨åˆ†
  httpMappingHint?: string             // æ˜ å°„æç¤ºæ–‡æœ¬
  httpMappingPriority?: number         // æ˜ å°„ä¼˜å…ˆçº§ (1-10, æ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜)
}

// ğŸ†• HTTPå‚æ•°æ˜ å°„ä¸“ç”¨å±æ€§æ¨¡æ¿
export const HttpMappingProperties = {
  deviceId: createProperty('deviceId', 'è®¾å¤‡ID', 'string', {
    description: 'è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ç¬¦',
    isCore: true,
    group: 'è®¾å¤‡',
    httpMappingSupported: true,
    httpMappingType: 'url',
    httpMappingHint: 'é€šå¸¸æ˜ å°„åˆ°API URLä¸­çš„{deviceId}å‚æ•°',
    httpMappingPriority: 9,
    example: 'device_001'
  }),

  apiKey: createProperty('apiKey', 'APIå¯†é’¥', 'string', {
    description: 'APIè®¿é—®å¯†é’¥',
    group: 'è®¤è¯',
    httpMappingSupported: true,
    httpMappingType: 'header',
    httpMappingHint: 'æ˜ å°„åˆ°Authorizationå¤´éƒ¨',
    httpMappingPriority: 8,
    example: 'sk-abc123...'
  }),

  tenantId: createProperty('tenantId', 'ç§Ÿæˆ·ID', 'string', {
    description: 'å¤šç§Ÿæˆ·ç¯å¢ƒä¸‹çš„ç§Ÿæˆ·æ ‡è¯†',
    group: 'ç§Ÿæˆ·',
    httpMappingSupported: true,
    httpMappingType: 'query',
    httpMappingHint: 'æ˜ å°„åˆ°æŸ¥è¯¢å‚æ•°tenant',
    httpMappingPriority: 7,
    example: 'tenant_001'
  })
}
```

#### 3. HTTPå‚æ•°æ˜ å°„æ³¨å†Œç³»ç»Ÿ

```typescript
// æ–°æ–‡ä»¶: src/card2.1/core/http-parameter-mapping.ts

// HTTPå‚æ•°å£°æ˜
export interface HttpParameterDeclaration {
  parameterName: string          // HTTPå‚æ•°å
  parameterType: 'url' | 'header' | 'query' | 'body'
  dataType: 'string' | 'number' | 'boolean' | 'json'
  displayName: string           // ç”¨æˆ·å¯è§çš„å‚æ•°åç§°
  description?: string          // å‚æ•°è¯´æ˜
  isDynamic: boolean           // æ˜¯å¦éœ€è¦åŠ¨æ€æ˜ å°„
  defaultValue?: any           // é»˜è®¤å€¼
  placeholder?: string         // å ä½ç¬¦ç¤ºä¾‹ (å¦‚: {{deviceId}})
}

class HttpParameterMappingRegistry {
  // HTTPæ•°æ®æºå‚æ•°å£°æ˜æ³¨å†Œè¡¨
  private httpDataSourceRegistry = new Map<string, HttpDataSourceMappingDeclaration>()
  
  // æ˜ å°„å…³ç³»å­˜å‚¨
  private mappingRelationships = new Map<string, ComponentHttpParameterMapping>()

  /**
   * è·å–ç»„ä»¶å¯æ˜ å°„çš„å±æ€§åˆ—è¡¨
   * ç›´æ¥ä»property-exposureç³»ç»Ÿè·å–æ”¯æŒHTTPæ˜ å°„çš„å±æ€§
   */
  getComponentMappableProperties(componentId: string, componentType: string) {
    const allProperties = propertyExposureRegistry.getListenableProperties(componentType)
    
    // ç­›é€‰æ”¯æŒHTTPæ˜ å°„çš„å±æ€§
    const mappableProperties = allProperties.filter(prop => 
      prop.httpMappingSupported === true
    )

    // æŒ‰ä¼˜å…ˆçº§æ’åº
    mappableProperties.sort((a, b) => 
      (b.httpMappingPriority || 0) - (a.httpMappingPriority || 0)
    )

    return mappableProperties.map(prop => ({
      propertyName: prop.name,
      propertyPath: prop.name,
      displayName: prop.label,
      description: prop.description,
      dataType: prop.type,
      mappingHint: prop.httpMappingHint,
      isRecommended: (prop.httpMappingPriority || 0) >= 8,
      group: prop.group
    }))
  }

  /**
   * åˆ›å»ºæ˜ å°„å…³ç³»
   */
  createMapping(
    componentId: string,
    componentProperty: string,
    dataSourceKey: string,
    httpParameter: string,
    mappingType: 'direct' | 'computed' | 'template' = 'direct'
  ) {
    // åˆ›å»ºæ˜ å°„å…³ç³»å¹¶å»ºç«‹å“åº”å¼ç»‘å®š
    // é›†æˆå‰é¢è®¾è®¡çš„ParameterMappingCoordinatoré€»è¾‘
  }

  /**
   * è·å–ç»„ä»¶çš„å®Œæ•´æ˜ å°„é…ç½® (ä¾›æ˜ å°„UIä½¿ç”¨)
   */
  getComponentMappingConfiguration(componentId: string, componentType: string) {
    return {
      // ç»„ä»¶å¯æ˜ å°„å±æ€§
      mappableProperties: this.getComponentMappableProperties(componentId, componentType),
      
      // HTTPæ•°æ®æºå¯æ˜ å°„å‚æ•°  
      httpParameters: this.getHttpDataSourceMappableParameters(componentId),
      
      // å½“å‰æ˜ å°„å…³ç³»
      currentMappings: this.mappingRelationships.get(componentId),
      
      // HTTPé…ç½®ä¿¡æ¯
      httpDataSource: this.httpDataSourceRegistry.get(componentId)
    }
  }
}

// åˆ›å»ºå…¨å±€å®ä¾‹
export const httpParameterMappingRegistry = new HttpParameterMappingRegistry()
```

#### 4. ç»„ä»¶å®šä¹‰ç¤ºä¾‹æ”¹é€ 

```typescript
// æ”¹é€ ç¤ºä¾‹: dual-data-displayç»„ä»¶å®šä¹‰
const dualDataDisplayDefinition: ComponentDefinition = {
  // ... ç°æœ‰å±æ€§ ...

  // ğŸ†• HTTPå‚æ•°æ˜ å°„æ”¯æŒ
  httpParameterMapping: {
    mappableProperties: [
      {
        propertyName: 'deviceId',
        propertyPath: 'config.deviceId',
        dataType: 'string',
        displayName: 'è®¾å¤‡ID',
        description: 'å½“å‰ç»„ä»¶ç›‘æ§çš„è®¾å¤‡æ ‡è¯†ç¬¦',
        mappingHint: 'æ˜ å°„åˆ°HTTPè¯·æ±‚URLä¸­çš„è®¾å¤‡IDå‚æ•°',
        isRecommended: true,
        group: 'è®¾å¤‡'
      },
      {
        propertyName: 'apiKey',
        propertyPath: 'config.apiKey',
        dataType: 'string', 
        displayName: 'APIå¯†é’¥',
        description: 'è®¿é—®è®¾å¤‡APIçš„è®¤è¯å¯†é’¥',
        mappingHint: 'æ˜ å°„åˆ°Authorizationè¯·æ±‚å¤´',
        isRecommended: true,
        group: 'è®¤è¯'
      }
    ],

    capability: {
      supportAutoMapping: true,
      maxMappingCount: 10,
      supportedMappingTypes: ['direct', 'template']
    }
  },

  // æ‰©å±•ç°æœ‰çš„å±æ€§æš´éœ²é…ç½®ï¼Œæ·»åŠ HTTPæ˜ å°„æ ‡è®°
  interaction: {
    propertyExposure: {
      componentType: 'dual-data-display',
      componentName: 'åŒæ•°æ®æºæ˜¾ç¤ºç»„ä»¶',
      listenableProperties: [
        {
          name: 'config.deviceId',
          label: 'è®¾å¤‡ID',
          type: 'string',
          description: 'è®¾å¤‡æ ‡è¯†ç¬¦',
          group: 'è®¾å¤‡',
          defaultValue: 'device_001',
          // ğŸ†• HTTPæ˜ å°„æ”¯æŒ
          httpMappingSupported: true,
          httpMappingType: 'url',
          httpMappingHint: 'æ˜ å°„åˆ°APIè·¯å¾„å‚æ•°',
          httpMappingPriority: 9
        }
      ]
    }
  }
}
```

### Card2.1é›†æˆä¼˜åŠ¿

1. **å¤ç”¨ç°æœ‰ç³»ç»Ÿ** - æ‰©å±•ç°æœ‰ `property-exposure` ç³»ç»Ÿï¼Œä¸é‡æ–°å‘æ˜è½®å­
2. **æ¸è¿›å¼å¢å¼º** - å¯¹ç°æœ‰ `ComponentDefinition` è¿›è¡Œæ‰©å±•ï¼Œä¿æŒå‘åå…¼å®¹  
3. **æ ‡å‡†åŒ–æ¥å£** - ä½¿ç”¨ç»Ÿä¸€çš„æ³¨å†Œå’ŒæŸ¥è¯¢æ¥å£ï¼Œå‡å°‘å­¦ä¹ æˆæœ¬
4. **è‡ªåŠ¨åŒ–æ³¨å†Œ** - ä»ç»„ä»¶å®šä¹‰ä¸­è‡ªåŠ¨æå–æ˜ å°„ä¿¡æ¯ï¼Œå‡å°‘æ‰‹åŠ¨é…ç½®
5. **é™ä½å¤æ‚åº¦** - é€šè¿‡æ ‡å‡†åŒ–çš„å±æ€§å£°æ˜å’Œæ˜ å°„æœºåˆ¶ï¼Œç®€åŒ–å¼€å‘æµç¨‹

### åŒç›²æ˜ å°„å·¥ä½œæµç¨‹

1. **ç»„ä»¶ä¾§å£°æ˜** - ç»„ä»¶é€šè¿‡ `httpParameterMapping.mappableProperties` å£°æ˜å¯æ˜ å°„å±æ€§
2. **æ•°æ®æºä¾§å£°æ˜** - HTTPæ•°æ®æºé€šè¿‡å‚æ•°é…ç½®å£°æ˜éœ€è¦æ˜ å°„çš„åŠ¨æ€å‚æ•°  
3. **æ˜ å°„UIè¿æ¥** - ç”¨æˆ·åœ¨æ˜ å°„ç•Œé¢ä¸­å»ºç«‹å±æ€§ä¸å‚æ•°çš„è¿æ¥å…³ç³»
4. **å“åº”å¼ç»‘å®š** - ç³»ç»Ÿè‡ªåŠ¨å»ºç«‹å±æ€§å˜åŒ–çš„ç›‘å¬å’ŒHTTPé…ç½®æ›´æ–°æœºåˆ¶
5. **å®ä¾‹çº§éš”ç¦»** - é€šè¿‡ç»„ä»¶IDç¡®ä¿ä¸åŒå®ä¾‹çš„æ˜ å°„é…ç½®å®Œå…¨ç‹¬ç«‹

---

---

## ğŸ“Š å®Œæ•´å®æ–½è®¡åˆ’æ€»è§ˆ

| é˜¶æ®µ | å†…å®¹ | é¢„ä¼°æ—¶é—´ | ä¾èµ–å…³ç³» | äº¤ä»˜ç‰© |
|------|------|---------|----------|--------|
| **Phase 1** | ç±»å‹ç³»ç»Ÿæ‰©å±• + HttpExecutorå¢å¼º | 3å¤© | æ—  | å¢å¼ºçš„HTTPæ‰§è¡Œå™¨ |
| **Phase 2** | æ€§èƒ½ä¼˜åŒ–æœºåˆ¶å®ç° | 2å¤© | Phase 1 | è®¢é˜…å¼åŠ¨æ€å‚æ•°ç³»ç»Ÿ |
| **Phase 3** | UIè¡¨å•ç»„ä»¶å¼€å‘ | 3å¤© | Phase 1 | 5æ ‡ç­¾é¡µHTTPé…ç½®ç•Œé¢ |
| **Phase 4** | Card2.1æ˜ å°„ç³»ç»Ÿé›†æˆ | 2å¤© | Phase 1, 3 | åŒç›²æ˜ å°„ç»„ä»¶ |
| **Phase 5** | ç³»ç»Ÿé›†æˆæµ‹è¯• + ä¼˜åŒ– | 1å¤© | å…¨éƒ¨ | å®Œæ•´å¯ç”¨ç³»ç»Ÿ |
| **æ€»è®¡** | **å®Œæ•´HTTPé…ç½®ç³»ç»Ÿ** | **11å¤©** | - | **ç”Ÿäº§å°±ç»ªç³»ç»Ÿ** |

### å…³é”®é‡Œç¨‹ç¢‘
- **Day 3**: HttpExecutorå¢å¼ºå®Œæˆï¼Œæ”¯æŒè„šæœ¬å¤„ç†
- **Day 5**: æ€§èƒ½ä¼˜åŒ–æœºåˆ¶å°±ç»ªï¼Œæ”¯æŒå¤§è§„æ¨¡é…ç½®
- **Day 8**: UIé…ç½®ç•Œé¢å®Œæˆï¼Œç”¨æˆ·å¯ä»¥å®Œæ•´é…ç½®HTTP
- **Day 10**: Card2.1æ˜ å°„å®Œæˆï¼Œç»„ä»¶å±æ€§å¯ç»‘å®šHTTPå‚æ•°
- **Day 11**: ç³»ç»Ÿå®Œå…¨é›†æˆï¼Œç«¯åˆ°ç«¯å¯ç”¨

### é£é™©æ§åˆ¶
- **æŠ€æœ¯é£é™©**: åŸºäºç°æœ‰æ¶æ„æ‰©å±•ï¼Œå¤ç”¨æˆç†Ÿç»„ä»¶ï¼Œé£é™©è¾ƒä½
- **é›†æˆé£é™©**: åˆ†é˜¶æ®µå®æ–½ï¼Œæ¯ä¸ªé˜¶æ®µç‹¬ç«‹å¯æµ‹è¯•
- **ç”¨æˆ·ä½“éªŒé£é™©**: é€šè¿‡5æ ‡ç­¾é¡µåˆ†å±‚è®¾è®¡ï¼Œé™ä½é…ç½®å¤æ‚åº¦

---

## ğŸ¯ ç³»ç»Ÿæ ¸å¿ƒç‰¹æ€§æ€»ç»“

### æŠ€æœ¯æ¶æ„ç‰¹æ€§
- âœ… **èŒè´£åˆ†ç¦»**: HttpExecutoråªå¤„ç†é™æ€é…ç½®ï¼ŒåŠ¨æ€è§£æç”±ä¸Šå±‚å¤„ç†
- âœ… **è„šæœ¬é›†æˆ**: preRequestScriptè°ƒæ•´é…ç½®ï¼ŒpostResponseScriptå¤„ç†å“åº”
- âœ… **æ€§èƒ½ä¼˜åŒ–**: åŸºäºDataWarehouseè®¢é˜…æœºåˆ¶ï¼Œé¿å…å¤§é…ç½®é‡æ–°ç”Ÿæˆ
- âœ… **å‘ä¸‹å…¼å®¹**: æ”¯æŒç°æœ‰ç®€å•HTTPé…ç½®æ ¼å¼

### ç”¨æˆ·ç•Œé¢ç‰¹æ€§
- âœ… **åˆ†å±‚é…ç½®**: 5æ ‡ç­¾é¡µè®¾è®¡ï¼ˆåŸºç¡€/è¯·æ±‚å¤´/å‚æ•°/è¯·æ±‚è„šæœ¬/å“åº”è„šæœ¬ï¼‰
- âœ… **åŠ¨æ€å‚æ•°**: é™æ€/åŠ¨æ€å‚æ•°ä¸€é”®åˆ‡æ¢ï¼Œæ”¯æŒæ•°æ®ç±»å‹è½¬æ¢
- âœ… **è„šæœ¬ç¼–è¾‘**: é›†æˆSimpleScriptEditorï¼Œæ”¯æŒè¯­æ³•é«˜äº®å’Œç¤ºä¾‹
- âœ… **å®æ—¶é¢„è§ˆ**: é…ç½®å˜åŒ–å®æ—¶ç”ŸæˆHTTPè¯·æ±‚é¢„è§ˆ

### ç»„ä»¶é›†æˆç‰¹æ€§  
- âœ… **åŒç›²æ˜ å°„**: ç»„ä»¶å±æ€§å’ŒHTTPå‚æ•°é€šè¿‡æ˜ å°„ç»„ä»¶è¿æ¥ï¼Œå®Œå…¨è§£è€¦
- âœ… **å“åº”å¼ç»‘å®š**: ç»„ä»¶å±æ€§å˜åŒ–è‡ªåŠ¨è§¦å‘HTTPé…ç½®æ›´æ–°
- âœ… **å®ä¾‹éš”ç¦»**: ä¸åŒç»„ä»¶å®ä¾‹çš„æ˜ å°„é…ç½®å®Œå…¨ç‹¬ç«‹
- âœ… **æ ‡å‡†åŒ–**: åŸºäºCard2.1å±æ€§æš´éœ²ç³»ç»Ÿï¼Œç»Ÿä¸€æ˜ å°„æœºåˆ¶

---

**ğŸ“„ æ–‡æ¡£çŠ¶æ€**: HTTPé…ç½®ç³»ç»Ÿå®Œæ•´éœ€æ±‚è®¾è®¡å·²å®Œæˆ  
**ğŸ—“ï¸ åˆ›å»ºæ—¶é—´**: 2025-08-29  
**ğŸ”„ æœ€åæ›´æ–°**: 2025-08-29  
**â±ï¸ é¢„è®¡å®æ–½å‘¨æœŸ**: 11å¤©ï¼ˆæŠ€æœ¯æ¶æ„ + UIè¡¨å• + ç»„ä»¶æ˜ å°„ + æ€§èƒ½ä¼˜åŒ– + é›†æˆæµ‹è¯•ï¼‰  
**ğŸ‘¥ ç›®æ ‡å›¢é˜Ÿ**: å‰ç«¯æ¶æ„å¸ˆã€UIå¼€å‘å·¥ç¨‹å¸ˆã€ç»„ä»¶å¼€å‘å·¥ç¨‹å¸ˆ  
**ğŸ¯ äº¤ä»˜ç›®æ ‡**: ç”Ÿäº§å°±ç»ªçš„HTTPé…ç½®ç³»ç»Ÿï¼Œæ”¯æŒåŠ¨æ€å‚æ•°æ˜ å°„å’Œä¼ä¸šçº§æ€§èƒ½è¦æ±‚