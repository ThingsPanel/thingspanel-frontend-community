# ThingsPanel é¡¹ç›®æ€»ä½“æ¶æ„æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

ThingsPanel æ˜¯ä¸€ä¸ªåŸºäº Vue 3ã€TypeScript å’Œ Naive UI æ„å»ºçš„ç°ä»£åŒ–ç‰©è”ç½‘åº”ç”¨æ”¯æ’‘å¹³å°å‰ç«¯é¡¹ç›®ã€‚è¯¥é¡¹ç›®é‡‡ç”¨äº†æœ€æ–°çš„å‰ç«¯æŠ€æœ¯æ ˆï¼Œå…·å¤‡é«˜åº¦çš„æ¨¡å—åŒ–å’Œç»„ä»¶åŒ–ç‰¹æ€§ï¼Œä¸“æ³¨äºæä¾›çµæ´»ã€å¯æ‰©å±•çš„ç‰©è”ç½‘è®¾å¤‡ç®¡ç†å’Œæ•°æ®å¯è§†åŒ–è§£å†³æ–¹æ¡ˆã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **ç°ä»£æŠ€æœ¯æ ˆ**ï¼šVue 3 + TypeScript + Vite + Pinia
- ğŸ¨ **UIæ¡†æ¶**ï¼šNaive UI ä½œä¸ºä¸»è¦UIç»„ä»¶åº“
- ğŸŒ **å›½é™…åŒ–**ï¼šå®Œæ•´çš„ä¸­è‹±æ–‡åŒè¯­æ”¯æŒ
- ğŸ“± **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯é€‚é…
- ğŸ§© **æ¨¡å—åŒ–æ¶æ„**ï¼šé«˜åº¦è§£è€¦çš„ç»„ä»¶å’Œæ¨¡å—è®¾è®¡
- ğŸ“Š **æ•°æ®å¯è§†åŒ–**ï¼šé›†æˆ EChartsã€G2 ç­‰å›¾è¡¨åº“
- ğŸ”Œ **æ’ä»¶ç³»ç»Ÿ**ï¼šå¯æ‰©å±•çš„æ’ä»¶å’Œå¡ç‰‡ç³»ç»Ÿ

## æŠ€æœ¯æ ˆè¯¦è§£

### æ ¸å¿ƒæŠ€æœ¯
- **Vue 3.4.27**: ä¸»æ¡†æ¶ï¼Œä½¿ç”¨ç»„åˆå¼API
- **TypeScript**: ä¸¥æ ¼æ¨¡å¼ï¼Œæä¾›ç±»å‹å®‰å…¨
- **Vite 5.2.11**: æ„å»ºå·¥å…·å’Œå¼€å‘æœåŠ¡å™¨
- **Pinia 2.1.7**: çŠ¶æ€ç®¡ç†
- **Vue Router 4**: è·¯ç”±ç®¡ç†
- **Vue I18n**: å›½é™…åŒ–

### UIå’Œæ ·å¼
- **Naive UI 2.42.0**: ä¸»è¦UIç»„ä»¶åº“
- **UnoCSS**: åŸå­åŒ–CSSæ¡†æ¶
- **SCSS**: CSSé¢„å¤„ç†å™¨
- **@vicons/***: å›¾æ ‡ç»„ä»¶åº“

### æ•°æ®å¯è§†åŒ–
- **ECharts 5.5.1**: ä¸»è¦å›¾è¡¨åº“
- **@antv/g2 4.2.10**: æ•°æ®å¯è§†åŒ–è¯­æ³•
- **@antv/data-set**: æ•°æ®å¤„ç†

### å¼€å‘å·¥å…·
- **ESLint**: ä»£ç è´¨é‡æ£€æŸ¥
- **Prettier**: ä»£ç æ ¼å¼åŒ–
- **Simple Git Hooks**: Gité’©å­ç®¡ç†
- **Vue DevTools**: å¼€å‘è°ƒè¯•å·¥å…·

## é¡¹ç›®ç»“æ„åˆ†æ

```
src/
â”œâ”€â”€ main.ts                    # åº”ç”¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ App.vue                    # æ ¹ç»„ä»¶
â”œâ”€â”€ assets/                    # é™æ€èµ„æº
â”‚   â”œâ”€â”€ audio/                 # éŸ³é¢‘æ–‡ä»¶
â”‚   â”œâ”€â”€ imgs/                  # å›¾ç‰‡èµ„æº
â”‚   â””â”€â”€ svg-icon/              # SVGå›¾æ ‡
â”œâ”€â”€ components/                # é€šç”¨ç»„ä»¶åº“
â”‚   â”œâ”€â”€ common/                # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ business/              # ä¸šåŠ¡ç»„ä»¶
â”‚   â”œâ”€â”€ custom/                # è‡ªå®šä¹‰ç»„ä»¶
â”‚   â”œâ”€â”€ advanced/              # é«˜çº§ç»„ä»¶
â”‚   â”œâ”€â”€ visual-editor/         # å¯è§†åŒ–ç¼–è¾‘å™¨
â”‚   â””â”€â”€ ...                   # å…¶ä»–ç»„ä»¶ç›®å½•
â”œâ”€â”€ views/                     # é¡µé¢è§†å›¾
â”‚   â”œâ”€â”€ _builtin/              # å†…ç½®é¡µé¢ï¼ˆç™»å½•ã€é”™è¯¯é¡µç­‰ï¼‰
â”‚   â”œâ”€â”€ dashboard/             # ä»ªè¡¨æ¿
â”‚   â”œâ”€â”€ device/                # è®¾å¤‡ç®¡ç†
â”‚   â”œâ”€â”€ alarm/                 # å‘Šè­¦ç®¡ç†
â”‚   â””â”€â”€ ...                   # å…¶ä»–ä¸šåŠ¡é¡µé¢
â”œâ”€â”€ router/                    # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ elegant/               # ä¼˜é›…è·¯ç”±ç”Ÿæˆ
â”‚   â”œâ”€â”€ guard/                 # è·¯ç”±å®ˆå«
â”‚   â””â”€â”€ routes/                # è·¯ç”±å®šä¹‰
â”œâ”€â”€ store/                     # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ modules/               # çŠ¶æ€æ¨¡å—
â”‚   â””â”€â”€ plugins/               # çŠ¶æ€æ’ä»¶
â”œâ”€â”€ service/                   # APIæœåŠ¡å±‚
â”‚   â”œâ”€â”€ api/                   # APIæ¥å£å®šä¹‰
â”‚   â””â”€â”€ request/               # è¯·æ±‚å°è£…
â”œâ”€â”€ hooks/                     # ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ business/              # ä¸šåŠ¡hooks
â”‚   â”œâ”€â”€ common/                # é€šç”¨hooks
â”‚   â””â”€â”€ chart/                 # å›¾è¡¨hooks
â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ common/                # é€šç”¨å·¥å…·
â”‚   â”œâ”€â”€ echarts/               # å›¾è¡¨å·¥å…·
â”‚   â””â”€â”€ service/               # æœåŠ¡å·¥å…·
â”œâ”€â”€ card/                      # å¡ç‰‡ç³»ç»Ÿ (æ—§ç‰ˆ)
â”‚   â”œâ”€â”€ builtin-card/          # å†…ç½®å¡ç‰‡
â”‚   â””â”€â”€ chart-card/            # å›¾è¡¨å¡ç‰‡
â”œâ”€â”€ card2.1/                   # æ–°ä¸€ä»£å¡ç‰‡ç³»ç»Ÿ
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ components/            # å¡ç‰‡ç»„ä»¶
â”‚   â””â”€â”€ hooks/                 # ä¸“ç”¨hooks
â”œâ”€â”€ layouts/                   # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ base-layout/           # åŸºç¡€å¸ƒå±€
â”‚   â””â”€â”€ modules/               # å¸ƒå±€æ¨¡å—
â”œâ”€â”€ locales/                   # å›½é™…åŒ–
â”‚   â”œâ”€â”€ langs/                 # è¯­è¨€åŒ…
â”‚   â””â”€â”€ ...                   # é…ç½®æ–‡ä»¶
â”œâ”€â”€ constants/                 # å¸¸é‡å®šä¹‰
â”œâ”€â”€ enum/                      # æšä¸¾ç±»å‹
â”œâ”€â”€ typings/                   # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ theme/                     # ä¸»é¢˜é…ç½®
â”œâ”€â”€ styles/                    # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ css/                   # CSSæ–‡ä»¶
â”‚   â””â”€â”€ scss/                  # SCSSæ–‡ä»¶
â””â”€â”€ plugins/                   # æ’ä»¶é…ç½®
    â”œâ”€â”€ assets.ts              # é™æ€èµ„æºæ’ä»¶
    â”œâ”€â”€ dayjs.ts               # æ—¥æœŸåº“æ’ä»¶
    â””â”€â”€ ...                   # å…¶ä»–æ’ä»¶
```

## æ ¸å¿ƒæ¶æ„ç‰¹ç‚¹

### 1. æ¨¡å—åŒ–è®¾è®¡
é¡¹ç›®é‡‡ç”¨é«˜åº¦æ¨¡å—åŒ–çš„æ¶æ„ï¼Œæ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½æœ‰æ˜ç¡®çš„èŒè´£åˆ†å·¥ï¼š
- **ç»„ä»¶å±‚**ï¼šå¯å¤ç”¨çš„UIç»„ä»¶
- **é¡µé¢å±‚**ï¼šä¸šåŠ¡é¡µé¢ç»„ä»¶
- **æœåŠ¡å±‚**ï¼šAPIå’Œæ•°æ®å¤„ç†
- **çŠ¶æ€å±‚**ï¼šå…¨å±€çŠ¶æ€ç®¡ç†
- **å·¥å…·å±‚**ï¼šé€šç”¨å·¥å…·å‡½æ•°

### 2. ç»„åˆå¼æ¶æ„
åŸºäºVue 3ç»„åˆå¼APIï¼Œé‡‡ç”¨å‡½æ•°å¼ç¼–ç¨‹æ€ç»´ï¼š
- **hooks/**: å¯å¤ç”¨çš„ä¸šåŠ¡é€»è¾‘
- **composables/**: ç»„åˆå¼å‡½æ•°
- **utils/**: çº¯å‡½æ•°å·¥å…·åº“

### 3. ç±»å‹å®‰å…¨
å…¨é¢çš„TypeScriptæ”¯æŒï¼š
- **typings/**: ä¸“é—¨çš„ç±»å‹å®šä¹‰ç›®å½•
- **ä¸¥æ ¼æ¨¡å¼**: å¯ç”¨TypeScriptä¸¥æ ¼æ£€æŸ¥
- **æ¥å£å®šä¹‰**: APIå’Œæ•°æ®ç»“æ„ç±»å‹åŒ–

### 4. å›½é™…åŒ–ä½“ç³»
å®Œæ•´çš„å¤šè¯­è¨€æ”¯æŒï¼š
- **Vue I18n**: å›½é™…åŒ–æ¡†æ¶
- **è¯­è¨€åŒ…**: åˆ†æ¨¡å—çš„ç¿»è¯‘æ–‡ä»¶
- **è¿è¡Œæ—¶åˆ‡æ¢**: åŠ¨æ€è¯­è¨€åˆ‡æ¢

### 5. ä¸»é¢˜ç³»ç»Ÿ
ç»Ÿä¸€çš„ä¸»é¢˜ç®¡ç†ï¼š
- **æ˜æš—ä¸»é¢˜**: æ”¯æŒä¸»é¢˜åˆ‡æ¢
- **CSSå˜é‡**: åŠ¨æ€ä¸»é¢˜å˜é‡
- **Naive UIé›†æˆ**: ä¸UIåº“ä¸»é¢˜åŒæ­¥

## å¯åŠ¨æµç¨‹åˆ†æ

### main.ts å¯åŠ¨æµç¨‹

```typescript
async function setupApp() {
  const app = createApp(App)
  
  // 1. æ ¸å¿ƒåŒæ­¥åˆå§‹åŒ–
  setupStore(app)          // PiniaçŠ¶æ€ç®¡ç†
  setupI18n(app)           // å›½é™…åŒ–
  setupLoading()           # åŠ è½½çŠ¶æ€
  setupNProgress()         // è¿›åº¦æ¡
  
  // 2. ç³»ç»Ÿè®¾ç½®å¹¶è¡ŒåŠ è½½
  sysSettingStore.initSysSetting()
  
  // 3. éå…³é”®åŠŸèƒ½å»¶è¿Ÿåˆå§‹åŒ–
  requestIdleCallback(() => {
    setupIconifyOffline()  // å›¾æ ‡ç³»ç»Ÿ
    setupDayjs()          // æ—¥æœŸåº“
    initEChartsComponents() // å›¾è¡¨ç»„ä»¶
  })
  
  // 4. è·¯ç”±åˆå§‹åŒ–
  await setupRouter(app)
  
  // 5. åº”ç”¨æŒ‚è½½
  app.mount('#app')
}
```

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

1. **å»¶è¿ŸåŠ è½½**: éå…³é”®åŠŸèƒ½ä½¿ç”¨ `requestIdleCallback`
2. **å¹¶è¡ŒåŠ è½½**: ç³»ç»Ÿè®¾ç½®å¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡å¯åŠ¨
3. **å†…å­˜ä¼˜åŒ–**: æ„å»ºé…ç½®é™åˆ¶å†…å­˜ä½¿ç”¨
4. **ä»£ç åˆ†å‰²**: æ‰‹åŠ¨é…ç½®å¤§å‹ä¾èµ–åˆ†åŒ…

## æ„å»ºå’Œéƒ¨ç½²é…ç½®

### Viteé…ç½®ç‰¹æ€§ (vite.config.ts)

```typescript
export default defineConfig({
  // è·¯å¾„åˆ«å
  resolve: {
    alias: {
      '@': './src',
      '~': './'
    }
  },
  
  // å¼€å‘æœåŠ¡å™¨
  server: {
    port: 5002,
    usePolling: true,  // WSL2æ”¯æŒ
    proxy: createViteProxy(viteEnv)
  },
  
  // æ„å»ºä¼˜åŒ–
  build: {
    chunkSizeWarningLimit: 4000,
    rollupOptions: {
      maxParallelFileOps: 2,  // å†…å­˜ä¼˜åŒ–
      output: {
        manualChunks: {       // æ‰‹åŠ¨åˆ†åŒ…
          'vendor-vue': ['vue', 'vue-router', 'pinia'],
          'vendor-ui': ['naive-ui'],
          'vendor-charts': ['@antv/g2', '@antv/data-set'],
          'vendor-utils': ['dayjs', 'lodash-es']
        }
      }
    }
  }
})
```

### TypeScripté…ç½® (tsconfig.json)

```json
{
  "compilerOptions": {
    "target": "ESNext",
    "module": "ESNext",
    "strict": true,
    "paths": {
      "@/*": ["./src/*"],
      "~/*": ["./*"]
    }
  }
}
```

## åŒ…ç®¡ç†å’Œå·¥ä½œåŒº

### é¡¹ç›®ä¾èµ–ç»“æ„
- **pnpm workspace**: å¤šåŒ…ç®¡ç†
- **å†…éƒ¨åŒ…**: @sa/* ç³»åˆ—å·¥ä½œåŒºåŒ…
- **å¤–éƒ¨ä¾èµ–**: ç¬¬ä¸‰æ–¹åº“å’Œæ¡†æ¶

### æ ¸å¿ƒè„šæœ¬å‘½ä»¤

```bash
# å¼€å‘
pnpm dev              # å¼€å‘ç¯å¢ƒå¯åŠ¨
pnpm dev:test         # æµ‹è¯•ç¯å¢ƒ
pnpm dev:prod         # ç”Ÿäº§ç¯å¢ƒ

# æ„å»º
pnpm build            # ç”Ÿäº§æ„å»º (4GBå†…å­˜)
pnpm build:4096       # é«˜å†…å­˜æ„å»º (8GB)
pnpm build:test       # æµ‹è¯•æ„å»º

# ä»£ç è´¨é‡
pnpm lint             # ESLintæ£€æŸ¥
pnpm typecheck        # TypeScriptæ£€æŸ¥
pnpm quality-check    # å®Œæ•´è´¨é‡æ£€æŸ¥
pnpm pre-commit-check # æäº¤å‰æ£€æŸ¥
```

## å¼€å‘è§„èŒƒå’Œçº¦å®š

### ä»£ç é£æ ¼
- **Vue 3**: ç»„åˆå¼API + `<script setup>`
- **TypeScript**: ä¸¥æ ¼æ¨¡å¼ï¼Œé¿å…anyç±»å‹
- **ESLint**: æ‰å¹³é…ç½®æ ¼å¼
- **å‘½åçº¦å®š**: PascalCaseç»„ä»¶ï¼ŒcamelCaseå‡½æ•°

### æ–‡ä»¶ç»„ç»‡
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ–‡ä»¶ä¸“æ³¨å•ä¸€åŠŸèƒ½
- **æ¨¡å—å¯¼å…¥**: ä½¿ç”¨è·¯å¾„åˆ«å @/ å’Œ ~/
- **ç±»å‹å®šä¹‰**: é›†ä¸­åœ¨ typings/ ç›®å½•
- **å¸¸é‡å®šä¹‰**: é›†ä¸­åœ¨ constants/ ç›®å½•

### Gitå·¥ä½œæµ
- **é¢„æäº¤é’©å­**: è‡ªåŠ¨è¿è¡Œç±»å‹æ£€æŸ¥å’Œä»£ç æ£€æŸ¥
- **æäº¤æ¶ˆæ¯**: è§„èŒƒåŒ–æäº¤ä¿¡æ¯
- **åˆ†æ”¯ç®¡ç†**: åŸºäºåŠŸèƒ½çš„åˆ†æ”¯ç­–ç•¥

## æ€»ç»“

ThingsPanelå‰ç«¯é¡¹ç›®æ˜¯ä¸€ä¸ªè®¾è®¡ç²¾è‰¯ã€æ¶æ„åˆç†çš„ç°ä»£åŒ–Vue.jsåº”ç”¨ã€‚é¡¹ç›®é‡‡ç”¨äº†ä¸šç•Œæœ€ä½³å®è·µï¼Œå…·å¤‡ä»¥ä¸‹çªå‡ºç‰¹ç‚¹ï¼š

1. **æŠ€æœ¯å…ˆè¿›**: ä½¿ç”¨æœ€æ–°çš„å‰ç«¯æŠ€æœ¯æ ˆ
2. **æ¶æ„æ¸…æ™°**: æ¨¡å—åŒ–ã€ç»„ä»¶åŒ–è®¾è®¡
3. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptæ”¯æŒ
4. **æ€§èƒ½ä¼˜åŒ–**: å¤šå±‚æ¬¡çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
5. **å¼€å‘å‹å¥½**: å®Œå–„çš„å¼€å‘å·¥å…·å’Œè§„èŒƒ
6. **å¯ç»´æŠ¤æ€§**: è‰¯å¥½çš„ä»£ç ç»„ç»‡å’Œæ–‡æ¡£

è¿™ä¸ªæ¶æ„ä¸ºç‰©è”ç½‘åº”ç”¨çš„å¼€å‘æä¾›äº†åšå®çš„åŸºç¡€ï¼Œæ”¯æŒå¿«é€Ÿå¼€å‘å’Œé•¿æœŸç»´æŠ¤ã€‚