# ThingsPanel é¡¹ç›®é—®é¢˜åˆ†æå’Œæ”¹è¿›å»ºè®®

## é—®é¢˜åˆ†ææ¦‚è¿°

é€šè¿‡å¯¹ThingsPanelé¡¹ç›®çš„æ·±å…¥åˆ†æï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªæ€»ä½“ä¸Šéå¸¸å‡ºè‰²çš„Vue 3ä¼ä¸šçº§é¡¹ç›®ã€‚è¯¥é¡¹ç›®åœ¨æ¶æ„è®¾è®¡ã€æŠ€æœ¯æ ˆé€‰æ‹©ã€ä»£ç ç»„ç»‡ç­‰æ–¹é¢éƒ½ä½“ç°äº†å¾ˆé«˜çš„ä¸“ä¸šæ°´å‡†ã€‚ä½†åœ¨æŸäº›ç»†èŠ‚æ–¹é¢ä»å­˜åœ¨ä¸€äº›å¯ä»¥ä¼˜åŒ–çš„ç©ºé—´ã€‚

## ğŸ” å‘ç°çš„ä¸»è¦é—®é¢˜

### 1. æ¶æ„å’Œç»„ç»‡å±‚é¢é—®é¢˜

#### 1.1 å¹¶è¡Œç½‘æ ¼ç³»ç»Ÿå†—ä½™
**é—®é¢˜æè¿°**: é¡¹ç›®ä¸­å­˜åœ¨ä¸‰å¥—å¹¶è¡Œçš„ç½‘æ ¼å¸ƒå±€ç³»ç»Ÿï¼š
- `GridLayoutPlus` (æ¨è)
- `GridPlus` (æ–°ç‰ˆ)  
- `Panelç³»ç»Ÿ` (æ—§ç‰ˆ)

**å½±å“**: 
- å¢åŠ äº†ä»£ç ç»´æŠ¤æˆæœ¬
- æ–°å¼€å‘è€…å®¹æ˜“æ··æ·†é€‰æ‹©
- åŒ…ä½“ç§¯ç›¸å¯¹è¾ƒå¤§

**å»ºè®®**:
```typescript
// å»ºè®®ç»Ÿä¸€ä½¿ç”¨ GridLayoutPlusï¼Œé€æ­¥è¿ç§»å…¶ä»–ç³»ç»Ÿ
// 1. åˆ¶å®šè¿ç§»è®¡åˆ’
const MIGRATION_PLAN = {
  phase1: 'åœæ­¢Panelç³»ç»Ÿæ–°åŠŸèƒ½å¼€å‘',
  phase2: 'å°†GridPlusåŠŸèƒ½åˆå¹¶åˆ°GridLayoutPlus',
  phase3: 'å®Œå…¨åºŸå¼ƒPanelç³»ç»Ÿ'
}

// 2. æä¾›è¿ç§»å·¥å…·
export function migrateFromPanelToGridPlus(panelConfig: PanelConfig): GridPlusConfig {
  return {
    layout: panelConfig.items.map(transformPanelItem),
    settings: adaptPanelSettings(panelConfig.settings)
  }
}
```

#### 1.2 Cardä¸Card2.1ç³»ç»Ÿå¹¶å­˜
**é—®é¢˜æè¿°**: ä¸¤ä»£å¡ç‰‡ç³»ç»ŸåŒæ—¶å­˜åœ¨ï¼Œé€ æˆé€‰æ‹©å›°æƒ‘

**å»ºè®®**:
- åŠ å¼ºCard2.1çš„æ–‡æ¡£è¯´æ˜
- æä¾›Cardåˆ°Card2.1çš„è¿ç§»æŒ‡å—
- è®¾ç½®æ˜ç¡®çš„åºŸå¼ƒæ—¶é—´çº¿

### 2. ä»£ç è´¨é‡é—®é¢˜

#### 2.1 å“åº”å¼å±æ€§è®¿é—®é”™è¯¯ (å·²ä¿®å¤)
**é—®é¢˜ä½ç½®**: `useVisualEditorIntegration.ts`
```typescript
// âŒ é”™è¯¯çš„å†™æ³• (å·²ä¿®å¤)
const components = componentTree.filteredComponents
if (!Array.isArray(components)) return []

// âœ… æ­£ç¡®çš„å†™æ³•
const components = componentTree.filteredComponents.value
if (!Array.isArray(components)) return []
```

#### 2.2 å›¾æ ‡ä½¿ç”¨ä¸ä¸€è‡´
**é—®é¢˜æè¿°**: éƒ¨åˆ†ä»£ç ä¸­ä½¿ç”¨äº†ä¸å­˜åœ¨çš„å›¾æ ‡åç§°
```typescript
// âŒ é”™è¯¯ï¼šè¿™äº›å›¾æ ‡åœ¨@vicons/ionicons5ä¸­ä¸å­˜åœ¨
import { AlignHorizontalCenter } from '@vicons/ionicons5'

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å­˜åœ¨çš„å›¾æ ‡
import { AlignHorizontalOutline } from '@vicons/ionicons5'
```

**å»ºè®®**: 
- å»ºç«‹å›¾æ ‡ä½¿ç”¨è§„èŒƒæ–‡æ¡£
- åˆ›å»ºå›¾æ ‡æ£€æŸ¥è„šæœ¬éªŒè¯å›¾æ ‡æ˜¯å¦å­˜åœ¨

### 3. æ€§èƒ½ä¼˜åŒ–ç©ºé—´

#### 3.1 å¤§æ–‡ä»¶å’Œå¤æ‚ç»„ä»¶
**å‘ç°çš„å¤§æ–‡ä»¶**:
- `PanelEditor.vue` (~1025è¡Œ)
- `use-hook-table.ts` (å¤æ‚åº¦è¾ƒé«˜)
- æŸäº›APIæ–‡ä»¶åŠŸèƒ½è¿‡äºé›†ä¸­

**å»ºè®®**:
```typescript
// å°†å¤§ç»„ä»¶æ‹†åˆ†ä¸ºæ›´å°çš„å­ç»„ä»¶
// PanelEditor.vue å¯ä»¥æ‹†åˆ†ä¸ºï¼š
const PANEL_EDITOR_COMPONENTS = {
  'PanelToolbar.vue': 'å·¥å…·æ ç»„ä»¶',
  'PanelCanvas.vue': 'ç”»å¸ƒç»„ä»¶', 
  'PanelPropertyPanel.vue': 'å±æ€§é¢æ¿',
  'PanelWidgetLibrary.vue': 'ç»„ä»¶åº“'
}
```

#### 3.2 å†…å­˜ä¼˜åŒ–ç©ºé—´
**å½“å‰é…ç½®**:
```typescript
// vite.config.ts
build: {
  rollupOptions: {
    maxParallelFileOps: 2  // å½“å‰é™åˆ¶è¾ƒä½
  }
}
```

**å»ºè®®**:
- æ ¹æ®å®é™…æ„å»ºæœºå™¨é…ç½®åŠ¨æ€è°ƒæ•´
- å®ç°æ›´ç²¾ç»†çš„ä»£ç åˆ†å‰²ç­–ç•¥

### 4. ç±»å‹å®‰å…¨é—®é¢˜

#### 4.1 éƒ¨åˆ†anyç±»å‹ä½¿ç”¨
**é—®é¢˜ä½ç½®**: æŸäº›å·¥å…·å‡½æ•°å’ŒAPIæ¥å£ä¸­ä»ä½¿ç”¨`any`ç±»å‹

**å»ºè®®**:
```typescript
// âŒ é¿å…ä½¿ç”¨any
function processData(data: any): any {
  return data
}

// âœ… ä½¿ç”¨å…·ä½“ç±»å‹æˆ–æ³›å‹
function processData<T>(data: T): ProcessedData<T> {
  return transformData(data)
}
```

#### 4.2 ç±»å‹å®šä¹‰åˆ†æ•£
**é—®é¢˜**: ä¸€äº›ä¸šåŠ¡ç±»å‹å®šä¹‰åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤å®šä¹‰

**å»ºè®®**: å»ºç«‹ç»Ÿä¸€çš„ç±»å‹å®šä¹‰ç´¢å¼•å’Œé‡ç”¨æœºåˆ¶

### 5. æ–‡æ¡£å’Œæ³¨é‡Šé—®é¢˜

#### 5.1 è‹±æ–‡æ³¨é‡Šä¸ä¸­æ–‡æ³¨é‡Šæ··ç”¨
**ç°çŠ¶**: ä»£ç ä¸­å­˜åœ¨è‹±æ–‡å’Œä¸­æ–‡æ³¨é‡Šæ··ç”¨çš„æƒ…å†µ

**å»ºè®®**: 
- ç»Ÿä¸€ä½¿ç”¨ä¸­æ–‡æ³¨é‡Šï¼ˆç¬¦åˆé¡¹ç›®è§„èŒƒï¼‰
- æŠ€æœ¯æœ¯è¯­å¯ä¿æŒè‹±æ–‡

#### 5.2 APIæ–‡æ¡£ä¸å®Œæ•´
**é—®é¢˜**: éƒ¨åˆ†APIæ¥å£ç¼ºå°‘è¯¦ç»†çš„JSDocæ³¨é‡Š

**å»ºè®®**:
```typescript
/**
 * è·å–è®¾å¤‡é¥æµ‹æ•°æ®
 * @param deviceId è®¾å¤‡ID
 * @param params æŸ¥è¯¢å‚æ•°
 * @param params.startTime å¼€å§‹æ—¶é—´
 * @param params.endTime ç»“æŸæ—¶é—´
 * @param params.keys é¥æµ‹å­—æ®µåˆ—è¡¨
 * @returns Promise<TelemetryData[]> é¥æµ‹æ•°æ®æ•°ç»„
 * @throws {DeviceNotFoundError} è®¾å¤‡ä¸å­˜åœ¨æ—¶æŠ›å‡º
 * @example
 * ```typescript
 * const data = await getTelemetryData('device-001', {
 *   startTime: '2023-01-01',
 *   endTime: '2023-01-02',
 *   keys: ['temperature', 'humidity']
 * })
 * ```
 */
export async function getTelemetryData(
  deviceId: string, 
  params: TelemetryQueryParams
): Promise<TelemetryData[]>
```

### 6. æµ‹è¯•è¦†ç›–é—®é¢˜

#### 6.1 å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä½
**ç°çŠ¶**: é¡¹ç›®ç¼ºå°‘ç³»ç»Ÿæ€§çš„å•å…ƒæµ‹è¯•

**å»ºè®®**:
```typescript
// å»ºè®®æ·»åŠ å…³é”®å‡½æ•°çš„æµ‹è¯•
describe('å·¥å…·å‡½æ•°æµ‹è¯•', () => {
  describe('deepClone', () => {
    it('åº”è¯¥æ­£ç¡®å…‹éš†ç®€å•å¯¹è±¡', () => {
      const obj = { a: 1, b: 'test' }
      const cloned = deepClone(obj)
      expect(cloned).toEqual(obj)
      expect(cloned).not.toBe(obj)
    })

    it('åº”è¯¥æ­£ç¡®å…‹éš†åµŒå¥—å¯¹è±¡', () => {
      const obj = { a: { b: { c: 1 } } }
      const cloned = deepClone(obj)
      expect(cloned.a.b.c).toBe(1)
      expect(cloned.a.b).not.toBe(obj.a.b)
    })
  })
})
```

#### 6.2 é›†æˆæµ‹è¯•ä¸è¶³
**å»ºè®®**: ä¸ºæ ¸å¿ƒä¸šåŠ¡æµç¨‹æ·»åŠ E2Eæµ‹è¯•

### 7. å®‰å…¨æ€§é—®é¢˜

#### 7.1 æ•æ„Ÿä¿¡æ¯æš´éœ²
**é—®é¢˜**: ä»£ç ä¸­å­˜åœ¨ä¸€äº›æµ‹è¯•ç”¨çš„API Token

**å»ºè®®**:
```typescript
// âŒ é¿å…åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
headers: {
  apifoxToken: 'XL299LiMEDZ0H5h3A29PxwQXdMJqWyY2'  
}

// âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡
headers: {
  apifoxToken: import.meta.env.VITE_API_TOKEN || ''
}
```

#### 7.2 XSSé˜²æŠ¤ä¸è¶³
**å»ºè®®**: åœ¨ç”¨æˆ·è¾“å…¥å¤„ç†ä¸­åŠ å¼ºXSSé˜²æŠ¤

## ğŸš€ æ”¹è¿›å»ºè®®

### 1. çŸ­æœŸæ”¹è¿› (1-2ä¸ªæœˆ)

#### 1.1 ä¿®å¤å·²çŸ¥é—®é¢˜
- [x] ä¿®å¤å“åº”å¼å±æ€§è®¿é—®é”™è¯¯
- [ ] ç»Ÿä¸€å›¾æ ‡ä½¿ç”¨è§„èŒƒ
- [ ] æ·»åŠ ç¼ºå¤±çš„ä¸­æ–‡æ³¨é‡Š
- [ ] ç§»é™¤ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯

#### 1.2 ä»£ç è´¨é‡æå‡
```typescript
// 1. æ·»åŠ ESLintè§„åˆ™æ£€æŸ¥
{
  "rules": {
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "prefer-const": "error"
  }
}

// 2. æ·»åŠ commitæäº¤æ£€æŸ¥
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "pre-push": "npm run test && npm run typecheck"
    }
  }
}
```

### 2. ä¸­æœŸæ”¹è¿› (3-6ä¸ªæœˆ)

#### 2.1 æ¶æ„ä¼˜åŒ–
- åˆ¶å®šç½‘æ ¼ç³»ç»Ÿç»Ÿä¸€è®¡åˆ’
- Card2.1å®Œå…¨æ›¿ä»£Cardç³»ç»Ÿ
- æ€§èƒ½ç›‘æ§ä½“ç³»å»ºè®¾

#### 2.2 æµ‹è¯•ä½“ç³»å»ºè®¾
```typescript
// æµ‹è¯•é…ç½®ç¤ºä¾‹
export default defineConfig({
  test: {
    globals: true,
    environment: 'jsdom',
    coverage: {
      reporter: ['text', 'json', 'html'],
      threshold: {
        global: {
          branches: 80,
          functions: 80,
          lines: 80,
          statements: 80
        }
      }
    }
  }
})
```

### 3. é•¿æœŸæ”¹è¿› (6-12ä¸ªæœˆ)

#### 3.1 æ¶æ„å‡çº§
- å¾®å‰ç«¯æ¶æ„æ¢ç´¢
- ç»„ä»¶åº“ç‹¬ç«‹å‘å¸ƒ
- æ€§èƒ½ç›‘æ§å’Œé”™è¯¯è¿½è¸ª

#### 3.2 å¼€å‘ä½“éªŒæå‡
```typescript
// å¼€å‘å·¥å…·é“¾ä¼˜åŒ–
{
  "scripts": {
    "dev:analyze": "npm run build -- --analyze",
    "dev:profile": "npm run dev -- --profile",
    "test:coverage": "vitest --coverage",
    "docs:dev": "vitepress dev docs",
    "changelog": "conventional-changelog -p angular -i CHANGELOG.md -s"
  }
}
```

## ğŸ“ˆ è´¨é‡æ”¹è¿›æŒ‡æ ‡

### ä»£ç è´¨é‡æŒ‡æ ‡
```typescript
const QUALITY_METRICS = {
  // ç±»å‹å®‰å…¨
  typeScriptStrictMode: '100%',  // å½“å‰å·²è¾¾æˆ
  anyTypeUsage: '<5%',          // ç›®æ ‡ï¼šå‡å°‘anyç±»å‹ä½¿ç”¨
  
  // æµ‹è¯•è¦†ç›–ç‡
  unitTestCoverage: '>80%',     // ç›®æ ‡
  e2eTestCoverage: '>60%',      // ç›®æ ‡
  
  // ä»£ç å¤æ‚åº¦
  maxFunctionLength: '<100è¡Œ',   // ç›®æ ‡
  maxFileLength: '<500è¡Œ',      // ç›®æ ‡
  cyclomaticComplexity: '<10',  // ç›®æ ‡
  
  // æ€§èƒ½æŒ‡æ ‡
  bundleSize: '<2MB',           // ç›®æ ‡
  firstContentfulPaint: '<1.5s', // ç›®æ ‡
  largestContentfulPaint: '<2.5s' // ç›®æ ‡
}
```

### å¼€å‘æ•ˆç‡æŒ‡æ ‡
```typescript
const EFFICIENCY_METRICS = {
  // æ„å»ºæ€§èƒ½
  devStartupTime: '<10s',       // ç›®æ ‡
  hotReloadTime: '<1s',         // ç›®æ ‡
  productionBuildTime: '<5min', // ç›®æ ‡
  
  // ä»£ç ç»´æŠ¤
  docsCoverage: '>90%',         // ç›®æ ‡ï¼šAPIæ–‡æ¡£è¦†ç›–ç‡
  codeReviewTime: '<24h',       // ç›®æ ‡ï¼šä»£ç è¯„å®¡å“åº”æ—¶é—´
  bugFixTime: '<48h',           // ç›®æ ‡ï¼šBugä¿®å¤æ—¶é—´
  
  // å¼€å‘ä½“éªŒ
  lintErrorsCount: '0',         // ç›®æ ‡
  typeErrorsCount: '0',         // ç›®æ ‡
  deprecationWarnings: '0'      // ç›®æ ‡
}
```

## ğŸ¯ ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ (å¿…é¡»è§£å†³)
1. **ä¿®å¤å“åº”å¼å±æ€§è®¿é—®é”™è¯¯** - å½±å“åŠŸèƒ½æ­£å¸¸è¿è¡Œ
2. **ç§»é™¤æ•æ„Ÿä¿¡æ¯ç¡¬ç¼–ç ** - å®‰å…¨é£é™©
3. **ç»Ÿä¸€å›¾æ ‡ä½¿ç”¨è§„èŒƒ** - é¿å…è¿è¡Œæ—¶é”™è¯¯

### ä¸­ä¼˜å…ˆçº§ (å»ºè®®è§£å†³)
1. **å®Œå–„APIæ–‡æ¡£å’Œæ³¨é‡Š** - æå‡ç»´æŠ¤æ•ˆç‡
2. **æ·»åŠ æ ¸å¿ƒåŠŸèƒ½å•å…ƒæµ‹è¯•** - ä¿éšœä»£ç è´¨é‡
3. **ä¼˜åŒ–å¤§æ–‡ä»¶æ‹†åˆ†** - æ”¹å–„ä»£ç å¯è¯»æ€§

### ä½ä¼˜å…ˆçº§ (å¯ä»¥å»¶å)
1. **ç½‘æ ¼ç³»ç»Ÿç»Ÿä¸€** - ä¸å½±å“å½“å‰åŠŸèƒ½
2. **æ€§èƒ½ç›‘æ§ä½“ç³»** - ä¼˜åŒ–ç±»éœ€æ±‚
3. **å¾®å‰ç«¯æ¶æ„æ¢ç´¢** - æœªæ¥è§„åˆ’

## ğŸ† æ€»ä½“è¯„ä»·

ThingsPanelæ˜¯ä¸€ä¸ª**éå¸¸ä¼˜ç§€**çš„Vue 3ä¼ä¸šçº§é¡¹ç›®ï¼Œå…·æœ‰ä»¥ä¸‹çªå‡ºä¼˜ç‚¹ï¼š

### ä¼˜ç§€ä¹‹å¤„
1. **æ¶æ„æ¸…æ™°**: åˆ†å±‚æ¶æ„è®¾è®¡åˆç†ï¼ŒèŒè´£è¾¹ç•Œæ˜ç¡®
2. **æŠ€æœ¯å…ˆè¿›**: ä½¿ç”¨æœ€æ–°çš„Vue 3 + TypeScriptæŠ€æœ¯æ ˆ
3. **è§„èŒƒä¸¥æ ¼**: ä¸¥æ ¼çš„å¼€å‘è§„èŒƒå’Œä»£ç è´¨é‡è¦æ±‚
4. **åŠŸèƒ½å®Œæ•´**: å®Œæ•´çš„ç‰©è”ç½‘å¹³å°åŠŸèƒ½è¦†ç›–
5. **å¯æ‰©å±•æ€§**: è‰¯å¥½çš„æ’ä»¶åŒ–å’Œæ¨¡å—åŒ–è®¾è®¡
6. **å›½é™…åŒ–**: å®Œæ•´çš„å¤šè¯­è¨€æ”¯æŒ
7. **ä¸»é¢˜ç³»ç»Ÿ**: å®Œå–„çš„æ˜æš—ä¸»é¢˜åˆ‡æ¢

### æ”¹è¿›ç©ºé—´
1. **æµ‹è¯•è¦†ç›–**: éœ€è¦åŠ å¼ºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
2. **æ–‡æ¡£å®Œå–„**: APIæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹éœ€è¦è¡¥å……
3. **æ¶æ„æ•´åˆ**: å¹¶è¡Œç³»ç»Ÿéœ€è¦æ•´åˆä¼˜åŒ–
4. **æ€§èƒ½ç›‘æ§**: éœ€è¦å»ºç«‹å®Œå–„çš„æ€§èƒ½ç›‘æ§ä½“ç³»

### ç»“è®º
è¿™æ˜¯ä¸€ä¸ªè¾¾åˆ°**ä¼ä¸šçº§ç”Ÿäº§æ ‡å‡†**çš„é«˜è´¨é‡å‰ç«¯é¡¹ç›®ï¼Œå­˜åœ¨çš„é—®é¢˜å¤§å¤šä¸ºä¼˜åŒ–ç±»é—®é¢˜ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½çš„æ­£å¸¸ä½¿ç”¨ã€‚é¡¹ç›®å±•ç°äº†å¼€å‘å›¢é˜Ÿæ·±åšçš„å‰ç«¯æŠ€æœ¯åŠŸåº•å’Œä¸¥è°¨çš„å·¥ç¨‹åŒ–å®è·µèƒ½åŠ›ã€‚

**æ¨èæŒ‡æ•°**: â­â­â­â­â­ (5/5æ˜Ÿ)