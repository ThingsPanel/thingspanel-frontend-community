# ThingsPanel é¡µé¢è·¯ç”±ç³»ç»Ÿè¯¦è§£

## è·¯ç”±ç³»ç»Ÿæ¦‚è¿°

ThingsPanelé‡‡ç”¨äº†ç°ä»£åŒ–çš„Vue 3è·¯ç”±æ¶æ„ï¼Œç»“åˆ`@elegant-router/vue`å®ç°åŸºäºæ–‡ä»¶çš„è‡ªåŠ¨è·¯ç”±ç”Ÿæˆç³»ç»Ÿã€‚æ•´ä¸ªè·¯ç”±ç³»ç»Ÿå…·æœ‰ç±»å‹å®‰å…¨ã€è‡ªåŠ¨åŒ–ç”Ÿæˆã€å¤šå±‚çº§åµŒå¥—ç­‰ç‰¹æ€§ï¼Œä¸ºç‰©è”ç½‘å¹³å°æä¾›äº†å®Œæ•´çš„é¡µé¢å¯¼èˆªå’Œæƒé™æ§åˆ¶åŠŸèƒ½ã€‚

## æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **Vue Router 4**: å®˜æ–¹è·¯ç”±ç®¡ç†å™¨
- **@elegant-router/vue**: åŸºäºæ–‡ä»¶çš„è·¯ç”±è‡ªåŠ¨ç”Ÿæˆ
- **TypeScript**: å®Œæ•´çš„ç±»å‹å®‰å…¨æ”¯æŒ
- **Vue I18n**: å›½é™…åŒ–è·¯ç”±å…ƒä¿¡æ¯
- **è·¯ç”±å®ˆå«**: æƒé™éªŒè¯å’Œé¡µé¢æ§åˆ¶

### è·¯ç”±ç”Ÿæˆæœºåˆ¶

#### è‡ªåŠ¨åŒ–æµç¨‹
```typescript
/**
 * è·¯ç”±ç”Ÿæˆæµç¨‹
 * 1. æ–‡ä»¶æ‰«æ: è‡ªåŠ¨æ‰«æ /src/views/ ç›®å½•ç»“æ„
 * 2. è·¯ç”±ç”Ÿæˆ: ç”Ÿæˆ routes.ts æ–‡ä»¶åŒ…å«å®Œæ•´è·¯ç”±é…ç½®
 * 3. ç»„ä»¶å¯¼å…¥: ç”Ÿæˆ imports.ts æ–‡ä»¶å®ç°æ‡’åŠ è½½
 * 4. ç±»å‹å®‰å…¨: å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
 */
```

#### é…ç½®æ–‡ä»¶ç»“æ„
```
src/router/
â”œâ”€â”€ index.ts              # è·¯ç”±å®ä¾‹åˆ›å»ºå’Œé…ç½®
â”œâ”€â”€ elegant/              # ä¼˜é›…è·¯ç”±ç”Ÿæˆç³»ç»Ÿ
â”‚   â”œâ”€â”€ imports.ts        # è‡ªåŠ¨ç”Ÿæˆçš„ç»„ä»¶å¯¼å…¥
â”‚   â”œâ”€â”€ routes.ts         # è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±é…ç½®
â”‚   â””â”€â”€ transform.ts      # è·¯ç”±è½¬æ¢é€»è¾‘
â”œâ”€â”€ guard/                # è·¯ç”±å®ˆå«ç³»ç»Ÿ
â”‚   â”œâ”€â”€ index.ts          # å®ˆå«æ³¨å†Œ
â”‚   â”œâ”€â”€ permission.ts     # æƒé™éªŒè¯
â”‚   â”œâ”€â”€ progress.ts       # åŠ è½½è¿›åº¦
â”‚   â””â”€â”€ title.ts          # é¡µé¢æ ‡é¢˜
â””â”€â”€ routes/               # æ‰‹åŠ¨è·¯ç”±å®šä¹‰
    â””â”€â”€ index.ts          # å¸¸é‡è·¯ç”±
```

## Viewsç›®å½•ç»„ç»‡ç»“æ„

### æ•´ä½“ç›®å½•å¸ƒå±€
```
src/views/
â”œâ”€â”€ ğŸ”§ _builtin/             # å†…ç½®ç³»ç»Ÿé¡µé¢ (constantè·¯ç”±)
â”‚   â”œâ”€â”€ 403/                 # æƒé™æ‹’ç»é¡µé¢
â”‚   â”œâ”€â”€ 404/                 # é¡µé¢æœªæ‰¾åˆ°
â”‚   â”œâ”€â”€ 500/                 # æœåŠ¡å™¨é”™è¯¯
â”‚   â””â”€â”€ login/               # ç™»å½•ç³»ç»Ÿ
â”œâ”€â”€ ğŸ“Š dashboard/            # ä»ªè¡¨æ¿ç³»ç»Ÿ
â”‚   â”œâ”€â”€ analysis/            # æ•°æ®åˆ†æçœ‹æ¿
â”‚   â”œâ”€â”€ mobile-panel/        # ç§»åŠ¨ç«¯çœ‹æ¿
â”‚   â”œâ”€â”€ panel/               # ä¼ ç»Ÿçœ‹æ¿ (å·²è¿ç§»æç¤º)
â”‚   â””â”€â”€ workbench/           # å·¥ä½œå°ä¸»é¡µ
â”œâ”€â”€ ğŸ”Œ device/               # è®¾å¤‡ç®¡ç†æ ¸å¿ƒ
â”‚   â”œâ”€â”€ config/              # è®¾å¤‡æ¨¡æ¿åˆ—è¡¨
â”‚   â”œâ”€â”€ config-detail/       # è®¾å¤‡æ¨¡æ¿è¯¦æƒ…
â”‚   â”œâ”€â”€ config-edit/         # è®¾å¤‡æ¨¡æ¿ç¼–è¾‘
â”‚   â”œâ”€â”€ details/             # è®¾å¤‡è¯¦æƒ…
â”‚   â”œâ”€â”€ details-child/       # å­è®¾å¤‡è¯¦æƒ…
â”‚   â”œâ”€â”€ grouping/            # è®¾å¤‡åˆ†ç»„
â”‚   â”œâ”€â”€ grouping-details/    # åˆ†ç»„è¯¦æƒ…
â”‚   â”œâ”€â”€ manage/              # è®¾å¤‡ç®¡ç†ä¸»é¡µ
â”‚   â”œâ”€â”€ service-access/      # ç¬¬ä¸‰æ–¹æœåŠ¡æ¥å…¥
â”‚   â”œâ”€â”€ service-details/     # æœåŠ¡è¯¦æƒ…
â”‚   â””â”€â”€ template/            # è®¾å¤‡æ¨¡æ¿é…ç½®
â”œâ”€â”€ ğŸ“ˆ visualization/        # å¯è§†åŒ–ç³»ç»Ÿ
â”‚   â”œâ”€â”€ kanban/              # ä¼ ç»Ÿçœ‹æ¿ç®¡ç†
â”‚   â”œâ”€â”€ kanban-details/      # çœ‹æ¿è¯¦æƒ…ç¼–è¾‘
â”‚   â”œâ”€â”€ panel-preview/       # çœ‹æ¿é¢„è§ˆ
â”‚   â””â”€â”€ visual-editor-details/ # å¯è§†åŒ–ç¼–è¾‘å™¨è¯¦æƒ…
â”œâ”€â”€ ğŸš€ ultra-kanban/         # æ–°ä¸€ä»£çœ‹æ¿ç³»ç»Ÿ
â”‚   â”œâ”€â”€ details/             # Ultraçœ‹æ¿è¯¦æƒ…
â”‚   â””â”€â”€ index.vue            # Ultraçœ‹æ¿ä¸»é¡µ
â”œâ”€â”€ ğŸ§ª test/                 # æµ‹è¯•ç³»ç»Ÿ
â”‚   â”œâ”€â”€ datasource-integration/ # æ•°æ®æºé›†æˆæµ‹è¯•
â”‚   â””â”€â”€ index.vue            # æµ‹è¯•ä¸­å¿ƒä¸»é¡µ
â”œâ”€â”€ ğŸš¨ alarm/                # å‘Šè­¦ç®¡ç†
â”‚   â”œâ”€â”€ notification-group/   # é€šçŸ¥ç»„ç®¡ç†
â”‚   â”œâ”€â”€ notification-record/  # é€šçŸ¥è®°å½•
â”‚   â””â”€â”€ warning-message/      # å‘Šè­¦æ¶ˆæ¯
â”œâ”€â”€ ğŸ” management/           # ç³»ç»Ÿç®¡ç†
â”‚   â”œâ”€â”€ user/                # ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ role/                # è§’è‰²ç®¡ç†
â”‚   â”œâ”€â”€ auth/                # æƒé™ç®¡ç†
â”‚   â”œâ”€â”€ api/                 # APIç®¡ç†
â”‚   â”œâ”€â”€ route/               # è·¯ç”±ç®¡ç†
â”‚   â”œâ”€â”€ notification/        # é€šçŸ¥ç®¡ç†
â”‚   â””â”€â”€ setting/             # ç³»ç»Ÿè®¾ç½®
â”œâ”€â”€ âš™ï¸ automation/           # è‡ªåŠ¨åŒ–ç³»ç»Ÿ
â”‚   â”œâ”€â”€ scene-manage/        # åœºæ™¯ç®¡ç†
â”‚   â”œâ”€â”€ scene-edit/          # åœºæ™¯ç¼–è¾‘
â”‚   â”œâ”€â”€ scene-linkage/       # åœºæ™¯è”åŠ¨
â”‚   â””â”€â”€ linkage-edit/        # è”åŠ¨ç¼–è¾‘
â”œâ”€â”€ ğŸ”§ apply/                # åº”ç”¨ç®¡ç†
â”‚   â”œâ”€â”€ plugin/              # æ’ä»¶åº”ç”¨
â”‚   â””â”€â”€ service/             # æœåŠ¡åº”ç”¨
â””â”€â”€ ğŸ› ï¸ å…¶ä»–åŠŸèƒ½æ¨¡å—...
```

## æ ¸å¿ƒé¡µé¢åˆ†æ

### 1. _builtin ç³»ç»Ÿå†…ç½®é¡µé¢

#### ç™»å½•ç³»ç»Ÿ (login/)
```typescript
/**
 * åŠ¨æ€ç™»å½•è·¯ç”±é…ç½®
 * æ”¯æŒå¤šç§ç™»å½•æ¨¡å¼çš„å•é¡µé¢åº”ç”¨
 */
interface LoginRoute {
  path: '/login/:module(pwd-login|code-login|register|reset-pwd|bind-wechat)?'
  component: LoginView
  meta: {
    constant: true,  // æ— éœ€è®¤è¯çš„å¸¸é‡è·¯ç”±
    title: 'login'
  }
}
```

**åŠŸèƒ½ç‰¹æ€§:**
- **å¯†ç ç™»å½•**: ç”¨æˆ·åå¯†ç è®¤è¯
- **éªŒè¯ç ç™»å½•**: æ‰‹æœºéªŒè¯ç ç™»å½•
- **ç”¨æˆ·æ³¨å†Œ**: æ–°ç”¨æˆ·æ³¨å†Œæµç¨‹
- **å¯†ç é‡ç½®**: å¿˜è®°å¯†ç é‡ç½®
- **å¾®ä¿¡ç»‘å®š**: ç¬¬ä¸‰æ–¹è´¦å·ç»‘å®š

**æŠ€æœ¯å®ç°:**
```vue
<script setup lang="ts">
/**
 * ç™»å½•é¡µé¢ä¸»ç»„ä»¶
 * é€šè¿‡è·¯ç”±å‚æ•°åŠ¨æ€åˆ‡æ¢ç™»å½•æ¨¡å¼
 */
import { computed } from 'vue'
import { useRoute } from 'vue-router'

const route = useRoute()
const loginModule = computed(() => {
  const module = route.params.module as string
  return module || 'pwd-login'  // é»˜è®¤å¯†ç ç™»å½•
})

// æ ¹æ®æ¨¡å—åŠ¨æ€åŠ è½½å¯¹åº”ç»„ä»¶
const LoginComponents = {
  'pwd-login': PwdLogin,
  'code-login': CodeLogin,
  'register': Register,
  'reset-pwd': ResetPwd,
  'bind-wechat': BindWechat
}
</script>
```

#### é”™è¯¯é¡µé¢ç³»ç»Ÿ
- **403é¡µé¢**: æƒé™ä¸è¶³æç¤ºï¼Œæä¾›è¿”å›é¦–é¡µé“¾æ¥
- **404é¡µé¢**: é¡µé¢æœªæ‰¾åˆ°ï¼Œé›†æˆæœç´¢å»ºè®®
- **500é¡µé¢**: æœåŠ¡å™¨é”™è¯¯ï¼Œæä¾›é”™è¯¯æŠ¥å‘ŠåŠŸèƒ½

### 2. Dashboard ä»ªè¡¨æ¿ç³»ç»Ÿ

#### Workbench å·¥ä½œå°ä¸»é¡µ
```vue
<script setup lang="ts">
/**
 * å·¥ä½œå°ä¸»é¡µ
 * ç‰©è”ç½‘å¹³å°çš„ä¸»è¦æ•°æ®å±•ç¤ºä¸­å¿ƒ
 */
defineOptions({
  name: 'Workbench'
})

// é¡µé¢å¸ƒå±€: Header + Main
interface WorkbenchLayout {
  header: {
    user: UserInfo
    notifications: Notification[]
    quickActions: QuickAction[]
  }
  main: {
    statistics: SystemStats
    charts: ChartData[]
    recentActivities: Activity[]
  }
}
</script>

<template>
  <div class="workbench">
    <WorkbenchHeader 
      :user="userInfo"
      :notifications="notifications"
    />
    <WorkbenchMain
      :statistics="systemStats"
      :charts="chartData"
      :activities="recentActivities"
    />
  </div>
</template>
```

### 3. Device è®¾å¤‡ç®¡ç†ç³»ç»Ÿ

#### è®¾å¤‡ç®¡ç†ä¸»é¡µ (device/manage/)
```typescript
/**
 * è®¾å¤‡ç®¡ç†é¡µé¢ç»“æ„
 * å®Œæ•´çš„è®¾å¤‡ç”Ÿå‘½å‘¨æœŸç®¡ç†
 */
interface DeviceManagePage {
  // ä¸»è¦åŠŸèƒ½
  deviceList: DeviceListComponent
  deviceAdd: MultiStepDeviceAdd    // å¤šæ­¥éª¤æ·»åŠ æµç¨‹
  deviceImport: BatchImportComponent
  deviceExport: ExportComponent
  
  // è®¾å¤‡æ“ä½œ
  deviceEdit: DeviceEditModal
  deviceDelete: BatchDeleteComponent
  deviceConfig: DeviceConfigModal
  
  // é«˜çº§åŠŸèƒ½
  deviceGroup: GroupManageComponent
  deviceMap: DeviceMapComponent
  deviceMonitor: MonitoringComponent
}
```

**å¤šæ­¥éª¤è®¾å¤‡æ·»åŠ æµç¨‹:**
```vue
<!-- è®¾å¤‡æ·»åŠ æ­¥éª¤ç»„ä»¶ -->
<template>
  <n-steps :current="currentStep" size="small">
    <n-step title="é€‰æ‹©è®¾å¤‡æ¨¡æ¿" />
    <n-step title="é…ç½®è®¾å¤‡ä¿¡æ¯" />
    <n-step title="å®Œæˆæ·»åŠ " />
  </n-steps>
  
  <component 
    :is="currentStepComponent"
    v-model="deviceData"
    @next="handleNext"
    @prev="handlePrev"
  />
</template>
```

#### è®¾å¤‡æ¨¡æ¿ç³»ç»Ÿ (device/template/)
```typescript
/**
 * è®¾å¤‡æ¨¡æ¿é…ç½®é¡µé¢
 * æ”¯æŒå¤æ‚çš„å¡ç‰‡é€‰æ‹©å’Œæ­¥éª¤é…ç½®
 */
interface DeviceTemplateConfig {
  // åŸºç¡€é…ç½®
  templateInfo: TemplateBasicInfo
  
  // å¡ç‰‡é€‰æ‹©ç³»ç»Ÿ
  cardSelection: {
    builtin: BuiltinCard[]     // å†…ç½®ç³»ç»Ÿå¡ç‰‡
    chart: ChartCard[]         // å›¾è¡¨å¡ç‰‡
    custom: CustomCard[]       # è‡ªå®šä¹‰å¡ç‰‡
  }
  
  // é«˜çº§é…ç½®
  protocolConfig: ProtocolConfig
  dataPointConfig: DataPointConfig
  alertRuleConfig: AlertRuleConfig
}
```

### 4. Visualization å¯è§†åŒ–ç³»ç»Ÿ

#### çœ‹æ¿ç®¡ç† (visualization/kanban/)
```vue
<script setup lang="ts">
/**
 * ä¼ ç»Ÿçœ‹æ¿ç®¡ç†é¡µé¢
 * ç½‘æ ¼å¼çœ‹æ¿å¡ç‰‡å±•ç¤ºç³»ç»Ÿ
 */
import { ref, reactive } from 'vue'
import { useKanbanStore } from '@/store/modules/panel'

// çœ‹æ¿æ•°æ®ç®¡ç†
const kanbanStore = useKanbanStore()
const kanbanList = ref<KanbanItem[]>([])

// æœç´¢å’Œè¿‡æ»¤
const searchParams = reactive({
  keyword: '',
  isHome: undefined,
  pageSize: 20,
  pageNum: 1
})

// çœ‹æ¿æ“ä½œ
const handleEdit = (kanban: KanbanItem) => {
  router.push(`/visualization/kanban-details/${kanban.id}`)
}

const handlePreview = (kanban: KanbanItem) => {
  window.open(`/visualization/panel-preview/${kanban.id}`)
}
</script>

<template>
  <div class="kanban-manage">
    <!-- æœç´¢å’Œæ“ä½œæ  -->
    <div class="toolbar">
      <n-input 
        v-model:value="searchParams.keyword"
        :placeholder="$t('common.search')"
        clearable
      />
      <n-button type="primary" @click="handleAdd">
        {{ $t('common.add') }}
      </n-button>
    </div>
    
    <!-- çœ‹æ¿ç½‘æ ¼å±•ç¤º -->
    <div class="kanban-grid">
      <div 
        v-for="kanban in kanbanList"
        :key="kanban.id"
        class="kanban-card"
      >
        <KanbanCard
          :kanban="kanban"
          @edit="handleEdit"
          @delete="handleDelete"
          @preview="handlePreview"
        />
      </div>
    </div>
  </div>
</template>
```

### 5. Ultra-Kanban æ–°ä¸€ä»£çœ‹æ¿ç³»ç»Ÿ

#### é©æ–°æ€§è®¾è®¡
```vue
<script setup lang="ts">
/**
 * Ultraçœ‹æ¿é¡µé¢
 * é›†æˆvisual-editorç»„ä»¶çš„å…¨æ–°çœ‹æ¿å®ç°
 * å®Œå…¨é‡å†™çš„çœ‹æ¿ç³»ç»Ÿï¼Œå…·æœ‰æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
 */
import { ref, reactive, computed } from 'vue'
import { useRouter } from 'vue-router'
import { useThemeStore } from '@/store/modules/theme'
import PanelEditor from '@/components/visual-editor/PanelEditor.vue'

// ä¸»é¢˜ç³»ç»Ÿé›†æˆ
const themeStore = useThemeStore()

// é¡µé¢çŠ¶æ€ç®¡ç†
const pageState = reactive({
  loading: false,
  kanbanList: [] as KanbanItem[],
  selectedKanban: null as KanbanItem | null,
  showEditor: false
})

/**
 * åˆ›å»ºæ–°çœ‹æ¿
 * é›†æˆVisual Editorçš„çœ‹æ¿åˆ›å»ºæµç¨‹
 */
const handleCreateKanban = () => {
  pageState.showEditor = true
  pageState.selectedKanban = null
}

/**
 * ç¼–è¾‘çœ‹æ¿
 * ä½¿ç”¨Visual Editorè¿›è¡Œçœ‹æ¿ç¼–è¾‘
 */
const handleEditKanban = (kanban: KanbanItem) => {
  pageState.selectedKanban = kanban
  pageState.showEditor = true
}
</script>

<template>
  <div class="ultra-kanban-page">
    <n-card :bordered="false">
      <template #header>
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold">
            {{ $t('page.ultra-kanban.title') }}
          </h3>
          <n-button 
            type="primary" 
            @click="handleCreateKanban"
          >
            {{ $t('common.create') }}
          </n-button>
        </div>
      </template>
      
      <!-- çœ‹æ¿åˆ—è¡¨ -->
      <UltraKanbanList
        :kanban-list="pageState.kanbanList"
        :loading="pageState.loading"
        @edit="handleEditKanban"
        @delete="handleDeleteKanban"
        @preview="handlePreviewKanban"
      />
    </n-card>
    
    <!-- Visual Editor æ¨¡æ€æ¡† -->
    <n-modal
      v-model:show="pageState.showEditor"
      :title="pageState.selectedKanban ? $t('common.edit') : $t('common.create')"
      class="ultra-kanban-editor-modal"
      style="width: 95vw; max-width: none;"
    >
      <PanelEditor
        :kanban-id="pageState.selectedKanban?.id"
        @save="handleSaveKanban"
        @cancel="pageState.showEditor = false"
      />
    </n-modal>
  </div>
</template>

<style scoped>
.ultra-kanban-page {
  padding: 16px;
  min-height: 100vh;
  background-color: var(--body-color);
}

.ultra-kanban-editor-modal {
  .n-modal {
    max-height: 95vh;
    overflow: auto;
  }
}
</style>
```

### 6. Test æµ‹è¯•ç³»ç»Ÿ

#### æµ‹è¯•ä¸­å¿ƒä¸»é¡µ (test/index.vue)
```vue
<script setup lang="ts">
/**
 * æµ‹è¯•ä¸­å¿ƒä¸»é¡µ
 * ç³»ç»ŸåŒ–çš„æµ‹è¯•åŠŸèƒ½ç»„ç»‡å’ŒçŠ¶æ€ç›‘æ§
 */
import { ref, reactive, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { useI18n } from 'vue-i18n'

const { t } = useI18n()
const router = useRouter()

// æµ‹è¯•é¡¹ç›®é…ç½®
const testItems = ref([
  {
    id: 'datasource-integration',
    title: t('test.datasourceIntegration.title'),
    description: t('test.datasourceIntegration.description'),
    status: 'ready',
    route: '/test/datasource-integration',
    tags: ['Card 2.1', 'æ•°æ®æº', 'é›†æˆæµ‹è¯•']
  },
  {
    id: 'editor-integration',
    title: t('test.editorIntegration.title'), 
    description: t('test.editorIntegration.description'),
    status: 'ready',
    route: '/test/editor-integration',
    tags: ['Visual Editor', 'ç¼–è¾‘å™¨', 'åŠŸèƒ½æµ‹è¯•']
  },
  {
    id: 'component-api-config',
    title: t('test.componentApiConfig.title'),
    description: t('test.componentApiConfig.description'),
    status: 'ready',
    route: '/test/component-api-config',
    tags: ['APIé…ç½®', 'ç»„ä»¶æµ‹è¯•']
  }
])

/**
 * ç³»ç»ŸçŠ¶æ€ç›‘æ§
 */
const systemStatus = reactive({
  card2System: 'normal',
  visualEditor: 'normal',
  dataSource: 'normal',
  lastUpdate: new Date()
})
</script>
```

## è·¯ç”±é…ç½®å’Œå…ƒä¿¡æ¯

### è·¯ç”±å…ƒä¿¡æ¯ç»“æ„
```typescript
/**
 * è·¯ç”±å…ƒä¿¡æ¯æ¥å£å®šä¹‰
 */
interface RouteMeta {
  title: string                    // é¡µé¢æ ‡é¢˜
  i18nKey?: string                // å›½é™…åŒ–é”®å
  icon?: string                   // é¡µé¢å›¾æ ‡
  order?: number                  // æ’åºæƒé‡
  constant?: boolean              // æ˜¯å¦ä¸ºå¸¸é‡è·¯ç”± (æ— éœ€è®¤è¯)
  hideInMenu?: boolean            // æ˜¯å¦åœ¨èœå•ä¸­éšè—
  activeMenu?: string             // æ¿€æ´»çš„èœå•é¡¹
  multiTab?: boolean              // æ˜¯å¦æ”¯æŒå¤šæ ‡ç­¾
  fixedIndexInTab?: number        // æ ‡ç­¾å›ºå®šä½ç½®
  permissions?: string[]          // é¡µé¢æƒé™
}
```

### åŠ¨æ€è·¯ç”±ç¤ºä¾‹
```typescript
/**
 * åŠ¨æ€è·¯ç”±é…ç½®ç¤ºä¾‹
 */
const routes: RouteRecordRaw[] = [
  {
    name: 'device_manage',
    path: '/device/manage',
    component: () => import('@/views/device/manage/index.vue'),
    meta: {
      title: 'device_manage',
      i18nKey: 'route.device_manage',
      icon: 'mdi:devices',
      order: 1
    }
  },
  {
    name: 'device_details',
    path: '/device/details/:id',
    component: () => import('@/views/device/details/index.vue'),
    meta: {
      title: 'device_details',
      i18nKey: 'route.device_details',
      hideInMenu: true,
      activeMenu: 'device_manage'
    }
  }
]
```

## è·¯ç”±å®ˆå«ç³»ç»Ÿ

### æƒé™éªŒè¯å®ˆå«
```typescript
/**
 * æƒé™éªŒè¯å®ˆå«å®ç°
 * /src/router/guard/permission.ts
 */
import { useAuthStore } from '@/store/modules/auth'
import { useRouteStore } from '@/store/modules/route'

export function createPermissionGuard(router: Router) {
  router.beforeEach(async (to, from, next) => {
    // 1. æ£€æŸ¥æ˜¯å¦ä¸ºå¸¸é‡è·¯ç”±
    if (to.meta.constant) {
      next()
      return
    }

    // 2. æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
    const authStore = useAuthStore()
    if (!authStore.isLogin) {
      next({ name: 'login', query: { redirect: to.fullPath } })
      return
    }

    // 3. æ£€æŸ¥è·¯ç”±æƒé™
    const routeStore = useRouteStore()
    if (!routeStore.isRouteExist(to.name)) {
      next({ name: '404' })
      return
    }

    // 4. æ£€æŸ¥é¡µé¢æƒé™
    if (to.meta.permissions) {
      const hasPermission = authStore.hasPermissions(to.meta.permissions)
      if (!hasPermission) {
        next({ name: '403' })
        return
      }
    }

    next()
  })
}
```

### é¡µé¢æ ‡é¢˜å®ˆå«
```typescript
/**
 * é¡µé¢æ ‡é¢˜ç®¡ç†å®ˆå«
 * /src/router/guard/title.ts
 */
export function createTitleGuard(router: Router) {
  router.afterEach((to) => {
    const { title, i18nKey } = to.meta
    
    // ä½¿ç”¨å›½é™…åŒ–æ ‡é¢˜
    if (i18nKey) {
      const { $t } = useI18n()
      document.title = `${$t(i18nKey)} - ${$t('app.name')}`
    } else if (title) {
      document.title = `${title} - ThingsPanel`
    }
  })
}
```

## å›½é™…åŒ–è·¯ç”±æ”¯æŒ

### è·¯ç”±æ ‡é¢˜å›½é™…åŒ–
```json
// /src/locales/langs/zh-cn/route.json
{
  "dashboard_workbench": "å·¥ä½œå°",
  "dashboard_analysis": "åˆ†æé¡µ",
  "device_manage": "è®¾å¤‡ç®¡ç†",
  "device_template": "è®¾å¤‡æ¨¡æ¿",
  "visualization_kanban": "çœ‹æ¿ç®¡ç†",
  "ultra-kanban": "Ultraçœ‹æ¿",
  "test_center": "æµ‹è¯•ä¸­å¿ƒ"
}

// /src/locales/langs/en-us/route.json  
{
  "dashboard_workbench": "Workbench",
  "dashboard_analysis": "Analysis",
  "device_manage": "Device Management", 
  "device_template": "Device Template",
  "visualization_kanban": "Kanban Management",
  "ultra-kanban": "Ultra Kanban",
  "test_center": "Test Center"
}
```

### é¢åŒ…å±‘å¯¼èˆªå›½é™…åŒ–
```vue
<script setup lang="ts">
/**
 * é¢åŒ…å±‘ç»„ä»¶å›½é™…åŒ–å®ç°
 */
import { computed } from 'vue'
import { useRoute } from 'vue-router'
import { useI18n } from 'vue-i18n'

const route = useRoute()
const { t } = useI18n()

const breadcrumbs = computed(() => {
  return route.matched.map(item => ({
    name: item.name,
    title: item.meta.i18nKey ? t(item.meta.i18nKey) : item.meta.title,
    path: item.path
  }))
})
</script>
```

## æœ€ä½³å®è·µå’Œç‰¹è‰²åŠŸèƒ½

### 1. è‡ªåŠ¨åŒ–è·¯ç”±ç”Ÿæˆ
- **é›¶é…ç½®**: åŸºäºæ–‡ä»¶ç»“æ„è‡ªåŠ¨ç”Ÿæˆè·¯ç”±
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹æ¨æ–­
- **æ‡’åŠ è½½**: è‡ªåŠ¨å®ç°ç»„ä»¶æ‡’åŠ è½½ä¼˜åŒ–

### 2. å¤šå±‚çº§è·¯ç”±æ”¯æŒ
```typescript
// æ”¯æŒå¤æ‚çš„åµŒå¥—è·¯ç”±ç»“æ„
{
  name: 'multi-menu_second_child_home',
  path: '/multi-menu/second/child/home', 
  component: 'view.multi-menu_second_child_home'
}
```

### 3. åŠ¨æ€è·¯ç”±å‚æ•°
```typescript
// æ”¯æŒåŠ¨æ€å‚æ•°å’Œå¯é€‰å‚æ•°
{
  name: 'login',
  path: '/login/:module(pwd-login|code-login|register|reset-pwd|bind-wechat)?'
}
```

### 4. æƒé™è·¯ç”±æ§åˆ¶
- **å¸¸é‡è·¯ç”±**: `constant: true` æ— éœ€è®¤è¯
- **åŠ¨æ€è·¯ç”±**: åŸºäºç”¨æˆ·æƒé™åŠ¨æ€ç”Ÿæˆ
- **èœå•æ§åˆ¶**: `hideInMenu` æ§åˆ¶èœå•æ˜¾ç¤º

### 5. æ ‡ç­¾é¡µè·¯ç”±ç®¡ç†
- **å¤šæ ‡ç­¾**: `multiTab: true` æ”¯æŒå¤šæ ‡ç­¾é¡µ
- **å›ºå®šæ ‡ç­¾**: `fixedIndexInTab` è®¾ç½®å›ºå®šä½ç½®
- **æ ‡ç­¾ç¼“å­˜**: æ™ºèƒ½çš„é¡µé¢ç¼“å­˜æœºåˆ¶

## æ€»ç»“

ThingsPanelçš„é¡µé¢è·¯ç”±ç³»ç»Ÿå±•ç°äº†ç°ä»£åŒ–Vue 3é¡¹ç›®çš„æœ€ä½³å®è·µï¼š

### æŠ€æœ¯ä¼˜åŠ¿
1. **è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜**: åŸºäºæ–‡ä»¶çš„è·¯ç”±è‡ªåŠ¨ç”Ÿæˆ
2. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptæ”¯æŒ
3. **å›½é™…åŒ–å®Œå¤‡**: è·¯ç”±æ ‡é¢˜å’Œé¢åŒ…å±‘å›½é™…åŒ–
4. **æƒé™æ§åˆ¶å®Œå–„**: å¤šå±‚çº§æƒé™éªŒè¯æœºåˆ¶
5. **ç”¨æˆ·ä½“éªŒä¼˜ç§€**: åŠ è½½è¿›åº¦ã€é”™è¯¯å¤„ç†ã€æ ‡ç­¾ç®¡ç†

### ä¸šåŠ¡é€‚é…æ€§
1. **ç‰©è”ç½‘ä¸šåŠ¡å®Œæ•´**: è¦†ç›–è®¾å¤‡ç®¡ç†ã€æ•°æ®å¯è§†åŒ–ã€ç³»ç»Ÿç®¡ç†ç­‰å…¨ä¸šåŠ¡æµç¨‹
2. **æ‰©å±•æ€§è‰¯å¥½**: æ”¯æŒæ’ä»¶åŒ–æ‰©å±•å’Œæ¨¡å—åŒ–å¼€å‘
3. **æµ‹è¯•å‹å¥½**: å®Œæ•´çš„æµ‹è¯•é¡µé¢å’Œå¼€å‘è°ƒè¯•æ”¯æŒ
4. **ç§»åŠ¨ç«¯æ”¯æŒ**: å“åº”å¼è®¾è®¡å’Œç§»åŠ¨ç«¯è·¯ç”±é€‚é…

### å¼€å‘æ•ˆç‡
1. **é›¶é…ç½®è·¯ç”±**: å‡å°‘æ‰‹åŠ¨è·¯ç”±é…ç½®å·¥ä½œé‡
2. **è§„èŒƒç»Ÿä¸€**: ç»Ÿä¸€çš„é¡µé¢ç»„ç»‡å’Œè·¯ç”±å‘½åè§„èŒƒ
3. **è°ƒè¯•ä¾¿åˆ©**: å®Œå–„çš„é”™è¯¯é¡µé¢å’Œå¼€å‘å·¥å…·é›†æˆ
4. **ç»´æŠ¤ç®€å•**: æ¸…æ™°çš„ç›®å½•ç»“æ„å’Œç»„ä»¶ç»„ç»‡

è¿™ä¸ªè·¯ç”±ç³»ç»Ÿä¸ºç‰©è”ç½‘å¹³å°æä¾›äº†åšå®çš„å¯¼èˆªåŸºç¡€ï¼Œæ”¯æŒå¿«é€Ÿå¼€å‘å’Œé•¿æœŸç»´æŠ¤ã€‚