<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ” å›è°ƒè°ƒè¯•æµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .test-container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    }
    .test-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 32px;
      text-align: center;
    }
    .test-header h1 {
      margin: 0 0 12px 0;
      font-size: 28px;
    }
    .test-header p {
      margin: 0;
      font-size: 16px;
      opacity: 0.9;
    }
    .test-section {
      margin-bottom: 40px;
      padding: 24px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      background: #fafafa;
    }
    .test-section h3 {
      margin: 0 0 20px 0;
      color: #333;
      font-size: 20px;
    }
    .step {
      margin-bottom: 20px;
      padding: 16px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid #2080f0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .step h4 {
      margin: 0 0 12px 0;
      color: #333;
      font-size: 16px;
    }
    .step p {
      margin: 0;
      color: #666;
      font-size: 14px;
      line-height: 1.6;
    }
    .step ul {
      margin: 8px 0 0 0;
      color: #666;
      font-size: 14px;
    }
    .debug-logs {
      background: #f8f8f8;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: #333;
      margin: 16px 0;
      border: 1px solid #e0e0e0;
      overflow-x: auto;
    }
    .nav-link {
      display: inline-block;
      padding: 12px 24px;
      background: #2080f0;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      margin-right: 12px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    .nav-link:hover {
      background: #40a9ff;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(32,128,240,0.3);
    }
    .critical-check {
      background: #fff3cd;
      border-left-color: #ffc107;
      border: 1px solid #ffeeba;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    .critical-check h4 {
      color: #856404;
      margin: 0 0 8px 0;
    }
    .critical-check p {
      color: #856404;
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>ğŸ” å›è°ƒè°ƒè¯•æµ‹è¯•</h1>
      <p>è¿½è¸ª ConfigEventBus â†’ InteractionManager å›è°ƒé“¾è·¯ï¼Œå®šä½ DataItemFetcher æœªæ‰§è¡Œçš„åŸå› </p>
    </div>

    <div class="test-section">
      <h3>ğŸ¯ å½“å‰é—®é¢˜åˆ†æ</h3>
      
      <div class="step">
        <h4>âœ… å·²ç¡®è®¤æ­£å¸¸çš„éƒ¨åˆ†</h4>
        <ul>
          <li>åŸºç¡€é…ç½®å˜æ›´æ£€æµ‹æ­£å¸¸</li>
          <li>ConfigEventBus äº‹ä»¶åˆ†å‘æ­£å¸¸</li>
          <li>shouldTriggerExecution è®¾ç½®æ­£ç¡®</li>
          <li>çœ‹åˆ°äº† "ğŸš€ [ConfigEventBus] è§¦å‘æ•°æ®é‡æ–°æ‰§è¡Œ" æ—¥å¿—</li>
        </ul>
      </div>

      <div class="step">
        <h4>âŒ å¾…è§£å†³çš„é—®é¢˜</h4>
        <ul>
          <li>æ²¡æœ‰çœ‹åˆ° "ğŸš€ [InteractionManager] å¤„ç†æ•°æ®æ‰§è¡Œè§¦å‘å™¨äº‹ä»¶"</li>
          <li>è¯´æ˜ InteractionManager.handleDataExecutionTrigger æ²¡æœ‰è¢«è°ƒç”¨</li>
          <li>å› æ­¤ DataItemFetcher ä¹Ÿä¸ä¼šè¢«è§¦å‘</li>
        </ul>
      </div>

      <div class="critical-check">
        <h4>ğŸ” å…³é”®è°ƒè¯•ç‚¹</h4>
        <p>ç°åœ¨å·²ç»åœ¨ ConfigEventBus å’Œ InteractionManager ä¸­æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œå¯ä»¥ç²¾ç¡®å®šä½å›è°ƒå¤±è´¥çš„åŸå› ã€‚</p>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸ§ª æµ‹è¯•æ­¥éª¤</h3>
      
      <div class="step">
        <h4>æ­¥éª¤ 1ï¼šæ¸…ç©ºæ§åˆ¶å°å¹¶å¼€å§‹æµ‹è¯•</h4>
        <p>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œæ¸…ç©ºæ§åˆ¶å°æ—¥å¿—</p>
      </div>

      <div class="step">
        <h4>æ­¥éª¤ 2ï¼šè®¿é—®æµ‹è¯•é¡µé¢</h4>
        <p>æ‰“å¼€æ•°æ®æºç³»ç»Ÿæµ‹è¯•é¡µé¢</p>
        <a href="http://localhost:5002/test/data-source-system" class="nav-link" target="_blank">
          ğŸ”— æ•°æ®æºç³»ç»Ÿæµ‹è¯•
        </a>
      </div>

      <div class="step">
        <h4>æ­¥éª¤ 3ï¼šä¿®æ”¹åŸºç¡€é…ç½®</h4>
        <p>æ‰¾åˆ°ä»»ä½•ç»„ä»¶ï¼Œä¿®æ”¹åŸºç¡€é…ç½®ä¸­çš„ deviceIdï¼Œç„¶åè§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—</p>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸ” é¢„æœŸè°ƒè¯•æ—¥å¿—</h3>
      
      <div class="step">
        <h4>åº”è¯¥çœ‹åˆ°çš„å®Œæ•´æ—¥å¿—é“¾</h4>
        <div class="debug-logs">
// åŸºç¡€é…ç½®å˜æ›´
ğŸ”§ [ConfigEventBus] åŸºç¡€é…ç½®å˜æ›´äº‹ä»¶ {...}

// äº‹ä»¶è§¦å‘
ğŸš€ [ConfigEventBus] è§¦å‘æ•°æ®é‡æ–°æ‰§è¡Œ {...}

// æ–°å¢çš„è°ƒè¯•æ—¥å¿—
ğŸ”„ [ConfigEventBus] å³å°†è°ƒç”¨dataExecutionTriggerCallback
âœ… [ConfigEventBus] dataExecutionTriggerCallbackè°ƒç”¨å®Œæˆ {...}

// InteractionManager æ¥æ”¶
ğŸ”¥ğŸ”¥ğŸ”¥ [InteractionManager] handleDataExecutionTrigger è¢«è°ƒç”¨äº†ï¼ï¼ï¼
ğŸš€ [InteractionManager] å¤„ç†æ•°æ®æ‰§è¡Œè§¦å‘å™¨äº‹ä»¶ {...}

// åç»­æ‰§è¡Œ
ğŸ” [InteractionManager] æ£€æŸ¥HTTPæ•°æ®æºæ˜ å°„ {...}
ğŸ”„ [InteractionManager] è§¦å‘HTTPæ•°æ®æºé‡æ–°æ‰§è¡Œ {...}
âœ… [InteractionManager] HTTPæ•°æ®æºé‡æ–°æ‰§è¡Œå®Œæˆ {...}
        </div>
      </div>

      <div class="step">
        <h4>å¦‚æœçœ‹ä¸åˆ° InteractionManager æ—¥å¿—</h4>
        <p>è¯´æ˜å›è°ƒæ³¨å†Œæˆ–è°ƒç”¨å‡ºç°é—®é¢˜ï¼Œéœ€è¦æ£€æŸ¥ï¼š</p>
        <ul>
          <li>InteractionManager æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–</li>
          <li>registerDataExecutionTrigger æ˜¯å¦æˆåŠŸæ³¨å†Œ</li>
          <li>å›è°ƒå‡½æ•°ç»‘å®šæ˜¯å¦æ­£ç¡®</li>
          <li>æ˜¯å¦æœ‰å¼‚æ­¥æ‰§è¡Œå¯¼è‡´çš„ä¸Šä¸‹æ–‡ä¸¢å¤±</li>
        </ul>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸ¯ è¯Šæ–­ç»“æœåˆ†æ</h3>
      
      <div class="step">
        <h4>æƒ…å†µ1ï¼šçœ‹åˆ°äº†å®Œæ•´æ—¥å¿—é“¾</h4>
        <p>è¯´æ˜å›è°ƒé“¾è·¯æ­£å¸¸ï¼Œé—®é¢˜å¯èƒ½åœ¨äºï¼š</p>
        <ul>
          <li>HTTP æ•°æ®æºæ˜ å°„æ²¡æœ‰æ‰¾åˆ°</li>
          <li>é…ç½®æ ¼å¼è½¬æ¢æœ‰é—®é¢˜</li>
          <li>VisualEditorBridge æ‰§è¡Œå¤±è´¥</li>
        </ul>
      </div>

      <div class="step">
        <h4>æƒ…å†µ2ï¼šConfigEventBus è°ƒç”¨å®Œæˆä½† InteractionManager æ²¡å“åº”</h4>
        <p>è¯´æ˜å›è°ƒæ³¨å†Œæˆ–è°ƒç”¨æœ‰é—®é¢˜ï¼š</p>
        <ul>
          <li>InteractionManager åˆå§‹åŒ–å¤±è´¥</li>
          <li>å›è°ƒå‡½æ•°ç»‘å®šé”™è¯¯</li>
          <li>å¼‚æ­¥æ‰§è¡Œä¸Šä¸‹æ–‡ä¸¢å¤±</li>
        </ul>
      </div>

      <div class="step">
        <h4>æƒ…å†µ3ï¼šConfigEventBus å°±æ²¡æœ‰è°ƒç”¨</h4>
        <p>è¯´æ˜é…ç½®äº‹ä»¶åˆ†å‘æœ‰é—®é¢˜ï¼š</p>
        <ul>
          <li>äº‹ä»¶æ ¼å¼ä¸æ­£ç¡®</li>
          <li>shouldTriggerExecution æ²¡æœ‰è®¾ç½®</li>
          <li>äº‹ä»¶ç›‘å¬å™¨æ³¨å†Œå¤±è´¥</li>
        </ul>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸ”— ç›¸å…³æµ‹è¯•é“¾æ¥</h3>
      <a href="http://localhost:5002/test/data-source-system" class="nav-link" target="_blank">
        æ•°æ®æºç³»ç»Ÿæµ‹è¯•
      </a>
      <a href="http://localhost:5002/test/editor-integration" class="nav-link" target="_blank">
        ç¼–è¾‘å™¨é›†æˆæµ‹è¯•
      </a>
    </div>
  </div>
</body>
</html>