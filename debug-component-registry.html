<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»„ä»¶æ³¨å†ŒçŠ¶æ€è°ƒè¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .component-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        .component-name { 
            font-weight: bold; 
            color: #007bff; 
            font-size: 16px; 
        }
        .component-type { 
            color: #6c757d; 
            font-size: 14px; 
            margin: 5px 0;
        }
        .component-status {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .status-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-badge.success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .status-badge.error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        .status-badge.warning { 
            background: #fff3cd; 
            color: #856404; 
            border: 1px solid #ffeaa7; 
        }
        .details {
            margin-top: 10px;
            font-size: 13px;
            color: #6c757d;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover { background: #0056b3; }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }
        .stat-label {
            font-size: 14px;
            color: #555;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="debug-card">
        <h1>ğŸ” Card 2.1 ç»„ä»¶æ³¨å†ŒçŠ¶æ€è°ƒè¯•</h1>
        <p>æ£€æŸ¥ triple-data-displayã€simple-displayã€dual-data-display ç»„ä»¶çš„æ³¨å†ŒçŠ¶æ€</p>

        <div>
            <button onclick="checkRegistryStatus()">ğŸ“‹ æ£€æŸ¥æ³¨å†Œè¡¨çŠ¶æ€</button>
            <button onclick="checkTargetComponents()">ğŸ¯ æ£€æŸ¥ç›®æ ‡ç»„ä»¶</button>
            <button onclick="checkVueComponents()">ğŸ”§ æ£€æŸ¥Vueç»„ä»¶</button>
            <button onclick="simulateVisualEditorFlow()">ğŸ¨ æ¨¡æ‹Ÿç¼–è¾‘å™¨æµç¨‹</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
        </div>

        <div class="stats" id="stats-container" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="total-registered">0</div>
                <div class="stat-label">å·²æ³¨å†Œç»„ä»¶</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="target-found">0</div>
                <div class="stat-label">ç›®æ ‡ç»„ä»¶æ‰¾åˆ°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="vue-valid">0</div>
                <div class="stat-label">Vueç»„ä»¶æœ‰æ•ˆ</div>
            </div>
        </div>

        <div id="debug-results"></div>
    </div>

    <script type="module">
        const targetComponents = ['triple-data-display', 'simple-display', 'dual-data-display'];
        
        // æ¨¡æ‹Ÿ ComponentRegistryï¼ˆä»å®é™…æºä»£ç å¤åˆ¶çš„é€»è¾‘ï¼‰
        class DebugComponentRegistry {
            static definitions = new Map();
            
            static register(definition) {
                if (!definition || !definition.type) {
                    console.error('âš ï¸ å°è¯•æ³¨å†Œæ— æ•ˆç»„ä»¶å®šä¹‰:', definition);
                    return;
                }
                
                this.definitions.set(definition.type, definition);
                console.log(`âœ… æ³¨å†Œç»„ä»¶: ${definition.type}`);
            }
            
            static get(componentType) {
                return this.definitions.get(componentType);
            }
            
            static getAll() {
                return Array.from(this.definitions.values());
            }
            
            static has(componentType) {
                return this.definitions.has(componentType);
            }
        }

        function addResult(title, content, type = 'info') {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'component-item';
            resultDiv.innerHTML = `
                <div class="component-name">${title}</div>
                <div class="details">${content}</div>
            `;
            document.getElementById('debug-results').appendChild(resultDiv);
        }

        function updateStats(totalRegistered, targetFound, vueValid) {
            document.getElementById('total-registered').textContent = totalRegistered;
            document.getElementById('target-found').textContent = targetFound;
            document.getElementById('vue-valid').textContent = vueValid;
            document.getElementById('stats-container').style.display = 'block';
        }

        function createMockComponentDefinition(type) {
            return {
                type: type,
                name: `${type} ç»„ä»¶`,
                description: `${type} ç»„ä»¶æè¿°`,
                category: 'æ•°æ®å±•ç¤º',
                icon: 'icon-placeholder',
                component: {
                    // æ¨¡æ‹Ÿ Vue ç»„ä»¶
                    __vccOpts: { name: type },
                    render: () => `<div>${type} ç»„ä»¶æ¸²æŸ“</div>`
                },
                configComponent: null,
                config: {
                    style: { width: 300, height: 200 }
                }
            };
        }

        window.checkRegistryStatus = function() {
            addResult('ğŸ“‹ æ³¨å†Œè¡¨çŠ¶æ€æ£€æŸ¥', 'å¼€å§‹æ£€æŸ¥ç»„ä»¶æ³¨å†Œè¡¨...');
            
            // æ¨¡æ‹Ÿç»„ä»¶æ³¨å†Œ
            targetComponents.forEach(type => {
                const mockDef = createMockComponentDefinition(type);
                DebugComponentRegistry.register(mockDef);
            });
            
            const allComponents = DebugComponentRegistry.getAll();
            addResult(
                `ğŸ“Š æ³¨å†Œè¡¨ç»Ÿè®¡`, 
                `å…±æœ‰ ${allComponents.length} ä¸ªç»„ä»¶å·²æ³¨å†Œã€‚<br>
                ç»„ä»¶ç±»å‹: ${allComponents.map(c => c.type).join(', ')}`
            );
            
            updateStats(allComponents.length, 0, 0);
        };

        window.checkTargetComponents = function() {
            addResult('ğŸ¯ ç›®æ ‡ç»„ä»¶æ£€æŸ¥', 'æ£€æŸ¥ç›®æ ‡ç»„ä»¶æ˜¯å¦å·²æ³¨å†Œ...');
            
            let targetFound = 0;
            targetComponents.forEach(type => {
                const exists = DebugComponentRegistry.has(type);
                const definition = DebugComponentRegistry.get(type);
                
                if (exists && definition) {
                    targetFound++;
                    addResult(
                        `âœ… ${type}`, 
                        `<div class="component-status">
                            <span class="status-badge success">å·²æ³¨å†Œ</span>
                            <span class="status-badge success">å®šä¹‰æœ‰æ•ˆ</span>
                        </div>
                        <div class="details">
                            åç§°: ${definition.name}<br>
                            åˆ†ç±»: ${definition.category}<br>
                            ç»„ä»¶å¯¹è±¡: ${definition.component ? 'å­˜åœ¨' : 'ç¼ºå¤±'}
                        </div>`
                    );
                } else {
                    addResult(
                        `âŒ ${type}`, 
                        `<div class="component-status">
                            <span class="status-badge error">æœªæ‰¾åˆ°</span>
                        </div>
                        <div class="details">
                            ç»„ä»¶æœªåœ¨æ³¨å†Œè¡¨ä¸­æ‰¾åˆ°ï¼Œå¯èƒ½æœªæ­£ç¡®å¯¼å…¥æˆ–æ³¨å†Œã€‚
                        </div>`
                    );
                }
            });
            
            const allComponents = DebugComponentRegistry.getAll();
            updateStats(allComponents.length, targetFound, 0);
        };

        window.checkVueComponents = function() {
            addResult('ğŸ”§ Vueç»„ä»¶éªŒè¯', 'æ£€æŸ¥ç»„ä»¶çš„Vueå®ä¾‹æ˜¯å¦æœ‰æ•ˆ...');
            
            let vueValid = 0;
            targetComponents.forEach(type => {
                const definition = DebugComponentRegistry.get(type);
                
                if (definition && definition.component) {
                    const component = definition.component;
                    const hasRender = typeof component.render === 'function';
                    const hasVccOpts = !!component.__vccOpts;
                    const isValidVue = hasRender || hasVccOpts;
                    
                    if (isValidVue) {
                        vueValid++;
                        addResult(
                            `âœ… ${type} Vueç»„ä»¶`, 
                            `<div class="component-status">
                                <span class="status-badge success">Vueç»„ä»¶æœ‰æ•ˆ</span>
                                ${hasRender ? '<span class="status-badge success">æœ‰renderå‡½æ•°</span>' : ''}
                                ${hasVccOpts ? '<span class="status-badge success">æœ‰__vccOpts</span>' : ''}
                            </div>
                            <div class="details">
                                ç»„ä»¶å¯ä»¥è¢«Visual Editoræ­£å¸¸æ¸²æŸ“ã€‚
                            </div>`
                        );
                    } else {
                        addResult(
                            `âš ï¸ ${type} Vueç»„ä»¶`, 
                            `<div class="component-status">
                                <span class="status-badge warning">Vueç»„ä»¶æ— æ•ˆ</span>
                            </div>
                            <div class="details">
                                ç»„ä»¶å¯¹è±¡å­˜åœ¨ä½†ä¸æ˜¯æœ‰æ•ˆçš„Vueç»„ä»¶ï¼ˆç¼ºå°‘renderå‡½æ•°å’Œ__vccOptsï¼‰ã€‚
                            </div>`
                        );
                    }
                } else {
                    addResult(
                        `âŒ ${type} Vueç»„ä»¶`, 
                        `<div class="component-status">
                            <span class="status-badge error">ç»„ä»¶å¯¹è±¡ä¸å­˜åœ¨</span>
                        </div>
                        <div class="details">
                            definition.component ä¸ºç©ºï¼Œæ— æ³•æ¸²æŸ“ã€‚
                        </div>`
                    );
                }
            });
            
            const allComponents = DebugComponentRegistry.getAll();
            const targetFound = targetComponents.filter(type => DebugComponentRegistry.has(type)).length;
            updateStats(allComponents.length, targetFound, vueValid);
        };

        window.simulateVisualEditorFlow = function() {
            addResult('ğŸ¨ Visual Editoræµç¨‹æ¨¡æ‹Ÿ', 'æ¨¡æ‹ŸVisual Editorè·å–å’Œæ¸²æŸ“ç»„ä»¶çš„å®Œæ•´æµç¨‹...');
            
            targetComponents.forEach(type => {
                // æ­¥éª¤1: è·å–ç»„ä»¶å®šä¹‰
                const definition = DebugComponentRegistry.get(type);
                if (!definition) {
                    addResult(
                        `âŒ ${type} - æ­¥éª¤1å¤±è´¥`, 
                        `<div class="component-status">
                            <span class="status-badge error">getComponentDefinitionå¤±è´¥</span>
                        </div>
                        <div class="details">
                            æ— æ³•ä»æ³¨å†Œè¡¨è·å–ç»„ä»¶å®šä¹‰ã€‚
                        </div>`
                    );
                    return;
                }
                
                // æ­¥éª¤2: è·å–ç»„ä»¶å®ä¾‹
                const component = definition.component;
                if (!component) {
                    addResult(
                        `âŒ ${type} - æ­¥éª¤2å¤±è´¥`, 
                        `<div class="component-status">
                            <span class="status-badge error">getComponentå¤±è´¥</span>
                        </div>
                        <div class="details">
                            ç»„ä»¶å®šä¹‰ä¸­çš„componentå­—æ®µä¸ºç©ºï¼Œè¿™å°±æ˜¯"ç»„ä»¶å®ç°ä¸å­˜åœ¨"é”™è¯¯çš„æ ¹æºï¼
                        </div>`
                    );
                    return;
                }
                
                // æ­¥éª¤3: éªŒè¯å¯æ¸²æŸ“æ€§
                const canRender = typeof component.render === 'function' || !!component.__vccOpts;
                if (!canRender) {
                    addResult(
                        `âš ï¸ ${type} - æ­¥éª¤3è­¦å‘Š`, 
                        `<div class="component-status">
                            <span class="status-badge warning">ç»„ä»¶å¯èƒ½æ— æ³•æ­£å¸¸æ¸²æŸ“</span>
                        </div>
                        <div class="details">
                            ç»„ä»¶å¯¹è±¡ä¸æ˜¯æ ‡å‡†çš„Vueç»„ä»¶æ ¼å¼ã€‚
                        </div>`
                    );
                    return;
                }
                
                // å…¨éƒ¨é€šè¿‡
                addResult(
                    `âœ… ${type} - æµç¨‹å®Œæˆ`, 
                    `<div class="component-status">
                        <span class="status-badge success">å®šä¹‰è·å–æˆåŠŸ</span>
                        <span class="status-badge success">ç»„ä»¶å®ä¾‹æœ‰æ•ˆ</span>
                        <span class="status-badge success">å¯ä»¥æ¸²æŸ“</span>
                    </div>
                    <div class="details">
                        è¯¥ç»„ä»¶åº”è¯¥å¯ä»¥åœ¨Visual Editorä¸­æ­£å¸¸å·¥ä½œã€‚
                    </div>`
                );
            });
            
            addResult('ğŸ’¡ è°ƒè¯•å»ºè®®', `
                <div class="details">
                    <strong>æ ¹æ®æ¨¡æ‹Ÿç»“æœï¼Œå¦‚æœå®é™…ç¯å¢ƒä¸­å‡ºç°"ç»„ä»¶å®ç°ä¸å­˜åœ¨"é”™è¯¯ï¼Œå¯èƒ½çš„åŸå› ï¼š</strong><br><br>
                    1. ğŸ” <strong>ç»„ä»¶æœªæ³¨å†Œ</strong>ï¼šç»„ä»¶å®šä¹‰æ²¡æœ‰æ­£ç¡®å¯¼å…¥åˆ°æ³¨å†Œè¡¨<br>
                    2. ğŸ”§ <strong>componentå­—æ®µä¸ºç©º</strong>ï¼šç»„ä»¶å®šä¹‰ä¸­çš„componentå±æ€§æ²¡æœ‰æ­£ç¡®æŒ‡å‘Vueç»„ä»¶<br>
                    3. ğŸ“¦ <strong>å¯¼å…¥è·¯å¾„é”™è¯¯</strong>ï¼šVueç»„ä»¶æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®<br>
                    4. â° <strong>å¼‚æ­¥åŠ è½½é—®é¢˜</strong>ï¼šç»„ä»¶åŠ è½½æ—¶æœºè¿‡æ—©ï¼ŒVueç»„ä»¶è¿˜æœªå‡†å¤‡å¥½<br><br>
                    
                    <strong>å»ºè®®æ£€æŸ¥æ­¥éª¤ï¼š</strong><br>
                    1. ç¡®è®¤ç»„ä»¶çš„index.tsæ–‡ä»¶æ­£ç¡®å¯¼å…¥äº†index.vue<br>
                    2. ç¡®è®¤ç»„ä»¶å®šä¹‰æ­£ç¡®æ³¨å†Œåˆ°äº†componentRegistry<br>
                    3. ç¡®è®¤Card2.1ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆåæ‰è¿›è¡Œç»„ä»¶æ¸²æŸ“<br>
                    4. åœ¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥å…·ä½“çš„é”™è¯¯ä¿¡æ¯
                </div>
            `);
        };

        window.clearResults = function() {
            document.getElementById('debug-results').innerHTML = '';
            document.getElementById('stats-container').style.display = 'none';
        };

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹æç¤º
        window.onload = function() {
            addResult('ğŸš€ è°ƒè¯•å·¥å…·å·²å°±ç»ª', `
                <div class="details">
                    è¿™ä¸ªå·¥å…·æ¨¡æ‹Ÿäº†Card 2.1ç»„ä»¶æ³¨å†Œå’ŒVisual Editorç»„ä»¶è·å–çš„å®Œæ•´æµç¨‹ã€‚<br><br>
                    ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹è°ƒè¯•åˆ†æï¼š<br>
                    â€¢ <strong>æ£€æŸ¥æ³¨å†Œè¡¨çŠ¶æ€</strong>ï¼šæŸ¥çœ‹ç»„ä»¶æ³¨å†Œæƒ…å†µ<br>
                    â€¢ <strong>æ£€æŸ¥ç›®æ ‡ç»„ä»¶</strong>ï¼šéªŒè¯é—®é¢˜ç»„ä»¶æ˜¯å¦å­˜åœ¨<br>
                    â€¢ <strong>æ£€æŸ¥Vueç»„ä»¶</strong>ï¼šéªŒè¯ç»„ä»¶æ˜¯å¦ä¸ºæœ‰æ•ˆçš„Vueå®ä¾‹<br>
                    â€¢ <strong>æ¨¡æ‹Ÿç¼–è¾‘å™¨æµç¨‹</strong>ï¼šå®Œæ•´æ¨¡æ‹ŸVisual Editorçš„ç»„ä»¶è·å–æµç¨‹
                </div>
            `);
        };
    </script>
</body>
</html>