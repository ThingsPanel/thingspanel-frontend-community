<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”— å±æ€§ç»‘å®šé“¾ç»¼åˆä¿®å¤æµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    }
    .test-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 32px;
      text-align: center;
    }
    .test-header h1 {
      margin: 0 0 12px 0;
      font-size: 28px;
    }
    .test-header p {
      margin: 0;
      font-size: 16px;
      opacity: 0.9;
    }
    .test-section {
      margin-bottom: 40px;
      padding: 24px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      background: #fafafa;
    }
    .test-section h3 {
      margin: 0 0 20px 0;
      color: #333;
      font-size: 20px;
    }
    .step {
      margin-bottom: 20px;
      padding: 16px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid #2080f0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .step h4 {
      margin: 0 0 12px 0;
      color: #333;
      font-size: 16px;
    }
    .step p {
      margin: 0;
      color: #666;
      font-size: 14px;
      line-height: 1.6;
    }
    .step ul {
      margin: 8px 0 0 0;
      color: #666;
      font-size: 14px;
    }
    .issue-fixed {
      background: #f6ffed;
      border-left-color: #52c41a;
    }
    .issue-fixed h4 {
      color: #52c41a;
    }
    .issue-critical {
      background: #fff1f0;
      border-left-color: #ff4d4f;
    }
    .issue-critical h4 {
      color: #ff4d4f;
    }
    .nav-link {
      display: inline-block;
      padding: 12px 24px;
      background: #2080f0;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      margin-right: 12px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    .nav-link:hover {
      background: #40a9ff;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(32,128,240,0.3);
    }
    .code-block {
      background: #f8f8f8;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: #333;
      margin: 16px 0;
      border: 1px solid #e0e0e0;
      overflow-x: auto;
    }
    .architecture-flow {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0;
      padding: 16px;
      background: white;
      border-radius: 8px;
      border: 1px solid #d9d9d9;
    }
    .flow-item {
      text-align: center;
      flex: 1;
      margin: 0 8px;
    }
    .flow-arrow {
      color: #2080f0;
      font-size: 18px;
      margin: 0 8px;
    }
    .test-matrix {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin: 20px 0;
    }
    .test-matrix .step {
      margin-bottom: 0;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>ğŸ”— å±æ€§ç»‘å®šé“¾ç»¼åˆä¿®å¤æµ‹è¯•</h1>
      <p>éªŒè¯ deviceId è¿ç§»åˆ°åŸºç¡€é…ç½®åï¼Œå±æ€§ä¿®æ”¹èƒ½å¦æ­£ç¡®è§¦å‘æ¥å£è¯·æ±‚çš„å®Œæ•´é“¾è·¯</p>
    </div>

    <div class="test-section">
      <h3>ğŸ¯ é—®é¢˜èƒŒæ™¯ä¸ä¿®å¤æ¦‚è¿°</h3>
      
      <div class="step issue-critical">
        <h4>ğŸš¨ æ ¸å¿ƒé—®é¢˜</h4>
        <p>æœ‰äººå°† deviceId ä»ç»„ä»¶çº§é…ç½®ç§»åˆ°åŸºç¡€é…ç½®ï¼Œç ´åäº†å±æ€§ç»‘å®šé“¾ï¼Œå¯¼è‡´å±æ€§ä¿®æ”¹æ— æ³•è§¦å‘æ¥å£å†æ¬¡è¯·æ±‚</p>
      </div>

      <div class="step">
        <h4>ğŸ“Š å½±å“èŒƒå›´</h4>
        <p>æ¶‰åŠä»¥ä¸‹ç³»ç»Ÿç»„ä»¶çš„é…ç½®ä¼ é€’å’Œäº‹ä»¶å¤„ç†æœºåˆ¶ï¼š</p>
        <ul>
          <li><strong>VisualEditorBridge</strong> - é…ç½®æ ¼å¼è½¬æ¢å’ŒåŸºç¡€é…ç½®æ³¨å…¥</li>
          <li><strong>PropertyPathManager</strong> - å±æ€§è·¯å¾„è§£æå’Œå€¼è®¾ç½®</li>
          <li><strong>ConfigEventBus</strong> - é…ç½®å˜æ›´äº‹ä»¶åˆ†å‘å’Œå¤„ç†</li>
          <li><strong>InteractionManager</strong> - æ•°æ®æ‰§è¡Œè§¦å‘å’ŒHTTPæ•°æ®æºæ˜ å°„</li>
        </ul>
      </div>

      <div class="architecture-flow">
        <div class="flow-item">
          <strong>åŸºç¡€é…ç½®å˜æ›´</strong><br>
          <small>deviceId/metricsList</small>
        </div>
        <div class="flow-arrow">â†’</div>
        <div class="flow-item">
          <strong>äº‹ä»¶æ€»çº¿åˆ†å‘</strong><br>
          <small>ConfigEventBus</small>
        </div>
        <div class="flow-arrow">â†’</div>
        <div class="flow-item">
          <strong>å±æ€§è·¯å¾„è§£æ</strong><br>
          <small>PropertyPathManager</small>
        </div>
        <div class="flow-arrow">â†’</div>
        <div class="flow-item">
          <strong>æ•°æ®æºæ›´æ–°</strong><br>
          <small>VisualEditorBridge</small>
        </div>
        <div class="flow-arrow">â†’</div>
        <div class="flow-item">
          <strong>æ¥å£è¯·æ±‚</strong><br>
          <small>HTTPæ‰§è¡Œå™¨</small>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸ”§ ä¿®å¤çš„å…³é”®ç»„ä»¶</h3>
      
      <div class="test-matrix">
        <div class="step issue-fixed">
          <h4>âœ… VisualEditorBridge å¢å¼º</h4>
          <p>æ”¯æŒåˆ†å±‚é…ç½®æ ¼å¼æ£€æµ‹ï¼Œè‡ªåŠ¨æ³¨å…¥åŸºç¡€é…ç½®å±æ€§åˆ°æ•°æ®æºé…ç½®ä¸­</p>
          <div class="code-block">
// æ£€æµ‹åˆ†å±‚é…ç½®æ ¼å¼
if (config.base || config.dataSource) {
  baseConfig = config.base || {}
  // åˆå¹¶åŸºç¡€é…ç½®ä¸­çš„è®¾å¤‡å±æ€§
  resolvedConfig = {
    ...config.dataSource,
    deviceId: baseConfig.deviceId,
    metricsList: baseConfig.metricsList
  }
}
          </div>
        </div>

        <div class="step issue-fixed">
          <h4>âœ… PropertyPathManager æ‰©å±•</h4>
          <p>æ–°å¢å±æ€§è·¯å¾„è§£æå’Œè®¾ç½®æ–¹æ³•ï¼Œæ”¯æŒ 'base.deviceId' æ ¼å¼è·¯å¾„</p>
          <div class="code-block">
// è§£æå±æ€§è·¯å¾„å€¼
resolvePropertyValue(config: any, propertyPath: string): any

// è®¾ç½®å±æ€§è·¯å¾„å€¼
setPropertyValue(config: any, propertyPath: string, value: any): void
          </div>
        </div>

        <div class="step issue-fixed">
          <h4>âœ… ConfigEventBus å¼ºåŒ–</h4>
          <p>å¢å¼ºåŸºç¡€é…ç½®å˜æ›´äº‹ä»¶å¤„ç†ï¼Œè‡ªåŠ¨è¯†åˆ«å…³é”®å­—æ®µå˜æ›´å¹¶è§¦å‘æ‰§è¡Œ</p>
          <div class="code-block">
// å…³é”®åŸºç¡€é…ç½®å˜æ›´è¿‡æ»¤å™¨
const criticalFields = ['deviceId', 'metricsList']
const hasCriticalChange = changedFields.some(
  field => criticalFields.includes(field)
)
if (hasCriticalChange) {
  event.context.shouldTriggerExecution = true
}
          </div>
        </div>

        <div class="step issue-fixed">
          <h4>âœ… InteractionManager é›†æˆ</h4>
          <p>é›†æˆé…ç½®äº‹ä»¶æ€»çº¿ï¼Œå¤„ç†åŸºç¡€é…ç½®å˜æ›´çš„æ•°æ®æ‰§è¡Œè§¦å‘</p>
          <div class="code-block">
// æ³¨å†Œæ•°æ®æ‰§è¡Œè§¦å‘å™¨
this.dataExecutionTriggerCleanup = registerDataExecutionTrigger(
  this.handleDataExecutionTrigger.bind(this)
)

// å¤„ç†HTTPæ•°æ®æºé‡æ–°æ‰§è¡Œ
async handleDataExecutionTrigger(event: ConfigChangeEvent) {
  if (event.section === 'base') {
    await this.reExecuteHttpDataSources(event.componentId)
  }
}
          </div>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸš€ æµ‹è¯•éªŒè¯æ­¥éª¤</h3>
      
      <div class="step">
        <h4>æ­¥éª¤ 1ï¼šæ‰“å¼€æ•°æ®æºç³»ç»Ÿæµ‹è¯•é¡µé¢</h4>
        <p>è®¿é—®ç»¼åˆæµ‹è¯•ç¯å¢ƒï¼ŒéªŒè¯æ‰€æœ‰æ•°æ®æºé…ç½®åŠŸèƒ½</p>
        <a href="http://localhost:5002/test/data-source-system" class="nav-link" target="_blank">
          ğŸ”— æ•°æ®æºç³»ç»Ÿæµ‹è¯•
        </a>
      </div>

      <div class="step">
        <h4>æ­¥éª¤ 2ï¼šæµ‹è¯•åŸºç¡€é…ç½®å˜æ›´é“¾è·¯</h4>
        <p><strong>éªŒè¯é‡ç‚¹ï¼š</strong>ä¿®æ”¹åŸºç¡€é…ç½®ä¸­çš„ deviceIdï¼Œè§‚å¯Ÿæ˜¯å¦è‡ªåŠ¨è§¦å‘æ¥å£è¯·æ±‚</p>
        <ul>
          <li>åœ¨é…ç½®é¢æ¿ä¸­ä¿®æ”¹åŸºç¡€é…ç½®çš„ deviceId</li>
          <li>æ£€æŸ¥æµè§ˆå™¨ç½‘ç»œé¢æ¿ï¼Œç¡®è®¤æœ‰æ–°çš„HTTPè¯·æ±‚å‘å‡º</li>
          <li>éªŒè¯è¿”å›æ•°æ®æ˜¯å¦åŸºäºæ–°çš„ deviceId</li>
        </ul>
      </div>

      <div class="step">
        <h4>æ­¥éª¤ 3ï¼šæµ‹è¯•å±æ€§ç»‘å®šæŠ½å±‰é›†æˆ</h4>
        <p><strong>éªŒè¯é‡ç‚¹ï¼š</strong>é€šè¿‡å±æ€§ç»‘å®šæŠ½å±‰ä¿®æ”¹ç»„ä»¶å±æ€§ï¼Œç¡®è®¤é…ç½®æ­£ç¡®ä¼ é€’</p>
        <ul>
          <li>æ‰“å¼€ä»»æ„HTTPé…ç½®å‚æ•°çš„å±æ€§ç»‘å®šæŠ½å±‰</li>
          <li>é€‰æ‹©åŸºç¡€é…ç½®ä¸­çš„ deviceId å±æ€§</li>
          <li>ç¡®è®¤å±æ€§è·¯å¾„è§£æä¸º 'base.deviceId' æ ¼å¼</li>
          <li>éªŒè¯å±æ€§å€¼èƒ½æ­£ç¡®è·å–å’Œè®¾ç½®</li>
        </ul>
      </div>

      <div class="step">
        <h4>æ­¥éª¤ 4ï¼šæµ‹è¯• Visual Editor é›†æˆ</h4>
        <p><strong>éªŒè¯é‡ç‚¹ï¼š</strong>åœ¨å¯è§†åŒ–ç¼–è¾‘å™¨ä¸­æµ‹è¯•å®Œæ•´çš„é…ç½®å˜æ›´æµç¨‹</p>
        <a href="http://localhost:5002/test/editor-integration" class="nav-link" target="_blank">
          ğŸ”— ç¼–è¾‘å™¨é›†æˆæµ‹è¯•
        </a>
        <ul>
          <li>æ·»åŠ å…·æœ‰HTTPæ•°æ®æºçš„ç»„ä»¶</li>
          <li>ä¿®æ”¹ç»„ä»¶çš„åŸºç¡€é…ç½®ï¼ˆdeviceIdã€metricsListï¼‰</li>
          <li>ç¡®è®¤æ•°æ®æºé‡æ–°æ‰§è¡Œï¼Œç»„ä»¶æ˜¾ç¤ºæ›´æ–°åçš„æ•°æ®</li>
        </ul>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸ” å…³é”®éªŒè¯ç‚¹</h3>
      
      <div class="step issue-fixed">
        <h4>âœ… é…ç½®æ ¼å¼è½¬æ¢æ­£ç¡®æ€§</h4>
        <p>VisualEditorBridge èƒ½æ­£ç¡®è¯†åˆ«å¹¶å¤„ç†æ–°çš„åˆ†å±‚é…ç½®æ ¼å¼ï¼Œå°†åŸºç¡€é…ç½®å±æ€§æ³¨å…¥åˆ°æ•°æ®æºé…ç½®ä¸­</p>
      </div>

      <div class="step issue-fixed">
        <h4>âœ… äº‹ä»¶é“¾è·¯å®Œæ•´æ€§</h4>
        <p>åŸºç¡€é…ç½®å˜æ›´ â†’ äº‹ä»¶åˆ†å‘ â†’ è·¯å¾„è§£æ â†’ æ•°æ®æºæ›´æ–° â†’ æ¥å£è¯·æ±‚ï¼Œæ•´ä¸ªé“¾è·¯ç•…é€šæ— é˜»</p>
      </div>

      <div class="step issue-fixed">
        <h4>âœ… å±æ€§ç»‘å®šä¸€è‡´æ€§</h4>
        <p>å±æ€§ç»‘å®šæŠ½å±‰ä¸­çš„é…ç½®ä¿®æ”¹ä¸ç›´æ¥é…ç½®ä¿®æ”¹æ•ˆæœä¸€è‡´ï¼Œéƒ½èƒ½è§¦å‘ç›¸åŒçš„æ›´æ–°æµç¨‹</p>
      </div>

      <div class="step issue-fixed">
        <h4>âœ… äº¤äº’ç³»ç»Ÿåè°ƒæ€§</h4>
        <p>InteractionManager æ­£ç¡®å“åº”åŸºç¡€é…ç½®å˜æ›´äº‹ä»¶ï¼Œè§¦å‘å¯¹åº”ç»„ä»¶çš„æ•°æ®é‡æ–°æ‰§è¡Œ</p>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸ¯ é¢„æœŸç»“æœ</h3>
      
      <div class="step issue-fixed">
        <h4>âœ… å±æ€§ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ</h4>
        <p>ä¿®æ”¹åŸºç¡€é…ç½®ä¸­çš„ deviceId æˆ– metricsList åï¼Œç›¸å…³ç»„ä»¶ç«‹å³é‡æ–°è¯·æ±‚æ¥å£å¹¶æ›´æ–°æ˜¾ç¤º</p>
      </div>

      <div class="step issue-fixed">
        <h4>âœ… é…ç½®ä¼ é€’é“¾è·¯ä¿®å¤</h4>
        <p>åŸºç¡€é…ç½® â†’ æ•°æ®æºé…ç½® â†’ æ‰§è¡Œå™¨é…ç½®çš„ä¼ é€’é“¾è·¯å®Œå…¨ä¿®å¤ï¼Œä¸å†å‡ºç°é…ç½®ä¸¢å¤±</p>
      </div>

      <div class="step issue-fixed">
        <h4>âœ… å¼€å‘ä½“éªŒæ”¹å–„</h4>
        <p>å¼€å‘è€…å’Œç”¨æˆ·ä¿®æ”¹ç»„ä»¶é…ç½®æ—¶ï¼Œç³»ç»Ÿå“åº”åŠæ—¶ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ·æ–°æˆ–é‡æ–°é…ç½®</p>
      </div>
    </div>

    <div class="test-section">
      <h3>ğŸ”— ç›¸å…³æµ‹è¯•é“¾æ¥</h3>
      <a href="http://localhost:5002/test/data-source-system" class="nav-link" target="_blank">
        æ•°æ®æºç³»ç»Ÿæµ‹è¯•
      </a>
      <a href="http://localhost:5002/test/data-binding-system-integration" class="nav-link" target="_blank">
        æ•°æ®ç»‘å®šç³»ç»Ÿé›†æˆæµ‹è¯•
      </a>
      <a href="http://localhost:5002/test/editor-integration" class="nav-link" target="_blank">
        ç¼–è¾‘å™¨é›†æˆæµ‹è¯•
      </a>
      <a href="http://localhost:5002/test/panel-editor-v2" class="nav-link" target="_blank">
        é¢æ¿ç¼–è¾‘å™¨ V2 æµ‹è¯•
      </a>
    </div>

    <div class="test-section">
      <h3>ğŸ“‹ è°ƒè¯•å»ºè®®</h3>
      
      <div class="step">
        <h4>ğŸ” æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ£€æŸ¥</h4>
        <ul>
          <li><strong>ç½‘ç»œé¢æ¿</strong>ï¼šæ£€æŸ¥HTTPè¯·æ±‚æ˜¯å¦åœ¨é…ç½®å˜æ›´åè‡ªåŠ¨å‘å‡º</li>
          <li><strong>æ§åˆ¶å°æ—¥å¿—</strong>ï¼šæŸ¥çœ‹ ConfigEventBus å’Œ InteractionManager çš„è°ƒè¯•æ—¥å¿—</li>
          <li><strong>Vue DevTools</strong>ï¼šç›‘æ§ç»„ä»¶çŠ¶æ€å’Œé…ç½®å¯¹è±¡çš„å˜åŒ–</li>
        </ul>
      </div>

      <div class="step">
        <h4>ğŸ› ï¸ å…³é”®è°ƒè¯•ç‚¹</h4>
        <ul>
          <li>éªŒè¯ <code>configEventBus.emitConfigChange</code> æ˜¯å¦è¢«æ­£ç¡®è°ƒç”¨</li>
          <li>æ£€æŸ¥ <code>PropertyPathManager.resolvePropertyValue</code> è·¯å¾„è§£æç»“æœ</li>
          <li>ç¡®è®¤ <code>InteractionManager.handleDataExecutionTrigger</code> æ‰§è¡Œæƒ…å†µ</li>
          <li>è§‚å¯Ÿ <code>VisualEditorBridge.injectBaseConfigToDataSource</code> é…ç½®åˆå¹¶ç»“æœ</li>
        </ul>
      </div>
    </div>
  </div>
</body>
</html>