<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…ç½®äº‹ä»¶ç›‘å¬æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .log-area {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ é…ç½®äº‹ä»¶ç›‘å¬æµ‹è¯•é¡µé¢</h1>
    <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•V2ç‰ˆæœ¬çš„é…ç½®äº‹ä»¶ç›‘å¬åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>

    <div class="test-section">
        <h2>æµ‹è¯•æ­¥éª¤</h2>
        <ol>
            <li>ç¡®ä¿å¼€å‘æœåŠ¡å™¨è¿è¡Œåœ¨ localhost:5002</li>
            <li>åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€: <a href="http://localhost:5002/test/panel-editor-v2" target="_blank">http://localhost:5002/test/panel-editor-v2</a></li>
            <li>åœ¨V2æµ‹è¯•é¡µé¢ä¸­ï¼š
                <ul>
                    <li>ç‚¹å‡»å·¦ä¾§ç»„ä»¶åº“ä¸­çš„ä»»æ„ç»„ä»¶ï¼Œæ·»åŠ åˆ°ç”»å¸ƒ</li>
                    <li>é€‰ä¸­ç”»å¸ƒä¸Šçš„ç»„ä»¶</li>
                    <li>åœ¨å³ä¾§é…ç½®é¢æ¿ä¸­ä¿®æ”¹é…ç½®é¡¹</li>
                </ul>
            </li>
            <li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é…ç½®å˜æ›´æ—¥å¿—è¾“å‡º</li>
            <li>åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æ—¥å¿—ï¼š<br>
                <code>ğŸ”„ GridstackRenderer æ”¶åˆ°é…ç½®å˜æ›´: {componentId: "xxx", section: "component", ...}</code>
            </li>
        </ol>
    </div>

    <div class="test-section">
        <h2>æœŸæœ›çš„æ§åˆ¶å°è¾“å‡º</h2>
        <div class="log-area" id="expectedLogs">
âœ… æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥çœ‹åˆ°ï¼š
ğŸ”„ GridstackRenderer æ”¶åˆ°é…ç½®å˜æ›´: {
  componentId: "widget_123",
  componentType: "widget", 
  section: "component",
  newConfig: {...},
  timestamp: 1757230000000,
  source: "user"
}
ç»„ä»¶ widget_123 çš„ component é…ç½®å·²æ›´æ–°

ğŸ”„ GridstackRenderer æ”¶åˆ°é…ç½®å˜æ›´: {
  componentId: "widget_123",
  componentType: "widget",
  section: "dataSource", 
  newConfig: {...},
  timestamp: 1757230001000,
  source: "user"
}
ç»„ä»¶ widget_123 çš„æ•°æ®æºé…ç½®å·²æ›´æ–°
        </div>
    </div>

    <div class="test-section">
        <h2>é—®é¢˜æ’æŸ¥</h2>
        <div>
            <h3>å¦‚æœæ²¡æœ‰çœ‹åˆ°é…ç½®å˜æ›´æ—¥å¿—ï¼š</h3>
            <ul>
                <li>æ£€æŸ¥ ConfigEventBus æ˜¯å¦æ­£å¸¸åˆå§‹åŒ–</li>
                <li>æ£€æŸ¥ GridstackRenderer æ˜¯å¦æ­£ç¡®æ³¨å†Œäº†äº‹ä»¶ç›‘å¬å™¨</li>
                <li>æ£€æŸ¥ ConfigurationPanel æ˜¯å¦æ­£ç¡®å‘å‡ºäº†é…ç½®å˜æ›´äº‹ä»¶</li>
                <li>æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰ä»»ä½•é”™è¯¯ä¿¡æ¯</li>
            </ul>

            <h3>è°ƒè¯•å·¥å…·ï¼š</h3>
            <p>åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œè°ƒè¯•ï¼š</p>
            <div class="log-area">
// æ£€æŸ¥å…¨å±€é…ç½®äº‹ä»¶æ€»çº¿
console.log('ConfigEventBus:', window.configEventBus)

// æŸ¥çœ‹äº‹ä»¶æ€»çº¿ç»Ÿè®¡ä¿¡æ¯
console.log('äº‹ä»¶ç»Ÿè®¡:', window.configEventBus?.getStatistics())

// æ‰‹åŠ¨è§¦å‘ä¸€ä¸ªæµ‹è¯•äº‹ä»¶
window.configEventBus?.emitConfigChange({
  componentId: 'test_widget',
  componentType: 'widget',
  section: 'component',
  oldConfig: null,
  newConfig: { test: true },
  timestamp: Date.now(),
  source: 'user'
})
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•ç»“æœè®°å½•</h2>
        <div>
            <button onclick="recordSuccess()">âœ… é…ç½®äº‹ä»¶ç›‘å¬æ­£å¸¸</button>
            <button onclick="recordFailure()">âŒ é…ç½®äº‹ä»¶ç›‘å¬å¼‚å¸¸</button>
            <button onclick="clearLogs()">ğŸ§¹ æ¸…é™¤è®°å½•</button>
        </div>
        <div class="log-area" id="testResults">
ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®è®°å½•æµ‹è¯•ç»“æœ...
        </div>
    </div>

    <script>
        const testResults = document.getElementById('testResults')
        
        function recordSuccess() {
            const timestamp = new Date().toLocaleString()
            testResults.textContent += `[${timestamp}] âœ… æµ‹è¯•é€šè¿‡ï¼šé…ç½®äº‹ä»¶ç›‘å¬åŠŸèƒ½æ­£å¸¸å·¥ä½œ\n`
        }
        
        function recordFailure() {
            const timestamp = new Date().toLocaleString()
            testResults.textContent += `[${timestamp}] âŒ æµ‹è¯•å¤±è´¥ï¼šé…ç½®äº‹ä»¶ç›‘å¬åŠŸèƒ½å¼‚å¸¸\n`
        }
        
        function clearLogs() {
            testResults.textContent = 'ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®è®°å½•æµ‹è¯•ç»“æœ...\n'
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„åŸºæœ¬ä¿¡æ¯
        window.addEventListener('load', () => {
            const timestamp = new Date().toLocaleString()
            testResults.textContent = `[${timestamp}] ğŸ“‹ æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡è¿›è¡Œé…ç½®äº‹ä»¶ç›‘å¬æµ‹è¯•\n`
        })
    </script>
</body>
</html>