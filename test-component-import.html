<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»„ä»¶å¯¼å…¥æµ‹è¯•</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .result-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        .success { border-left-color: #28a745; background-color: #d4edda; }
        .error { border-left-color: #dc3545; background-color: #f8d7da; }
        .warning { border-left-color: #ffc107; background-color: #fff3cd; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-card">
        <h1>ğŸ§ª Card 2.1 ç»„ä»¶å¯¼å…¥æµ‹è¯•</h1>
        <p>æµ‹è¯•problematicç»„ä»¶çš„å¯¼å…¥å’Œæ³¨å†ŒçŠ¶æ€</p>

        <div>
            <button onclick="testViteGlobImport()">ğŸ“¦ æµ‹è¯•Vite Globå¯¼å…¥</button>
            <button onclick="testDirectImport()">ğŸ¯ æµ‹è¯•ç›´æ¥å¯¼å…¥</button>
            <button onclick="testRegistration()">ğŸ“ æµ‹è¯•ç»„ä»¶æ³¨å†Œ</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
        </div>

        <div id="test-results"></div>
    </div>

    <script type="module">
        function addResult(title, content, type = 'info') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `result-item ${type}`;
            resultDiv.innerHTML = `<strong>${title}</strong><br>${content}`;
            document.getElementById('test-results').appendChild(resultDiv);
        }

        window.testViteGlobImport = async function() {
            addResult('ğŸ“¦ Vite Globå¯¼å…¥æµ‹è¯•', 'å¼€å§‹æµ‹è¯•import.meta.globæ¨¡å¼...');
            
            try {
                // æ¨¡æ‹ŸCard2.1ç»„ä»¶åŠ è½½å™¨çš„globæ¨¡å¼
                const modulePattern = '../src/card2.1/components/**/index.{ts,js}';
                addResult('ğŸ” æ‰«ææ¨¡å¼', `ä½¿ç”¨æ¨¡å¼: ${modulePattern}`, 'info');
                
                // æ³¨æ„ï¼šåœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¿™éœ€è¦åœ¨Viteæ„å»ºç¯å¢ƒä¸‹è¿è¡Œ
                addResult('â„¹ï¸ ç¯å¢ƒè¯´æ˜', 'ç”±äºè¿™æ˜¯é™æ€HTMLæ–‡ä»¶ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨import.meta.globï¼Œéœ€è¦åœ¨Vueå¼€å‘ç¯å¢ƒä¸­æµ‹è¯•', 'warning');
                
                // æ¨¡æ‹Ÿæ‰«æç»“æœ
                const mockModules = [
                    '../src/card2.1/components/triple-data-display/index.ts',
                    '../src/card2.1/components/simple-display/index.ts', 
                    '../src/card2.1/components/dual-data-display/index.ts'
                ];
                
                addResult('ğŸ“‹ æ¨¡æ‹Ÿæ‰«æç»“æœ', `
                    æ‰¾åˆ°ç»„ä»¶æ¨¡å—: <br>
                    <pre>${mockModules.join('\\n')}</pre>
                `, 'success');
                
            } catch (error) {
                addResult('âŒ Globå¯¼å…¥å¤±è´¥', `é”™è¯¯: ${error.message}`, 'error');
            }
        };

        window.testDirectImport = async function() {
            addResult('ğŸ¯ ç›´æ¥å¯¼å…¥æµ‹è¯•', 'æµ‹è¯•ç»„ä»¶æ¨¡å—çš„ç›´æ¥å¯¼å…¥...');
            
            const targetComponents = [
                'triple-data-display',
                'simple-display', 
                'dual-data-display'
            ];
            
            for (const componentType of targetComponents) {
                try {
                    addResult(`ğŸ” ${componentType}`, 'å°è¯•å¯¼å…¥ç»„ä»¶å®šä¹‰...', 'info');
                    
                    // åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¿™é‡Œåº”è¯¥èƒ½å¤ŸåŠ¨æ€å¯¼å…¥
                    // const module = await import(\`/src/card2.1/components/\${componentType}/index.ts\`);
                    
                    addResult(`â„¹ï¸ ${componentType}`, 'åœ¨é™æ€HTMLä¸­æ— æ³•æ‰§è¡ŒçœŸå®å¯¼å…¥ï¼Œéœ€è¦åœ¨å¼€å‘ç¯å¢ƒä¸­æµ‹è¯•', 'warning');
                    
                    // æ¨¡æ‹Ÿå¯¼å…¥æˆåŠŸçš„æƒ…å†µ
                    const mockModule = {
                        default: {
                            type: componentType,
                            name: `${componentType}ç»„ä»¶`,
                            component: { render: () => `<div>${componentType}</div>` }
                        }
                    };
                    
                    addResult(`âœ… ${componentType}`, `
                        æ¨¡æ‹Ÿå¯¼å…¥æˆåŠŸ:<br>
                        <pre>${JSON.stringify(mockModule.default, null, 2)}</pre>
                    `, 'success');
                    
                } catch (error) {
                    addResult(`âŒ ${componentType}`, `å¯¼å…¥å¤±è´¥: ${error.message}`, 'error');
                }
            }
        };

        window.testRegistration = function() {
            addResult('ğŸ“ ç»„ä»¶æ³¨å†Œæµ‹è¯•', 'æµ‹è¯•ç»„ä»¶æ³¨å†Œæµç¨‹...');
            
            // æ¨¡æ‹Ÿç»„ä»¶æ³¨å†Œä¸­å¿ƒ
            const mockRegistry = {
                definitions: new Map(),
                register(definition) {
                    if (!definition || !definition.type) {
                        throw new Error('æ— æ•ˆçš„ç»„ä»¶å®šä¹‰');
                    }
                    this.definitions.set(definition.type, definition);
                },
                get(type) {
                    return this.definitions.get(type);
                },
                has(type) {
                    return this.definitions.has(type);
                }
            };
            
            const targetComponents = ['triple-data-display', 'simple-display', 'dual-data-display'];
            
            // æ¨¡æ‹Ÿæ³¨å†Œè¿‡ç¨‹
            targetComponents.forEach(type => {
                try {
                    const mockDefinition = {
                        type: type,
                        name: `${type}ç»„ä»¶`,
                        description: `${type}ç»„ä»¶æè¿°`,
                        category: 'æ•°æ®å±•ç¤º',
                        component: {
                            // æ¨¡æ‹ŸVueç»„ä»¶
                            render: () => `<div>${type}</div>`,
                            __vccOpts: { name: type }
                        }
                    };
                    
                    mockRegistry.register(mockDefinition);
                    addResult(`âœ… ${type}`, 'æ³¨å†ŒæˆåŠŸ', 'success');
                    
                } catch (error) {
                    addResult(`âŒ ${type}`, `æ³¨å†Œå¤±è´¥: ${error.message}`, 'error');
                }
            });
            
            // éªŒè¯æ³¨å†Œç»“æœ
            addResult('ğŸ” æ³¨å†ŒéªŒè¯', 'æ£€æŸ¥ç»„ä»¶æ˜¯å¦èƒ½ä»æ³¨å†Œè¡¨æ­£ç¡®è·å–...', 'info');
            
            targetComponents.forEach(type => {
                const definition = mockRegistry.get(type);
                const hasComponent = definition && definition.component;
                const componentValid = hasComponent && 
                    (typeof definition.component.render === 'function' || 
                     definition.component.__vccOpts);
                
                if (componentValid) {
                    addResult(`âœ… ${type}éªŒè¯`, 'ç»„ä»¶å®šä¹‰å’ŒVueç»„ä»¶éƒ½æœ‰æ•ˆ', 'success');
                } else if (definition) {
                    addResult(`âš ï¸ ${type}éªŒè¯`, 'ç»„ä»¶å®šä¹‰å­˜åœ¨ä½†componentå­—æ®µæ— æ•ˆ', 'warning');
                } else {
                    addResult(`âŒ ${type}éªŒè¯`, 'ç»„ä»¶æœªåœ¨æ³¨å†Œè¡¨ä¸­æ‰¾åˆ°', 'error');
                }
            });
            
            addResult('ğŸ’¡ å®é™…ç¯å¢ƒè°ƒè¯•å»ºè®®', `
                <strong>åœ¨çœŸå®å¼€å‘ç¯å¢ƒä¸­ï¼Œè¯·æ£€æŸ¥ï¼š</strong><br><br>
                1. ğŸ”§ åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·Consoleä¸­æ‰§è¡Œï¼š<br>
                   <pre>// æ£€æŸ¥ç»„ä»¶æ³¨å†ŒçŠ¶æ€
console.log('Card2.1æ³¨å†Œè¡¨:', window.__CARD2_DEBUG__);
// æˆ–è€…æ£€æŸ¥å…¨å±€å¯¹è±¡
console.log('æ‰€æœ‰æ³¨å†Œç»„ä»¶:', Object.keys(window));</pre><br>
                
                2. ğŸ“‹ åœ¨Vue DevToolsä¸­æŸ¥çœ‹ç»„ä»¶æ ‘<br>
                
                3. ğŸ” æ£€æŸ¥ç½‘ç»œé¢æ¿ï¼Œçœ‹æ˜¯å¦æœ‰ç»„ä»¶æ–‡ä»¶åŠ è½½å¤±è´¥<br>
                
                4. â° ç¡®è®¤åˆå§‹åŒ–æ—¶æœºï¼šç»„ä»¶æ³¨å†Œå¿…é¡»åœ¨æ¸²æŸ“ä¹‹å‰å®Œæˆ<br>
                
                5. ğŸ¯ åœ¨Card2Wrapper.vueä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—ï¼š<br>
                <pre>console.log('è·å–ç»„ä»¶å®šä¹‰:', componentType);
console.log('ç»„ä»¶å®šä¹‰:', definition);
console.log('ç»„ä»¶å®ä¾‹:', component);</pre>
            `, 'info');
        };

        window.clearResults = function() {
            document.getElementById('test-results').innerHTML = '';
        };

        // é¡µé¢åŠ è½½æç¤º
        window.onload = function() {
            addResult('ğŸš€ æµ‹è¯•å·¥å…·å°±ç»ª', `
                è¿™ä¸ªå·¥å…·æ¨¡æ‹Ÿäº†Card 2.1ç»„ä»¶çš„å¯¼å…¥å’Œæ³¨å†Œæµç¨‹ã€‚<br>
                ç”±äºç¯å¢ƒé™åˆ¶ï¼Œå¤§éƒ¨åˆ†æ˜¯æ¨¡æ‹Ÿæµ‹è¯•ï¼ŒçœŸå®æµ‹è¯•éœ€è¦åœ¨å¼€å‘ç¯å¢ƒä¸­è¿›è¡Œã€‚<br><br>
                <strong>æ¨èçš„è°ƒè¯•æ­¥éª¤ï¼š</strong><br>
                1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:5003<br>
                2. æ‰“å¼€å¼€å‘è€…å·¥å…·Console<br>  
                3. å°è¯•æ‰‹åŠ¨æ‰§è¡Œç»„ä»¶å¯¼å…¥å’Œæ³¨å†Œé€»è¾‘<br>
                4. æ£€æŸ¥å®é™…çš„é”™è¯¯å †æ ˆå’Œå˜é‡å€¼
            `);
        };
    </script>
</body>
</html>