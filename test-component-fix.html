<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»„ä»¶æ ‘ä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .success { color: #52c41a; }
        .error { color: #ff4d4f; }
        .warning { color: #faad14; }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .test-result.success { background: #f6ffed; border: 1px solid #b7eb8f; }
        .test-result.error { background: #fff2f0; border: 1px solid #ffccc7; }
        .test-result.warning { background: #fffbe6; border: 1px solid #ffe58f; }
        .test-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .component-item {
            background: #fafafa;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #d9d9d9;
        }
        .component-name { font-weight: bold; color: #1890ff; }
        .component-type { color: #666; font-size: 12px; }
        .component-category { color: #722ed1; font-size: 12px; }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #40a9ff; }
        button:disabled { background: #d9d9d9; cursor: not-allowed; }
        .stats { 
            display: flex; 
            gap: 20px; 
            margin: 15px 0;
            padding: 10px;
            background: #e6f7ff;
            border-radius: 4px;
        }
        .stat-item { text-align: center; }
        .stat-value { font-size: 24px; font-weight: bold; color: #1890ff; }
        .stat-label { font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="test-card">
        <h1>ğŸ”§ ç»„ä»¶æ ‘ localeCompare ä¿®å¤éªŒè¯</h1>
        <p>æµ‹è¯• useComponentTree.ts ä¸­çš„ localeCompare é”™è¯¯ä¿®å¤æ˜¯å¦æœ‰æ•ˆ</p>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="total-components">0</div>
                <div class="stat-label">æ€»ç»„ä»¶æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="successful-sorts">0</div>
                <div class="stat-label">æˆåŠŸæ’åº</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="errors-caught">0</div>
                <div class="stat-label">é”™è¯¯æ•è·</div>
            </div>
        </div>

        <div>
            <button onclick="testComponentTree()">ğŸ” æµ‹è¯•ç»„ä»¶æ ‘åŠŸèƒ½</button>
            <button onclick="testSorting()">ğŸ“Š æµ‹è¯•æ’åºåŠŸèƒ½</button>
            <button onclick="testSearching()">ğŸ” æµ‹è¯•æœç´¢åŠŸèƒ½</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
        </div>

        <div id="test-results"></div>
        <div id="component-list"></div>
    </div>

    <script type="module">
        let testResults = [];
        let totalComponents = 0;
        let successfulSorts = 0;
        let errorsCaught = 0;

        // æµ‹è¯•ç”¨çš„æ¨¡æ‹Ÿç»„ä»¶æ•°æ®ï¼ˆåŒ…å«ä¸€äº›å¯èƒ½å¯¼è‡´ undefined çš„æƒ…å†µï¼‰
        const mockComponents = [
            { name: "æµ‹è¯•ç»„ä»¶A", type: "test-a", mainCategory: "æµ‹è¯•", description: "æµ‹è¯•ç»„ä»¶Aæè¿°" },
            { name: undefined, type: "test-b", mainCategory: "æµ‹è¯•", description: "åç§°ä¸ºundefinedçš„ç»„ä»¶" },
            { name: "æµ‹è¯•ç»„ä»¶C", type: undefined, mainCategory: "æµ‹è¯•", description: "ç±»å‹ä¸ºundefinedçš„ç»„ä»¶" },
            { name: "æµ‹è¯•ç»„ä»¶D", type: "test-d", mainCategory: undefined, description: "åˆ†ç±»ä¸ºundefinedçš„ç»„ä»¶" },
            { name: null, type: "test-e", mainCategory: "æµ‹è¯•", description: "åç§°ä¸ºnullçš„ç»„ä»¶" },
            { name: "", type: "test-f", mainCategory: "", description: "åç§°å’Œåˆ†ç±»ä¸ºç©ºå­—ç¬¦ä¸²çš„ç»„ä»¶" },
            { name: "æ­£å¸¸ç»„ä»¶", type: "normal", mainCategory: "åŸºç¡€", description: "å®Œå…¨æ­£å¸¸çš„ç»„ä»¶" }
        ];

        function updateStats() {
            document.getElementById('total-components').textContent = totalComponents;
            document.getElementById('successful-sorts').textContent = successfulSorts;
            document.getElementById('errors-caught').textContent = errorsCaught;
        }

        function addResult(type, message) {
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `
                <strong>[${new Date().toLocaleTimeString()}]</strong> 
                <span class="${type}">${message}</span>
            `;
            document.getElementById('test-results').appendChild(resultDiv);
        }

        function testSafeSort(components, sortBy) {
            try {
                const sorted = [...components].sort((a, b) => {
                    let aValue, bValue;

                    switch (sortBy) {
                        case 'name':
                            aValue = a.name || '';
                            bValue = b.name || '';
                            break;
                        case 'type':
                            aValue = a.type || '';
                            bValue = b.type || '';
                            break;
                        case 'category':
                            aValue = a.mainCategory || '';
                            bValue = b.mainCategory || '';
                            break;
                        default:
                            aValue = a.name || '';
                            bValue = b.name || '';
                    }

                    // ç¡®ä¿å€¼ä¸æ˜¯ undefinedï¼Œé˜²æ­¢ localeCompare é”™è¯¯ï¼ˆè¿™å°±æ˜¯æˆ‘ä»¬çš„ä¿®å¤ï¼‰
                    const safeAValue = String(aValue || '');
                    const safeBValue = String(bValue || '');

                    const comparison = safeAValue.localeCompare(safeBValue);
                    return comparison;
                });

                successfulSorts++;
                return { success: true, data: sorted };
            } catch (error) {
                errorsCaught++;
                return { success: false, error: error.message };
            }
        }

        window.testComponentTree = function() {
            addResult('success', 'ğŸš€ å¼€å§‹æµ‹è¯•ç»„ä»¶æ ‘åŸºæœ¬åŠŸèƒ½...');
            
            totalComponents = mockComponents.length;
            
            // æµ‹è¯•åŸºæœ¬åŠŸèƒ½
            if (mockComponents && Array.isArray(mockComponents)) {
                addResult('success', `âœ… ç»„ä»¶æ•°ç»„æ­£å¸¸ï¼ŒåŒ…å« ${mockComponents.length} ä¸ªç»„ä»¶`);
            } else {
                addResult('error', 'âŒ ç»„ä»¶æ•°ç»„å¼‚å¸¸');
                return;
            }

            // æ˜¾ç¤ºç»„ä»¶åˆ—è¡¨
            displayComponents(mockComponents);
            updateStats();
        };

        window.testSorting = function() {
            addResult('success', 'ğŸ“Š å¼€å§‹æµ‹è¯•æ’åºåŠŸèƒ½...');
            
            const sortTypes = ['name', 'type', 'category'];
            
            sortTypes.forEach(sortBy => {
                const result = testSafeSort(mockComponents, sortBy);
                
                if (result.success) {
                    addResult('success', `âœ… æŒ‰${sortBy}æ’åºæˆåŠŸï¼Œæ’åºäº† ${result.data.length} ä¸ªç»„ä»¶`);
                } else {
                    addResult('error', `âŒ æŒ‰${sortBy}æ’åºå¤±è´¥: ${result.error}`);
                }
            });

            updateStats();
        };

        window.testSearching = function() {
            addResult('success', 'ğŸ” å¼€å§‹æµ‹è¯•æœç´¢åŠŸèƒ½...');
            
            const searchQueries = ['æµ‹è¯•', 'ç»„ä»¶', 'undefined', ''];
            
            searchQueries.forEach(query => {
                try {
                    const filtered = mockComponents.filter(comp => 
                        (comp.name || '').toLowerCase().includes(query.toLowerCase()) ||
                        (comp.description || '').toLowerCase().includes(query.toLowerCase()) ||
                        (comp.type || '').toLowerCase().includes(query.toLowerCase())
                    );
                    
                    addResult('success', `âœ… æœç´¢"${query}"æˆåŠŸï¼Œæ‰¾åˆ° ${filtered.length} ä¸ªç»„ä»¶`);
                } catch (error) {
                    addResult('error', `âŒ æœç´¢"${query}"å¤±è´¥: ${error.message}`);
                    errorsCaught++;
                }
            });

            updateStats();
        };

        function displayComponents(components) {
            const listDiv = document.getElementById('component-list');
            listDiv.innerHTML = '<h3>ğŸ“‹ ç»„ä»¶åˆ—è¡¨</h3><div class="test-list"></div>';
            
            const listContainer = listDiv.querySelector('.test-list');
            
            components.forEach((comp, index) => {
                const compDiv = document.createElement('div');
                compDiv.className = 'component-item';
                compDiv.innerHTML = `
                    <div class="component-name">${comp.name || '(æ— åç§°)'}</div>
                    <div class="component-type">ç±»å‹: ${comp.type || '(æ— ç±»å‹)'}</div>
                    <div class="component-category">åˆ†ç±»: ${comp.mainCategory || '(æ— åˆ†ç±»)'}</div>
                    <div style="font-size: 12px; color: #999; margin-top: 5px;">
                        ${comp.description || '(æ— æè¿°)'}
                    </div>
                `;
                listContainer.appendChild(compDiv);
            });
        }

        window.clearResults = function() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('component-list').innerHTML = '';
            testResults = [];
            totalComponents = 0;
            successfulSorts = 0;
            errorsCaught = 0;
            updateStats();
            addResult('warning', 'ğŸ—‘ï¸ æµ‹è¯•ç»“æœå·²æ¸…ç©º');
        };

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.onload = function() {
            addResult('success', 'ğŸ‰ ç»„ä»¶æ ‘ä¿®å¤éªŒè¯å·¥å…·å·²åŠ è½½');
            addResult('warning', 'ğŸ’¡ ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½');
        };
    </script>
</body>
</html>