# ğŸ¯ æ•°ç»„æ•°æ®é…ç½®æµ‹è¯•æŒ‡å—

## ğŸ“‹ é‡è¦æ”¹è¿›æ€»ç»“

æˆ‘ä»¬æˆåŠŸå°†**æŠ½è±¡çš„key1/key2/key3**é…ç½®æ›¿æ¢ä¸º**è¯­ä¹‰åŒ–çš„æ•°æ®é…ç½®ç•Œé¢**ï¼

### ğŸ”„ æ ¸å¿ƒå˜åŒ–å¯¹æ¯”

#### **ä¹‹å‰çš„é—®é¢˜**:
- âŒ key1ã€key2ã€key3 å«ä¹‰ä¸æ˜ç¡®
- âŒ æ•°ç»„å’Œå¯¹è±¡æ•°æ®å¤„ç†ä¸ä¸€è‡´
- âŒ ç”¨æˆ·ä¸çŸ¥é“é…ç½®å­—æ®µçš„ä½œç”¨

#### **ç°åœ¨çš„è§£å†³æ–¹æ¡ˆ**:
- âœ… **æ•°ç»„æ•°æ®é…ç½®**: Xè½´å­—æ®µã€Yè½´å­—æ®µã€æ ‡ç­¾å­—æ®µ
- âœ… **å¯¹è±¡æ•°æ®é…ç½®**: è‡ªåŠ¨æ£€æµ‹æ•°å€¼å­—æ®µï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- âœ… **æ™ºèƒ½é¢„è§ˆ**: å®æ—¶æ˜¾ç¤ºæ˜ å°„ç»“æœ
- âœ… **ç»Ÿä¸€æ•°æ®æµ**: ç»„ä»¶æ¥æ”¶åŸå§‹æ•°æ®+é…ç½®ä¿¡æ¯

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
# æ³¨æ„ï¼šå¦‚æœé‡åˆ°ä¾èµ–é—®é¢˜ï¼Œè¯·å…ˆè§£å†³rollupæ¨¡å—é—®é¢˜
pnpm dev
```

### 2. è¿›å…¥Visual Editor
è®¿é—®ï¼šèœå• â†’ æµ‹è¯• â†’ ç¼–è¾‘å™¨é›†æˆæµ‹è¯•

### 3. æ·»åŠ é€šç”¨æ•°æ®å¯è§†åŒ–ç»„ä»¶
- åœ¨å·¦ä¾§ç»„ä»¶åº“ä¸­æ‰¾åˆ°"é€šç”¨æ•°æ®å¯è§†åŒ–"ç»„ä»¶
- æ‹–æ‹½åˆ°ç”»å¸ƒä¸Š
- ç‚¹å‡»ç»„ä»¶é€‰ä¸­å®ƒ

### 4. æµ‹è¯•æ•°ç»„æ•°æ®é…ç½®

#### A. åˆ‡æ¢åˆ°"æ•°æ®æº"é€‰é¡¹å¡
- å³ä¾§è®¾ç½®é¢æ¿ â†’ "æ•°æ®æº"é€‰é¡¹å¡
- ç¡®è®¤çœ‹åˆ°åµŒå…¥çš„æ•°æ®æºé…ç½®è¡¨å•

#### B. åŠ è½½æ•°ç»„ç¤ºä¾‹
- ç‚¹å‡» **"æ•°ç»„ç¤ºä¾‹"** æŒ‰é’®
- JSONç¼–è¾‘å™¨ä¼šè‡ªåŠ¨å¡«å…¥æ—¶é—´åºåˆ—æ•°æ®
- è§‚å¯Ÿç•Œé¢å˜åŒ–ï¼š

**æœŸæœ›ç»“æœ**:
```
æ•°æ®é…ç½® [æ•°ç»„æ•°æ® (7é¡¹)]

é…ç½®æ•°ç»„ä¸­æ¯ä¸ªå¯¹è±¡çš„å­—æ®µæ˜ å°„ï¼Œç”¨äºå›¾è¡¨X/Yè½´æ˜¾ç¤º

Xè½´å­—æ®µå: [timestamp        ]  # æ—¶é—´æˆ–ç´¢å¼•å­—æ®µï¼Œç”¨äºå›¾è¡¨æ¨ªè½´
Yè½´å­—æ®µå: [temperature      ]  # æ•°å€¼å­—æ®µï¼Œç”¨äºå›¾è¡¨çºµè½´  
æ ‡ç­¾å­—æ®µå: [label           ]  # å¯é€‰ï¼Œç”¨äºæ•°æ®ç‚¹æ ‡ç­¾æ˜¾ç¤º

æ•°æ®é¢„è§ˆ:
âœ… æ•°ç»„æ•°æ® (7 é¡¹)
Xè½´ (timestamp): 2024-01-01 10:00
Yè½´ (temperature): 22.5
æ ‡ç­¾ (label): æ•°æ®ç‚¹1
```

#### C. éªŒè¯å›¾è¡¨æ¸²æŸ“
- ç»„ä»¶åº”è‡ªåŠ¨åˆ‡æ¢åˆ°å›¾è¡¨æ¨¡å¼
- æ˜¾ç¤ºæ¸©åº¦éšæ—¶é—´å˜åŒ–çš„EChartsæ›²çº¿å›¾
- Xè½´æ˜¾ç¤ºæ—¶é—´ï¼ŒYè½´æ˜¾ç¤ºæ¸©åº¦å€¼

#### D. ğŸ¯ æµ‹è¯•å®æ—¶å“åº”ï¼ˆé‡è¦ï¼ï¼‰
- åœ¨"Yè½´å­—æ®µå"è¾“å…¥æ¡†ä¸­å°† `temperature` æ”¹ä¸º `humidity`
- **æœŸæœ›ç»“æœ**: å›¾è¡¨ç«‹å³åˆ‡æ¢æ˜¾ç¤ºæ¹¿åº¦æ•°æ®ï¼ŒYè½´æ•°å€¼èŒƒå›´æ”¹å˜
- æ•°æ®é¢„è§ˆåŒºåŸŸæ˜¾ç¤ºï¼š`Yè½´ (humidity): 65`
- å†æ”¹å› `temperature`ï¼Œå›¾è¡¨åº”ç«‹å³åˆ‡æ¢å›æ¸©åº¦æ•°æ®

### 5. æµ‹è¯•å¯¹è±¡æ•°æ®é…ç½®

#### A. åŠ è½½å¯¹è±¡ç¤ºä¾‹
- ç‚¹å‡» **"å¯¹è±¡ç¤ºä¾‹"** æŒ‰é’®  
- è§‚å¯Ÿç•Œé¢å˜åŒ–ä¸ºå¯¹è±¡æ•°æ®é…ç½®æ¨¡å¼

**æœŸæœ›ç»“æœ**:
```
æ•°æ®é…ç½® [å¯¹è±¡æ•°æ® (15å­—æ®µ)]

å¯¹è±¡æ•°æ®å°†è‡ªåŠ¨æ‰«ææ‰€æœ‰æ•°å€¼å­—æ®µï¼Œæ— éœ€é¢å¤–é…ç½®

æ£€æµ‹åˆ°çš„æ•°å€¼å­—æ®µ:
[sensors.temperature.current: 25.5] [sensors.humidity.current: 60] 
[sensors.pressure.current: 1013.25] [statistics.uptime: 86400] 
[statistics.dataPoints: 1440] ...

æ•°æ®é¢„è§ˆ:
âœ… å¯¹è±¡æ•°æ® (8 ä¸ªæ•°å€¼å­—æ®µ)
[sensors.temperature.current: 25.5] [device.status: online] ...è¿˜æœ‰ 3 ä¸ªå­—æ®µ
```

### 6. éªŒè¯é…ç½®å˜æ›´çš„å®æ—¶æ•ˆæœ

#### A. ä¿®æ”¹æ•°ç»„å­—æ®µæ˜ å°„
- åœ¨"Yè½´å­—æ®µå"ä¸­è¾“å…¥ `humidity`
- è§‚å¯Ÿæ•°æ®é¢„è§ˆç«‹å³æ›´æ–°ï¼š`Yè½´ (humidity): 65`
- ç»„ä»¶ä¸­çš„å›¾è¡¨åº”å®æ—¶åˆ‡æ¢åˆ°æ˜¾ç¤ºæ¹¿åº¦æ›²çº¿

#### B. æµ‹è¯•éšæœºæ›´æ–°
- ç‚¹å‡»"éšæœºæ›´æ–°"æŒ‰é’®
- è§‚å¯Ÿå›¾è¡¨æ•°æ®å’Œé¢„è§ˆåŒæ—¶æ›´æ–°

## ğŸ”§ æŠ€æœ¯å®ç°å…³é”®ç‚¹

### 1. æ•°æ®ä¼ é€’é“¾è·¯
```
DataSourceConfigForm â†’ SettingsPanel â†’ NodeWrapper â†’ Card2Wrapper â†’ UniversalDataVizCard
        â†“                  â†“              â†“             â†“               â†“
    arrayConfig      data-updated     card2Data      :data prop    receivedData
                                                     :metadata     props.metadata
```

### 2. æ–°çš„æ•°æ®ç»“æ„
```javascript
// DataSourceConfigForm å‘é€
widget.metadata = {
  card2Data: [åŸå§‹æ•°ç»„æ•°æ®],
  dataConfig: {
    isArray: true,
    arrayConfig: {
      xField: 'timestamp',
      yField: 'temperature', 
      labelField: 'label'
    }
  }
}

// UniversalDataVizCard æ¥æ”¶
arrayXPath.value = metadata.dataConfig.arrayConfig.xField
arrayYPath.value = metadata.dataConfig.arrayConfig.yField
```

### 3. æ™ºèƒ½é¢„è§ˆæœºåˆ¶
- **æ•°ç»„æ•°æ®**: æ˜¾ç¤ºç¬¬ä¸€ä¸ªå…ƒç´ çš„å­—æ®µå€¼æ˜ å°„
- **å¯¹è±¡æ•°æ®**: æ˜¾ç¤ºæ£€æµ‹åˆ°çš„æ•°å€¼å­—æ®µåˆ—è¡¨  
- **å®æ—¶æ›´æ–°**: é…ç½®å˜æ›´æ—¶ç«‹å³æ›´æ–°é¢„è§ˆå’Œç»„ä»¶

## ğŸ› å¯èƒ½é‡åˆ°çš„é—®é¢˜

### 1. ä¾èµ–é—®é¢˜ âš ï¸
å¦‚æœå¼€å‘æœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼ˆrollupæ¨¡å—é”™è¯¯ï¼‰ï¼Œéœ€è¦ï¼š
```bash
# åˆ é™¤ä¾èµ–å¹¶é‡æ–°å®‰è£…
rm -rf node_modules pnpm-lock.yaml
pnpm install

# å¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå¯ä»¥å°è¯•
pnpm install --force
```

### 2. âœ… å·²ä¿®å¤ï¼šç»„ä»¶æ·»åŠ æ—¶çš„JavaScripté”™è¯¯
**é”™è¯¯ä¿¡æ¯**: `TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))`

**ä¿®å¤**: åœ¨ UniversalDataVizCard.vue ä¸­å·²ä¿®å¤watchå‡½æ•°çš„å®‰å…¨è§£æ„ï¼š
```javascript
// ä¿®å¤å‰ï¼ˆä¼šæŠ¥é”™ï¼‰
watch(() => [props.data, props.metadata], ([newData, newMetadata], [oldData, oldMetadata]) => {

// ä¿®å¤åï¼ˆå®‰å…¨å¤„ç†ï¼‰
watch(() => [props.data, props.metadata], (newValues, oldValues) => {
  const [newData, newMetadata] = newValues || []
  const [oldData, oldMetadata] = oldValues || []
```

### 3. âœ… å·²ä¿®å¤ï¼šæ•°æ®æºé…ç½®æ—¶çš„å¼•ç”¨é”™è¯¯
**é”™è¯¯ä¿¡æ¯**: `ReferenceError: result is not defined`

**ä¿®å¤**: åœ¨ DataSourceConfigForm.vue ä¸­å·²ä¿®å¤updateOutputå‡½æ•°ä¸­çš„å˜é‡å¼•ç”¨ï¼š
```javascript
// ä¿®å¤å‰ï¼ˆä¼šæŠ¥é”™ï¼‰
config: {
  output: result  // resultå˜é‡ä¸å­˜åœ¨

// ä¿®å¤åï¼ˆæ­£ç¡®å¼•ç”¨ï¼‰
config: {
  output: currentOutputData.value  // ä½¿ç”¨æ­£ç¡®çš„å˜é‡
```

### 4. âœ… å·²ä¿®å¤ï¼šæ•°æ®é…ç½®ä¼ é€’é“¾è·¯ä¸­æ–­
**é—®é¢˜**: NodeWrapperä¼ é€’ç»™Card2Wrapperçš„æ•°æ®ä¸å®Œæ•´ï¼Œå¯¼è‡´UniversalDataVizCardæ— æ³•æ¥æ”¶åˆ°dataConfigä¿¡æ¯

**ä¿®å¤**: åœ¨ NodeWrapper.vue å’Œ Card2Wrapper.vue ä¸­æ·»åŠ metadata propä¼ é€’ï¼š
```vue
<!-- NodeWrapper.vue -->
<Card2Wrapper
  :data="node.metadata?.card2Data"
  :metadata="node.metadata"  <!-- æ–°å¢ï¼šä¼ é€’å®Œæ•´metadata -->
  ...
/>

<!-- Card2Wrapper.vue -->
<component
  :metadata="metadata || { card2Data: data, dataSource: dataSource }"  <!-- ä½¿ç”¨å®Œæ•´metadata -->
  ...
/>
```

### 5. âœ… å·²ä¿®å¤ï¼šæ•°ç»„é…ç½®å˜åŒ–æ—¶çš„å“åº”å¼æ›´æ–°é—®é¢˜
**é—®é¢˜**: ç”¨æˆ·ä¿®æ”¹æ•°ç»„å­—æ®µé…ç½®ï¼ˆXè½´ã€Yè½´å­—æ®µåï¼‰æ—¶ï¼Œå›¾è¡¨ä¸ä¼šå®æ—¶å“åº”å˜åŒ–

**ä¿®å¤**: 
1. **DataSourceConfigForm.vue** - æ”¹è¿›å“åº”å¼æ›´æ–°æœºåˆ¶ï¼š
```javascript
// åˆ›å»ºå…¨æ–°metadataå¯¹è±¡ç¡®ä¿å“åº”å¼æ›´æ–°
const newMetadata = {
  ...props.widget.metadata,
  card2Data: parsedJson.value,
  dataConfig: { /* æ–°é…ç½® */ },
  _updateTimestamp: Date.now() // æ—¶é—´æˆ³ç¡®ä¿æ˜¯æ–°å¯¹è±¡
}
props.widget.metadata = newMetadata
```

2. **UniversalDataVizCard.vue** - æ·»åŠ è·¯å¾„å˜åŒ–ç›‘å¬å™¨ï¼š
```javascript
// ç›‘å¬æ•°ç»„è·¯å¾„é…ç½®å˜åŒ–ï¼Œé‡æ–°æ¸²æŸ“å›¾è¡¨
watch([() => arrayXPath.value, () => arrayYPath.value], ([newXPath, newYPath]) => {
  if (è·¯å¾„å˜åŒ–ä¸”æœ‰æ•°ç»„æ•°æ®) {
    initChart() // é‡æ–°æ¸²æŸ“å›¾è¡¨
  }
})
```

### 6. ç»„ä»¶ä¸æ˜¾ç¤ºæ•°æ®
- æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰æ•°æ®ä¼ é€’æ—¥å¿—ï¼š`ğŸ” [UniversalDataViz] æ•°æ®å’Œé…ç½®å˜åŒ–`
- ç¡®è®¤ universal-data-viz ç»„ä»¶åœ¨å·¦ä¾§ç»„ä»¶åº“ä¸­å¯è§
- éªŒè¯ NodeWrapper æ˜¯å¦æ­£ç¡®ä¼ é€’ metadata

### 7. å›¾è¡¨ä¸æ¸²æŸ“  
- ç¡®è®¤æ•°ç»„æ•°æ®åŒ…å«æ•°å€¼å­—æ®µ
- æ£€æŸ¥ arrayXPath å’Œ arrayYPath æ˜¯å¦æ­£ç¡®è®¾ç½®
- æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š`ğŸ¯ [UniversalDataViz] ä½¿ç”¨DataSourceConfigFormçš„æ•°ç»„é…ç½®`
- éªŒè¯ ECharts åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ

## âœ¨ é¢„æœŸç”¨æˆ·ä½“éªŒ

ç”¨æˆ·ç°åœ¨å¯ä»¥ï¼š
1. **ç›´è§‚ç†è§£**æ¯ä¸ªé…ç½®å­—æ®µçš„ä½œç”¨ï¼ˆXè½´ã€Yè½´ã€æ ‡ç­¾ï¼‰
2. **å®æ—¶é¢„è§ˆ**é…ç½®æ•ˆæœï¼Œæ— éœ€çŒœæµ‹
3. **ä¸€é”®åˆ‡æ¢**æ•°ç»„å’Œå¯¹è±¡æ•°æ®æ¨¡å¼
4. **æ‰€è§å³æ‰€å¾—**çš„æ•°æ®æºé…ç½®ä½“éªŒ

è¿™å½»åº•è§£å†³äº†ä¹‹å‰key1/key2/key3çš„è¯­ä¹‰ä¸æ˜ç¡®é—®é¢˜ï¼ğŸ‰