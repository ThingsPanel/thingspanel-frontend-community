# Card 2.1 ç»„ä»¶å¼€å‘æŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº† Card 2.1 ç»„ä»¶ç³»ç»Ÿçš„å¼€å‘æµç¨‹å’Œå…³é”®è¦ç‚¹ï¼ŒåŸºäºä»ªè¡¨ç›˜ç»„ä»¶ï¼ˆgauge-chartï¼‰çš„å®Œæ•´å¼€å‘è¿‡ç¨‹æ•´ç†ã€‚

## ç»„ä»¶å¼€å‘æµç¨‹

### 1. æ–‡ä»¶ç»“æ„åˆ›å»º

Card 2.1 ç»„ä»¶å¿…é¡»éµå¾ªä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š

```
src/card2.1/components/
â””â”€â”€ [category]/        # ç±»åˆ«æ–‡ä»¶å¤¹ï¼ˆå¦‚ chart, system, alarmï¼‰
    â””â”€â”€ [subcategory]/ # å­ç±»åˆ«ï¼ˆå¦‚ data, statusï¼‰
        â””â”€â”€ [component-name]/
            â”œâ”€â”€ definition.ts      # ç»„ä»¶å®šä¹‰å’Œå…ƒæ•°æ®
            â”œâ”€â”€ index.vue          # ç»„ä»¶å®ç°
            â”œâ”€â”€ setting.vue        # é…ç½®é¢æ¿UI
            â”œâ”€â”€ settingConfig.ts   # é…ç½®é¡¹ç±»å‹å®šä¹‰
            â””â”€â”€ index.ts           # å¯¼å‡ºæ–‡ä»¶
```

#### ç¤ºä¾‹ï¼šä»ªè¡¨ç›˜ç»„ä»¶
```
src/card2.1/components/chart/data/gauge-chart/
â”œâ”€â”€ definition.ts
â”œâ”€â”€ index.vue
â”œâ”€â”€ setting.vue
â”œâ”€â”€ settingConfig.ts
â””â”€â”€ index.ts
```

### 2. ç»„ä»¶å®šä¹‰ï¼ˆdefinition.tsï¼‰

#### å¿…éœ€å­—æ®µ
```typescript
export const gaugeChartDefinition: ComponentDefinition = {
  // åŸºç¡€ä¿¡æ¯
  id: 'gauge-chart',
  name: 'ä»ªè¡¨ç›˜',
  description: 'åœ†å½¢ä»ªè¡¨ç›˜å›¾è¡¨ï¼Œç”¨äºæ˜¾ç¤ºå•ä¸ªæ•°å€¼åŠå…¶åœ¨èŒƒå›´å†…çš„ä½ç½®',
  category: 'chart',
  subCategory: 'data',
  version: '1.0.0',

  // ç»„ä»¶é…ç½®
  component: GaugeChartCustomize,

  // ğŸ”¥ å…³é”®ï¼šæ•°æ®æºå®šä¹‰
  dataSources: [
    {
      key: 'main',
      name: 'æ•°æ®æº',
      description: 'ä»ªè¡¨ç›˜çš„ä¸»è¦æ•°æ®æº',
      supportedTypes: ['static', 'api', 'websocket'],
      required: false,
      // ğŸ”¥ é‡è¦ï¼šæä¾›ç¤ºä¾‹å€¼
      example: {
        value: 75,
        unit: 'â„ƒ',
        metricsName: 'æ¸©åº¦',
        timestamp: '2025-10-15T10:30:00.000Z'
      }
    }
  ],

  // äº¤äº’èƒ½åŠ›ï¼ˆå¯é€‰ï¼‰
  interactionCapabilities: {
    canTrigger: false,
    canReceive: false,
    exposedProperties: []
  }
}
```

#### æ•°æ®æºè®¾è®¡åŸåˆ™

**å•ä¸€æ•°æ®æº vs å¤šæ•°æ®æº**

- âœ… **å•ä¸€æ•°æ®æº**ï¼šé€‚ç”¨äºå¤§å¤šæ•°ç»„ä»¶
  ```typescript
  dataSources: [{
    key: 'main',
    example: { value, unit, metricsName, timestamp }
  }]
  ```

- âœ… **å¤šæ•°æ®æº**ï¼šä»…ç”¨äºå¤šç³»åˆ—å›¾è¡¨ï¼ˆå¤šæ¡æ›²çº¿ã€å¤šæŸ±çŠ¶å›¾ç­‰ï¼‰
  ```typescript
  dataSources: [
    { key: 'series1', example: {...} },
    { key: 'series2', example: {...} }
  ]
  ```

**æ•°æ®æº vs é…ç½®é¡¹**

- **æ•°æ®æºï¼ˆdataSourcesï¼‰**ï¼šåŠ¨æ€æ•°æ®ï¼Œæ¥è‡ª APIã€WebSocket ç­‰
- **é…ç½®é¡¹ï¼ˆcomponentï¼‰**ï¼šé™æ€è®¾ç½®ï¼Œå¦‚é¢œè‰²ã€å°ºå¯¸ã€æœ€å°å€¼ã€æœ€å¤§å€¼

### 3. é…ç½®ç±»å‹å®šä¹‰ï¼ˆsettingConfig.tsï¼‰

```typescript
export interface GaugeChartCustomize {
  // æ•°æ®é…ç½®ï¼ˆé™æ€é…ç½®ï¼Œéæ•°æ®æºï¼‰
  value?: number        // é»˜è®¤å€¼
  min?: number          // æœ€å°å€¼
  max?: number          // æœ€å¤§å€¼
  title?: string        // æ ‡é¢˜
  unit?: string         // å•ä½

  // æ ·å¼é…ç½®
  radius?: string       // ä»ªè¡¨ç›˜åŠå¾„
  thickness?: number    // æŒ‡ç¤ºå™¨ç²—ç»†
  titleColor?: string   // æ ‡é¢˜é¢œè‰²
  valueColor?: string   // æ•°å€¼é¢œè‰²

  // åŠ¨ç”»é…ç½®
  animationDuration?: number
}
```

### 4. ç»„ä»¶å®ç°ï¼ˆindex.vueï¼‰

#### å…³é”®è¦ç‚¹

**4.1 ä½¿ç”¨ useCard2Props Hook**

```typescript
// ğŸ”¥ å…³é”®ä¿®å¤ï¼šdata å¿…é¡»ä¼ å…¥ computed åŒ…è£…
const { unifiedConfig, displayData } = useCard2Props({
  config: props.config,
  data: computed(() => props.data),  // âœ… æ­£ç¡®ï¼šå»ºç«‹å“åº”å¼ä¾èµ–
  // data: props.data,                // âŒ é”™è¯¯ï¼šæ— æ³•å“åº”å˜åŒ–
  componentId: props.componentId
})
```

**ä¸ºä»€ä¹ˆå¿…é¡»ä½¿ç”¨ `computed(() => props.data)`ï¼Ÿ**

- `props.data` æ˜¯å“åº”å¼æ•°æ®ï¼Œä½†ç›´æ¥ä¼ é€’åªä¼šä¼ é€’å½“å‰å€¼çš„å¿«ç…§
- `computed(() => props.data)` åˆ›å»ºè®¡ç®—å±æ€§ï¼Œå»ºç«‹å“åº”å¼ä¾èµ–é“¾
- å½“ `props.data` æ›´æ–°æ—¶ï¼Œè®¡ç®—å±æ€§ä¼šé‡æ–°æ‰§è¡Œï¼Œè§¦å‘ `useCard2Props` å†…éƒ¨çš„ `displayData` æ›´æ–°

**4.2 æ•°æ®è®¿é—®è·¯å¾„**

æ•°æ®æºè¿”å›çš„æ•°æ®ç»“æ„ï¼š
```typescript
{
  main: {           // æ•°æ®æº key
    data: {         // å®é™…æ•°æ®
      value: 75,
      unit: 'â„ƒ',
      metricsName: 'æ¸©åº¦',
      timestamp: '...'
    }
  }
}
```

è®¿é—®æ–¹å¼ï¼š
```typescript
const displayValue = computed(() => {
  // æ•°æ®æºä¼˜å…ˆï¼Œé…ç½®å€¼å…œåº•
  const dataSourceValue = displayData.value?.main?.data?.value
  return Number(dataSourceValue ?? unifiedConfig.value.component?.value ?? 75)
})
```

**4.3 å®Œæ•´ç¤ºä¾‹**

```vue
<script setup lang="ts">
import { ref, computed, watch, onMounted, onUnmounted, nextTick } from 'vue'
import { useCard2Props } from '@/card2.1/hooks'
import type { GaugeChartCustomize } from './settingConfig'

interface Props {
  config: GaugeChartCustomize
  data?: Record<string, unknown>
  componentId?: string
}

const props = withDefaults(defineProps<Props>(), {
  data: () => ({})
})

// ğŸ”¥ å…³é”®ï¼šä½¿ç”¨ computed åŒ…è£… props.data
const { unifiedConfig, displayData } = useCard2Props({
  config: props.config,
  data: computed(() => props.data),
  componentId: props.componentId
})

// è®¡ç®—æ˜¾ç¤ºå€¼ï¼ˆæ•°æ®æºä¼˜å…ˆï¼‰
const displayValue = computed(() => {
  const dataSourceValue = displayData.value?.main?.data?.value
  return Number(dataSourceValue ?? unifiedConfig.value.component?.value ?? 75)
})

// ç»„ä»¶é€»è¾‘...
</script>
```

### 5. é…ç½®é¢æ¿ï¼ˆsetting.vueï¼‰

ä½¿ç”¨ Naive UI ç»„ä»¶æ„å»ºé…ç½®ç•Œé¢ï¼š

```vue
<template>
  <n-space vertical :size="16">
    <n-form-item label="å½“å‰å€¼">
      <n-input-number
        v-model:value="localConfig.value"
        :min="0"
        :max="100"
        @update:value="handleConfigChange"
      />
    </n-form-item>

    <!-- æ›´å¤šé…ç½®é¡¹... -->
  </n-space>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue'
import { NSpace, NFormItem, NInputNumber } from 'naive-ui'
import type { GaugeChartCustomize } from './settingConfig'

// Props å’Œ emits
const props = defineProps<{ config: GaugeChartCustomize }>()
const emit = defineEmits<{
  (e: 'update:config', config: GaugeChartCustomize): void
}>()

// æœ¬åœ°é…ç½®
const localConfig = ref<GaugeChartCustomize>({ ...props.config })

// é…ç½®å˜æ›´å¤„ç†
const handleConfigChange = () => {
  emit('update:config', { ...localConfig.value })
}

// ç›‘å¬å¤–éƒ¨é…ç½®å˜åŒ–
watch(() => props.config, (newConfig) => {
  localConfig.value = { ...newConfig }
}, { deep: true })
</script>
```

### 6. ç»„ä»¶æ³¨å†Œ

#### 6.1 ç±»åˆ«æ˜ å°„

åœ¨ `src/card2.1/core2/registry/category-definition.ts` æ·»åŠ æ˜ å°„ï¼š

```typescript
export const COMPONENT_TO_CATEGORY_MAP: Record<string, string> = {
  // ... å…¶ä»–ç»„ä»¶
  'gauge-chart': 'data',  // æ–°å¢ä»ªè¡¨ç›˜ç»„ä»¶æ˜ å°„
}
```

#### 6.2 è‡ªåŠ¨æ³¨å†Œ

ç³»ç»Ÿé€šè¿‡ `import.meta.glob` è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œç»„ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨æ³¨å†Œã€‚

### 7. å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### é—®é¢˜1ï¼šç»„ä»¶æ˜¾ç¤ºé»˜è®¤å€¼ï¼Œä¸æ˜¾ç¤ºæ•°æ®æºæ•°æ®

**åŸå› **ï¼šå“åº”å¼ä¾èµ–é“¾æ–­è£‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// âŒ é”™è¯¯
const { displayData } = useCard2Props({
  data: props.data
})

// âœ… æ­£ç¡®
const { displayData } = useCard2Props({
  data: computed(() => props.data)
})
```

#### é—®é¢˜2ï¼šç¤ºä¾‹å€¼æœªåœ¨æ•°æ®æºé…ç½®ç•Œé¢æ˜¾ç¤º

**åŸå› **ï¼šç¤ºä¾‹å€¼è®¿é—®è·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// âŒ é”™è¯¯
const exampleData = currentDataSource?.originalData?.originalData?.example

// âœ… æ­£ç¡®
const exampleData = currentDataSource?.originalData?.example
```

#### é—®é¢˜3ï¼šç»„ä»¶å½’ç±»åˆ° "other" åˆ†ç±»

**åŸå› **ï¼šæœªåœ¨ COMPONENT_TO_CATEGORY_MAP æ·»åŠ æ˜ å°„

**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨ `category-definition.ts` æ·»åŠ ç»„ä»¶IDåˆ°åˆ†ç±»çš„æ˜ å°„

#### é—®é¢˜4ï¼šæ•°æ®æºç»“æ„è¯†åˆ«å¤±è´¥

**åŸå› **ï¼š`useCard2Props` çš„ `isDataFromWarehouse` æ£€æŸ¥ä¸æ”¯æŒåµŒå¥—ç»“æ„

**è§£å†³æ–¹æ¡ˆ**ï¼š
ç³»ç»Ÿå·²æ”¯æŒåµŒå¥—ç»“æ„è¯†åˆ«ï¼ˆå¦‚ `{ main: { data: {...} } }`ï¼‰ï¼Œæ— éœ€é¢å¤–å¤„ç†

## å¼€å‘æ£€æŸ¥æ¸…å•

å¼€å‘æ–°ç»„ä»¶æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ¸…å•é€é¡¹æ£€æŸ¥ï¼š

### æ–‡ä»¶ç»“æ„
- [ ] åˆ›å»ºæ­£ç¡®çš„ç›®å½•ç»“æ„
- [ ] åŒ…å«æ‰€æœ‰å¿…éœ€æ–‡ä»¶ï¼ˆdefinition.ts, index.vue, setting.vue, settingConfig.ts, index.tsï¼‰

### ç»„ä»¶å®šä¹‰
- [ ] å®šä¹‰æ­£ç¡®çš„ category å’Œ subCategory
- [ ] æ•°æ®æºè®¾è®¡åˆç†ï¼ˆå•ä¸€ vs å¤šæ•°æ®æºï¼‰
- [ ] æä¾›å®Œæ•´çš„ç¤ºä¾‹å€¼ï¼ˆexampleï¼‰
- [ ] åŒºåˆ†æ•°æ®æºå’Œé…ç½®é¡¹

### ç»„ä»¶å®ç°
- [ ] ä½¿ç”¨ `computed(() => props.data)` åŒ…è£… data å‚æ•°
- [ ] æ­£ç¡®è®¿é—®æ•°æ®è·¯å¾„ï¼ˆdisplayData.value?.main?.data?.xxxï¼‰
- [ ] æ•°æ®æºä¼˜å…ˆï¼Œé…ç½®å€¼å…œåº•
- [ ] æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š

### é…ç½®é¢æ¿
- [ ] ä½¿ç”¨ Naive UI ç»„ä»¶
- [ ] å®ç°åŒå‘ç»‘å®šï¼ˆv-model å’Œ emitï¼‰
- [ ] ç›‘å¬å¤–éƒ¨é…ç½®å˜åŒ–

### ç»„ä»¶æ³¨å†Œ
- [ ] åœ¨ COMPONENT_TO_CATEGORY_MAP æ·»åŠ æ˜ å°„
- [ ] éªŒè¯ç»„ä»¶å‡ºç°åœ¨æ­£ç¡®çš„åˆ†ç±»ä¸‹

### æµ‹è¯•éªŒè¯
- [ ] é™æ€é…ç½®èƒ½æ­£ç¡®æ˜¾ç¤º
- [ ] æ•°æ®æºæ•°æ®èƒ½æ­£ç¡®æ˜¾ç¤º
- [ ] æ•°æ®æºæ›´æ–°æ—¶ç»„ä»¶å“åº”å¼æ›´æ–°
- [ ] é…ç½®é¢æ¿ä¿®æ”¹èƒ½å®æ—¶ç”Ÿæ•ˆ

## æœ€ä½³å®è·µ

1. **ä¼˜å…ˆä½¿ç”¨ Naive UI ç»„ä»¶**ï¼šé¿å…é‡å¤é€ è½®å­
2. **å®Œæ•´çš„ç±»å‹å®šä¹‰**ï¼šé¿å…ä½¿ç”¨ `any`
3. **è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š**ï¼šç‰¹åˆ«æ˜¯ä¸šåŠ¡é€»è¾‘å’Œå…³é”®ä¿®å¤ç‚¹
4. **å“åº”å¼ä¾èµ–**ï¼šä¼ é€’ props æ—¶å¿…é¡»ä½¿ç”¨ `computed` æˆ– `toRef`
5. **æ•°æ®æºè®¾è®¡**ï¼šéµå¾ªå•ä¸€èŒè´£ï¼ŒåŒºåˆ†åŠ¨æ€æ•°æ®å’Œé™æ€é…ç½®
6. **ç¤ºä¾‹å€¼å®Œæ•´**ï¼šç¡®ä¿æ•°æ®æºé…ç½®ç•Œé¢èƒ½æ­£ç¡®é¢„è§ˆ

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹æ•°æ®æµ
```typescript
// åœ¨ç»„ä»¶ä¸­æ·»åŠ ä¸´æ—¶æ—¥å¿—
console.log('displayData:', displayData.value)
console.log('unifiedConfig:', unifiedConfig.value)
```

### éªŒè¯å“åº”å¼
```typescript
// æ£€æŸ¥ computed æ˜¯å¦è¢«è§¦å‘
const displayValue = computed(() => {
  console.log('displayValue computed è¢«è§¦å‘')
  return displayData.value?.main?.data?.value
})
```

### æ£€æŸ¥æ•°æ®æºæ‰§è¡Œ
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹ Network é¢æ¿å’Œ Console é¢æ¿ï¼Œç¡®è®¤ï¼š
- API è¯·æ±‚æˆåŠŸ
- æ•°æ®æ ¼å¼æ­£ç¡®
- ç»„ä»¶æ¥æ”¶åˆ°æ•°æ®æ›´æ–°

## å‚è€ƒç»„ä»¶

æ¨èå‚è€ƒä»¥ä¸‹ç»„ä»¶çš„å®ç°ï¼š
- **ä»ªè¡¨ç›˜ç»„ä»¶**ï¼š`src/card2.1/components/chart/data/gauge-chart/`
- **æ•°å­—æŒ‡ç¤ºå™¨**ï¼š`src/card2.1/components/chart/data/digit-indicator/`

## æ€»ç»“

Card 2.1 ç»„ä»¶å¼€å‘çš„æ ¸å¿ƒè¦ç‚¹ï¼š

1. **ä¸¥æ ¼çš„æ–‡ä»¶ç»“æ„**ï¼šä¿è¯è‡ªåŠ¨æ³¨å†Œæœºåˆ¶æ­£å¸¸å·¥ä½œ
2. **æ­£ç¡®çš„æ•°æ®æºè®¾è®¡**ï¼šå•ä¸€æ•°æ®æºä¼˜å…ˆï¼ŒåŒºåˆ†æ•°æ®å’Œé…ç½®
3. **å“åº”å¼ä¾èµ–å¤„ç†**ï¼šä½¿ç”¨ `computed(() => props.data)` å»ºç«‹ä¾èµ–é“¾
4. **æ ‡å‡†åŒ–é…ç½®æ¥å£**ï¼šä½¿ç”¨ `useCard2Props` ç»Ÿä¸€ç®¡ç†é…ç½®
5. **å®Œæ•´çš„ç±»å‹å®šä¹‰**ï¼šTypeScript ä¸¥æ ¼æ¨¡å¼ï¼Œé¿å… `any`

éµå¾ªæœ¬æŒ‡å—ï¼Œå¯ä»¥å¿«é€Ÿå¼€å‘å‡ºç¬¦åˆ Card 2.1 æ¶æ„è§„èŒƒçš„é«˜è´¨é‡ç»„ä»¶ã€‚
