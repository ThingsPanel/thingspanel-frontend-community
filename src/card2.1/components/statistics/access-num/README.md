# è®¾å¤‡æ€»æ•°ç»Ÿè®¡ç»„ä»¶ (Access Num Card)

## ğŸ“‹ ç»„ä»¶æ¦‚è¿°

**è®¾å¤‡æ€»æ•°ç»Ÿè®¡ç»„ä»¶** æ˜¯ä» `builtin-card/access` æˆåŠŸè¿ç§»åˆ° Card2.1 ç³»ç»Ÿçš„ç»Ÿè®¡å±•ç¤ºç»„ä»¶ã€‚è¯¥ç»„ä»¶ç”¨äºå®æ—¶æ˜¾ç¤ºç³»ç»Ÿä¸­è®¾å¤‡çš„æ€»æ•°ç»Ÿè®¡ä¿¡æ¯ï¼Œæ”¯æŒè‡ªåŠ¨åˆ·æ–°ã€æƒé™æ§åˆ¶å’Œä¸»é¢˜é€‚é…ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- âœ… **å†å²å…¼å®¹æ€§**ï¼šä¿æŒç»„ä»¶ID `access-num` ä¸å˜ï¼Œå®Œç¾å…¼å®¹å†å²æ•°æ®
- âœ… **è‡ªåŒ…å«è®¾è®¡**ï¼šæ— éœ€å¤–éƒ¨æ•°æ®æºé…ç½®ï¼Œç»„ä»¶å†…éƒ¨è‡ªåŠ¨è·å–æ•°æ®
- âœ… **æ™ºèƒ½æƒé™å¤„ç†**ï¼šæ ¹æ®ç”¨æˆ·æƒé™è‡ªåŠ¨é€‰æ‹©å¯¹åº”APIæ¥å£
- âœ… **è‡ªåŠ¨åˆ·æ–°**ï¼šæ”¯æŒå¯é…ç½®çš„å®šæ—¶æ•°æ®æ›´æ–°
- âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æ¢å¤å’Œç”¨æˆ·åé¦ˆæœºåˆ¶
- âœ… **ä¸»é¢˜é›†æˆ**ï¼šå®Œå…¨æ”¯æŒæ˜æš—ä¸»é¢˜åˆ‡æ¢
- âœ… **å“åº”å¼è®¾è®¡**ï¼šé€‚é…å„ç§å±å¹•å°ºå¯¸å’Œå®¹å™¨å¤§å°
- âœ… **å¼€å‘å‹å¥½**ï¼šå†…ç½®è°ƒè¯•é¢æ¿å’Œæ—¥å¿—ç³»ç»Ÿ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç»„ä»¶ç»“æ„
```
src/card2.1/components/statistics/access-num/
â”œâ”€â”€ AccessNumCard.vue     # Vueç»„ä»¶å®ç°
â”œâ”€â”€ index.ts              # Card2.1ç»„ä»¶å®šä¹‰
â”œâ”€â”€ MIGRATION_GUIDE.md    # è¯¦ç»†è¿ç§»æŒ‡å—
â””â”€â”€ README.md            # ç»„ä»¶è¯´æ˜æ–‡æ¡£
```

### æ•°æ®æµæ¶æ„
```mermaid
graph TD
    A[ç»„ä»¶æŒ‚è½½] --> B[è·å–ç”¨æˆ·æƒé™]
    B --> C{æƒé™ç±»å‹}
    C -->|TENANT_ADMIN| D[è°ƒç”¨sumData API]
    C -->|å…¶ä»–æƒé™| E[è°ƒç”¨totalNumber API]
    D --> F[å¤„ç†å“åº”æ•°æ®]
    E --> F
    F --> G[æ›´æ–°ç»„ä»¶çŠ¶æ€]
    G --> H[æ˜¾ç¤ºè®¾å¤‡æ€»æ•°]
    H --> I[å¯åŠ¨è‡ªåŠ¨åˆ·æ–°]
    I --> J{å®šæ—¶å™¨è§¦å‘}
    J -->|æ˜¯| B
    J -->|å¦| K[ç»„ä»¶å¸è½½æ—¶åœæ­¢]
```

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### 1. åœ¨ Visual Editor ä¸­ä½¿ç”¨

1. æ‰“å¼€å¯è§†åŒ–ç¼–è¾‘å™¨ (`/test/editor-integration`)
2. åœ¨ç»„ä»¶åº“çš„ **"ç»Ÿè®¡"** åˆ†ç±»ä¸­æ‰¾åˆ° **"è®¾å¤‡æ€»æ•°"** ç»„ä»¶
3. æ‹–æ‹½ç»„ä»¶åˆ°ç”»å¸ƒä¸Š
4. ç»„ä»¶ä¼šè‡ªåŠ¨å¼€å§‹è·å–å’Œæ˜¾ç¤ºè®¾å¤‡æ•°æ®
5. å¯åœ¨å³ä¾§å±æ€§é¢æ¿ä¸­é…ç½®ç»„ä»¶å‚æ•°

### 2. ç¼–ç¨‹æ–¹å¼ä½¿ç”¨

```vue
<template>
  <AccessNumCard 
    :title="'æˆ‘çš„è®¾å¤‡ç»Ÿè®¡'"
    :show-icon="true"
    :gradient-colors="['#ec4786', '#b955a4']"
    :refresh-interval="30000"
    :show-debug="false"
  />
</template>

<script setup lang="ts">
import AccessNumCard from '@/card2.1/components/statistics/access-num/AccessNumCard.vue'
</script>
```

## âš™ï¸ é…ç½®å‚æ•°

### Props æ¥å£

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `rawDataSources` | `any` | `null` | Card2.1æ ‡å‡†æ•°æ®ç»‘å®šæ¥å£ |
| `title` | `string` | `''` | è‡ªå®šä¹‰ç»„ä»¶æ ‡é¢˜ |
| `showIcon` | `boolean` | `true` | æ˜¯å¦æ˜¾ç¤ºè®¾å¤‡å›¾æ ‡ |
| `gradientColors` | `string[]` | `['#ec4786', '#b955a4']` | èƒŒæ™¯æ¸å˜è‰²é…ç½® |
| `refreshInterval` | `number` | `30000` | è‡ªåŠ¨åˆ·æ–°é—´éš”ï¼ˆæ¯«ç§’ï¼‰ |
| `showDebug` | `boolean` | `false` | æ˜¯å¦æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯é¢æ¿ |

### å¯é…ç½®å±æ€§ï¼ˆVisual Editorï¼‰

```typescript
{
  title: {
    type: 'string',
    default: 'è®¾å¤‡æ€»æ•°',
    label: 'æ ‡é¢˜',
    description: 'ç»„ä»¶æ˜¾ç¤ºæ ‡é¢˜'
  },
  showIcon: {
    type: 'boolean', 
    default: true,
    label: 'æ˜¾ç¤ºå›¾æ ‡',
    description: 'æ˜¯å¦æ˜¾ç¤ºè®¾å¤‡å›¾æ ‡'
  },
  gradientColors: {
    type: 'array',
    default: ['#ec4786', '#b955a4'],
    label: 'æ¸å˜è‰²',
    description: 'èƒŒæ™¯æ¸å˜é¢œè‰²é…ç½®'
  },
  refreshInterval: {
    type: 'number',
    default: 30000,
    label: 'åˆ·æ–°é—´éš”(ms)',
    description: 'æ•°æ®è‡ªåŠ¨åˆ·æ–°é—´éš”æ—¶é—´'
  }
}
```

## ğŸ”„ API é›†æˆ

### æ•°æ®æºé…ç½®

ç»„ä»¶ä¼šæ ¹æ®ç”¨æˆ·æƒé™è‡ªåŠ¨é€‰æ‹©APIï¼š

```typescript
// TENANT_ADMIN æƒé™ï¼šä½¿ç”¨æ±‡æ€»æ•°æ®æ¥å£
const response = await sumData()

// å…¶ä»–æƒé™ï¼šä½¿ç”¨æ€»æ•°æ¥å£  
const response = await totalNumber()

// é¢„æœŸå“åº”æ ¼å¼
interface ApiResponse {
  data: {
    device_total: number  // è®¾å¤‡æ€»æ•°
  }
}
```

### é”™è¯¯å¤„ç†æœºåˆ¶

```typescript
// 1. ç½‘ç»œé”™è¯¯å¤„ç†
catch (err) {
  error.value = err.message || 'è·å–è®¾å¤‡æ•°æ®å¤±è´¥'
  logger.error('è·å–è®¾å¤‡æ•°æ®å‡ºé”™', err)
  
  // ä¿æŒUIç¨³å®šæ€§
  if (deviceTotal.value === 0) {
    deviceTotal.value = 0
  }
}

// 2. æ•°æ®æ ¼å¼éªŒè¯
if (response?.data && typeof response.data.device_total === 'number') {
  deviceTotal.value = response.data.device_total
} else {
  throw new Error('APIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘ device_total å­—æ®µ')
}
```

## ğŸ¨ æ ·å¼ç³»ç»Ÿ

### ä¸»é¢˜å˜é‡æ”¯æŒ

```css
.access-num-card {
  /* ä½¿ç”¨ä¸»é¢˜å˜é‡ï¼Œè‡ªåŠ¨é€‚é…æ˜æš—ä¸»é¢˜ */
  background: var(--card-color);
  color: var(--text-color);
  border: 1px solid var(--border-color);
}

/* æš—ä¸»é¢˜ç‰¹æ®Šé€‚é… */
[data-theme="dark"] .debug-panel {
  background: var(--card-color-dark, #333);
  border-color: var(--border-color-dark, #555);
}
```

### å“åº”å¼è®¾è®¡

```css
/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 480px) {
  .count-number { font-size: 28px; }
  .icon-and-count {
    flex-direction: column;
    align-items: center;
  }
}

/* å®¹å™¨æŸ¥è¯¢é€‚é… */
@container (max-width: 250px) {
  .count-number { font-size: 24px; }
  .gradient-container { padding: 10px; }
}
```

## ğŸ” è°ƒè¯•åŠŸèƒ½

### å¼€å¯è°ƒè¯•æ¨¡å¼

```vue
<AccessNumCard :show-debug="true" />
```

### è°ƒè¯•ä¿¡æ¯åŒ…å«

- å½“å‰è®¾å¤‡æ€»æ•°
- åˆ·æ–°çŠ¶æ€å’Œæœ€åæ›´æ–°æ—¶é—´
- ç”¨æˆ·æƒé™ä¿¡æ¯
- ç»„ä»¶é…ç½®å‚æ•°
- åŸå§‹æ•°æ®æºä¿¡æ¯
- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœ‰ï¼‰

### æ§åˆ¶å°æ—¥å¿—

```typescript
// ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ—¥å¿—
logger.info('AccessNumCard ç»„ä»¶æŒ‚è½½')
logger.info('AccessNumCard ç»„ä»¶å¸è½½')

// æ•°æ®è·å–æ—¥å¿—
logger.info('å¼€å§‹è·å–è®¾å¤‡ç»Ÿè®¡æ•°æ®', { userAuthority })
logger.info('è®¾å¤‡æ•°æ®è·å–æˆåŠŸ', { deviceTotal, updateTime })
logger.error('è·å–è®¾å¤‡æ•°æ®å‡ºé”™', error)

// è‡ªåŠ¨åˆ·æ–°æ—¥å¿—
logger.info('å¯åŠ¨è‡ªåŠ¨åˆ·æ–°', { interval })
logger.info('åœæ­¢è‡ªåŠ¨åˆ·æ–°')
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. æ™ºèƒ½æ•°å€¼æ ¼å¼åŒ–

```typescript
const formattedCount = computed(() => {
  if (deviceTotal.value >= 10000) {
    return `${(deviceTotal.value / 10000).toFixed(1)}ä¸‡`
  } else if (deviceTotal.value >= 1000) {
    return `${(deviceTotal.value / 1000).toFixed(1)}k`
  }
  return deviceTotal.value.toString()
})
```

### 2. å®šæ—¶å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

```typescript
// ç»„ä»¶æŒ‚è½½æ—¶å¯åŠ¨
onMounted(() => {
  startAutoRefresh()
})

// ç»„ä»¶å¸è½½æ—¶æ¸…ç†
onUnmounted(() => {
  stopAutoRefresh()
})

// å‚æ•°å˜åŒ–æ—¶é‡å¯
watch(() => props.refreshInterval, () => {
  startAutoRefresh()
})
```

### 3. é”™è¯¯çŠ¶æ€ä¿æŠ¤

- APIè°ƒç”¨å¤±è´¥æ—¶ä¸å´©æºƒç•Œé¢
- ä¿æŒä¸Šæ¬¡æˆåŠŸçš„æ•°æ®æ˜¾ç¤º
- æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- æ”¯æŒåç»­è‡ªåŠ¨æ¢å¤

## ğŸ“Š ä¸åŸç»„ä»¶å¯¹æ¯”

| ç‰¹æ€§ | åŸ builtin-card | æ–° Card2.1 | æå‡ |
|------|-----------------|------------|------|
| **ç»„ä»¶ID** | access-num | access-num | ä¿æŒå…¼å®¹ âœ… |
| **æ•°æ®è·å–** | ä¾èµ–å¤–éƒ¨é…ç½® | å†…éƒ¨è‡ªç®¡ç† | ç®€åŒ–ä½¿ç”¨ ğŸš€ |
| **è‡ªåŠ¨åˆ·æ–°** | âŒ | âœ… å¯é…ç½® | æ–°åŠŸèƒ½ â­ |
| **é”™è¯¯å¤„ç†** | åŸºç¡€ | å®Œå–„æ¢å¤æœºåˆ¶ | å¯é æ€§ â¬†ï¸ |
| **ä¸»é¢˜æ”¯æŒ** | éƒ¨åˆ† | å®Œå…¨é›†æˆ | ä¸€è‡´æ€§ â¬†ï¸ |
| **å“åº”å¼** | åŸºç¡€ | å…¨é¢é€‚é… | ä½“éªŒ â¬†ï¸ |
| **è°ƒè¯•æ”¯æŒ** | âŒ | âœ… å†…ç½®é¢æ¿ | å¼€å‘æ•ˆç‡ â¬†ï¸ |
| **å›½é™…åŒ–** | éƒ¨åˆ† | å®Œå…¨æ”¯æŒ | å¤šè¯­è¨€ â¬†ï¸ |

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

**é—®é¢˜ 1ï¼šç»„ä»¶ä¸æ˜¾ç¤ºæ•°æ®**
```bash
# è§£å†³æ­¥éª¤
1. æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIæœåŠ¡çŠ¶æ€
2. ç¡®è®¤ç”¨æˆ·æƒé™å’Œè®¤è¯çŠ¶æ€
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
4. å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼š<AccessNumCard :show-debug="true" />
```

**é—®é¢˜ 2ï¼šè‡ªåŠ¨åˆ·æ–°ä¸å·¥ä½œ**
```bash
# æ£€æŸ¥é¡¹ç›®
1. ç¡®è®¤ refreshInterval > 0
2. æ£€æŸ¥ç»„ä»¶æ˜¯å¦æ­£å¸¸æŒ‚è½½å’Œå¸è½½
3. æŸ¥çœ‹æ§åˆ¶å°å®šæ—¶å™¨ç›¸å…³æ—¥å¿—
4. ç¡®è®¤æ²¡æœ‰JavaScripté”™è¯¯é˜»æ–­æ‰§è¡Œ
```

**é—®é¢˜ 3ï¼šæƒé™é”™è¯¯**
```bash
# æ’æŸ¥æ­¥éª¤  
1. æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼šauthStore.userInfo
2. ç¡®è®¤APIæ¥å£æƒé™é…ç½®
3. æŸ¥çœ‹ç½‘ç»œè¯·æ±‚è¿”å›çš„é”™è¯¯ç 
4. éªŒè¯åç«¯æœåŠ¡çš„æƒé™éªŒè¯é€»è¾‘
```

**é—®é¢˜ 4ï¼šä¸»é¢˜æ ·å¼å¼‚å¸¸**
```bash
# è§£å†³æ–¹æ³•
1. ç¡®è®¤ä¸»é¢˜ç³»ç»Ÿæ­£å¸¸åŠ è½½
2. æ£€æŸ¥CSSå˜é‡æ˜¯å¦æ­£ç¡®å®šä¹‰
3. éªŒè¯æš—ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜é‡æ–°åŠ è½½
```

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’ä¸­çš„åŠŸèƒ½

1. **æ•°æ®ç¼“å­˜**ï¼šæ·»åŠ æœ¬åœ°ç¼“å­˜å‡å°‘APIè°ƒç”¨
2. **è®¾å¤‡åˆ†ç±»ç»Ÿè®¡**ï¼šæ”¯æŒæŒ‰è®¾å¤‡ç±»å‹åˆ†ç»„æ˜¾ç¤º
3. **è¶‹åŠ¿å›¾è¡¨**ï¼šæ˜¾ç¤ºè®¾å¤‡æ•°é‡å˜åŒ–è¶‹åŠ¿
4. **äº¤äº’åŠŸèƒ½**ï¼šç‚¹å‡»è·³è½¬è®¾å¤‡åˆ—è¡¨é¡µé¢
5. **å¯¼å‡ºåŠŸèƒ½**ï¼šæ”¯æŒæ•°æ®å¯¼å‡ºExcel/CSV
6. **å®æ—¶æ¨é€**ï¼šWebSocketå®æ—¶æ•°æ®æ›´æ–°

### æ‰©å±•æ¥å£

```typescript
// æœªæ¥å¯èƒ½çš„æ‰©å±•Props
interface FutureProps extends Props {
  showTrend?: boolean           // æ˜¾ç¤ºè¶‹åŠ¿å›¾
  enableClick?: boolean         // å¯ç”¨ç‚¹å‡»äº¤äº’  
  exportEnabled?: boolean       // å¯ç”¨å¯¼å‡ºåŠŸèƒ½
  websocketUrl?: string        // WebSocketè¿æ¥åœ°å€
  cacheEnabled?: boolean       // å¯ç”¨æ•°æ®ç¼“å­˜
  groupByType?: boolean        // æŒ‰ç±»å‹åˆ†ç»„æ˜¾ç¤º
}
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¼€å‘å›¢é˜Ÿ
- **å¼€å‘è€…**: ThingsPanel Team
- **ç‰ˆæœ¬**: Card2.1 (v2.1.0)
- **è¿ç§»æ—¥æœŸ**: 2025-09-08

### è·å–å¸®åŠ©
1. æŸ¥çœ‹ [è¿ç§»æŒ‡å—](./MIGRATION_GUIDE.md) äº†è§£è¯¦ç»†è¿ç§»è¿‡ç¨‹
2. å¯ç”¨ç»„ä»¶è°ƒè¯•æ¨¡å¼è·å–è¯Šæ–­ä¿¡æ¯
3. æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°æ—¥å¿—
4. å‚è€ƒå…¶ä»– Card2.1 ç»„ä»¶çš„å®ç°æ¡ˆä¾‹

---

**ğŸ‰ è¯¥ç»„ä»¶å·²æˆåŠŸå®Œæˆä» builtin-card åˆ° Card2.1 çš„å®Œæ•´è¿ç§»ï¼Œæä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼**