# å‘Šè­¦ä¿¡æ¯ç»Ÿè®¡ç»„ä»¶ (Alarm Info Card)

## ğŸ“‹ ç»„ä»¶æ¦‚è¿°

**å‘Šè­¦ä¿¡æ¯ç»Ÿè®¡ç»„ä»¶** æ˜¯ä» `builtin-card/alarm-info` æˆåŠŸè¿ç§»åˆ° Card2.1 ç³»ç»Ÿçš„ç»Ÿè®¡å±•ç¤ºç»„ä»¶ã€‚è¯¥ç»„ä»¶ç”¨äºå®æ—¶æ˜¾ç¤ºç³»ç»Ÿæœ€æ–°å‘Šè­¦ä¿¡æ¯åˆ—è¡¨ï¼Œæ”¯æŒè‡ªåŠ¨åˆ·æ–°ã€é”™è¯¯å¤„ç†å’Œä¸»é¢˜é€‚é…ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- âœ… **å†å²å…¼å®¹æ€§**ï¼šä¿æŒç»„ä»¶ID `alarm-info` ä¸å˜ï¼Œå®Œç¾å…¼å®¹å†å²æ•°æ®
- âœ… **è‡ªåŒ…å«è®¾è®¡**ï¼šæ— éœ€å¤–éƒ¨æ•°æ®æºé…ç½®ï¼Œç»„ä»¶å†…éƒ¨è‡ªåŠ¨è·å–å‘Šè­¦æ•°æ®
- âœ… **å‘Šè­¦çŠ¶æ€åˆ†ç±»**ï¼šæ”¯æŒé«˜å±ã€ä¸­å±ã€ä½å±ã€æ­£å¸¸å››ç§å‘Šè­¦çŠ¶æ€æ˜¾ç¤º
- âœ… **è‡ªåŠ¨åˆ·æ–°**ï¼šæ”¯æŒå¯é…ç½®çš„å®šæ—¶æ•°æ®æ›´æ–°
- âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æ¢å¤å’Œç”¨æˆ·åé¦ˆæœºåˆ¶
- âœ… **ä¸»é¢˜é›†æˆ**ï¼šå®Œå…¨æ”¯æŒæ˜æš—ä¸»é¢˜åˆ‡æ¢
- âœ… **å“åº”å¼è®¾è®¡**ï¼šé€‚é…å„ç§å±å¹•å°ºå¯¸å’Œå®¹å™¨å¤§å°
- âœ… **è·¯ç”±è·³è½¬**ï¼šæ”¯æŒç‚¹å‡»æŸ¥çœ‹å…¨éƒ¨è·³è½¬åˆ°å‘Šè­¦ç®¡ç†é¡µé¢
- âœ… **å¼€å‘å‹å¥½**ï¼šå†…ç½®è°ƒè¯•é¢æ¿å’Œæ—¥å¿—ç³»ç»Ÿ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç»„ä»¶ç»“æ„
```
src/card2.1/components/statistics/alarm-info/
â”œâ”€â”€ AlarmInfoCard.vue     # Vueç»„ä»¶å®ç°
â”œâ”€â”€ index.ts              # Card2.1ç»„ä»¶å®šä¹‰
â”œâ”€â”€ MIGRATION_GUIDE.md    # è¯¦ç»†è¿ç§»æŒ‡å—
â””â”€â”€ README.md            # ç»„ä»¶è¯´æ˜æ–‡æ¡£
```

### æ•°æ®æµæ¶æ„
```mermaid
graph TD
    A[ç»„ä»¶æŒ‚è½½] --> B[è·å–å‘Šè­¦æ•°æ®]
    B --> C[è°ƒç”¨alarmHistory API]
    C --> D{APIå“åº”}
    D -->|æˆåŠŸ| E[æ›´æ–°å‘Šè­¦åˆ—è¡¨]
    D -->|å¤±è´¥| F[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
    E --> G[å¯åŠ¨è‡ªåŠ¨åˆ·æ–°]
    F --> H[æä¾›é‡è¯•é€‰é¡¹]
    G --> I{å®šæ—¶å™¨è§¦å‘}
    I -->|æ˜¯| B
    I -->|å¦| J[ç»„ä»¶å¸è½½æ—¶åœæ­¢]
```

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### 1. åœ¨ Visual Editor ä¸­ä½¿ç”¨

1. æ‰“å¼€å¯è§†åŒ–ç¼–è¾‘å™¨ (`/test/editor-integration`)
2. åœ¨ç»„ä»¶åº“çš„ **"ç»Ÿè®¡"** åˆ†ç±»ä¸­æ‰¾åˆ° **"å‘Šè­¦ä¿¡æ¯"** ç»„ä»¶
3. æ‹–æ‹½ç»„ä»¶åˆ°ç”»å¸ƒä¸Š
4. ç»„ä»¶ä¼šè‡ªåŠ¨å¼€å§‹è·å–å’Œæ˜¾ç¤ºå‘Šè­¦æ•°æ®
5. å¯åœ¨å³ä¾§å±æ€§é¢æ¿ä¸­é…ç½®ç»„ä»¶å‚æ•°

### 2. ç¼–ç¨‹æ–¹å¼ä½¿ç”¨

```vue
<template>
  <AlarmInfoCard 
    :title="'ç³»ç»Ÿå‘Šè­¦'"
    :page-size="15"
    :refresh-interval="30000"
    :show-view-all-button="true"
    :enable-auto-refresh="true"
    :show-debug="false"
  />
</template>

<script setup lang="ts">
import AlarmInfoCard from '@/card2.1/components/statistics/alarm-info/AlarmInfoCard.vue'
</script>
```

## âš™ï¸ é…ç½®å‚æ•°

### Props æ¥å£

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `rawDataSources` | `any` | `null` | Card2.1æ ‡å‡†æ•°æ®ç»‘å®šæ¥å£ |
| `title` | `string` | `''` | è‡ªå®šä¹‰ç»„ä»¶æ ‡é¢˜ |
| `pageSize` | `number` | `10` | æ˜¾ç¤ºçš„å‘Šè­¦æ¡æ•° (5-20) |
| `refreshInterval` | `number` | `60000` | è‡ªåŠ¨åˆ·æ–°é—´éš”ï¼ˆæ¯«ç§’ï¼‰ |
| `showViewAllButton` | `boolean` | `true` | æ˜¯å¦æ˜¾ç¤ºæŸ¥çœ‹å…¨éƒ¨æŒ‰é’® |
| `enableAutoRefresh` | `boolean` | `true` | æ˜¯å¦å¯ç”¨è‡ªåŠ¨åˆ·æ–° |
| `showDebug` | `boolean` | `false` | æ˜¯å¦æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯é¢æ¿ |

### å¯é…ç½®å±æ€§ï¼ˆVisual Editorï¼‰

```typescript
{
  title: {
    type: 'string',
    default: 'å‘Šè­¦ä¿¡æ¯',
    label: 'æ ‡é¢˜',
    description: 'ç»„ä»¶æ˜¾ç¤ºæ ‡é¢˜'
  },
  pageSize: {
    type: 'number',
    default: 10,
    label: 'æ˜¾ç¤ºæ¡æ•°',
    description: 'æ¯é¡µæ˜¾ç¤ºçš„å‘Šè­¦æ¡æ•°',
    min: 5,
    max: 20
  },
  refreshInterval: {
    type: 'number',
    default: 60000,
    label: 'åˆ·æ–°é—´éš”(ms)',
    description: 'æ•°æ®è‡ªåŠ¨åˆ·æ–°é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰'
  },
  showViewAllButton: {
    type: 'boolean',
    default: true,
    label: 'æ˜¾ç¤ºæŸ¥çœ‹å…¨éƒ¨æŒ‰é’®',
    description: 'æ˜¯å¦æ˜¾ç¤ºè·³è½¬åˆ°å‘Šè­¦ç®¡ç†é¡µé¢çš„æŒ‰é’®'
  },
  enableAutoRefresh: {
    type: 'boolean',
    default: true,
    label: 'å¯ç”¨è‡ªåŠ¨åˆ·æ–°',
    description: 'æ˜¯å¦å¯ç”¨å®šæ—¶è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½'
  }
}
```

## ğŸ”„ API é›†æˆ

### æ•°æ®æºé…ç½®

ç»„ä»¶å†…éƒ¨è°ƒç”¨å›ºå®šçš„å‘Šè­¦å†å²APIï¼š

```typescript
// è°ƒç”¨å‘Šè­¦å†å²APIè·å–æ•°æ®
const params = {
  page: 1,
  page_size: props.pageSize, // å¯é…ç½®æ˜¾ç¤ºæ¡æ•°
  alarm_status: '',          // ä¸è¿‡æ»¤çŠ¶æ€ï¼Œæ˜¾ç¤ºæ‰€æœ‰å‘Šè­¦
  start_time: '',           // ä¸é™åˆ¶æ—¶é—´èŒƒå›´
  end_time: ''
}

const response = await alarmHistory(params)

// é¢„æœŸå“åº”æ ¼å¼
interface ApiResponse {
  data: {
    list: AlarmData[]  // å‘Šè­¦æ•°æ®åˆ—è¡¨
    total: number      // æ€»æ¡æ•°
  }
}
```

### å‘Šè­¦çŠ¶æ€æ˜ å°„

```typescript
// å‘Šè­¦çŠ¶æ€å¯¹åº”å…³ç³»
const statusMapping = {
  'H': { label: 'é«˜å±å‘Šè­¦', type: 'error' },   // çº¢è‰²
  'M': { label: 'ä¸­å±å‘Šè­¦', type: 'warning' }, // æ©™è‰²  
  'L': { label: 'ä½å±å‘Šè­¦', type: 'info' },    // è“è‰²
  'N': { label: 'æ­£å¸¸', type: 'success' }      // ç»¿è‰²
}
```

### é”™è¯¯å¤„ç†æœºåˆ¶

```typescript
// 1. ç½‘ç»œé”™è¯¯å¤„ç†
catch (err) {
  error.value = err.message || 'è·å–å‘Šè­¦æ•°æ®å¤±è´¥'
  logger.error('è·å–å‘Šè­¦æ•°æ®å‡ºé”™', err)
  
  // ä¿æŒUIç¨³å®šæ€§
  if (alarmList.value.length === 0) {
    alarmList.value = []
  }
}

// 2. æ•°æ®æ ¼å¼éªŒè¯
if (response?.data?.list && Array.isArray(response.data.list)) {
  alarmList.value = response.data.list
} else {
  throw new Error('APIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘ list å­—æ®µ')
}
```

## ğŸ¨ æ ·å¼ç³»ç»Ÿ

### ä¸»é¢˜å˜é‡æ”¯æŒ

```css
.alarm-info-card {
  /* ä½¿ç”¨ä¸»é¢˜å˜é‡ï¼Œè‡ªåŠ¨é€‚é…æ˜æš—ä¸»é¢˜ */
  background: var(--card-color);
  color: var(--text-color);
  border: 1px solid var(--border-color);
}

/* æš—ä¸»é¢˜ç‰¹æ®Šé€‚é… */
[data-theme="dark"] .debug-panel {
  background: var(--card-color-dark, #333);
  border-color: var(--border-color-dark, #555);
}
```

### å“åº”å¼è®¾è®¡

```css
/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 480px) {
  .title { font-size: 14px; }
  .header {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }
}

/* å®¹å™¨æŸ¥è¯¢é€‚é… */
@container (max-width: 350px) {
  .title { font-size: 13px; }
  .alarm-table :deep(.n-data-table) {
    font-size: 12px;
  }
}
```

## ğŸ” è°ƒè¯•åŠŸèƒ½

### å¼€å¯è°ƒè¯•æ¨¡å¼

```vue
<AlarmInfoCard :show-debug="true" />
```

### è°ƒè¯•ä¿¡æ¯åŒ…å«

- å½“å‰å‘Šè­¦æ¡æ•°å’Œåˆ—è¡¨å†…å®¹
- åˆ·æ–°çŠ¶æ€å’Œæœ€åæ›´æ–°æ—¶é—´
- é…ç½®å‚æ•°ä¿¡æ¯
- åŸå§‹æ•°æ®æºä¿¡æ¯
- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœ‰ï¼‰

### æ§åˆ¶å°æ—¥å¿—

```typescript
// ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ—¥å¿—
logger.info('AlarmInfoCard ç»„ä»¶æŒ‚è½½')
logger.info('AlarmInfoCard ç»„ä»¶å¸è½½')

// æ•°æ®è·å–æ—¥å¿—
logger.info('å¼€å§‹è·å–å‘Šè­¦ä¿¡æ¯æ•°æ®', { pageSize })
logger.info('å‘Šè­¦æ•°æ®è·å–æˆåŠŸ', { alarmCount, updateTime })
logger.error('è·å–å‘Šè­¦æ•°æ®å‡ºé”™', error)

// è‡ªåŠ¨åˆ·æ–°æ—¥å¿—
logger.info('å¯åŠ¨è‡ªåŠ¨åˆ·æ–°', { interval })
logger.info('åœæ­¢è‡ªåŠ¨åˆ·æ–°')

// é¡µé¢è·³è½¬æ—¥å¿—
logger.info('è·³è½¬åˆ°å‘Šè­¦ç®¡ç†é¡µé¢')
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. æ™ºèƒ½åŠ è½½çŠ¶æ€

```typescript
// åŒºåˆ†é¦–æ¬¡åŠ è½½å’Œåˆ·æ–°çŠ¶æ€
if (alarmList.value.length === 0) {
  isLoading.value = true  // é¦–æ¬¡åŠ è½½æ˜¾ç¤ºå®Œæ•´loading
} else {
  isRefreshing.value = true  // åç»­åˆ·æ–°æ˜¾ç¤ºå°spinner
}
```

### 2. å®šæ—¶å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

```typescript
// ç»„ä»¶æŒ‚è½½æ—¶å¯åŠ¨
onMounted(() => {
  startAutoRefresh()
})

// ç»„ä»¶å¸è½½æ—¶æ¸…ç†
onUnmounted(() => {
  stopAutoRefresh()
})

// å‚æ•°å˜åŒ–æ—¶é‡å¯
watch(() => [props.refreshInterval, props.enableAutoRefresh], () => {
  startAutoRefresh()
})
```

### 3. è¡¨æ ¼è™šæ‹ŸåŒ–

- ä½¿ç”¨ Naive UI çš„ `flex-height` å±æ€§ä¼˜åŒ–è¡¨æ ¼æ€§èƒ½
- æ”¯æŒæ¨ªå‘æ»šåŠ¨ä»¥é€‚é…å°å±å¹•
- æ–‡æœ¬çœç•¥å’Œ tooltip æå‡ç”¨æˆ·ä½“éªŒ

## ğŸ“Š ä¸åŸç»„ä»¶å¯¹æ¯”

| ç‰¹æ€§ | åŸ builtin-card | æ–° Card2.1 | æå‡ |
|------|-----------------|------------|------|
| **ç»„ä»¶ID** | alarm-info | alarm-info | ä¿æŒå…¼å®¹ âœ… |
| **æ•°æ®è·å–** | å›ºå®šAPIè°ƒç”¨ | å†…éƒ¨è‡ªç®¡ç† + é…ç½®åŒ– | æ›´çµæ´» ğŸš€ |
| **è‡ªåŠ¨åˆ·æ–°** | âŒ | âœ… å¯é…ç½®é—´éš” | æ–°åŠŸèƒ½ â­ |
| **é”™è¯¯å¤„ç†** | åŸºç¡€ | å®Œå–„æ¢å¤æœºåˆ¶ | å¯é æ€§ â¬†ï¸ |
| **ä¸»é¢˜æ”¯æŒ** | éƒ¨åˆ† | å®Œå…¨é›†æˆ | ä¸€è‡´æ€§ â¬†ï¸ |
| **å“åº”å¼** | åŸºç¡€ | å…¨é¢é€‚é… | ä½“éªŒ â¬†ï¸ |
| **è°ƒè¯•æ”¯æŒ** | âŒ | âœ… å†…ç½®é¢æ¿ | å¼€å‘æ•ˆç‡ â¬†ï¸ |
| **å¯é…ç½®æ€§** | å›ºå®š | âœ… å¤šé¡¹é…ç½® | çµæ´»æ€§ â¬†ï¸ |

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

**é—®é¢˜ 1ï¼šç»„ä»¶ä¸æ˜¾ç¤ºæ•°æ®**
```bash
# è§£å†³æ­¥éª¤
1. æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIæœåŠ¡çŠ¶æ€
2. ç¡®è®¤å‘Šè­¦å†å²APIæƒé™å’Œå¯è®¿é—®æ€§
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
4. å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼š<AlarmInfoCard :show-debug="true" />
```

**é—®é¢˜ 2ï¼šè‡ªåŠ¨åˆ·æ–°ä¸å·¥ä½œ**
```bash
# æ£€æŸ¥é¡¹ç›®
1. ç¡®è®¤ enableAutoRefresh ä¸º true
2. ç¡®è®¤ refreshInterval > 0
3. æ£€æŸ¥ç»„ä»¶æ˜¯å¦æ­£å¸¸æŒ‚è½½å’Œå¸è½½
4. æŸ¥çœ‹æ§åˆ¶å°å®šæ—¶å™¨ç›¸å…³æ—¥å¿—
```

**é—®é¢˜ 3ï¼šæŸ¥çœ‹å…¨éƒ¨æŒ‰é’®æ— å“åº”**
```bash
# æ’æŸ¥æ­¥éª¤  
1. æ£€æŸ¥è·¯ç”±é…ç½®ï¼š/alarm/warning-message
2. ç¡®è®¤å‘Šè­¦ç®¡ç†é¡µé¢å­˜åœ¨ä¸”å¯è®¿é—®
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°è·¯ç”±è·³è½¬é”™è¯¯
4. éªŒè¯ vue-router é…ç½®æ­£ç¡®æ€§
```

**é—®é¢˜ 4ï¼šå‘Šè­¦çŠ¶æ€æ˜¾ç¤ºå¼‚å¸¸**
```bash
# è§£å†³æ–¹æ³•
1. ç¡®è®¤APIè¿”å›çš„alarm_statuså­—æ®µå€¼
2. æ£€æŸ¥çŠ¶æ€æ˜ å°„é…ç½®æ˜¯å¦å®Œæ•´
3. éªŒè¯ Naive UI Tag ç»„ä»¶æ­£å¸¸å·¥ä½œ
4. æŸ¥çœ‹æ˜¯å¦æœ‰è‡ªå®šä¹‰æ ·å¼å†²çª
```

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’ä¸­çš„åŠŸèƒ½

1. **å‘Šè­¦è¿‡æ»¤**ï¼šæ”¯æŒæŒ‰çŠ¶æ€ã€æ—¶é—´èŒƒå›´è¿‡æ»¤å‘Šè­¦
2. **å‘Šè­¦ç»Ÿè®¡å›¾**ï¼šæ˜¾ç¤ºå‘Šè­¦æ•°é‡è¶‹åŠ¿å›¾è¡¨
3. **å®æ—¶æ¨é€**ï¼šWebSocketå®æ—¶å‘Šè­¦é€šçŸ¥
4. **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒæ‰¹é‡å¤„ç†å‘Šè­¦
5. **å¯¼å‡ºåŠŸèƒ½**ï¼šæ”¯æŒå‘Šè­¦æ•°æ®å¯¼å‡ºExcel/CSV
6. **è‡ªå®šä¹‰åˆ—**ï¼šç”¨æˆ·å¯é…ç½®æ˜¾ç¤ºçš„è¡¨æ ¼åˆ—

### æ‰©å±•æ¥å£

```typescript
// æœªæ¥å¯èƒ½çš„æ‰©å±•Props
interface FutureProps extends Props {
  statusFilter?: string[]       // çŠ¶æ€è¿‡æ»¤å™¨
  timeRangeFilter?: string     // æ—¶é—´èŒƒå›´è¿‡æ»¤
  showChart?: boolean          // æ˜¾ç¤ºç»Ÿè®¡å›¾è¡¨
  enableWebSocket?: boolean    // å¯ç”¨å®æ—¶æ¨é€
  customColumns?: string[]     // è‡ªå®šä¹‰æ˜¾ç¤ºåˆ—
  enableBatchOperation?: boolean // å¯ç”¨æ‰¹é‡æ“ä½œ
}
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¼€å‘å›¢é˜Ÿ
- **å¼€å‘è€…**: ThingsPanel Team
- **ç‰ˆæœ¬**: Card2.1 (v2.1.0)
- **è¿ç§»æ—¥æœŸ**: 2025-09-08

### è·å–å¸®åŠ©
1. æŸ¥çœ‹ [è¿ç§»æŒ‡å—](./MIGRATION_GUIDE.md) äº†è§£è¯¦ç»†è¿ç§»è¿‡ç¨‹
2. å¯ç”¨ç»„ä»¶è°ƒè¯•æ¨¡å¼è·å–è¯Šæ–­ä¿¡æ¯
3. æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°æ—¥å¿—
4. å‚è€ƒå…¶ä»– Card2.1 ç»„ä»¶çš„å®ç°æ¡ˆä¾‹

---

**ğŸ‰ è¯¥ç»„ä»¶å·²æˆåŠŸå®Œæˆä» builtin-card åˆ° Card2.1 çš„å®Œæ•´è¿ç§»ï¼Œæä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼**