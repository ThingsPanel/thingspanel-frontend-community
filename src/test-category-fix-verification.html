<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card 2.1 æ–‡ä»¶å¤¹åˆ†ç±»ç³»ç»ŸéªŒè¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 15px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .result-box {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { border-left: 4px solid #27ae60; background: #d5f5d5; }
        .error { border-left: 4px solid #e74c3c; background: #fde2e2; }
        .info { border-left: 4px solid #3498db; background: #e3f2fd; }
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .category-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            background: white;
        }
        .category-title {
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 8px;
            margin-bottom: 10px;
        }
        .component-list {
            list-style: none;
            padding: 0;
        }
        .component-item {
            padding: 5px 0;
            border-bottom: 1px dotted #ddd;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ Card 2.1 æ–‡ä»¶å¤¹åˆ†ç±»ç³»ç»Ÿä¿®å¤éªŒè¯</h1>
            <p>éªŒè¯è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿæ˜¯å¦æ­£ç¡®æŒ‰ç…§æ–‡ä»¶å¤¹è¿›è¡Œåˆ†ç±»</p>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ åˆ†ç±»æ˜ å°„é…ç½®æµ‹è¯•</h3>
            <button class="test-button" onclick="testCategoryMapping()">éªŒè¯åˆ†ç±»æ˜ å°„é…ç½®</button>
            <button class="test-button" onclick="testFolderPathParsing()">æµ‹è¯•æ–‡ä»¶å¤¹è·¯å¾„è§£æ</button>
            <div id="mapping-result" class="result-box" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸš€ è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿæµ‹è¯•</h3>
            <button class="test-button" onclick="testAutoRegistry()">æµ‹è¯•è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿ</button>
            <button class="test-button" onclick="testCategoryFiltering()">æµ‹è¯•å¼€å‘ç¯å¢ƒåˆ†ç±»è¿‡æ»¤</button>
            <div id="registry-result" class="result-box" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š åˆ†ç±»æ˜¾ç¤ºéªŒè¯</h3>
            <button class="test-button" onclick="showAllCategories()">æ˜¾ç¤ºæ‰€æœ‰åˆ†ç±»</button>
            <button class="test-button" onclick="showComponentsByCategory()">æŒ‰åˆ†ç±»æ˜¾ç¤ºç»„ä»¶</button>
            <div id="categories-result" class="result-box" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ æœŸæœ›çš„åˆ†ç±»ç»“æœ</h3>
            <div class="category-grid">
                <div class="category-card">
                    <div class="category-title">ğŸ“Š ä»ªè¡¨ç›˜</div>
                    <p>dashboard/ æ–‡ä»¶å¤¹ä¸‹çš„ç»„ä»¶</p>
                </div>
                <div class="category-card">
                    <div class="category-title">â„¹ï¸ ä¿¡æ¯</div>
                    <p>information/ æ–‡ä»¶å¤¹ä¸‹çš„ç»„ä»¶</p>
                </div>
                <div class="category-card">
                    <div class="category-title">ğŸ® æ§åˆ¶</div>
                    <p>control/ æ–‡ä»¶å¤¹ä¸‹çš„ç»„ä»¶</p>
                </div>
                <div class="category-card">
                    <div class="category-title">ğŸ“ˆ æ•°æ®</div>
                    <p>data/ æ–‡ä»¶å¤¹ä¸‹çš„ç»„ä»¶</p>
                </div>
                <div class="category-card">
                    <div class="category-title">ğŸ“Š ç»Ÿè®¡</div>
                    <p>statistics/ æ–‡ä»¶å¤¹ä¸‹çš„ç»„ä»¶</p>
                </div>
                <div class="category-card">
                    <div class="category-title">ğŸ“ ä½ç½®</div>
                    <p>location/ æ–‡ä»¶å¤¹ä¸‹çš„ç»„ä»¶</p>
                </div>
                <div class="category-card">
                    <div class="category-title">ğŸµ éŸ³è§†é¢‘</div>
                    <p>media/ æ–‡ä»¶å¤¹ä¸‹çš„ç»„ä»¶</p>
                </div>
                <div class="category-card">
                    <div class="category-title">âš ï¸ å‘Šè­¦</div>
                    <p>alarm/ æ–‡ä»¶å¤¹ä¸‹çš„ç»„ä»¶</p>
                </div>
                <div class="category-card">
                    <div class="category-title">ğŸ§ª æµ‹è¯• (ä»…å¼€å‘)</div>
                    <p>test/ æ–‡ä»¶å¤¹ä¸‹çš„ç»„ä»¶ï¼Œä»…å¼€å‘ç¯å¢ƒæ˜¾ç¤º</p>
                </div>
                <div class="category-card">
                    <div class="category-title">ğŸ”§ è®¾å¤‡ (ç‰¹æ®Šé€»è¾‘)</div>
                    <p>device/ ä¸èµ°æ–‡ä»¶å¤¹é€»è¾‘ï¼Œæœ‰å…¶ä»–é€»è¾‘å®ç°</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // æµ‹è¯•åˆ†ç±»æ˜ å°„é…ç½®
        window.testCategoryMapping = async function() {
            const resultDiv = document.getElementById('mapping-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•åˆ†ç±»æ˜ å°„é…ç½®...';

            try {
                // åŠ¨æ€å¯¼å…¥åˆ†ç±»æ˜ å°„é…ç½®
                const { FOLDER_CATEGORY_MAPPING, getCategoryDisplayName, shouldShowCategory, validateCategoryMapping } = 
                    await import('./src/card2.1/components/category-mapping.ts');

                const validation = validateCategoryMapping();
                let result = '=== åˆ†ç±»æ˜ å°„é…ç½®éªŒè¯ç»“æœ ===\n\n';
                
                if (validation.valid) {
                    result += 'âœ… é…ç½®éªŒè¯é€šè¿‡ï¼\n\n';
                } else {
                    result += 'âŒ é…ç½®å­˜åœ¨é—®é¢˜:\n' + validation.issues.join('\n') + '\n\n';
                }

                result += 'ğŸ“‹ å·²é…ç½®çš„åˆ†ç±»æ˜ å°„:\n';
                Object.entries(FOLDER_CATEGORY_MAPPING).forEach(([folder, config]) => {
                    result += `${folder}/ â†’ "${config.displayName}" (é¡ºåº: ${config.order}`;
                    if (config.devOnly) result += ', ä»…å¼€å‘ç¯å¢ƒ';
                    if (!config.enabled) result += ', æœªå¯ç”¨';
                    result += ')\n';
                });

                result += '\nğŸ§ª æµ‹è¯•ç”¨ä¾‹:\n';
                result += `statistics â†’ ${getCategoryDisplayName('statistics')}\n`;
                result += `test â†’ ${getCategoryDisplayName('test')} (å¼€å‘ç¯å¢ƒ: ${shouldShowCategory('test', true)})\n`;
                result += `device â†’ ${getCategoryDisplayName('device')} (å¯ç”¨: ${FOLDER_CATEGORY_MAPPING.device.enabled})\n`;

                resultDiv.textContent = result;
                resultDiv.className = 'result-box success';
            } catch (error) {
                resultDiv.textContent = 'âŒ æµ‹è¯•å¤±è´¥:\n' + error.toString();
                resultDiv.className = 'result-box error';
            }
        };

        // æµ‹è¯•æ–‡ä»¶å¤¹è·¯å¾„è§£æ
        window.testFolderPathParsing = async function() {
            const resultDiv = document.getElementById('mapping-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•æ–‡ä»¶å¤¹è·¯å¾„è§£æ...';

            try {
                const { getCategoryByFolderPath } = await import('./src/card2.1/components/category-mapping.ts');
                
                const testPaths = [
                    './statistics/access-num/index.ts',
                    './test/simple-display/index.ts', 
                    './alarm/alarm-info/index.ts',
                    './data/chart-display/index.ts',
                    './unknown/component/index.ts'
                ];

                let result = '=== æ–‡ä»¶å¤¹è·¯å¾„è§£ææµ‹è¯• ===\n\n';
                testPaths.forEach(path => {
                    const config = getCategoryByFolderPath(path);
                    result += `è·¯å¾„: ${path}\n`;
                    if (config) {
                        result += `  â†’ åˆ†ç±»: ${config.displayName} (é¡ºåº: ${config.order})\n`;
                    } else {
                        result += `  â†’ åˆ†ç±»: æœªæ‰¾åˆ°æ˜ å°„\n`;
                    }
                    result += '\n';
                });

                resultDiv.textContent = result;
                resultDiv.className = 'result-box success';
            } catch (error) {
                resultDiv.textContent = 'âŒ æµ‹è¯•å¤±è´¥:\n' + error.toString();
                resultDiv.className = 'result-box error';
            }
        };

        // æµ‹è¯•è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿ
        window.testAutoRegistry = async function() {
            const resultDiv = document.getElementById('registry-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿ...';

            try {
                const { autoRegistry } = await import('./src/card2.1/components/auto-registry.ts');
                
                // ç­‰å¾…åˆå§‹åŒ–å®Œæˆ
                await autoRegistry.initialize();

                const components = autoRegistry.getAllComponents();
                const categories = autoRegistry.getAllCategories();
                const stats = autoRegistry.getStats();

                let result = '=== è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿæµ‹è¯•ç»“æœ ===\n\n';
                result += `ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:\n`;
                result += `- æ€»ç»„ä»¶æ•°: ${stats.total}\n`;
                result += `- åˆ†ç±»æ•°: ${categories.length}\n`;
                result += `- æœ‰æ•ˆç»„ä»¶æ•°: ${components.length}\n\n`;
                
                result += `ğŸ“‹ å‘ç°çš„åˆ†ç±»:\n`;
                categories.forEach((category, index) => {
                    const categoryComponents = autoRegistry.getComponentsByCategory(category);
                    result += `${index + 1}. ${category} (${categoryComponents.length} ä¸ªç»„ä»¶)\n`;
                });

                result += '\nğŸ” æŒ‰åˆ†ç±»ç»Ÿè®¡:\n';
                Object.entries(stats.byCategory).forEach(([category, count]) => {
                    result += `- ${category}: ${count} ä¸ªç»„ä»¶\n`;
                });

                resultDiv.textContent = result;
                resultDiv.className = 'result-box success';
            } catch (error) {
                resultDiv.textContent = 'âŒ æµ‹è¯•å¤±è´¥:\n' + error.toString();
                resultDiv.className = 'result-box error';
            }
        };

        // æµ‹è¯•å¼€å‘ç¯å¢ƒåˆ†ç±»è¿‡æ»¤
        window.testCategoryFiltering = async function() {
            const resultDiv = document.getElementById('registry-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•å¼€å‘ç¯å¢ƒåˆ†ç±»è¿‡æ»¤...';

            try {
                const { getValidCategories } = await import('./src/card2.1/components/category-mapping.ts');
                
                const prodCategories = getValidCategories(false); // ç”Ÿäº§ç¯å¢ƒ
                const devCategories = getValidCategories(true);   // å¼€å‘ç¯å¢ƒ

                let result = '=== å¼€å‘ç¯å¢ƒåˆ†ç±»è¿‡æ»¤æµ‹è¯• ===\n\n';
                result += `ğŸ­ ç”Ÿäº§ç¯å¢ƒåˆ†ç±» (${prodCategories.length} ä¸ª):\n`;
                prodCategories.forEach(({ folder, config }) => {
                    result += `- ${config.displayName} (${folder}/)\n`;
                });

                result += `\nğŸ§ª å¼€å‘ç¯å¢ƒåˆ†ç±» (${devCategories.length} ä¸ª):\n`;
                devCategories.forEach(({ folder, config }) => {
                    result += `- ${config.displayName} (${folder}/)`;
                    if (config.devOnly) result += ' [ä»…å¼€å‘ç¯å¢ƒ]';
                    result += '\n';
                });

                result += `\nâœ… è¿‡æ»¤é€»è¾‘éªŒè¯:\n`;
                result += `- test åˆ†ç±»åœ¨ç”Ÿäº§ç¯å¢ƒ: ${prodCategories.some(c => c.folder === 'test') ? 'æ˜¾ç¤º' : 'éšè—'}\n`;
                result += `- test åˆ†ç±»åœ¨å¼€å‘ç¯å¢ƒ: ${devCategories.some(c => c.folder === 'test') ? 'æ˜¾ç¤º' : 'éšè—'}\n`;
                result += `- device åˆ†ç±»: ${devCategories.some(c => c.folder === 'device') ? 'å¯ç”¨' : 'ç¦ç”¨'} (ç‰¹æ®Šé€»è¾‘)\n`;

                resultDiv.textContent = result;
                resultDiv.className = 'result-box success';
            } catch (error) {
                resultDiv.textContent = 'âŒ æµ‹è¯•å¤±è´¥:\n' + error.toString();
                resultDiv.className = 'result-box error';
            }
        };

        // æ˜¾ç¤ºæ‰€æœ‰åˆ†ç±»
        window.showAllCategories = async function() {
            const resultDiv = document.getElementById('categories-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box info';
            resultDiv.textContent = 'æ­£åœ¨åŠ è½½åˆ†ç±»ä¿¡æ¯...';

            try {
                const { autoRegistry } = await import('./src/card2.1/components/auto-registry.ts');
                
                await autoRegistry.initialize();
                const categories = autoRegistry.getAllCategories();

                let result = '=== æ‰€æœ‰åˆ†ç±»æ˜¾ç¤º ===\n\n';
                result += `å‘ç° ${categories.length} ä¸ªåˆ†ç±»:\n\n`;
                
                categories.forEach((category, index) => {
                    result += `${index + 1}. ${category}\n`;
                });

                resultDiv.textContent = result;
                resultDiv.className = 'result-box success';
            } catch (error) {
                resultDiv.textContent = 'âŒ æ˜¾ç¤ºå¤±è´¥:\n' + error.toString();
                resultDiv.className = 'result-box error';
            }
        };

        // æŒ‰åˆ†ç±»æ˜¾ç¤ºç»„ä»¶
        window.showComponentsByCategory = async function() {
            const resultDiv = document.getElementById('categories-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result-box info';
            resultDiv.textContent = 'æ­£åœ¨åŠ è½½ç»„ä»¶åˆ†ç±»ä¿¡æ¯...';

            try {
                const { autoRegistry } = await import('./src/card2.1/components/auto-registry.ts');
                
                await autoRegistry.initialize();
                const categories = autoRegistry.getAllCategories();

                let result = '=== æŒ‰åˆ†ç±»æ˜¾ç¤ºç»„ä»¶ ===\n\n';
                
                categories.forEach(category => {
                    const components = autoRegistry.getComponentsByCategory(category);
                    result += `ğŸ“‚ ${category} (${components.length} ä¸ªç»„ä»¶):\n`;
                    
                    if (components.length === 0) {
                        result += '  (æš‚æ— ç»„ä»¶)\n';
                    } else {
                        components.forEach(component => {
                            result += `  - ${component.name} (${component.type})\n`;
                        });
                    }
                    result += '\n';
                });

                resultDiv.textContent = result;
                resultDiv.className = 'result-box success';
            } catch (error) {
                resultDiv.textContent = 'âŒ æ˜¾ç¤ºå¤±è´¥:\n' + error.toString();
                resultDiv.className = 'result-box error';
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.addEventListener('load', function() {
            console.log('ğŸš€ Card 2.1 åˆ†ç±»ç³»ç»ŸéªŒè¯é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“ è¯·ç‚¹å‡»æŒ‰é’®è¿›è¡Œå„é¡¹æµ‹è¯•');
            
            // è‡ªåŠ¨è¿è¡Œåˆ†ç±»æ˜ å°„é…ç½®æµ‹è¯•
            setTimeout(testCategoryMapping, 1000);
        });
    </script>
</body>
</html>