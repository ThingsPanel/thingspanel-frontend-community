<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ” å‚æ•°ç»‘å®šè°ƒè¯•éªŒè¯</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #ff7875 0%, #faad14 100%);
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    }
    .header {
      background: linear-gradient(135deg, #ff7875 0%, #faad14 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 24px;
      text-align: center;
    }
    .header h1 {
      margin: 0 0 8px 0;
      font-size: 24px;
    }
    .debug-section {
      margin-bottom: 24px;
      padding: 20px;
      border: 2px solid #ff7875;
      border-radius: 8px;
      background: #fff2f0;
    }
    .debug-section h3 {
      margin: 0 0 16px 0;
      color: #ff7875;
      font-size: 18px;
    }
    .problem-item {
      margin: 12px 0;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border-left: 4px solid #ff7875;
    }
    .fix-item {
      margin: 12px 0;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border-left: 4px solid #52c41a;
    }
    .log-sample {
      background: #1f1f1f;
      color: #00ff00;
      padding: 12px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      margin: 8px 0;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    .config-sample {
      background: #f8f8f8;
      border: 1px solid #d9d9d9;
      padding: 12px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      margin: 8px 0;
      overflow-x: auto;
    }
    .nav-button {
      display: inline-block;
      padding: 10px 20px;
      background: #ff7875;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      margin-right: 12px;
      margin-bottom: 8px;
      transition: all 0.2s;
    }
    .nav-button:hover {
      background: #ff4d4f;
      transform: translateY(-1px);
    }
    .expected-log {
      background: #f6ffed;
      border: 1px solid #52c41a;
      padding: 12px;
      border-radius: 4px;
      margin: 8px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ” å‚æ•°ç»‘å®šè°ƒè¯•éªŒè¯</h1>
      <p>ä¸“é—¨è°ƒè¯•ä¿®æ”¹è®¾å¤‡IDåå‚æ•°ç»‘å®šä¸ºä»€ä¹ˆè¿˜ç”¨é»˜è®¤å€¼çš„é—®é¢˜</p>
    </div>

    <div class="debug-section">
      <h3>âŒ å‘ç°çš„æ ¸å¿ƒé—®é¢˜</h3>
      
      <div class="problem-item">
        <h4>é—®é¢˜ï¼šå‚æ•°é…ç½®ä¸­ value å­—æ®µä¸ºç©º</h4>
        <p>ä»ä½ æä¾›çš„æ—¥å¿—é…ç½®å¯ä»¥çœ‹åˆ°ï¼š</p>
        <div class="config-sample">{
  "key": "id",
  "value": "",                    // âŒ ç©ºå­—ç¬¦ä¸²ï¼
  "valueMode": "component",
  "selectedTemplate": "component-property-binding",
  "defaultValue": "1"
}</div>
        <p><strong>æ ¹å› </strong>ï¼šå‚æ•°ç»‘å®šéœ€è¦å®Œæ•´è·¯å¾„å¦‚ <code>triple-data-display_1757425833399.customize.deviceId</code>ï¼Œä½†å®é™… value ä¸ºç©º</p>
      </div>

      <div class="problem-item">
        <h4>ç»“æœï¼šæ€»æ˜¯å›é€€åˆ°é»˜è®¤å€¼</h4>
        <p>å› ä¸º <code>getComponentPropertyValue("")</code> è¿”å› undefinedï¼Œè§¦å‘é»˜è®¤å€¼æœºåˆ¶</p>
        <div class="log-sample">ğŸ”— [DataItemFetcher] è·¯å¾„å‚æ•°è§£æ: id = 1  â† ä½¿ç”¨äº†é»˜è®¤å€¼è€Œä¸æ˜¯æœ€æ–°çš„ 122</div>
      </div>
    </div>

    <div class="debug-section">
      <h3>âœ… å®æ–½çš„ä¿®å¤æ–¹æ¡ˆ</h3>
      
      <div class="fix-item">
        <h4>ä¿®å¤1ï¼šå‚æ•°è§£æè¿‡ç¨‹è°ƒè¯•æ—¥å¿—</h4>
        <p><strong>æ–‡ä»¶</strong>ï¼š<code>/src/core/data-architecture/executors/DataItemFetcher.ts:169-177</code></p>
        <p>æ·»åŠ è¯¦ç»†çš„å‚æ•°è§£æè°ƒè¯•ä¿¡æ¯ï¼Œæ˜¾ç¤ºï¼š</p>
        <ul>
          <li>å‚æ•°é”®ã€å€¼ã€æ¨¡æ¿ç±»å‹</li>
          <li>é»˜è®¤å€¼å’Œç»„ä»¶ID</li>
        </ul>
      </div>

      <div class="fix-item">
        <h4>ä¿®å¤2ï¼šè‡ªåŠ¨æ„é€ å±æ€§ç»‘å®šè·¯å¾„</h4>
        <p><strong>æ–‡ä»¶</strong>ï¼š<code>/src/core/data-architecture/executors/DataItemFetcher.ts:183-188</code></p>
        <p>å½“ value ä¸ºç©ºæ—¶ï¼Œè‡ªåŠ¨æ„é€ æ­£ç¡®çš„ç»‘å®šè·¯å¾„ï¼š</p>
        <div class="config-sample">// ğŸ”¥ å…³é”®ä¿®å¤ï¼šå¦‚æœ value ä¸ºç©ºï¼Œæ„é€ æ­£ç¡®çš„å±æ€§ç»‘å®šè·¯å¾„
if (!bindingPath || bindingPath.trim() === '') {
  // æ ¹æ®å‚æ•°é…ç½®æ„é€ å±æ€§ç»‘å®šè·¯å¾„
  bindingPath = `${this.componentId}.customize.deviceId`
  console.log(`ğŸ”§ [DataItemFetcher] è‡ªåŠ¨æ„é€ å±æ€§ç»‘å®šè·¯å¾„: ${bindingPath}`)
}</div>
      </div>

      <div class="fix-item">
        <h4>ä¿®å¤3ï¼šå±æ€§ç»‘å®šè¿‡ç¨‹è°ƒè¯•å¢å¼º</h4>
        <p><strong>æ–‡ä»¶</strong>ï¼š<code>/src/core/data-architecture/executors/DataItemFetcher.ts:106-142</code></p>
        <p>åœ¨ <code>getComponentPropertyValue</code> ä¸­æ·»åŠ è¯¦ç»†è°ƒè¯•ï¼Œæ˜¾ç¤ºï¼š</p>
        <ul>
          <li>ç»‘å®šè·¯å¾„è§£æè¿‡ç¨‹</li>
          <li>EditorStore ä¸­å¯ç”¨çš„èŠ‚ç‚¹åˆ—è¡¨</li>
          <li>å±æ€§è¯»å–ç»“æœ</li>
        </ul>
      </div>
    </div>

    <div class="debug-section">
      <h3>ğŸ§ª æµ‹è¯•éªŒè¯æ­¥éª¤</h3>
      
      <div class="expected-log">
        <h4>é¢„æœŸçš„æ–°å¢è°ƒè¯•æ—¥å¿—ï¼ˆæŒ‰é¡ºåºå‡ºç°ï¼‰ï¼š</h4>
        <div class="log-sample">ğŸ” [DataItemFetcher] resolveParameterValue è°ƒè¯• {
  "paramKey": "id",
  "paramValue": "",
  "selectedTemplate": "component-property-binding",
  "valueMode": "component",
  "defaultValue": "1",
  "componentId": "triple-data-display_1757425833399"
}

ğŸ”§ [DataItemFetcher] è‡ªåŠ¨æ„é€ å±æ€§ç»‘å®šè·¯å¾„: triple-data-display_1757425833399.customize.deviceId

ğŸ” [DataItemFetcher] getComponentPropertyValue è°ƒè¯• {
  "bindingPath": "triple-data-display_1757425833399.customize.deviceId",
  "currentComponentId": "triple-data-display_1757425833399"
}

ğŸ”§ [DataItemFetcher] è§£æå±æ€§ç»‘å®šè·¯å¾„ {
  "åŸå§‹è·¯å¾„": "triple-data-display_1757425833399.customize.deviceId",
  "ç»„ä»¶ID": "triple-data-display_1757425833399",
  "å±æ€§è·¯å¾„": "customize.deviceId"
}

ğŸ¯ [DataItemFetcher] å±æ€§ç»‘å®šç»“æœ {
  "bindingPath": "triple-data-display_1757425833399.customize.deviceId",
  "actualValue": 122,                    â† å…³é”®ï¼šåº”è¯¥æ˜¯æ–°å€¼ 122 è€Œä¸æ˜¯é»˜è®¤å€¼ 1
  "actualValueType": "string"
}

ğŸ”— [DataItemFetcher] è·¯å¾„å‚æ•°è§£æ: id = 122    â† æœ€ç»ˆç›®æ ‡ï¼šä½¿ç”¨æ–°å€¼è€Œä¸æ˜¯é»˜è®¤å€¼</div>
      </div>
    </div>

    <div class="debug-section">
      <h3>ğŸ¯ æµ‹è¯•æ“ä½œæŒ‡å—</h3>
      
      <p><strong>æµ‹è¯•æ­¥éª¤</strong>ï¼š</p>
      <ol>
        <li>è®¿é—®æ•°æ®æºæµ‹è¯•é¡µé¢</li>
        <li>æ·»åŠ  TripleDataDisplay ç»„ä»¶å¹¶é…ç½®HTTPæ•°æ®æº</li>
        <li>è®¾ç½®è·¯å¾„å‚æ•°ç»‘å®šåˆ°ç»„ä»¶å±æ€§</li>
        <li>åœ¨å±æ€§é¢æ¿ä¿®æ”¹ deviceId ä»é»˜è®¤å€¼æ”¹ä¸º 122</li>
        <li><strong>é‡ç‚¹è§‚å¯Ÿæ§åˆ¶å°ä¸­æ–°å¢çš„è°ƒè¯•æ—¥å¿—</strong></li>
      </ol>

      <p><strong>æˆåŠŸæ ‡å¿—</strong>ï¼š</p>
      <ul>
        <li>çœ‹åˆ° <code>ğŸ”§ è‡ªåŠ¨æ„é€ å±æ€§ç»‘å®šè·¯å¾„</code> æ—¥å¿—</li>
        <li>çœ‹åˆ° <code>actualValue: 122</code> è€Œä¸æ˜¯é»˜è®¤å€¼</li>
        <li>HTTPè¯·æ±‚ä½¿ç”¨æ–°çš„è®¾å¤‡IDå€¼å‘é€</li>
      </ul>
    </div>

    <div class="debug-section">
      <h3>ğŸ”— æµ‹è¯•é“¾æ¥</h3>
      <a href="http://localhost:5002/test/data-source-system" class="nav-button" target="_blank">
        ğŸ§ª å¼€å§‹æµ‹è¯•éªŒè¯
      </a>
    </div>

    <div class="debug-section">
      <h3>ğŸ“‹ å¦‚æœä»æœ‰é—®é¢˜</h3>
      <p>è¯·æä¾›å®Œæ•´çš„æ§åˆ¶å°æ—¥å¿—ï¼Œç‰¹åˆ«å…³æ³¨ï¼š</p>
      <ul>
        <li><code>ğŸ” [DataItemFetcher] resolveParameterValue è°ƒè¯•</code> çš„å®Œæ•´è¾“å‡º</li>
        <li><code>ğŸ” [DataItemFetcher] getComponentPropertyValue è°ƒè¯•</code> çš„ç»“æœ</li>
        <li><code>ğŸ¯ [DataItemFetcher] å±æ€§ç»‘å®šç»“æœ</code> ä¸­çš„ actualValue</li>
      </ul>
      <p>è¿™å°†å¸®åŠ©æˆ‘ä»¬ç²¾ç¡®å®šä½å‚æ•°ç»‘å®šå¤±è´¥çš„å…·ä½“ç¯èŠ‚ã€‚</p>
    </div>
  </div>
</body>
</html>