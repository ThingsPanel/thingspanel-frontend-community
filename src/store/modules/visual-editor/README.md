# ğŸ”¥ Visual Editor ç»Ÿä¸€æ¶æ„ç³»ç»Ÿ

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå…¨æ–°è®¾è®¡çš„ç»Ÿä¸€Visual Editoræ¶æ„ç³»ç»Ÿï¼Œå®Œå…¨è§£å†³äº†åŸæœ‰åˆ†æ•£æ¶æ„çš„æ•°æ®ç®¡ç†æ··ä¹±é—®é¢˜ã€‚è¯¥ç³»ç»Ÿæä¾›äº†ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†ã€é…ç½®æœåŠ¡ã€æ•°æ®æµæ§åˆ¶å’ŒCard2.1é›†æˆã€‚

## ğŸ—ï¸ æ¶æ„ç»„ä»¶

### æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | ä½œç”¨ | è¯´æ˜ |
|------|------|------|
| `index.ts` | ç³»ç»Ÿå…¥å£ | ç»Ÿä¸€çš„APIæ¥å£å’Œä¾¿æ·hook |
| `unified-editor.ts` | çŠ¶æ€ç®¡ç† | å”¯ä¸€æ•°æ®æºï¼Œæ›¿ä»£åŒé‡å­˜å‚¨ |
| `configuration-service.ts` | é…ç½®æœåŠ¡ | ç±»å‹å®‰å…¨çš„é…ç½®ç®¡ç† |
| `data-flow-manager.ts` | æ•°æ®æµç®¡ç† | åŸºäºactionçš„å•å‘æ•°æ®æµ |
| `card2-adapter.ts` | Card2.1é€‚é…å™¨ | æ ‡å‡†åŒ–çš„ç»„ä»¶é›†æˆ |

### æ”¯æŒæ–‡ä»¶

| æ–‡ä»¶ | ä½œç”¨ |
|------|------|
| `integration-example.ts` | é›†æˆç¤ºä¾‹ä»£ç  |
| `migration-helper.ts` | æ¶æ„è¿ç§»åŠ©æ‰‹ |
| `integration-guide.md` | è¯¦ç»†é›†æˆæŒ‡å— |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```typescript
import { useVisualEditor } from '@/store/modules/visual-editor'

// è·å–ç¼–è¾‘å™¨å®ä¾‹
const editor = useVisualEditor()

// åˆå§‹åŒ–ç³»ç»Ÿ
await editor.initialize()

// æ·»åŠ èŠ‚ç‚¹
await editor.addNode({
  id: 'my-node',
  type: 'MyComponent',
  position: { x: 100, y: 100 },
  data: { title: 'Hello World' }
})

// é…ç½®ç»„ä»¶
await editor.updateConfiguration('my-node', 'component', {
  properties: { text: 'Hello' },
  style: { width: 300, height: 200 }
})
```

### Card2.1ç»„ä»¶é›†æˆ

```typescript
// æ³¨å†ŒCard2.1ç»„ä»¶
editor.card2Adapter.registerCard2Component({
  type: 'MyCard2Component',
  name: 'æˆ‘çš„ç»„ä»¶',
  // ... å…¶ä»–é…ç½®
})

// è‡ªåŠ¨å¤„ç†æ•°æ®ç»‘å®šå’Œç”Ÿå‘½å‘¨æœŸ
```

## ğŸ§ª æµ‹è¯•å’ŒéªŒè¯

### è®¿é—®æµ‹è¯•é¡µé¢

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š`pnpm dev`
2. è®¿é—®ï¼š`http://localhost:5002/test`
3. ç‚¹å‡» "ğŸ”¥ ç»Ÿä¸€æ¶æ„æµ‹è¯•" è¿›å…¥æµ‹è¯•å¹³å°

### æµ‹è¯•é¡¹ç›®

- âœ… **åŸºæœ¬åŠŸèƒ½æµ‹è¯•** - ç³»ç»Ÿåˆå§‹åŒ–ã€èŠ‚ç‚¹ç®¡ç†
- âœ… **Card2.1é›†æˆæµ‹è¯•** - ç»„ä»¶æ³¨å†Œã€æ•°æ®ç»‘å®š
- âœ… **æ•°æ®æµç®¡ç†æµ‹è¯•** - Actionå¤„ç†ã€å‰¯ä½œç”¨
- âœ… **é…ç½®ç®¡ç†æµ‹è¯•** - é…ç½®CRUDã€æŒä¹…åŒ–
- âœ… **é”™è¯¯å¤„ç†æµ‹è¯•** - é”™è¯¯æ•è·ã€æ¢å¤
- âœ… **æ¶æ„è¿ç§»æµ‹è¯•** - æ—§æ•°æ®è¿ç§»ã€å…¼å®¹æ€§

## ğŸ”§ è§£å†³çš„æ ¸å¿ƒé—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| åŒé‡çŠ¶æ€å­˜å‚¨å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ | ç»Ÿä¸€çŠ¶æ€ç®¡ç†ä¸­å¿ƒ |
| åˆ†æ•£çš„é…ç½®ç®¡ç†éš¾ä»¥ç»´æŠ¤ | é…ç½®æœåŠ¡ç±»ç»Ÿä¸€ç®¡ç† |
| å¤æ‚çš„æ•°æ®æµéš¾ä»¥è°ƒè¯• | åŸºäºactionçš„å•å‘æ•°æ®æµ |
| Card2.1é›†æˆçš„å¤æ‚è½¬æ¢é€»è¾‘ | æ ‡å‡†åŒ–é€‚é…å™¨ |
| ç¼ºä¹ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶ | å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ¢å¤ |

## ğŸ“š API æ–‡æ¡£

### useVisualEditor()

ä¸»è¦çš„hookå‡½æ•°ï¼Œæä¾›ç»Ÿä¸€çš„ç¼–è¾‘å™¨APIã€‚

#### æ ¸å¿ƒæ–¹æ³•

- `initialize()` - åˆå§‹åŒ–ç³»ç»Ÿ
- `addNode(node)` - æ·»åŠ èŠ‚ç‚¹
- `updateConfiguration(id, section, config)` - æ›´æ–°é…ç½®
- `getConfiguration(id)` - è·å–é…ç½®
- `saveAll()` - ä¿å­˜æ‰€æœ‰é…ç½®
- `getStatus()` - è·å–ç³»ç»ŸçŠ¶æ€

#### å­ç³»ç»Ÿè®¿é—®

- `store` - ç»Ÿä¸€çŠ¶æ€ç®¡ç†
- `configService` - é…ç½®æœåŠ¡
- `dataFlowManager` - æ•°æ®æµç®¡ç†
- `card2Adapter` - Card2.1é€‚é…å™¨

### é…ç½®ç»“æ„

```typescript
interface WidgetConfiguration {
  base: BaseConfiguration          // åŸºç¡€é…ç½®ï¼ˆæ ‡é¢˜ã€é€æ˜åº¦ç­‰ï¼‰
  component: ComponentConfiguration    // ç»„ä»¶é…ç½®ï¼ˆå±æ€§ã€æ ·å¼ç­‰ï¼‰
  dataSource: DataSourceConfiguration | null  // æ•°æ®æºé…ç½®
  interaction: InteractionConfiguration   // äº¤äº’é…ç½®
  metadata: Record<string, any>    // å…ƒæ•°æ®
}
```

## ğŸ”„ è¿ç§»æŒ‡å—

### è‡ªåŠ¨è¿ç§»

```typescript
import { performQuickMigration } from '@/store/modules/visual-editor/migration-helper'

const result = await performQuickMigration()
console.log('è¿ç§»ç»“æœ:', result.status)
```

### æ‰‹åŠ¨è¿ç§»

1. **æ›¿æ¢storeå¼•ç”¨**:
   ```typescript
   // âŒ æ—§æ–¹å¼
   import { useVisualEditorStore } from '@/store/modules/visual-editor/legacy'
   
   // âœ… æ–°æ–¹å¼
   import { useVisualEditor } from '@/store/modules/visual-editor'
   ```

2. **æ›´æ–°é…ç½®æ“ä½œ**:
   ```typescript
   // âŒ æ—§æ–¹å¼
   configurationManager.setConfiguration(id, config)
   
   // âœ… æ–°æ–¹å¼
   editor.configService.setConfiguration(id, config)
   ```

3. **ä½¿ç”¨actionæ¨¡å¼**:
   ```typescript
   // âŒ æ—§æ–¹å¼ - ç›´æ¥ä¿®æ”¹çŠ¶æ€
   store.nodes.push(newNode)
   
   // âœ… æ–°æ–¹å¼ - é€šè¿‡action
   await editor.addNode(newNode)
   ```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### æœ€ä½³å®è·µ

1. **å§‹ç»ˆé€šè¿‡editorå®ä¾‹æ“ä½œ** - ä¸è¦ç›´æ¥è®¿é—®åº•å±‚store
2. **ä½¿ç”¨TypeScriptç±»å‹** - åˆ©ç”¨ç±»å‹å®‰å…¨é¿å…é”™è¯¯
3. **å¤„ç†å¼‚æ­¥æ“ä½œ** - æ‰€æœ‰æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„
4. **æ¸…ç†äº‹ä»¶ç›‘å¬å™¨** - é¿å…å†…å­˜æ³„æ¼

### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨æ‰¹é‡æ“ä½œå¤„ç†å¤§é‡æ•°æ®å˜æ›´
- åˆç†ä½¿ç”¨å‰¯ä½œç”¨å¤„ç†å™¨
- é…ç½®ä¼šè‡ªåŠ¨ç¼“å­˜ï¼Œé¿å…é‡å¤è·å–

### è°ƒè¯•å»ºè®®

- å¼€å¯æ§åˆ¶å°æ—¥å¿—æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
- ä½¿ç”¨Vue DevToolsæŸ¥çœ‹çŠ¶æ€å˜åŒ–
- é€šè¿‡äº‹ä»¶ç›‘å¬å™¨äº†è§£ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
- ä½¿ç”¨æµ‹è¯•é¡µé¢éªŒè¯åŠŸèƒ½

## ğŸ†˜ å¸¸è§é—®é¢˜

**Q: å¦‚ä½•ä»æ—§æ¶æ„è¿ç§»ï¼Ÿ**
A: ä½¿ç”¨è¿ç§»åŠ©æ‰‹å·¥å…·è‡ªåŠ¨æ£€æŸ¥å’Œè¿ç§»ï¼Œæˆ–å‚è€ƒè¿ç§»æŒ‡å—æ‰‹åŠ¨è¿ç§»ã€‚

**Q: é…ç½®ä¸ç”Ÿæ•ˆæ€ä¹ˆåŠï¼Ÿ**
A: æ£€æŸ¥é…ç½®æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œä½¿ç”¨é…ç½®éªŒè¯åŠŸèƒ½ç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚

**Q: Card2.1ç»„ä»¶é›†æˆå¤±è´¥ï¼Ÿ**
A: ç¡®ä¿ç»„ä»¶å®šä¹‰å®Œæ•´ï¼Œæ£€æŸ¥æ•°æ®æºé…ç½®ï¼Œä½¿ç”¨é€‚é…å™¨æµ‹è¯•åŠŸèƒ½ã€‚

**Q: æ€§èƒ½é—®é¢˜å¦‚ä½•ä¼˜åŒ–ï¼Ÿ**
A: ä½¿ç”¨æ‰¹é‡æ“ä½œï¼Œåˆç†ç®¡ç†å‰¯ä½œç”¨ï¼Œé¿å…é¢‘ç¹çš„é…ç½®æ›´æ–°ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/store/modules/visual-editor/
â”œâ”€â”€ index.ts                    # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ unified-editor.ts           # ç»Ÿä¸€çŠ¶æ€ç®¡ç†
â”œâ”€â”€ configuration-service.ts    # é…ç½®æœåŠ¡ç±»
â”œâ”€â”€ data-flow-manager.ts        # æ•°æ®æµç®¡ç†å™¨
â”œâ”€â”€ card2-adapter.ts           # Card2.1é€‚é…å™¨
â”œâ”€â”€ integration-example.ts      # é›†æˆç¤ºä¾‹
â”œâ”€â”€ migration-helper.ts         # è¿ç§»åŠ©æ‰‹
â”œâ”€â”€ integration-guide.md        # é›†æˆæŒ‡å—
â””â”€â”€ README.md                  # æœ¬æ–‡æ¡£
```

## ğŸ”— ç›¸å…³é“¾æ¥

- [é›†æˆæŒ‡å—](./integration-guide.md) - è¯¦ç»†çš„é›†æˆæ–‡æ¡£
- [æµ‹è¯•é¡µé¢](/test/unified-architecture) - åœ¨çº¿æµ‹è¯•ç³»ç»Ÿ
- [Card2.1ç³»ç»Ÿ](/src/card2.1/) - Card2.1ç»„ä»¶ç³»ç»Ÿ

---

**ğŸ”¥ è¿™ä¸ªç»Ÿä¸€æ¶æ„ç³»ç»Ÿå®Œå…¨è§£å†³äº†åŸæœ‰çš„æ•°æ®ç®¡ç†æ··ä¹±é—®é¢˜ï¼Œæä¾›äº†ç¨³å®šã€å¯é ã€æ˜“ç»´æŠ¤çš„Visual EditoråŸºç¡€è®¾æ–½ã€‚**