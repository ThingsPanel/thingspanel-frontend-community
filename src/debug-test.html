<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card 2.1 ç³»ç»Ÿè°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        }
        h1 { color: #2d3748; margin-bottom: 30px; }
        h2 { color: #4a5568; margin-top: 30px; margin-bottom: 15px; }
        .step {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .highlight {
            background: #fef5e7;
            border-left: 4px solid #f6ad55;
            padding: 15px;
            margin: 15px 0;
        }
        .success { border-left-color: #68d391; background: #f0fff4; }
        .error { border-left-color: #fc8181; background: #fed7d7; }
        .info { border-left-color: #63b3ed; background: #ebf8ff; }
        .warning { border-left-color: #f6ad55; background: #fef5e7; }
        ul li { margin-bottom: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Card 2.1 ç³»ç»Ÿè°ƒè¯•é¡µé¢</h1>
        
        <div class="highlight info">
            <strong>ğŸ“Œ è°ƒè¯•ç›®æ ‡ï¼š</strong>è§£å†³ <code>universal-data-viz</code> ç»„ä»¶æœªå‡ºç°åœ¨ Visual Editor å·¦ä¾§ç»„ä»¶åˆ—è¡¨çš„é—®é¢˜ã€‚
        </div>

        <h2>ğŸš€ å¿«é€Ÿå¼€å§‹è°ƒè¯•</h2>
        <div class="step">
            <h3>1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨</h3>
            <div class="code-block">pnpm dev</div>
            <p>åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š<a href="http://localhost:5002">http://localhost:5002</a></p>
        </div>

        <div class="step">
            <h3>2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·</h3>
            <ul>
                <li>æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·</li>
                <li>åˆ‡æ¢åˆ° "Console" æ ‡ç­¾</li>
                <li>æ¸…ç©ºæ§åˆ¶å°ï¼ˆCtrl+L æˆ– Cmd+Kï¼‰</li>
            </ul>
        </div>

        <div class="step">
            <h3>3. è®¿é—® Visual Editor æµ‹è¯•é¡µé¢</h3>
            <ul>
                <li>åœ¨ä¸»åº”ç”¨ä¸­å¯¼èˆªåˆ°ï¼š<strong>èœå• â†’ æµ‹è¯• â†’ ç¼–è¾‘å™¨é›†æˆæµ‹è¯•</strong></li>
                <li>æˆ–ç›´æ¥è®¿é—®ï¼š<code>/test/editor-integration</code></li>
            </ul>
        </div>

        <h2>ğŸ” å…³é”®è°ƒè¯•æ—¥å¿—</h2>
        <div class="step">
            <p>åœ¨æ§åˆ¶å°ä¸­æŸ¥æ‰¾ä»¥ä¸‹å…³é”®æ—¥å¿—æ ‡ç­¾ï¼ˆæŒ‰é¡ºåºå‡ºç°ï¼‰ï¼š</p>
            
            <h4>1. ç»„ä»¶åŠ è½½é˜¶æ®µ</h4>
            <div class="code-block">
[ComponentLoader] æ­£åœ¨æå–ç»„ä»¶IDï¼Œè·¯å¾„: ../components/universal-data-viz/index.ts
ğŸ¯ [ComponentLoader] æ£€æµ‹åˆ° universal-data-viz ç»„ä»¶è·¯å¾„
ğŸ¯ [ComponentLoader] æå–çš„ç»„ä»¶ID: universal-data-viz
[ComponentLoader] Including component: universal-data-viz
            </div>

            <h4>2. æƒé™æ£€æŸ¥é˜¶æ®µ</h4>
            <div class="code-block">
ğŸ¯ [AutoRegistry] universal-data-viz æƒé™æ£€æŸ¥: {ç»„ä»¶æƒé™: "ä¸é™", ç”¨æˆ·æƒé™: "TENANT_USER"}
âœ… [AutoRegistry] universal-data-viz æƒé™æ£€æŸ¥é€šè¿‡: ç»„ä»¶æƒé™ä¸º"ä¸é™"
            </div>

            <h4>3. æ³¨å†Œæ£€æŸ¥é˜¶æ®µ</h4>
            <div class="code-block">
ğŸ¯ [AutoRegistry] universal-data-viz æ³¨å†Œæ£€æŸ¥: {isRegistered: true, è®¡ç®—ç»“æœ: true}
âœ… [AutoRegistry] universal-data-viz æ³¨å†Œæ£€æŸ¥é€šè¿‡
âœ… [AutoRegistry] æ³¨å†Œç»„ä»¶: universal-data-viz (é€šç”¨æ•°æ®å¯è§†åŒ–)
            </div>

            <h4>4. Visual Editor é›†æˆé˜¶æ®µ</h4>
            <div class="code-block">
ğŸ¯ [VisualEditorIntegration] filteredComponents ä¸­æ˜¯å¦åŒ…å« universal-data-viz: true
            </div>
        </div>

        <h2>âŒ å¸¸è§é—®é¢˜è¯Šæ–­</h2>
        
        <div class="step">
            <h3>é—®é¢˜1ï¼šç»„ä»¶æœªè¢«åŠ è½½</h3>
            <div class="highlight error">
                <strong>ç—‡çŠ¶ï¼š</strong>æ§åˆ¶å°ä¸­æ²¡æœ‰çœ‹åˆ° <code>[ComponentLoader] æ£€æµ‹åˆ° universal-data-viz ç»„ä»¶è·¯å¾„</code>
            </div>
            <p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
            <ul>
                <li>æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š<code>src/card2.1/components/universal-data-viz/index.ts</code></li>
                <li>æ£€æŸ¥ glob æ¨¡å¼æ˜¯å¦æ­£ç¡®åŒ¹é…</li>
                <li>é‡å¯å¼€å‘æœåŠ¡å™¨</li>
            </ul>
        </div>

        <div class="step">
            <h3>é—®é¢˜2ï¼šæƒé™æ£€æŸ¥å¤±è´¥</h3>
            <div class="highlight error">
                <strong>ç—‡çŠ¶ï¼š</strong>çœ‹åˆ°æƒé™æ£€æŸ¥ä½†ç»“æœä¸º false
            </div>
            <p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
            <ul>
                <li>æ£€æŸ¥ç»„ä»¶å®šä¹‰ä¸­çš„ <code>permission: 'ä¸é™'</code></li>
                <li>æ£€æŸ¥ç”¨æˆ·æƒé™è®¾ç½®ï¼ˆlocalStorage ä¸­çš„ userInfoï¼‰</li>
            </ul>
        </div>

        <div class="step">
            <h3>é—®é¢˜3ï¼šæ³¨å†Œæ£€æŸ¥å¤±è´¥</h3>
            <div class="highlight error">
                <strong>ç—‡çŠ¶ï¼š</strong>ç»„ä»¶è¢«æ£€æµ‹åˆ°ä½†æœªæ³¨å†Œ
            </div>
            <p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
            <ul>
                <li>æ£€æŸ¥ç»„ä»¶å®šä¹‰ä¸­çš„ <code>isRegistered: true</code></li>
                <li>æ£€æŸ¥ç»„ä»¶å®šä¹‰çš„å¿…éœ€å­—æ®µï¼ˆtype, name, componentï¼‰</li>
            </ul>
        </div>

        <div class="step">
            <h3>é—®é¢˜4ï¼šVisual Editor é›†æˆå¤±è´¥</h3>
            <div class="highlight error">
                <strong>ç—‡çŠ¶ï¼š</strong>ç»„ä»¶å·²æ³¨å†Œä½†æœªå‡ºç°åœ¨ç¼–è¾‘å™¨ä¸­
            </div>
            <p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
            <ul>
                <li>æ£€æŸ¥ <code>availableWidgets</code> è®¡ç®—å±æ€§çš„ç»“æœ</li>
                <li>æ£€æŸ¥ç»„ä»¶è½¬æ¢é€»è¾‘æ˜¯å¦æ­£ç¡®</li>
                <li>æ£€æŸ¥ WidgetLibrary ç»„ä»¶æ˜¯å¦æ­£ç¡®ä½¿ç”¨é›†æˆ</li>
            </ul>
        </div>

        <h2>ğŸ› ï¸ æ‰‹åŠ¨éªŒè¯å‘½ä»¤</h2>
        <div class="step">
            <p>åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ‰‹åŠ¨éªŒè¯ï¼š</p>
            
            <h4>æ£€æŸ¥ Card 2.1 ç³»ç»ŸçŠ¶æ€</h4>
            <div class="code-block">
// åœ¨ Vue DevTools æˆ–ç»„ä»¶å†…éƒ¨æ‰§è¡Œ
const { initializeCard2System, getComponentRegistry } = await import('/src/card2.1/index.ts')
await initializeCard2System()
const registry = getComponentRegistry()
console.log('æ³¨å†Œçš„ç»„ä»¶ï¼š', registry.getAll().map(c => c.type))
            </div>

            <h4>æ£€æŸ¥ Visual Editor é›†æˆ</h4>
            <div class="code-block">
// åœ¨ WidgetLibrary ç»„ä»¶ä¸­æ£€æŸ¥
console.log('Available Widgets:', this.card2Integration.availableWidgets.value)
console.log('åŒ…å« universal-data-vizï¼š', 
  this.card2Integration.availableWidgets.value.some(w => w.type === 'universal-data-viz'))
            </div>
        </div>

        <h2>âœ… æˆåŠŸéªŒè¯æ ‡å‡†</h2>
        <div class="step highlight success">
            <p>å½“çœ‹åˆ°ä»¥ä¸‹æ‰€æœ‰æ—¥å¿—æ—¶ï¼Œè¯´æ˜ç»„ä»¶åŠ è½½æˆåŠŸï¼š</p>
            <ol>
                <li>âœ… ComponentLoader æˆåŠŸæ£€æµ‹åˆ°ç»„ä»¶è·¯å¾„</li>
                <li>âœ… ComponentLoader æˆåŠŸæå–ç»„ä»¶ID</li>
                <li>âœ… AutoRegistry æƒé™æ£€æŸ¥é€šè¿‡</li>
                <li>âœ… AutoRegistry æ³¨å†Œæ£€æŸ¥é€šè¿‡</li>
                <li>âœ… AutoRegistry æˆåŠŸæ³¨å†Œç»„ä»¶</li>
                <li>âœ… VisualEditorIntegration åœ¨ filteredComponents ä¸­æ‰¾åˆ°ç»„ä»¶</li>
                <li>âœ… VisualEditorIntegration æˆåŠŸè½¬æ¢ä¸º Widget</li>
                <li>âœ… WidgetLibrary åœ¨å·¦ä¾§åˆ—è¡¨ä¸­æ˜¾ç¤ºç»„ä»¶</li>
            </ol>
        </div>

        <div class="highlight info">
            <p><strong>ğŸ’¡ æç¤ºï¼š</strong>å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·å°†å®Œæ•´çš„æ§åˆ¶å°æ—¥å¿—å‘é€ç»™å¼€å‘å›¢é˜Ÿè¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚</p>
        </div>
    </div>
</body>
</html>