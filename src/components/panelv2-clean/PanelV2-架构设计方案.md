# PanelV2 å¯è§†åŒ–çœ‹æ¿ç³»ç»Ÿæ¶æ„è®¾è®¡æ–¹æ¡ˆ

> **å‡çº§ï¼Œè€Œéé‡æ„** - é¢å‘æœªæ¥çš„ä¼ä¸šçº§å¯è§†åŒ–çœ‹æ¿æ¶æ„

## 1. æ ¸å¿ƒè®¾è®¡ç†å¿µ

### 1.1 å‡çº§æ¶æ„åŸåˆ™
- **å½»åº•åˆ†å±‚åˆ†ç¦»**ï¼šç¬¬ä¸€å±‚çº¯UIå¸ƒå±€ï¼Œç¬¬äºŒå±‚å„ç§å¼•æ“
- **å®Œå…¨å¯æ’æ‹”**ï¼šä»»ä½•ç»„ä»¶éƒ½å¯ä»¥ç‹¬ç«‹æ›¿æ¢å’Œæ‰©å±•
- **æè‡´æ•°æ®é©±åŠ¨**ï¼šä¸€åˆ‡çš†é…ç½®ï¼Œé›¶ç¡¬ç¼–ç 
- **å“åº”å¼è®¾è®¡**ï¼šè‡ªé€‚åº”å®¹å™¨ï¼ŒåŠ¨æ€å¸ƒå±€ï¼Œæ€§èƒ½ä¼˜å…ˆ
- **å¼€å‘è€…å‹å¥½**ï¼šæ¸…æ™°çš„æ¥å£ï¼Œå®Œæ•´çš„ç±»å‹å®šä¹‰ï¼Œç®€å•çš„æ‰©å±•API
- **ä¼ä¸šçº§å¯é **ï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†ï¼ŒçŠ¶æ€ç®¡ç†ï¼Œæ•°æ®æ ¡éªŒ

### 1.2 é©å‘½æ€§ä¸¤å±‚æ¶æ„

#### ç¬¬ä¸€å±‚ï¼šçº¯å‡€ç¼–è¾‘å™¨åº•åº§ï¼ˆPure Infrastructure Layerï¼‰
**å”¯ä¸€èŒè´£**ï¼šUIå¸ƒå±€ç®¡ç† + æ•°æ®ä¼ é€’ç®¡é“
- âœ… ç®¡ç†toolbar/sidebar/canvas/inspectorå››å¤§åŒºåŸŸå¸ƒå±€
- âœ… å“åº”å¼æ–­ç‚¹å’Œè‡ªé€‚åº”å¸ƒå±€
- âœ… æ•°æ®æ€»çº¿å’Œäº‹ä»¶æ€»çº¿
- âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç†å’ŒçŠ¶æ€åŒæ­¥
- âŒ **ç»ä¸æ¶‰åŠ**ï¼šä¸šåŠ¡é€»è¾‘ã€æ¸²æŸ“å®ç°ã€é…ç½®ç»†èŠ‚ã€ä¸»é¢˜æ ·å¼

#### ç¬¬äºŒå±‚ï¼šä¸“ä¸šå¼•æ“å±‚ï¼ˆProfessional Engine Layerï¼‰
**èŒè´£**ï¼šå„ç§ä¸“ä¸š"å¼•æ“"çš„å…·ä½“å®ç°
- ğŸ¯ **èŠ‚ç‚¹æ³¨å†Œå¼•æ“**ï¼šç®¡ç†ç»„ä»¶æ ‘å½¢ç»“æ„å’Œæ³¨å†Œç³»ç»Ÿ
- ğŸ¯ **æ¸²æŸ“å¼•æ“**ï¼šå½“å‰GridStackå¸ƒå±€ï¼Œé¢„ç•™å¤šå¼•æ“æ‰©å±•æ¥å£
- ğŸ¯ **é…ç½®å¼•æ“**ï¼šJSON Schemaé©±åŠ¨çš„åŠ¨æ€è¡¨å•ç”Ÿæˆå™¨
- ğŸ¯ **å·¥å…·å¼•æ“**ï¼šå¯æ‰©å±•çš„å·¥å…·é›†å’Œå¿«æ·é”®ç®¡ç†
- ğŸ¯ **ä¸»é¢˜å¼•æ“**ï¼šå“åº”å¤–éƒ¨ä¸»é¢˜ç³»ç»Ÿçš„é€‚é…æ¥å£
- ğŸ¯ **æ•°æ®å¼•æ“**ï¼šèŠ‚ç‚¹æ•°æ®ç®¡ç†ã€çŠ¶æ€åŒæ­¥ã€å˜æ›´ç›‘å¬

### 1.3 V2ä¸V1çš„æ˜ç¡®è¾¹ç•Œ

#### V1ä¿æŒç°çŠ¶
- ğŸ“¦ ç°æœ‰çš„panelç»„ä»¶ç»§ç»­ç»´æŠ¤ï¼ŒåŠŸèƒ½ç¨³å®š
- ğŸ”§ ç»§ç»­æœåŠ¡ç°æœ‰ä¸šåŠ¡ï¼Œä¸åšç ´åæ€§å˜æ›´
- ğŸ“ˆ ä½œä¸ºV2çš„å‚è€ƒå®ç°å’ŒåŠŸèƒ½å¯¹ç…§

#### V2ç‹¬ç«‹å‘å±•  
- ğŸš€ å…¨æ–°çš„æ¶æ„è®¾è®¡ï¼Œä¸å—V1å®ç°çº¦æŸ
- ğŸ¨ ä¸“æ³¨äºå¯æ‰©å±•æ€§å’Œå¼€å‘ä½“éªŒ
- ğŸ”® ä¸ºä¸‹ä¸€ä»£å¯è§†åŒ–éœ€æ±‚åšæŠ€æœ¯å‚¨å¤‡
- ğŸ¤ æ•°æ®æ ¼å¼å¯è½¬æ¢ï¼Œæ”¯æŒV1åˆ°V2çš„è¿ç§»è·¯å¾„

#### å…±å­˜ç­–ç•¥
- ğŸ—ï¸ V2ä½œä¸ºæ–°é¡¹ç›®çš„é¦–é€‰æŠ€æœ¯æ–¹æ¡ˆ
- ğŸ”„ V1é¡¹ç›®å¯é€‰æ‹©æ€§è¿ç§»åˆ°V2
- ğŸ“Š ä¸¤ä¸ªç‰ˆæœ¬å…±äº«è®¾è®¡æ€è·¯ä½†æŠ€æœ¯ç‹¬ç«‹
- âš–ï¸ æ ¹æ®é¡¹ç›®å¤æ‚åº¦å’Œéœ€æ±‚é€‰æ‹©åˆé€‚ç‰ˆæœ¬

## 2. æ ¸å¿ƒæ•°æ®ç»“æ„è®¾è®¡

### 2.1 æ•´ä½“çœ‹æ¿æ•°æ®ç»“æ„
```typescript
interface PanelV2Data {
  // çœ‹æ¿å…ƒä¿¡æ¯
  meta: {
    id: string
    name: string
    version: '2.0'
    createdAt: string
    updatedAt: string
    description?: string
    tags?: string[]
    // å½“å‰ä½¿ç”¨çš„æ¸²æŸ“å¼•æ“
    renderEngine: 'gridstack' | string  // é¢„ç•™æ‰©å±•
    // V1å…¼å®¹æ ‡è¯†
    migratedFromV1?: boolean
  }
  
  // çœ‹æ¿çº§é…ç½®ï¼ˆå…¨å±€è®¾ç½®ï¼‰
  config: PanelConfig
  
  // èŠ‚ç‚¹æ•°æ®é›†åˆ
  nodes: NodeData[]
  
  // è¿è¡Œæ—¶çŠ¶æ€ï¼ˆä¸æŒä¹…åŒ–ï¼Œä»…å†…å­˜ï¼‰
  runtime: {
    selectedNodeIds: string[]
    viewMode: 'edit' | 'preview' | 'fullscreen'
    viewport: {
      zoom: number
      offsetX: number
      offsetY: number
    }
    clipboard?: NodeData[]
    isDirty: boolean  // æ˜¯å¦æœ‰æœªä¿å­˜çš„ä¿®æ”¹
    lastSaveTime?: number
  }
  
  // æ‰©å±•æ•°æ®ï¼ˆæ’ä»¶ä½¿ç”¨ï¼‰
  extensions?: Record<string, any>
}
```

### 2.2 èŠ‚ç‚¹å®šä¹‰ä¸ç»„ä»¶æ˜ å°„

```typescript
// å®Œæ•´çš„èŠ‚ç‚¹æ•°æ®ç»“æ„
interface NodeData {
  // åŸºç¡€æ ‡è¯†
  id: string
  type: string  // å¯¹åº”ComponentDefinitionçš„type
  name: string
  
  // å¸ƒå±€ä¿¡æ¯ï¼ˆç”±æ¸²æŸ“å¼•æ“ç®¡ç†ï¼‰
  layout: {
    x: number
    y: number
    w: number
    h: number
    minW?: number
    minH?: number
    maxW?: number
    maxH?: number
    locked?: boolean  // æ˜¯å¦é”å®šä½ç½®
  }
  
  // èŠ‚ç‚¹é…ç½®ï¼ˆåˆ†å±‚è®¾è®¡ï¼‰
  config: {
    // åŸºç¡€é…ç½®ï¼ˆä½ç½®ã€å¯è§æ€§ç­‰ï¼‰
    base: NodeBaseConfig
    // äº¤äº’é…ç½®ï¼ˆç‚¹å‡»ã€æ‚¬åœç­‰ï¼‰
    interaction: NodeInteractionConfig  
    // å†…å®¹é…ç½®ï¼ˆç»„ä»¶ç‰¹å®šçš„ä¸šåŠ¡é…ç½®ï¼‰
    content: NodeContentConfig
  }
  
  // æ ·å¼é…ç½®ï¼ˆå“åº”ä¸»é¢˜ï¼‰
  style: NodeStyleConfig
  
  // æ•°æ®ç»‘å®šï¼ˆå¯é€‰ï¼‰
  dataBind?: {
    source: string    // æ•°æ®æºæ ‡è¯†
    fields: string[]  // ç»‘å®šå­—æ®µ
    transform?: string // æ•°æ®å˜æ¢å‡½æ•°
  }
  
  // å…ƒæ•°æ®
  meta: {
    createTime: number
    updateTime: number
    version: string
    tags?: string[]
  }
}

// ç»„ä»¶å®šä¹‰æ ‡å‡†ï¼ˆæ³¨å†Œæ—¶ä½¿ç”¨ï¼‰
interface ComponentDefinition {
  // ç»„ä»¶æ ‡è¯†
  type: string
  name: string
  category: string
  
  // Vueç»„ä»¶
  component: Component
  
  // é…ç½®Schemaï¼ˆJSON Schemaæ ¼å¼ï¼‰
  configSchema: {
    base: ConfigSchema      // åŸºç¡€é…ç½®schema
    interaction: ConfigSchema // äº¤äº’é…ç½®schema  
    content: ConfigSchema   // å†…å®¹é…ç½®schema
  }
  
  // é»˜è®¤é…ç½®
  defaults: {
    layout: { w: number, h: number, minW?: number, minH?: number }
    config: { base: any, interaction: any, content: any }
    style: NodeStyleConfig
  }
  
  // ç»„ä»¶å…ƒä¿¡æ¯
  meta: {
    title: string
    description?: string
    icon?: string
    poster?: string  // é¢„è§ˆå›¾
    version: string
    author?: string
    keywords?: string[]
  }
  
  // å“åº”å¼é…ç½®
  responsive: {
    autoResize: boolean
    maintainAspectRatio?: boolean
    resizeHandles?: Array<'n' | 's' | 'e' | 'w' | 'ne' | 'nw' | 'se' | 'sw'>
  }
}

// åˆ†ç±»æ ‘ç»“æ„
interface CategoryTree {
  id: string
  name: string
  icon?: string
  order: number
  children?: CategoryTree[]
  // è¯¥åˆ†ç±»ä¸‹çš„ç»„ä»¶ç±»å‹
  componentTypes?: string[]
}
```

## 3. é©å‘½æ€§åˆ†å±‚æ¶æ„è¯¦è®¾

### 3.1 ç¬¬ä¸€å±‚ï¼šçº¯å‡€ç¼–è¾‘å™¨åº•åº§

#### 3.1.1 çº¯UIå¸ƒå±€ç®¡ç†å™¨
```typescript
interface PureLayoutManager {
  // å››å¤§æ ¸å¿ƒåŒºåŸŸç®¡ç†
  regions: {
    toolbar: {
      visible: boolean
      height: number
      position: 'top' | 'bottom'
      collapsible: boolean
    }
    sidebar: {
      visible: boolean  
      width: number
      position: 'left' | 'right'
      resizable: boolean
      collapsible: boolean
    }
    canvas: {
      flex: number
      padding: number
      background: 'transparent'  // ä¸è´Ÿè´£æ ·å¼
    }
    inspector: {
      visible: boolean
      width: number  
      position: 'left' | 'right'
      resizable: boolean
      collapsible: boolean
    }
  }
  
  // å“åº”å¼æ–­ç‚¹ï¼ˆçº¯å¸ƒå±€ï¼Œä¸æ¶‰åŠæ ·å¼ï¼‰
  breakpoints: {
    mobile: number
    tablet: number 
    desktop: number
    ultrawide: number
  }
  
  // è‡ªé€‚åº”è¡Œä¸º
  responsive: {
    autoCollapse: boolean  // å°å±è‡ªåŠ¨æŠ˜å sidebar
    stackOnMobile: boolean // ç§»åŠ¨ç«¯å †å å¸ƒå±€
    minCanvasWidth: number // ç”»å¸ƒæœ€å°å®½åº¦
  }
}
```

#### 3.1.2 çº¯å‡€æ•°æ®ä¼ é€’ç®¡é“
```typescript
interface PureDataPipeline {
  // å”¯ä¸€æ•°æ®æº
  state: Ref<PanelV2Data>
  
  // çº¯å‡€äº‹ä»¶æ€»çº¿ï¼ˆä¸æ¶‰åŠä¸šåŠ¡é€»è¾‘ï¼‰
  events: {
    emit(event: string, payload: any): void
    on(event: string, handler: (payload: any) => void): void
    off(event: string, handler: Function): void
    once(event: string, handler: (payload: any) => void): void
  }
  
  // åŸºç¡€æ•°æ®æ“ä½œï¼ˆåªä¼ é€’ï¼Œä¸å¤„ç†ï¼‰
  operations: {
    // çœ‹æ¿çº§æ“ä½œ
    updatePanel(update: Partial<PanelV2Data>): void
    // èŠ‚ç‚¹çº§æ“ä½œ  
    addNode(node: NodeData): void
    updateNode(id: string, update: Partial<NodeData>): void
    removeNode(id: string): void
    // é€‰æ‹©æ“ä½œ
    selectNodes(ids: string[]): void
    clearSelection(): void
  }
  
  // æ•°æ®å˜æ›´ç›‘å¬ï¼ˆçº¯é€šçŸ¥ï¼Œä¸å¤„ç†ï¼‰
  watchers: {
    onPanelChange: (newPanel: PanelV2Data, oldPanel: PanelV2Data) => void
    onNodeChange: (nodeId: string, newNode: NodeData, oldNode: NodeData) => void
    onSelectionChange: (selectedIds: string[]) => void
  }
  
  // æ•°æ®æŒä¹…åŒ–æ¥å£ï¼ˆå§”æ‰˜ç»™å¤–éƒ¨ï¼‰
  persistence: {
    save?: (data: PanelV2Data) => Promise<void>
    load?: (id: string) => Promise<PanelV2Data>
    autosave?: boolean
  }
}
```

#### 3.1.3 ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨
```typescript
interface LifecycleManager {
  // ç¼–è¾‘å™¨ç”Ÿå‘½å‘¨æœŸ
  phases: {
    'before-mount': LifecycleHook[]
    'mounted': LifecycleHook[]
    'before-unmount': LifecycleHook[]
    'unmounted': LifecycleHook[]
  }
  
  // é¢æ¿ç”Ÿå‘½å‘¨æœŸ
  panelPhases: {
    'panel-created': LifecycleHook[]
    'panel-loaded': LifecycleHook[]
    'panel-saved': LifecycleHook[]
    'panel-destroyed': LifecycleHook[]
  }
  
  // èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸ
  nodePhases: {
    'node-added': LifecycleHook[]
    'node-updated': LifecycleHook[]
    'node-removed': LifecycleHook[]
    'node-selected': LifecycleHook[]
  }
  
  // æ³¨å†Œé’©å­
  registerHook(phase: string, hook: LifecycleHook): void
  unregisterHook(phase: string, hook: LifecycleHook): void
  
  // è§¦å‘é’©å­
  trigger(phase: string, context: any): Promise<void>
}

type LifecycleHook = (context: any) => void | Promise<void>
```
```

### 3.2 ç¬¬äºŒå±‚ï¼šä¸“ä¸šå¼•æ“å±‚è¯¦è®¾

#### 3.2.1 ä¸»é¢˜å¼•æ“ - å“åº”å¤–éƒ¨ä¸»é¢˜ç³»ç»Ÿ
```typescript
interface ThemeEngine {
  // ä¸»é¢˜é€‚é…å™¨ï¼ˆå“åº”å¤–éƒ¨ä¸»é¢˜è€Œéåˆ›å»ºä¸»é¢˜ï¼‰
  adapter: {
    // ç›‘å¬å¤–éƒ¨ä¸»é¢˜å˜æ›´ï¼ˆå¦‚naive-uiä¸»é¢˜åˆ‡æ¢ï¼‰
    listenToExternalTheme(callback: (theme: ExternalTheme) => void): void
    // è·å–å½“å‰å¤–éƒ¨ä¸»é¢˜
    getCurrentTheme(): ExternalTheme
    // è®¢é˜…ä¸»é¢˜å˜æ›´äº‹ä»¶
    subscribe(event: 'theme-change', handler: ThemeChangeHandler): void
    unsubscribe(event: 'theme-change', handler: ThemeChangeHandler): void
  }
  
  // ä¸»é¢˜å˜é‡æ˜ å°„ï¼ˆå°†å¤–éƒ¨ä¸»é¢˜è½¬æ¢ä¸ºå†…éƒ¨CSSå˜é‡ï¼‰
  mapping: {
    // ä¸»é¢˜å˜é‡æ˜ å°„è¡¨
    variableMap: Record<string, string>
    // åŠ¨æ€æ˜ å°„å‡½æ•°
    mapThemeVariables(externalTheme: ExternalTheme): CSSVariables
    // åº”ç”¨ä¸»é¢˜å˜é‡åˆ°DOM
    applyThemeVariables(variables: CSSVariables, scope?: string): void
  }
  
  // ç»„ä»¶æ ·å¼éš”ç¦»
  isolation: {
    // ä¸ºPanelV2åˆ›å»ºéš”ç¦»çš„æ ·å¼ä½œç”¨åŸŸ
    createStyleScope(scopeId: string): StyleScope
    // åœ¨ä½œç”¨åŸŸå†…åº”ç”¨ä¸»é¢˜
    applyToScope(scope: StyleScope, variables: CSSVariables): void
    // æ¸…ç†ä½œç”¨åŸŸ
    destroyScope(scopeId: string): void
  }
}

interface ExternalTheme {
  name: string
  type: 'light' | 'dark' | 'auto'
  colors: {
    primary: string
    success: string
    warning: string
    error: string
    info: string
    // èƒŒæ™¯è‰²ç³»
    bodyColor: string
    cardColor: string
    modalColor: string
    // æ–‡å­—è‰²ç³»
    textColorBase: string
    textColor1: string
    textColor2: string
    textColor3: string
    // è¾¹æ¡†è‰²ç³»
    borderColor: string
    dividerColor: string
  }
  // å…¶ä»–ä¸»é¢˜å±æ€§...
}

interface CSSVariables {
  '--panel-bg-color': string
  '--panel-card-color': string
  '--panel-text-color': string
  '--panel-border-color': string
  '--panel-primary-color': string
  // æ›´å¤šå†…éƒ¨å˜é‡...
}

// é»˜è®¤ä¸»é¢˜æ˜ å°„é…ç½®
const DEFAULT_THEME_MAPPING = {
  '--panel-bg-color': 'bodyColor',
  '--panel-card-color': 'cardColor', 
  '--panel-text-color': 'textColorBase',
  '--panel-border-color': 'borderColor',
  '--panel-primary-color': 'primaryColor'
}
```

#### 3.2.2 å·¥å…·å¼•æ“ - å¯æ‰©å±•å·¥å…·é›†ç®¡ç†
```typescript
interface ToolEngine {
  // å·¥å…·æ³¨å†Œè¡¨
  registry: {
    // é¢„åˆ¶å·¥å…·é›†
    builtInTools: Map<string, ToolDefinition>
    // è‡ªå®šä¹‰å·¥å…·é›†  
    customTools: Map<string, ToolDefinition>
    // æ’ä»¶å·¥å…·é›†
    pluginTools: Map<string, ToolDefinition>
  }
  
  // å·¥å…·ç®¡ç†
  manager: {
    // æ³¨å†Œå·¥å…·
    registerTool(tool: ToolDefinition): void
    unregisterTool(toolId: string): void
    // è·å–å·¥å…·
    getTool(toolId: string): ToolDefinition | null
    getToolsByCategory(category: ToolCategory): ToolDefinition[]
    // å·¥å…·å¯ç”¨æ§åˆ¶ï¼ˆç¼–ç¨‹æ—¶é€‰æ‹©ï¼‰
    enableTool(toolId: string): void
    disableTool(toolId: string): void
    isToolEnabled(toolId: string): boolean
  }
  
  // å¿«æ·é”®ç³»ç»Ÿ
  shortcuts: {
    // ç»‘å®šå¿«æ·é”®
    bindShortcut(key: string, toolId: string): void
    unbindShortcut(key: string): void
    // å¿«æ·é”®ç›‘å¬
    startListening(): void
    stopListening(): void
    // å¿«æ·é”®å†²çªæ£€æµ‹
    detectConflicts(): ShortcutConflict[]
  }
  
  // å·¥å…·æ‰§è¡Œ
  executor: {
    // æ‰§è¡Œå·¥å…·
    execute(toolId: string, context: EditorContext): Promise<ToolResult>
    // æ‰¹é‡æ‰§è¡Œ
    executeBatch(toolIds: string[], context: EditorContext): Promise<ToolResult[]>
    // å·¥å…·æ‰§è¡Œå†å²
    getExecutionHistory(): ToolExecution[]
    clearHistory(): void
  }
}

interface ToolDefinition {
  // åŸºç¡€ä¿¡æ¯
  id: string
  name: string
  description?: string
  icon: string
  category: ToolCategory
  version: string
  
  // å¿«æ·é”®é…ç½®
  shortcut?: {
    key: string
    modifiers?: ('ctrl' | 'alt' | 'shift' | 'meta')[]
    description: string
  }
  
  // å·¥å…·è¡Œä¸º
  action: (context: EditorContext) => Promise<ToolResult>
  
  // å¯ç”¨æ¡ä»¶
  enabled?: (context: EditorContext) => boolean
  visible?: (context: EditorContext) => boolean
  
  // å·¥å…·çŠ¶æ€
  hasState?: boolean
  getState?: (context: EditorContext) => any
  setState?: (context: EditorContext, state: any) => void
  
  // æƒé™æ§åˆ¶
  permissions?: string[]
  roles?: string[]
  
  // UIé…ç½®
  ui: {
    // å·¥å…·æ æ˜¾ç¤ºé…ç½®
    showInToolbar?: boolean
    toolbarGroup?: string
    toolbarOrder?: number
    // å³é”®èœå•æ˜¾ç¤º
    showInContextMenu?: boolean
    contextMenuOrder?: number
    // è‡ªå®šä¹‰UIç»„ä»¶
    customComponent?: Component
  }
}

type ToolCategory = 'edit' | 'view' | 'layout' | 'data' | 'export' | 'debug' | 'plugin'

interface ToolResult {
  success: boolean
  message?: string
  data?: any
  error?: Error
}

// é¢„åˆ¶å·¥å…·é›†å®šä¹‰
const BUILT_IN_TOOLS: Record<string, ToolDefinition> = {
  // === ç¼–è¾‘ç±»å·¥å…· ===
  UNDO: {
    id: 'undo',
    name: 'æ’¤é”€',
    icon: 'undo',
    category: 'edit',
    shortcut: { key: 'z', modifiers: ['ctrl'] },
    action: async (ctx) => ctx.dataEngine.undo(),
    enabled: (ctx) => ctx.dataEngine.canUndo(),
    ui: { showInToolbar: true, toolbarGroup: 'edit', toolbarOrder: 1 }
  },
  
  REDO: {
    id: 'redo', 
    name: 'é‡åš',
    icon: 'redo',
    category: 'edit',
    shortcut: { key: 'y', modifiers: ['ctrl'] },
    action: async (ctx) => ctx.dataEngine.redo(),
    enabled: (ctx) => ctx.dataEngine.canRedo(),
    ui: { showInToolbar: true, toolbarGroup: 'edit', toolbarOrder: 2 }
  },
  
  COPY: {
    id: 'copy',
    name: 'å¤åˆ¶',
    icon: 'copy', 
    category: 'edit',
    shortcut: { key: 'c', modifiers: ['ctrl'] },
    action: async (ctx) => ctx.clipboard.copy(ctx.selectedNodes),
    enabled: (ctx) => ctx.selectedNodes.length > 0,
    ui: { showInToolbar: true, showInContextMenu: true }
  },
  
  PASTE: {
    id: 'paste',
    name: 'ç²˜è´´',
    icon: 'paste',
    category: 'edit', 
    shortcut: { key: 'v', modifiers: ['ctrl'] },
    action: async (ctx) => ctx.clipboard.paste(),
    enabled: (ctx) => ctx.clipboard.hasContent(),
    ui: { showInToolbar: true, showInContextMenu: true }
  },
  
  DELETE: {
    id: 'delete',
    name: 'åˆ é™¤',
    icon: 'delete',
    category: 'edit',
    shortcut: { key: 'Delete' },
    action: async (ctx) => ctx.renderEngine.removeNodes(ctx.selectedNodes.map(n => n.id)),
    enabled: (ctx) => ctx.selectedNodes.length > 0,
    ui: { showInContextMenu: true }
  },
  
  // === å¸ƒå±€ç±»å·¥å…· ===
  ALIGN_LEFT: {
    id: 'align-left',
    name: 'å·¦å¯¹é½', 
    icon: 'align-left',
    category: 'layout',
    action: async (ctx) => ctx.layoutEngine.alignNodes(ctx.selectedNodes, 'left'),
    enabled: (ctx) => ctx.selectedNodes.length > 1,
    ui: { showInToolbar: true, toolbarGroup: 'layout' }
  },
  
  ALIGN_CENTER: {
    id: 'align-center',
    name: 'å±…ä¸­å¯¹é½',
    icon: 'align-center', 
    category: 'layout',
    action: async (ctx) => ctx.layoutEngine.alignNodes(ctx.selectedNodes, 'center'),
    enabled: (ctx) => ctx.selectedNodes.length > 1,
    ui: { showInToolbar: true, toolbarGroup: 'layout' }
  },
  
  // === è§†å›¾ç±»å·¥å…· ===
  ZOOM_IN: {
    id: 'zoom-in',
    name: 'æ”¾å¤§',
    icon: 'zoom-in',
    category: 'view',
    shortcut: { key: '=', modifiers: ['ctrl'] },
    action: async (ctx) => ctx.renderEngine.zoomIn(),
    ui: { showInToolbar: true, toolbarGroup: 'view' }
  },
  
  ZOOM_OUT: {
    id: 'zoom-out', 
    name: 'ç¼©å°',
    icon: 'zoom-out',
    category: 'view',
    shortcut: { key: '-', modifiers: ['ctrl'] },
    action: async (ctx) => ctx.renderEngine.zoomOut(),
    ui: { showInToolbar: true, toolbarGroup: 'view' }
  },
  
  ZOOM_FIT: {
    id: 'zoom-fit',
    name: 'é€‚åº”ç”»å¸ƒ',
    icon: 'zoom-fit',
    category: 'view', 
    shortcut: { key: '0', modifiers: ['ctrl'] },
    action: async (ctx) => ctx.renderEngine.zoomToFit(),
    ui: { showInToolbar: true, toolbarGroup: 'view' }
  },
  
  // === æ•°æ®ç±»å·¥å…· ===
  SAVE: {
    id: 'save',
    name: 'ä¿å­˜',
    icon: 'save',
    category: 'data',
    shortcut: { key: 's', modifiers: ['ctrl'] },
    action: async (ctx) => ctx.dataEngine.save(),
    enabled: (ctx) => ctx.dataEngine.isDirty(),
    ui: { showInToolbar: true, toolbarGroup: 'data', toolbarOrder: 1 }
  },
  
  REFRESH: {
    id: 'refresh',
    name: 'åˆ·æ–°',
    icon: 'refresh', 
    category: 'data',
    shortcut: { key: 'F5' },
    action: async (ctx) => ctx.dataEngine.reload(),
    ui: { showInToolbar: true, toolbarGroup: 'data' }
  },
  
  // === å¯¼å‡ºç±»å·¥å…· ===
  EXPORT_JSON: {
    id: 'export-json',
    name: 'å¯¼å‡ºJSON',
    icon: 'file-json',
    category: 'export',
    action: async (ctx) => ctx.exportEngine.exportAsJSON(),
    ui: { showInContextMenu: true }
  },
  
  EXPORT_IMAGE: {
    id: 'export-image',
    name: 'å¯¼å‡ºå›¾ç‰‡',
    icon: 'image',
    category: 'export', 
    action: async (ctx) => ctx.exportEngine.exportAsImage(),
    ui: { showInContextMenu: true }
  }
}
```

#### 3.2.3 èŠ‚ç‚¹æ³¨å†Œå¼•æ“ - ç»„ä»¶æ ‘å½¢ç®¡ç†
```typescript
interface NodeRegistryEngine {
  // ç»„ä»¶æ³¨å†Œè¡¨
  registry: {
    // æ‰€æœ‰æ³¨å†Œçš„ç»„ä»¶å®šä¹‰
    components: Map<string, ComponentDefinition>
    // åˆ†ç±»æ˜ å°„
    categories: Map<string, CategoryDefinition>
    // æœç´¢ç´¢å¼•
    searchIndex: SearchIndex
  }
  
  // ç»„ä»¶ç®¡ç†
  manager: {
    // æ³¨å†Œç»„ä»¶
    register(component: ComponentDefinition): Promise<void>
    unregister(type: string): Promise<void>
    batchRegister(components: ComponentDefinition[]): Promise<void>
    
    // æŸ¥è¯¢ç»„ä»¶
    getComponent(type: string): ComponentDefinition | null
    getComponentsByCategory(categoryId: string): ComponentDefinition[]
    getAllComponents(): ComponentDefinition[]
    
    // ç»„ä»¶éªŒè¯
    validate(component: ComponentDefinition): ValidationResult
    validateAll(): ValidationResult[]
  }
  
  // åˆ†ç±»ç®¡ç†
  categories: {
    // åˆ›å»ºåˆ†ç±»
    createCategory(category: CategoryDefinition): void
    updateCategory(id: string, update: Partial<CategoryDefinition>): void
    deleteCategory(id: string): void
    
    // åˆ†ç±»æŸ¥è¯¢
    getCategory(id: string): CategoryDefinition | null
    getRootCategories(): CategoryDefinition[]
    getCategoryTree(): CategoryTreeNode[]
    
    // åˆ†ç±»å…³è”
    assignComponentToCategory(componentType: string, categoryId: string): void
    removeComponentFromCategory(componentType: string, categoryId: string): void
  }
  
  // æœç´¢åŠŸèƒ½
  search: {
    // æœç´¢ç»„ä»¶
    searchComponents(query: SearchQuery): ComponentDefinition[]
    // å…³é”®è¯ç´¢å¼•
    buildSearchIndex(): void
    updateSearchIndex(component: ComponentDefinition): void
    // æœç´¢å»ºè®®
    getSuggestions(partialQuery: string): string[]
  }
  
  // æ ‘å½¢ç»“æ„ç”Ÿæˆ
  tree: {
    // ç”Ÿæˆå®Œæ•´æ ‘å½¢ç»“æ„ï¼ˆç”¨äºå·¦ä¾§é¢æ¿æ˜¾ç¤ºï¼‰
    generateTree(options?: TreeOptions): CategoryTreeNode[]
    // ç”Ÿæˆæ‰å¹³åˆ—è¡¨ï¼ˆç”¨äºæœç´¢ç»“æœï¼‰
    generateFlatList(options?: ListOptions): ComponentListItem[]
    // è¿‡æ»¤æ ‘å½¢ç»“æ„
    filterTree(tree: CategoryTreeNode[], predicate: (node: any) => boolean): CategoryTreeNode[]
  }
}

interface CategoryDefinition {
  id: string
  name: string
  description?: string
  icon?: string
  color?: string
  parentId?: string
  order: number
  
  // æ˜¾ç¤ºé…ç½®
  display: {
    collapsible: boolean
    defaultExpanded: boolean
    showCount: boolean
    customIcon?: Component
  }
  
  // æƒé™æ§åˆ¶
  permissions?: {
    view?: string[]
    create?: string[]
    edit?: string[]
  }
  
  // å…ƒæ•°æ®
  meta: {
    createdAt: number
    updatedAt: number
    version: string
  }
}

interface CategoryTreeNode {
  id: string
  name: string
  icon?: string
  type: 'category' | 'component'
  children?: CategoryTreeNode[]
  
  // åˆ†ç±»ç‰¹æœ‰å±æ€§
  categoryData?: CategoryDefinition
  componentData?: ComponentDefinition
  
  // UIçŠ¶æ€
  expanded?: boolean
  visible?: boolean
  disabled?: boolean
  
  // ç»Ÿè®¡ä¿¡æ¯
  componentCount?: number
  totalCount?: number
}

interface SearchQuery {
  keyword: string
  categories?: string[]
  tags?: string[]
  author?: string
  version?: string
  
  // æœç´¢é€‰é¡¹
  options: {
    fuzzy: boolean
    caseSensitive: boolean
    searchInDescription: boolean
    searchInKeywords: boolean
    maxResults: number
  }
}

interface SearchIndex {
  // å…³é”®è¯ç´¢å¼•
  keywords: Map<string, Set<string>>  // keyword -> component types
  // åˆ†ç±»ç´¢å¼•
  categories: Map<string, Set<string>>  // category -> component types
  // æ ‡ç­¾ç´¢å¼•
  tags: Map<string, Set<string>>  // tag -> component types
  // ä½œè€…ç´¢å¼•
  authors: Map<string, Set<string>>  // author -> component types
}

// é¢„åˆ¶åˆ†ç±»å®šä¹‰
const BUILT_IN_CATEGORIES: CategoryDefinition[] = [
  {
    id: 'basic',
    name: 'åŸºç¡€ç»„ä»¶',
    icon: 'layers',
    order: 1,
    display: { collapsible: true, defaultExpanded: true, showCount: true },
    meta: { createdAt: Date.now(), updatedAt: Date.now(), version: '1.0.0' }
  },
  {
    id: 'chart',
    name: 'å›¾è¡¨ç»„ä»¶', 
    icon: 'chart-bar',
    order: 2,
    display: { collapsible: true, defaultExpanded: true, showCount: true },
    meta: { createdAt: Date.now(), updatedAt: Date.now(), version: '1.0.0' }
  },
  {
    id: 'form',
    name: 'è¡¨å•ç»„ä»¶',
    icon: 'form',
    order: 3,
    display: { collapsible: true, defaultExpanded: false, showCount: true },
    meta: { createdAt: Date.now(), updatedAt: Date.now(), version: '1.0.0' }
  },
  {
    id: 'media',
    name: 'åª’ä½“ç»„ä»¶',
    icon: 'image',
    order: 4,
    display: { collapsible: true, defaultExpanded: false, showCount: true },
    meta: { createdAt: Date.now(), updatedAt: Date.now(), version: '1.0.0' }
  },
  {
    id: 'advanced',
    name: 'é«˜çº§ç»„ä»¶',
    icon: 'puzzle',
    order: 5,
    display: { collapsible: true, defaultExpanded: false, showCount: true },
    meta: { createdAt: Date.now(), updatedAt: Date.now(), version: '1.0.0' }
  },
  {
    id: 'plugin',
    name: 'æ’ä»¶ç»„ä»¶',
    icon: 'plugin',
    order: 6,
    display: { collapsible: true, defaultExpanded: false, showCount: true },
    meta: { createdAt: Date.now(), updatedAt: Date.now(), version: '1.0.0' }
  }
]
```

#### 3.2.4 æ¸²æŸ“å¼•æ“ - å¤šå¼•æ“æ¶æ„æ”¯æŒ
```typescript
interface RenderEngine {
  // æ¸²æŸ“å™¨ç®¡ç†
  manager: {
    // å½“å‰æ¿€æ´»çš„æ¸²æŸ“å™¨
    currentRenderer: CanvasRenderer | null
    // å¯ç”¨æ¸²æŸ“å™¨æ³¨å†Œè¡¨
    availableRenderers: Map<string, CanvasRendererClass>
    
    // æ¸²æŸ“å™¨åˆ‡æ¢
    switchRenderer(type: string, config?: RendererConfig): Promise<void>
    getCurrentRendererType(): string | null
    
    // æ¸²æŸ“å™¨æ³¨å†Œ
    registerRenderer(type: string, rendererClass: CanvasRendererClass): void
    unregisterRenderer(type: string): void
  }
  
  // æ¸²æŸ“æ“ä½œ
  operations: {
    // åˆå§‹åŒ–
    init(container: HTMLElement, config: RendererConfig): Promise<void>
    destroy(): Promise<void>
    
    // èŠ‚ç‚¹æ“ä½œ
    addNode(node: NodeData): Promise<void>
    updateNode(nodeId: string, data: Partial<NodeData>): Promise<void>
    removeNode(nodeId: string): Promise<void>
    batchUpdateNodes(updates: Array<{id: string, data: Partial<NodeData>}>): Promise<void>
    
    // å¸ƒå±€æ“ä½œ
    layout(): Promise<void>
    autoLayout(algorithm?: LayoutAlgorithm): Promise<void>
    
    // è§†å›¾æ“ä½œ
    zoomIn(factor?: number): Promise<void>
    zoomOut(factor?: number): Promise<void>
    zoomToFit(): Promise<void>
    zoomToSelection(): Promise<void>
    setViewport(viewport: Viewport): Promise<void>
    
    // é€‰æ‹©æ“ä½œ
    selectNodes(nodeIds: string[]): void
    selectAll(): void
    clearSelection(): void
    getSelectedNodes(): string[]
  }
  
  // äº‹ä»¶å¤„ç†
  events: {
    // èŠ‚ç‚¹äº‹ä»¶
    onNodeClick(nodeId: string, event: MouseEvent): void
    onNodeDoubleClick(nodeId: string, event: MouseEvent): void
    onNodeContextMenu(nodeId: string, event: MouseEvent): void
    
    // å¸ƒå±€äº‹ä»¶
    onLayoutChange(changes: LayoutChange[]): void
    onViewportChange(viewport: Viewport): void
    
    // é€‰æ‹©äº‹ä»¶
    onSelectionChange(selectedIds: string[]): void
  }
  
  // å¯¼å‡ºåŠŸèƒ½
  export: {
    // å¯¼å‡ºä¸ºå›¾ç‰‡
    exportAsImage(options?: ImageExportOptions): Promise<Blob>
    // å¯¼å‡ºä¸ºSVG
    exportAsSVG(options?: SVGExportOptions): Promise<string>
    // å¯¼å‡ºå¸ƒå±€æ•°æ®
    exportLayoutData(): Promise<LayoutData[]>
  }
}

// é€šç”¨æ¸²æŸ“å™¨æ¥å£
interface CanvasRenderer {
  readonly type: string
  readonly version: string
  readonly capabilities: RendererCapabilities
  
  // ç”Ÿå‘½å‘¨æœŸ
  init(container: HTMLElement, config: RendererConfig): Promise<void>
  destroy(): Promise<void>
  
  // èŠ‚ç‚¹ç®¡ç†
  addNode(node: NodeData): Promise<void>
  removeNode(nodeId: string): Promise<void>
  updateNode(nodeId: string, data: Partial<NodeData>): Promise<void>
  
  // å¸ƒå±€ç®¡ç†
  layout(): Promise<void>
  setViewport(viewport: Viewport): Promise<void>
  
  // é€‰æ‹©ç®¡ç†
  selectNodes(nodeIds: string[]): void
  clearSelection(): void
  
  // äº‹ä»¶å¤„ç†
  on(event: RendererEvent, handler: EventHandler): void
  off(event: RendererEvent, handler: EventHandler): void
  
  // å¯¼å‡ºèƒ½åŠ›
  exportImage(): Promise<Blob>
  exportData(): Promise<any>
}

interface RendererCapabilities {
  // æ”¯æŒçš„åŠŸèƒ½
  features: {
    drag: boolean          // æ‹–æ‹½æ”¯æŒ
    resize: boolean        // è°ƒæ•´å¤§å°
    rotate: boolean        // æ—‹è½¬æ”¯æŒ
    zIndex: boolean        // å±‚çº§æ§åˆ¶
    grouping: boolean      // åˆ†ç»„æ”¯æŒ
    snapping: boolean      // å¯¹é½è¾…åŠ©
    guides: boolean        // å‚è€ƒçº¿
    animation: boolean     // åŠ¨ç”»æ”¯æŒ
  }
  
  // æ€§èƒ½ç‰¹æ€§
  performance: {
    maxNodes: number       // æœ€å¤§èŠ‚ç‚¹æ•°
    virtualScrolling: boolean  // è™šæ‹Ÿæ»šåŠ¨
    lazyRendering: boolean     // æ‡’æ¸²æŸ“
    hardwareAcceleration: boolean  // ç¡¬ä»¶åŠ é€Ÿ
  }
  
  // å¯¼å‡ºæ ¼å¼
  exportFormats: ('png' | 'jpg' | 'svg' | 'pdf')[]
}

// GridStackæ¸²æŸ“å™¨å®ç°
interface GridStackRenderer extends CanvasRenderer {
  readonly type: 'gridstack'
  gridstack: GridStack
  
  // GridStackç‰¹æœ‰é…ç½®
  updateGridConfig(config: {
    columns?: number
    cellHeight?: number | 'auto'
    margin?: number | string
    animate?: boolean
    float?: boolean
    disableDrag?: boolean
    disableResize?: boolean
  }): void
  
  // GridStackç‰¹æœ‰æ“ä½œ
  compact(doSort?: boolean): void
  enableMove(enable: boolean): void
  enableResize(enable: boolean): void
  
  // å“åº”å¼æ”¯æŒ
  setResponsiveMode(enabled: boolean): void
  updateBreakpoints(breakpoints: ResponsiveBreakpoints): void
}

// é¢„ç•™æ‰©å±•ï¼š3Dæ¸²æŸ“å™¨æ¥å£
interface ThreeJSRenderer extends CanvasRenderer {
  readonly type: 'threejs'
  scene: THREE.Scene
  camera: THREE.Camera
  renderer: THREE.WebGLRenderer
  
  // 3Dç‰¹æœ‰æ“ä½œ
  setCamera(type: 'perspective' | 'orthographic'): void
  setCameraPosition(x: number, y: number, z: number): void
  addLight(light: THREE.Light): void
  
  // 3Då¸ƒå±€
  arrange3D(layout: Layout3D): Promise<void>
  setDepth(nodeId: string, depth: number): void
}

// é¢„ç•™æ‰©å±•ï¼šSVGæ¸²æŸ“å™¨æ¥å£  
interface SVGRenderer extends CanvasRenderer {
  readonly type: 'svg'
  svgElement: SVGElement
  
  // SVGç‰¹æœ‰æ“ä½œ
  addDefs(defs: SVGDefsElement): void
  createGroup(id: string): SVGGElement
  applyTransform(nodeId: string, transform: SVGTransform): void
}

interface RendererConfig {
  // é€šç”¨é…ç½®
  common: {
    background?: string
    showGrid?: boolean
    gridSize?: number
    showGuides?: boolean
    snapToGrid?: boolean
    snapDistance?: number
  }
  
  // ç‰¹å®šæ¸²æŸ“å™¨é…ç½®
  [key: string]: any
}

interface Viewport {
  zoom: number
  offsetX: number
  offsetY: number
  width: number
  height: number
}

interface LayoutChange {
  nodeId: string
  oldLayout: any
  newLayout: any
  type: 'move' | 'resize' | 'add' | 'remove'
}

type RendererEvent = 
  | 'node-added' 
  | 'node-removed' 
  | 'node-updated'
  | 'layout-changed'
  | 'viewport-changed'
  | 'selection-changed'
  | 'node-click'
  | 'node-double-click'
  | 'node-context-menu'

type EventHandler = (event: any) => void

// æ¸²æŸ“å™¨å·¥å‚
class RendererFactory {
  private static renderers = new Map<string, CanvasRendererClass>()
  
  static register(type: string, rendererClass: CanvasRendererClass): void {
    this.renderers.set(type, rendererClass)
  }
  
  static create(type: string, container: HTMLElement, config: RendererConfig): CanvasRenderer {
    const RendererClass = this.renderers.get(type)
    if (!RendererClass) {
      throw new Error(`Unknown renderer type: ${type}`)
    }
    return new RendererClass(container, config)
  }
  
  static getAvailableTypes(): string[] {
    return Array.from(this.renderers.keys())
  }
}

// é¢„æ³¨å†Œå†…ç½®æ¸²æŸ“å™¨
RendererFactory.register('gridstack', GridStackRenderer)
// æœªæ¥æ‰©å±•
// RendererFactory.register('threejs', ThreeJSRenderer)
// RendererFactory.register('svg', SVGRenderer)
```

#### 3.2.5 é…ç½®å¼•æ“ - JSON Schemaé©±åŠ¨è¡¨å•
```typescript
interface ConfigEngine {
  // Schemaç®¡ç†
  schema: {
    // æ³¨å†Œé…ç½®Schema
    registerSchema(componentType: string, schema: ConfigSchemaDefinition): void
    unregisterSchema(componentType: string): void
    
    // è·å–Schema
    getSchema(componentType: string): ConfigSchemaDefinition | null
    getSchemasByCategory(category: string): ConfigSchemaDefinition[]
    
    // åˆå¹¶Schemaï¼ˆæ”¯æŒç»§æ‰¿ï¼‰
    mergeSchemas(base: ConfigSchemaDefinition, override: ConfigSchemaDefinition): ConfigSchemaDefinition
    
    // SchemaéªŒè¯
    validateSchema(schema: ConfigSchemaDefinition): ValidationResult
  }
  
  // è¡¨å•æ¸²æŸ“å™¨
  renderer: {
    // æ¸²æŸ“é…ç½®è¡¨å•
    renderForm(schema: ConfigSchemaDefinition, data: any, options?: RenderOptions): VNode
    
    // æ¸²æŸ“å•ä¸ªå­—æ®µ
    renderField(fieldSchema: FieldSchema, value: any, path: string): VNode
    
    // è¡¨å•ç»„ä»¶æ³¨å†Œ
    registerComponent(type: string, component: Component): void
    getComponent(type: string): Component | null
    
    // è‡ªå®šä¹‰æ¸²æŸ“å™¨
    registerRenderer(type: string, renderer: FieldRenderer): void
  }
  
  // æ•°æ®ç»‘å®š
  binding: {
    // åŒå‘ç»‘å®š
    bindData(schema: ConfigSchemaDefinition, data: Ref<any>): FormBinding
    unbindData(binding: FormBinding): void
    
    // æ•°æ®å˜æ›´ç›‘å¬
    watchChanges(binding: FormBinding, callback: (path: string, value: any) => void): void
    
    // æ‰¹é‡æ›´æ–°
    batchUpdate(binding: FormBinding, updates: Record<string, any>): void
  }
  
  // éªŒè¯ç³»ç»Ÿ
  validation: {
    // å®æ—¶éªŒè¯
    validate(schema: ConfigSchemaDefinition, data: any): ValidationResult
    validateField(fieldSchema: FieldSchema, value: any): FieldValidationResult
    
    // è‡ªå®šä¹‰éªŒè¯å™¨
    registerValidator(name: string, validator: CustomValidator): void
    
    // å¼‚æ­¥éªŒè¯
    validateAsync(schema: ConfigSchemaDefinition, data: any): Promise<ValidationResult>
  }
  
  // æ¡ä»¶æ˜¾ç¤º
  conditional: {
    // è®¡ç®—å­—æ®µå¯è§æ€§
    isFieldVisible(fieldSchema: FieldSchema, data: any): boolean
    
    // è®¡ç®—å­—æ®µå¯ç”¨çŠ¶æ€
    isFieldEnabled(fieldSchema: FieldSchema, data: any): boolean
    
    // ä¾èµ–å…³ç³»è§£æ
    resolveDependencies(schema: ConfigSchemaDefinition): DependencyGraph
  }
}

interface ConfigSchemaDefinition {
  // Schemaå…ƒä¿¡æ¯
  $schema?: string
  $id?: string
  title?: string
  description?: string
  version?: string
  
  // æ ¹å¯¹è±¡ç±»å‹ï¼ˆé€šå¸¸æ˜¯objectï¼‰
  type: 'object'
  
  // å­—æ®µå®šä¹‰
  properties: Record<string, FieldSchema>
  
  // å¿…å¡«å­—æ®µ
  required?: string[]
  
  // å­—æ®µé¡ºåº
  propertyOrder?: string[]
  
  // åˆ†ç»„é…ç½®
  groups?: SchemaGroup[]
  
  // å…¨å±€é…ç½®
  options?: {
    theme?: string
    layout?: 'vertical' | 'horizontal' | 'inline'
    labelWidth?: number
    showHelp?: boolean
    collapsible?: boolean
  }
}

interface FieldSchema {
  // åŸºç¡€ç±»å‹
  type: 'string' | 'number' | 'boolean' | 'array' | 'object' | 'null'
  
  // å­—æ®µä¿¡æ¯
  title?: string
  description?: string
  default?: any
  
  // çº¦æŸæ¡ä»¶
  minimum?: number
  maximum?: number
  minLength?: number
  maxLength?: number
  pattern?: string
  format?: string
  
  // æšä¸¾é€‰é¡¹
  enum?: any[]
  enumNames?: string[]
  
  // å¯¹è±¡ç±»å‹
  properties?: Record<string, FieldSchema>
  additionalProperties?: boolean | FieldSchema
  
  // æ•°ç»„ç±»å‹
  items?: FieldSchema
  minItems?: number
  maxItems?: number
  uniqueItems?: boolean
  
  // UIé…ç½®
  ui?: {
    // ç»„ä»¶ç±»å‹
    component?: string
    // ç»„ä»¶å±æ€§
    componentProps?: Record<string, any>
    // å¸ƒå±€é…ç½®
    layout?: {
      span?: number
      offset?: number
      labelCol?: number
      wrapperCol?: number
    }
    // æ ·å¼ç±»
    className?: string
    style?: Record<string, any>
    // å ä½ç¬¦
    placeholder?: string
    // å¸®åŠ©æ–‡æœ¬
    help?: string
    // æ ‡ç­¾é…ç½®
    label?: {
      text?: string
      tooltip?: string
      required?: boolean
    }
  }
  
  // æ¡ä»¶æ˜¾ç¤º
  dependencies?: Record<string, FieldDependency>
  
  // éªŒè¯è§„åˆ™
  validation?: {
    rules?: ValidationRule[]
    asyncRules?: AsyncValidationRule[]
    trigger?: 'change' | 'blur' | 'submit'
  }
}

interface SchemaGroup {
  key: string
  title: string
  description?: string
  fields: string[]
  
  // åˆ†ç»„UIé…ç½®
  ui?: {
    collapsible?: boolean
    defaultExpanded?: boolean
    icon?: string
    layout?: 'card' | 'fieldset' | 'tabs'
  }
}

interface FieldDependency {
  // ä¾èµ–å­—æ®µè·¯å¾„
  source: string
  
  // æ¡ä»¶ç±»å‹
  condition: 'equals' | 'not-equals' | 'contains' | 'not-contains' | 'greater' | 'less' | 'exists' | 'not-exists'
  
  // æ¡ä»¶å€¼
  value?: any
  
  // ä½œç”¨ç±»å‹
  effect: 'show' | 'hide' | 'enable' | 'disable' | 'require' | 'optional'
}

interface ValidationRule {
  type: 'required' | 'pattern' | 'min' | 'max' | 'length' | 'custom'
  value?: any
  message?: string
  validator?: (value: any, data: any) => boolean | string
}

interface AsyncValidationRule {
  type: string
  validator: (value: any, data: any) => Promise<boolean | string>
  debounce?: number
}

// å†…ç½®è¡¨å•ç»„ä»¶
const BUILT_IN_FORM_COMPONENTS = {
  // åŸºç¡€è¾“å…¥
  'text-input': {
    component: 'NInput',
    props: { type: 'text' }
  },
  'textarea': {
    component: 'NInput',
    props: { type: 'textarea', rows: 3 }
  },
  'number-input': {
    component: 'NInputNumber',
    props: {}
  },
  'password-input': {
    component: 'NInput',
    props: { type: 'password', showPasswordOn: 'click' }
  },
  
  // é€‰æ‹©å™¨
  'select': {
    component: 'NSelect',
    props: { clearable: true }
  },
  'multi-select': {
    component: 'NSelect',
    props: { multiple: true, clearable: true }
  },
  'radio-group': {
    component: 'NRadioGroup',
    props: {}
  },
  'checkbox-group': {
    component: 'NCheckboxGroup',
    props: {}
  },
  
  // å¼€å…³å’Œæ»‘å—
  'switch': {
    component: 'NSwitch',
    props: {}
  },
  'slider': {
    component: 'NSlider',
    props: {}
  },
  'rate': {
    component: 'NRate',
    props: {}
  },
  
  // é¢œè‰²å’Œæ—¥æœŸ
  'color-picker': {
    component: 'NColorPicker',
    props: { showAlpha: true }
  },
  'date-picker': {
    component: 'NDatePicker',
    props: { type: 'date' }
  },
  'time-picker': {
    component: 'NTimePicker',
    props: {}
  },
  
  // ä¸Šä¼ å’Œæ–‡ä»¶
  'upload': {
    component: 'NUpload',
    props: { max: 1 }
  },
  'image-upload': {
    component: 'NUpload',
    props: { accept: 'image/*', listType: 'image-card' }
  },
  
  // å¤æ‚ç»„ä»¶
  'code-editor': {
    component: 'CodeEditor',
    props: { language: 'json' }
  },
  'json-editor': {
    component: 'JsonEditor',
    props: {}
  },
  'expression-editor': {
    component: 'ExpressionEditor',
    props: {}
  }
}

// é…ç½®Schemaç¤ºä¾‹ï¼šæ–‡æœ¬å¡ç‰‡
const TEXT_CARD_SCHEMA: ConfigSchemaDefinition = {
  title: 'æ–‡æœ¬å¡ç‰‡é…ç½®',
  type: 'object',
  groups: [
    {
      key: 'basic',
      title: 'åŸºç¡€é…ç½®',
      fields: ['title', 'content', 'textAlign'],
      ui: { defaultExpanded: true }
    },
    {
      key: 'style',
      title: 'æ ·å¼é…ç½®', 
      fields: ['fontSize', 'fontWeight', 'color', 'backgroundColor'],
      ui: { collapsible: true }
    },
    {
      key: 'interaction',
      title: 'äº¤äº’é…ç½®',
      fields: ['clickable', 'clickAction', 'hoverEffect'],
      ui: { collapsible: true }
    }
  ],
  properties: {
    title: {
      type: 'string',
      title: 'æ ‡é¢˜',
      default: 'æ–‡æœ¬æ ‡é¢˜',
      ui: {
        component: 'text-input',
        placeholder: 'è¯·è¾“å…¥æ ‡é¢˜'
      },
      validation: {
        rules: [{ type: 'required', message: 'æ ‡é¢˜ä¸èƒ½ä¸ºç©º' }]
      }
    },
    content: {
      type: 'string',
      title: 'å†…å®¹',
      default: 'è¿™æ˜¯æ–‡æœ¬å†…å®¹',
      ui: {
        component: 'textarea',
        componentProps: { rows: 4 },
        placeholder: 'è¯·è¾“å…¥å†…å®¹'
      }
    },
    textAlign: {
      type: 'string',
      title: 'æ–‡æœ¬å¯¹é½',
      default: 'left',
      enum: ['left', 'center', 'right', 'justify'],
      enumNames: ['å·¦å¯¹é½', 'å±…ä¸­', 'å³å¯¹é½', 'ä¸¤ç«¯å¯¹é½'],
      ui: {
        component: 'radio-group'
      }
    },
    fontSize: {
      type: 'number',
      title: 'å­—ä½“å¤§å°',
      default: 14,
      minimum: 12,
      maximum: 48,
      ui: {
        component: 'slider',
        componentProps: { marks: { 12: '12px', 24: '24px', 48: '48px' } }
      }
    },
    fontWeight: {
      type: 'string',
      title: 'å­—ä½“ç²—ç»†',
      default: 'normal',
      enum: ['normal', 'bold', '100', '200', '300', '400', '500', '600', '700', '800', '900'],
      enumNames: ['æ­£å¸¸', 'ç²—ä½“', '100', '200', '300', '400', '500', '600', '700', '800', '900'],
      ui: {
        component: 'select'
      }
    },
    color: {
      type: 'string',
      title: 'æ–‡å­—é¢œè‰²',
      default: '#333333',
      format: 'color',
      ui: {
        component: 'color-picker'
      }
    },
    backgroundColor: {
      type: 'string',  
      title: 'èƒŒæ™¯é¢œè‰²',
      default: 'transparent',
      format: 'color',
      ui: {
        component: 'color-picker',
        componentProps: { showAlpha: true }
      }
    },
    clickable: {
      type: 'boolean',
      title: 'å¯ç”¨ç‚¹å‡»',
      default: false,
      ui: {
        component: 'switch'
      }
    },
    clickAction: {
      type: 'string',
      title: 'ç‚¹å‡»è¡Œä¸º',
      default: 'none',
      enum: ['none', 'link', 'modal', 'custom'],
      enumNames: ['æ— ', 'è·³è½¬é“¾æ¥', 'å¼¹å‡ºæ¨¡æ€', 'è‡ªå®šä¹‰'],
      dependencies: {
        clickable: {
          source: 'clickable',
          condition: 'equals',
          value: true,
          effect: 'show'
        }
      },
      ui: {
        component: 'select'
      }
    },
    hoverEffect: {
      type: 'boolean',
      title: 'æ‚¬åœæ•ˆæœ',
      default: true,
      ui: {
        component: 'switch'
      }
    }
  },
  required: ['title', 'content']
}
```

#### 3.2.6 æ•°æ®å¼•æ“ - çŠ¶æ€ç®¡ç†å’ŒåŒæ­¥
```typescript
interface DataEngine {
  // çŠ¶æ€ç®¡ç†
  state: {
    // å½“å‰é¢æ¿æ•°æ®
    current: Ref<PanelV2Data>
    
    // å†å²è®°å½•ï¼ˆç”¨äºæ’¤é”€/é‡åšï¼‰
    history: {
      past: PanelV2Data[]
      future: PanelV2Data[]
      maxSize: number
    }
    
    // å˜æ›´è¿½è¸ª
    changes: {
      isDirty: Ref<boolean>
      lastSaveTime: Ref<number | null>
      unsavedChanges: ChangeRecord[]
    }
    
    // è¿è¡Œæ—¶ç¼“å­˜
    cache: Map<string, any>
  }
  
  // æ•°æ®æ“ä½œ
  operations: {
    // é¢æ¿çº§æ“ä½œ
    updatePanel(update: Partial<PanelV2Data>): void
    resetPanel(): void
    clonePanel(): PanelV2Data
    
    // èŠ‚ç‚¹æ“ä½œ
    addNode(node: NodeData): void
    updateNode(id: string, update: Partial<NodeData>): void
    removeNode(id: string): void
    cloneNode(id: string): NodeData
    moveNode(id: string, newLayout: any): void
    
    // æ‰¹é‡æ“ä½œ
    batchUpdateNodes(updates: Array<{id: string, update: Partial<NodeData>}>): void
    batchRemoveNodes(ids: string[]): void
    
    // é€‰æ‹©æ“ä½œ
    selectNodes(ids: string[]): void
    clearSelection(): void
    selectAll(): void
    invertSelection(): void
  }
  
  // å†å²ç®¡ç†ï¼ˆæ’¤é”€/é‡åšï¼‰
  history: {
    // è®°å½•å˜æ›´
    recordChange(change: ChangeRecord): void
    
    // æ’¤é”€/é‡åš
    undo(): boolean
    redo(): boolean
    canUndo(): boolean
    canRedo(): boolean
    
    // å†å²ç®¡ç†
    clearHistory(): void
    getHistorySize(): number
    setMaxHistorySize(size: number): void
    
    // æ‰¹é‡æ“ä½œï¼ˆé˜²æ­¢äº§ç”Ÿè¿‡å¤šå†å²è®°å½•ï¼‰
    startBatch(): void
    endBatch(): void
  }
  
  // æ•°æ®éªŒè¯
  validation: {
    // éªŒè¯æ•´ä¸ªé¢æ¿
    validatePanel(panel: PanelV2Data): ValidationResult
    
    // éªŒè¯å•ä¸ªèŠ‚ç‚¹
    validateNode(node: NodeData): ValidationResult
    
    // å®æ—¶éªŒè¯
    enableRealTimeValidation(enabled: boolean): void
    
    // è‡ªå®šä¹‰éªŒè¯å™¨
    registerValidator(name: string, validator: DataValidator): void
  }
  
  // æ•°æ®åŒæ­¥
  sync: {
    // è‡ªåŠ¨ä¿å­˜
    enableAutoSave(interval?: number): void
    disableAutoSave(): void
    
    // æ‰‹åŠ¨ä¿å­˜
    save(): Promise<void>
    saveAs(name: string): Promise<void>
    
    // åŠ è½½æ•°æ®
    load(id: string): Promise<void>
    loadFromJSON(json: string): Promise<void>
    
    // åŒæ­¥çŠ¶æ€
    getSyncStatus(): SyncStatus
    
    // å†²çªè§£å†³
    resolveConflict(strategy: ConflictResolution): Promise<void>
  }
  
  // æ•°æ®å˜æ¢
  transform: {
    // æ•°æ®è¿ç§»ï¼ˆç‰ˆæœ¬å…¼å®¹ï¼‰
    migrate(data: any, fromVersion: string, toVersion: string): PanelV2Data
    
    // æ•°æ®æ¸…ç†
    cleanup(data: PanelV2Data): PanelV2Data
    
    // æ•°æ®å‹ç¼©
    compress(data: PanelV2Data): CompressedData
    decompress(compressed: CompressedData): PanelV2Data
    
    // å¯¼å…¥å¯¼å‡º
    exportToV1Format(data: PanelV2Data): any
    importFromV1Format(v1Data: any): PanelV2Data
  }
  
  // äº‹ä»¶ç³»ç»Ÿ
  events: {
    // æ•°æ®å˜æ›´äº‹ä»¶
    on(event: DataEvent, handler: EventHandler): void
    off(event: DataEvent, handler: EventHandler): void
    emit(event: DataEvent, payload: any): void
    
    // ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
    onBeforeChange(handler: (change: ChangeRecord) => boolean | void): void
    onAfterChange(handler: (change: ChangeRecord) => void): void
    
    // ä¿å­˜äº‹ä»¶
    onBeforeSave(handler: (data: PanelV2Data) => boolean | Promise<boolean>): void
    onAfterSave(handler: (data: PanelV2Data) => void): void
  }
}

interface ChangeRecord {
  id: string
  timestamp: number
  type: ChangeType
  target: 'panel' | 'node'
  targetId?: string
  
  // å˜æ›´å†…å®¹
  before: any
  after: any
  
  // å˜æ›´è·¯å¾„
  path?: string
  
  // å˜æ›´å…ƒæ•°æ®
  meta?: {
    user?: string
    source?: string  // 'user' | 'api' | 'plugin' | 'system'
    batch?: string   // æ‰¹é‡æ“ä½œçš„æ‰¹æ¬¡ID
  }
}

type ChangeType = 
  | 'create' | 'update' | 'delete' 
  | 'move' | 'resize' | 'style'
  | 'config' | 'data' | 'selection'

interface ValidationResult {
  valid: boolean
  errors: ValidationError[]
  warnings: ValidationWarning[]
}

interface ValidationError {
  path: string
  message: string
  code: string
  severity: 'error' | 'warning' | 'info'
}

interface SyncStatus {
  isSaving: boolean
  isLoading: boolean
  lastSyncTime: number | null
  hasUnsavedChanges: boolean
  syncError: Error | null
}

type ConflictResolution = 'local' | 'remote' | 'merge' | 'manual'

type DataEvent = 
  | 'panel-updated' | 'node-added' | 'node-updated' | 'node-removed'
  | 'selection-changed' | 'history-changed' | 'validation-changed'
  | 'save-started' | 'save-completed' | 'save-failed'
  | 'load-started' | 'load-completed' | 'load-failed'

// è‡ªé€‚åº”èŠ‚ç‚¹æ¸²æŸ“å™¨
interface AdaptiveNodeRenderer {
  // å®¹å™¨ç®¡ç†
  container: {
    // åˆ›å»ºè‡ªé€‚åº”å®¹å™¨
    create(nodeId: string, config: NodeRenderConfig): AdaptiveContainer
    destroy(nodeId: string): void
    
    // è·å–å®¹å™¨å®ä¾‹
    get(nodeId: string): AdaptiveContainer | null
    getAll(): AdaptiveContainer[]
    
    // å®¹å™¨æ›´æ–°
    update(nodeId: string, config: Partial<NodeRenderConfig>): void
    resize(nodeId: string, size: Size): void
  }
  
  // å“åº”å¼ç³»ç»Ÿ
  responsive: {
    // å…¨å±€å“åº”å¼é…ç½®
    setGlobalConfig(config: ResponsiveConfig): void
    
    // èŠ‚ç‚¹å“åº”å¼é…ç½®
    setNodeConfig(nodeId: string, config: NodeResponsiveConfig): void
    
    // æ–­ç‚¹ç®¡ç†
    registerBreakpoint(name: string, breakpoint: Breakpoint): void
    getCurrentBreakpoint(): string
    
    // å“åº”å¼ç›‘å¬
    onBreakpointChange(handler: (breakpoint: string) => void): void
  }
  
  // è‡ªé€‚åº”ç­–ç•¥
  adaptation: {
    // æ³¨å†Œè‡ªé€‚åº”ç­–ç•¥
    registerStrategy(name: string, strategy: AdaptationStrategy): void
    
    // åº”ç”¨ç­–ç•¥
    applyStrategy(nodeId: string, strategyName: string): void
    
    // æ™ºèƒ½è‡ªé€‚åº”
    enableSmartAdaptation(nodeId: string): void
    disableSmartAdaptation(nodeId: string): void
  }
}

interface AdaptiveContainer {
  id: string
  element: HTMLElement
  
  // å°ºå¯¸ä¿¡æ¯
  size: Ref<Size>
  contentSize: Ref<Size>
  availableSize: Ref<Size>
  
  // Vueç»„ä»¶å®ä¾‹
  component: ComponentInternalInstance | null
  
  // è‡ªé€‚åº”é…ç½®
  config: NodeRenderConfig
  
  // ResizeObserver
  resizeObserver: ResizeObserver
  
  // æ–¹æ³•
  mount(vueComponent: Component, props: any): void
  unmount(): void
  updateProps(props: any): void
  requestResize(size: Partial<Size>): void
  
  // äº‹ä»¶
  on(event: ContainerEvent, handler: Function): void
  off(event: ContainerEvent, handler: Function): void
  emit(event: ContainerEvent, data: any): void
}

interface NodeRenderConfig {
  // è‡ªé€‚åº”é…ç½®
  autoResize: boolean
  maintainAspectRatio: boolean
  
  // å°ºå¯¸çº¦æŸ
  minSize?: Size
  maxSize?: Size
  
  // å“åº”å¼é…ç½®
  responsive?: {
    enabled: boolean
    breakpoints?: Record<string, Partial<NodeRenderConfig>>
  }
  
  // æ€§èƒ½é…ç½®
  performance?: {
    throttleResize: number
    lazyMount: boolean
    virtualScrolling: boolean
  }
}

interface ResponsiveConfig {
  // å…¨å±€æ–­ç‚¹
  breakpoints: Record<string, Breakpoint>
  
  // é»˜è®¤è¡Œä¸º
  defaultBehavior: {
    autoHide: boolean      // å°å±è‡ªåŠ¨éšè—
    autoStack: boolean     // è‡ªåŠ¨å †å å¸ƒå±€
    scaleContent: boolean  // å†…å®¹ç¼©æ”¾
  }
  
  // æ€§èƒ½é…ç½®
  performance: {
    debounceDelay: number
    useRAF: boolean        // ä½¿ç”¨ requestAnimationFrame
  }
}

interface Breakpoint {
  minWidth?: number
  maxWidth?: number
  minHeight?: number
  maxHeight?: number
}

interface AdaptationStrategy {
  name: string
  description: string
  
  // ç­–ç•¥å‡½æ•°
  adapt(container: AdaptiveContainer, context: AdaptationContext): void
  
  // ç­–ç•¥æ¡ä»¶
  shouldApply?(container: AdaptiveContainer, context: AdaptationContext): boolean
  
  // ç­–ç•¥ä¼˜å…ˆçº§
  priority: number
}

interface AdaptationContext {
  // å½“å‰ç¯å¢ƒ
  viewport: Size
  breakpoint: string
  deviceType: 'mobile' | 'tablet' | 'desktop'
  
  // å®¹å™¨ä¿¡æ¯
  containerSize: Size
  availableSize: Size
  
  // å…¶ä»–èŠ‚ç‚¹ä¿¡æ¯
  siblingNodes: AdaptiveContainer[]
  parentContainer?: AdaptiveContainer
}

// å†…ç½®è‡ªé€‚åº”ç­–ç•¥
const BUILT_IN_ADAPTATION_STRATEGIES: AdaptationStrategy[] = [
  {
    name: 'scale-content',
    description: 'ç­‰æ¯”ç¼©æ”¾å†…å®¹',
    priority: 1,
    adapt: (container, context) => {
      const scale = Math.min(
        context.containerSize.width / container.config.minSize?.width || 1,
        context.containerSize.height / container.config.minSize?.height || 1
      )
      container.element.style.transform = `scale(${scale})`
    }
  },
  {
    name: 'overflow-scroll',
    description: 'å†…å®¹æº¢å‡ºæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡',
    priority: 2,
    adapt: (container, context) => {
      const needsScroll = 
        context.contentSize.width > context.containerSize.width ||
        context.contentSize.height > context.containerSize.height
      
      if (needsScroll) {
        container.element.style.overflow = 'auto'
      }
    }
  },
  {
    name: 'responsive-layout',
    description: 'å“åº”å¼å¸ƒå±€è°ƒæ•´',
    priority: 3,
    adapt: (container, context) => {
      if (context.deviceType === 'mobile') {
        // ç§»åŠ¨ç«¯é€‚é…é€»è¾‘
        container.element.classList.add('mobile-layout')
      }
    }
  }
]

type ContainerEvent = 
  | 'mounted' | 'unmounted' | 'resized' | 'props-updated'
  | 'size-requested' | 'adaptation-applied'
```

## 4. å…³é”®é—®é¢˜è§£å†³æ–¹æ¡ˆ

### 4.1 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 4.1.1 æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–
```typescript
interface PerformanceEngine {
  // è™šæ‹ŸåŒ–æ¸²æŸ“
  virtualization: {
    // è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§é‡èŠ‚ç‚¹åœºæ™¯ï¼‰
    enableVirtualScrolling(threshold: number): void
    disableVirtualScrolling(): void
    
    // è§†çª—è£å‰ªï¼ˆåªæ¸²æŸ“å¯è§åŒºåŸŸï¼‰
    enableViewportCulling(margin?: number): void
    setViewportMargin(margin: number): void
    
    // å±‚çº§ä¼˜åŒ–ï¼ˆåˆ†å±‚æ¸²æŸ“ï¼‰
    enableLayeredRendering(): void
    setRenderLayers(layers: RenderLayer[]): void
  }
  
  // æ‡’åŠ è½½ç­–ç•¥
  lazyLoading: {
    // ç»„ä»¶æ‡’åŠ è½½
    enableLazyComponents(strategy: 'intersection' | 'distance' | 'priority'): void
    
    // èµ„æºæ‡’åŠ è½½
    enableLazyResources(types: ('image' | 'video' | 'audio' | 'data')[]): void
    
    // é¢„åŠ è½½ç­–ç•¥
    enablePreloading(strategy: PreloadStrategy): void
    preloadComponents(types: string[]): Promise<void>
  }
  
  // ç¼“å­˜æœºåˆ¶
  caching: {
    // æ¸²æŸ“ç»“æœç¼“å­˜
    enableRenderCache(maxSize: number): void
    clearRenderCache(): void
    
    // è®¡ç®—ç»“æœç¼“å­˜
    enableComputationCache(): void
    cacheComputation(key: string, result: any, ttl?: number): void
    
    // èµ„æºç¼“å­˜
    enableResourceCache(types: string[]): void
    setCachePolicy(policy: CachePolicy): void
  }
  
  // æ‰¹é‡å¤„ç†
  batching: {
    // çŠ¶æ€æ›´æ–°æ‰¹å¤„ç†
    enableStateBatching(flushStrategy: 'microtask' | 'animation' | 'idle'): void
    
    // DOMæ“ä½œæ‰¹å¤„ç†
    enableDOMBatching(): void
    batchDOMOperations(operations: DOMOperation[]): void
    
    // ç½‘ç»œè¯·æ±‚æ‰¹å¤„ç†
    enableRequestBatching(window: number): void
    batchRequests(requests: NetworkRequest[]): Promise<any[]>
  }
  
  // å†…å­˜ç®¡ç†
  memory: {
    // å†…å­˜ç›‘æ§
    enableMemoryMonitoring(): void
    getMemoryUsage(): MemoryInfo
    
    // åƒåœ¾å›æ”¶ä¼˜åŒ–
    enableGCOptimization(): void
    forceGC(): void
    
    // å†…å­˜æ³„æ¼æ£€æµ‹
    enableLeakDetection(): void
    detectLeaks(): MemoryLeak[]
    
    // å¯¹è±¡æ± 
    createObjectPool<T>(factory: () => T, maxSize: number): ObjectPool<T>
  }
}

interface RenderLayer {
  id: string
  name: string
  zIndex: number
  nodes: string[]
  
  // æ¸²æŸ“ç­–ç•¥
  strategy: {
    method: 'canvas' | 'svg' | 'dom'
    priority: number
    caching: boolean
  }
  
  // æ›´æ–°ç­–ç•¥
  update: {
    frequency: 'realtime' | 'throttled' | 'ondemand'
    throttleMs?: number
  }
}

interface PreloadStrategy {
  // é¢„åŠ è½½æ—¶æœº
  trigger: 'immediate' | 'intersection' | 'idle' | 'interaction'
  
  // é¢„åŠ è½½æ•°é‡
  maxConcurrent: number
  
  // ä¼˜å…ˆçº§ç­–ç•¥
  priority: (component: ComponentDefinition) => number
  
  // é¢„åŠ è½½æ¡ä»¶
  condition?: (component: ComponentDefinition) => boolean
}

interface CachePolicy {
  // ç¼“å­˜å¤§å°é™åˆ¶
  maxSize: number
  maxMemory: number
  
  // ç¼“å­˜ç­–ç•¥
  strategy: 'lru' | 'lfu' | 'ttl' | 'adaptive'
  
  // TTLé…ç½®
  defaultTTL: number
  maxTTL: number
  
  // æ¸…ç†ç­–ç•¥
  cleanup: {
    interval: number
    threshold: number
  }
}

interface MemoryInfo {
  used: number
  total: number
  limit: number
  pressure: 'low' | 'moderate' | 'critical'
}

interface MemoryLeak {
  type: 'listener' | 'timer' | 'observer' | 'reference'
  source: string
  size: number
  age: number
}
```

#### 4.1.2 ç½‘ç»œæ€§èƒ½ä¼˜åŒ–
```typescript
interface NetworkOptimizer {
  // è¯·æ±‚ä¼˜åŒ–
  requests: {
    // è¯·æ±‚å»é‡
    enableDeduplication(): void
    
    // è¯·æ±‚åˆå¹¶
    enableRequestMerging(window: number): void
    
    // è¯·æ±‚ä¼˜å…ˆçº§
    setPriority(url: string, priority: 'high' | 'normal' | 'low'): void
    
    // è¯·æ±‚ç¼“å­˜
    enableRequestCache(policy: RequestCachePolicy): void
  }
  
  // æ•°æ®ä¼ è¾“ä¼˜åŒ–
  transfer: {
    // æ•°æ®å‹ç¼©
    enableCompression(formats: ('gzip' | 'brotli')[]): void
    
    // å¢é‡æ›´æ–°
    enableIncrementalUpdates(): void
    
    // æ•°æ®åˆ†ç‰‡
    enableDataChunking(chunkSize: number): void
  }
  
  // è¿æ¥ä¼˜åŒ–
  connection: {
    // è¿æ¥æ± 
    setConnectionPool(maxConnections: number): void
    
    // Keep-Alive
    enableKeepAlive(timeout: number): void
    
    // HTTP/2æ¨é€
    enableServerPush(resources: string[]): void
  }
}

interface RequestCachePolicy {
  // ç¼“å­˜é”®ç”Ÿæˆ
  keyGenerator: (request: Request) => string
  
  // ç¼“å­˜æ¡ä»¶
  shouldCache: (response: Response) => boolean
  
  // ç¼“å­˜æ—¶é—´
  ttl: number | ((response: Response) => number)
  
  // å­˜å‚¨ä½ç½®
  storage: 'memory' | 'indexeddb' | 'localstorage'
}
```

### 4.2 é”™è¯¯å¤„ç†æœºåˆ¶

#### 4.2.1 å…¨å±€é”™è¯¯å¤„ç†
```typescript
interface ErrorEngine {
  // é”™è¯¯æ•è·
  capture: {
    // å…¨å±€é”™è¯¯æ•è·
    enableGlobalCapture(): void
    
    // Promiseé”™è¯¯æ•è·
    enablePromiseRejectionCapture(): void
    
    // Vueé”™è¯¯æ•è·
    enableVueErrorCapture(): void
    
    // ç½‘ç»œé”™è¯¯æ•è·
    enableNetworkErrorCapture(): void
    
    // è‡ªå®šä¹‰é”™è¯¯æ•è·
    captureError(error: Error, context?: ErrorContext): void
  }
  
  // é”™è¯¯åˆ†ç±»
  classification: {
    // é”™è¯¯ç±»å‹åˆ†ç±»
    classifyError(error: Error): ErrorType
    
    // ä¸¥é‡ç¨‹åº¦è¯„ä¼°
    assessSeverity(error: Error): ErrorSeverity
    
    // é”™è¯¯å½’å› 
    attributeError(error: Error): ErrorAttribution
  }
  
  // é”™è¯¯æ¢å¤
  recovery: {
    // è‡ªåŠ¨æ¢å¤ç­–ç•¥
    registerRecoveryStrategy(errorType: ErrorType, strategy: RecoveryStrategy): void
    
    // æ‰‹åŠ¨æ¢å¤
    recover(error: Error): Promise<boolean>
    
    // é‡è¯•æœºåˆ¶
    enableRetry(config: RetryConfig): void
    
    // é™çº§ç­–ç•¥
    enableFallback(strategies: FallbackStrategy[]): void
  }
  
  // é”™è¯¯æŠ¥å‘Š
  reporting: {
    // æœ¬åœ°æ—¥å¿—
    enableLocalLogging(level: LogLevel): void
    
    // è¿œç¨‹ä¸ŠæŠ¥
    enableRemoteReporting(endpoint: string, options?: ReportingOptions): void
    
    // ç”¨æˆ·åé¦ˆ
    enableUserFeedback(): void
    
    // é”™è¯¯ç»Ÿè®¡
    getErrorStats(): ErrorStats
  }
  
  // é”™è¯¯é¢„é˜²
  prevention: {
    // è¾“å…¥éªŒè¯
    enableInputValidation(): void
    
    // è¾¹ç•Œæ£€æŸ¥
    enableBoundaryChecks(): void
    
    // ç±»å‹æ£€æŸ¥
    enableRuntimeTypeChecks(): void
    
    // èµ„æºç›‘æ§
    enableResourceMonitoring(): void
  }
}

type ErrorType = 
  | 'render-error'      // æ¸²æŸ“é”™è¯¯
  | 'data-error'        // æ•°æ®é”™è¯¯
  | 'network-error'     // ç½‘ç»œé”™è¯¯
  | 'validation-error'  // éªŒè¯é”™è¯¯
  | 'permission-error'  // æƒé™é”™è¯¯
  | 'resource-error'    // èµ„æºé”™è¯¯
  | 'plugin-error'      // æ’ä»¶é”™è¯¯
  | 'system-error'      // ç³»ç»Ÿé”™è¯¯

type ErrorSeverity = 'low' | 'medium' | 'high' | 'critical'

interface ErrorAttribution {
  source: 'user' | 'system' | 'network' | 'plugin' | 'unknown'
  component?: string
  action?: string
  timestamp: number
}

interface RecoveryStrategy {
  name: string
  
  // æ¢å¤æ¡ä»¶
  canRecover(error: Error): boolean
  
  // æ¢å¤æ“ä½œ
  recover(error: Error): Promise<RecoveryResult>
  
  // æ¢å¤ä¼˜å…ˆçº§
  priority: number
}

interface RecoveryResult {
  success: boolean
  message?: string
  newState?: any
  shouldRetry?: boolean
}

interface RetryConfig {
  // æœ€å¤§é‡è¯•æ¬¡æ•°
  maxAttempts: number
  
  // é‡è¯•é—´éš”
  delay: number | ((attempt: number) => number)
  
  // é‡è¯•æ¡ä»¶
  shouldRetry: (error: Error, attempt: number) => boolean
  
  // æŒ‡æ•°é€€é¿
  exponentialBackoff?: {
    base: number
    max: number
  }
}

interface FallbackStrategy {
  condition: (error: Error) => boolean
  fallback: () => any | Promise<any>
  priority: number
}

interface ErrorStats {
  total: number
  byType: Record<ErrorType, number>
  bySeverity: Record<ErrorSeverity, number>
  bySource: Record<string, number>
  trends: {
    hourly: number[]
    daily: number[]
    weekly: number[]
  }
}
```

#### 4.2.2 ç»„ä»¶çº§é”™è¯¯è¾¹ç•Œ
```typescript
interface ErrorBoundarySystem {
  // é”™è¯¯è¾¹ç•Œç®¡ç†
  boundaries: {
    // åˆ›å»ºé”™è¯¯è¾¹ç•Œ
    create(scope: ErrorBoundaryScope): ErrorBoundary
    
    // é”€æ¯é”™è¯¯è¾¹ç•Œ
    destroy(boundaryId: string): void
    
    // è·å–é”™è¯¯è¾¹ç•Œ
    get(boundaryId: string): ErrorBoundary | null
    
    // é‡ç½®é”™è¯¯è¾¹ç•Œ
    reset(boundaryId: string): void
  }
  
  // é”™è¯¯éš”ç¦»
  isolation: {
    // ç»„ä»¶çº§éš”ç¦»
    isolateComponent(componentId: string): void
    
    // åŠŸèƒ½çº§éš”ç¦»
    isolateFeature(featureName: string): void
    
    // æ’ä»¶çº§éš”ç¦»
    isolatePlugin(pluginId: string): void
  }
}

interface ErrorBoundary {
  id: string
  scope: ErrorBoundaryScope
  
  // é”™è¯¯æ•è·
  catchError(error: Error, errorInfo: ErrorInfo): void
  
  // é”™è¯¯å¤„ç†
  handleError(error: Error): ErrorHandlingResult
  
  // æ¢å¤æ“ä½œ
  recover(): Promise<boolean>
  
  // é‡ç½®çŠ¶æ€
  reset(): void
  
  // é™çº§æ¸²æŸ“
  renderFallback(): VNode
}

interface ErrorBoundaryScope {
  type: 'component' | 'feature' | 'plugin' | 'global'
  target: string
  
  // é”™è¯¯å¤„ç†ç­–ç•¥
  strategy: {
    // æ˜¯å¦é˜»æ­¢é”™è¯¯å†’æ³¡
    stopPropagation: boolean
    
    // è‡ªåŠ¨æ¢å¤
    autoRecover: boolean
    
    // é™çº§ç­–ç•¥
    fallbackType: 'component' | 'message' | 'retry' | 'hide'
  }
}

interface ErrorInfo {
  componentStack: string
  errorBoundary: string
  errorBoundaryStack: string
}

interface ErrorHandlingResult {
  handled: boolean
  shouldRecover: boolean
  fallbackContent?: VNode
  nextAction?: 'retry' | 'reload' | 'redirect' | 'ignore'
}
```

### 4.3 ç›‘æ§å’Œè°ƒè¯•ç³»ç»Ÿ

#### 4.3.1 æ€§èƒ½ç›‘æ§
```typescript
interface PerformanceMonitor {
  // æ€§èƒ½æŒ‡æ ‡æ”¶é›†
  metrics: {
    // æ¸²æŸ“æ€§èƒ½
    measureRenderTime(componentId: string): void
    measureLayoutTime(): void
    measurePaintTime(): void
    
    // äº¤äº’æ€§èƒ½
    measureInteractionDelay(): void
    measureResponseTime(action: string): void
    
    // èµ„æºæ€§èƒ½
    measureResourceLoading(): void
    measureMemoryUsage(): void
    measureNetworkLatency(): void
    
    // è‡ªå®šä¹‰æŒ‡æ ‡
    recordCustomMetric(name: string, value: number): void
  }
  
  // æ€§èƒ½åˆ†æ
  analysis: {
    // æ€§èƒ½ç“¶é¢ˆåˆ†æ
    analyzeBottlenecks(): PerformanceBottleneck[]
    
    // å†…å­˜æ³„æ¼åˆ†æ
    analyzeMemoryLeaks(): MemoryLeakReport[]
    
    // æ¸²æŸ“æ€§èƒ½åˆ†æ
    analyzeRenderPerformance(): RenderPerformanceReport
    
    // ç½‘ç»œæ€§èƒ½åˆ†æ
    analyzeNetworkPerformance(): NetworkPerformanceReport
  }
  
  // æ€§èƒ½é¢„è­¦
  alerts: {
    // è®¾ç½®æ€§èƒ½é˜ˆå€¼
    setThreshold(metric: string, threshold: number): void
    
    // æ³¨å†Œé¢„è­¦å›è°ƒ
    onThresholdExceeded(callback: (metric: string, value: number) => void): void
    
    // è‡ªåŠ¨ä¼˜åŒ–å»ºè®®
    getOptimizationSuggestions(): OptimizationSuggestion[]
  }
}

interface PerformanceBottleneck {
  type: 'render' | 'network' | 'memory' | 'computation'
  severity: number
  location: string
  description: string
  suggestions: string[]
}

interface OptimizationSuggestion {
  type: 'critical' | 'recommended' | 'optional'
  category: 'performance' | 'memory' | 'network' | 'user-experience'
  description: string
  implementation: string
  expectedImprovement: string
}
```

#### 4.3.2 å¼€å‘è°ƒè¯•å·¥å…·
```typescript
interface DebugTools {
  // ç»„ä»¶è°ƒè¯•
  component: {
    // ç»„ä»¶æ ‘æŸ¥çœ‹
    inspectComponentTree(): ComponentTreeNode[]
    
    // ç»„ä»¶çŠ¶æ€æŸ¥çœ‹
    inspectComponentState(componentId: string): any
    
    // ç»„ä»¶æ€§èƒ½åˆ†æ
    profileComponent(componentId: string): ComponentProfile
    
    // ç»„ä»¶äº‹ä»¶è·Ÿè¸ª
    traceComponentEvents(componentId: string): EventTrace[]
  }
  
  // æ•°æ®æµè°ƒè¯•
  dataFlow: {
    // æ•°æ®å˜æ›´è·Ÿè¸ª
    traceDataChanges(): DataChangeTrace[]
    
    // çŠ¶æ€å¿«ç…§
    takeStateSnapshot(): StateSnapshot
    
    // çŠ¶æ€å¯¹æ¯”
    compareStates(snapshot1: StateSnapshot, snapshot2: StateSnapshot): StateDiff
    
    // æ•°æ®æµå¯è§†åŒ–
    visualizeDataFlow(): DataFlowGraph
  }
  
  // æ¸²æŸ“è°ƒè¯•
  rendering: {
    // æ¸²æŸ“è¾¹ç•Œæ˜¾ç¤º
    showRenderBoundaries(enabled: boolean): void
    
    // é‡æ¸²æŸ“é«˜äº®
    highlightReRenders(enabled: boolean): void
    
    // æ¸²æŸ“æ—¶åºåˆ†æ
    analyzeRenderTimeline(): RenderTimeline
    
    // æ¸²æŸ“æ ‘å¯¼å‡º
    exportRenderTree(): RenderTreeExport
  }
  
  // ç½‘ç»œè°ƒè¯•
  network: {
    // è¯·æ±‚æ‹¦æˆª
    interceptRequests(enabled: boolean): void
    
    // è¯·æ±‚æ—¥å¿—
    getRequestLog(): NetworkRequestLog[]
    
    // æ¨¡æ‹Ÿç½‘ç»œæ¡ä»¶
    simulateNetworkConditions(conditions: NetworkConditions): void
    
    // API Mock
    enableAPIMock(endpoints: MockEndpoint[]): void
  }
}

interface ComponentProfile {
  renderCount: number
  averageRenderTime: number
  memoryUsage: number
  childComponents: string[]
  props: Record<string, any>
  state: Record<string, any>
}

interface DataChangeTrace {
  timestamp: number
  path: string
  oldValue: any
  newValue: any
  source: string
  stack: string[]
}

interface NetworkConditions {
  downloadSpeed: number  // kb/s
  uploadSpeed: number    // kb/s
  latency: number        // ms
  packetLoss: number     // percentage
}
```

## 5. æ’ä»¶ç³»ç»Ÿå’Œæ‰©å±•æœºåˆ¶

### 5.1 æ’ä»¶æ¶æ„
```typescript
interface PluginSystem {
  // æ’ä»¶ç®¡ç†
  manager: {
    install(plugin: PanelV2Plugin): Promise<void>
    uninstall(pluginId: string): Promise<void>
    activate(pluginId: string): Promise<void>
    deactivate(pluginId: string): Promise<void>
    
    // æ’ä»¶æŸ¥è¯¢
    getPlugin(id: string): PanelV2Plugin | null
    getAllPlugins(): PanelV2Plugin[]
    getActivePlugins(): PanelV2Plugin[]
  }
  
  // æ’ä»¶ä¸Šä¸‹æ–‡
  context: {
    // æä¾›ç»™æ’ä»¶çš„API
    registerComponent(component: ComponentDefinition): void
    registerTool(tool: ToolDefinition): void
    registerRenderer(renderer: CanvasRenderer): void
    
    // äº‹ä»¶ç³»ç»Ÿ
    on(event: string, handler: Function): void
    emit(event: string, data: any): void
    
    // æ•°æ®è®¿é—®
    getPanel(): PanelV2Data
    getSelectedNodes(): NodeData[]
  }
}

interface PanelV2Plugin {
  // æ’ä»¶å…ƒä¿¡æ¯
  meta: {
    id: string
    name: string
    version: string
    description: string
    author: string
    homepage?: string
    repository?: string
  }
  
  // æ’ä»¶åŠŸèƒ½
  components?: ComponentDefinition[]
  tools?: ToolDefinition[]
  renderers?: CanvasRenderer[]
  
  // ç”Ÿå‘½å‘¨æœŸ
  install?(context: PluginContext): Promise<void>
  uninstall?(context: PluginContext): Promise<void>
  activate?(context: PluginContext): Promise<void>
  deactivate?(context: PluginContext): Promise<void>
}
```

## 6. æŠ€æœ¯å®æ–½è·¯çº¿

### Phase 1: åŸºç¡€æ¶æ„ (2å‘¨)
1. **ç¬¬ä¸€å±‚ç¼–è¾‘å™¨åº•åº§**
   - çº¯å‡€å¸ƒå±€ç®¡ç†å™¨å®ç°
   - æ•°æ®ä¼ é€’ç®¡é“å»ºç«‹
   - ä¸»é¢˜é€‚é…æ¥å£

2. **åŸºç¡€ç±»å‹å®šä¹‰**
   - å®Œæ•´çš„TypeScriptç±»å‹ç³»ç»Ÿ
   - æ•°æ®ç»“æ„æ ‡å‡†åŒ–

### Phase 2: æ ¸å¿ƒå¼•æ“ (4å‘¨)  
1. **æ¸²æŸ“å¼•æ“** - GridStackå°è£…
2. **é…ç½®å¼•æ“** - JSON Schemaè¡¨å•
3. **æ•°æ®å¼•æ“** - çŠ¶æ€ç®¡ç†å’ŒåŒæ­¥
4. **èŠ‚ç‚¹æ³¨å†Œå¼•æ“** - æ ‘å½¢ç»„ä»¶ç®¡ç†

### Phase 3: é«˜çº§åŠŸèƒ½ (2å‘¨)
1. **å·¥å…·å¼•æ“** - å®Œæ•´å·¥å…·é›†
2. **è‡ªé€‚åº”æ¸²æŸ“** - ResizeObserveræœºåˆ¶
3. **æ€§èƒ½ä¼˜åŒ–** - è™šæ‹ŸåŒ–å’Œç¼“å­˜
4. **é”™è¯¯å¤„ç†** - å®Œæ•´å®¹é”™æœºåˆ¶

## 7. æ€»ç»“ä¸å±•æœ›

### 7.1 æ ¸å¿ƒåˆ›æ–°ç‚¹
1. **å½»åº•åˆ†å±‚åˆ†ç¦»** - ç¬¬ä¸€å±‚çº¯UIï¼Œç¬¬äºŒå±‚ä¸“ä¸šå¼•æ“
2. **å®Œå…¨æ•°æ®é©±åŠ¨** - JSON Schemaé…ç½®ï¼Œé›¶ç¡¬ç¼–ç 
3. **æè‡´è‡ªé€‚åº”** - ResizeObserver + CSS Variables
4. **ä¼ä¸šçº§å¯é ** - å®Œæ•´é”™è¯¯å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–
5. **é¢å‘æœªæ¥** - é¢„ç•™å¤šæ¸²æŸ“å™¨æ‰©å±•æ¥å£

### 7.2 æŠ€æœ¯ä¼˜åŠ¿
- **å¼€å‘æ•ˆç‡æå‡10å€** - æ–°ç»„ä»¶å¼€å‘ä»2å¤©ç¼©çŸ­åˆ°2å°æ—¶
- **æ€§èƒ½å“è¶Š** - æ”¯æŒ1000+èŠ‚ç‚¹æµç•…è¿è¡Œ
- **æ‰©å±•æ€§æå¼º** - æ”¯æŒä»»æ„æ¸²æŸ“å™¨å’Œç»„ä»¶ç±»å‹
- **ç»´æŠ¤æˆæœ¬ä½** - æ¸…æ™°æ¶æ„ï¼Œå®Œæ•´æ–‡æ¡£

### 7.3 åº”ç”¨å‰æ™¯
- **ThingsPanelæ ¸å¿ƒç«äº‰åŠ›** - ä¸‹ä¸€ä»£å¯è§†åŒ–æŠ€æœ¯åŸºç¡€
- **æŠ€æœ¯æ ‡æ†** - ä¼ä¸šçº§å¯è§†åŒ–è§£å†³æ–¹æ¡ˆå‚è€ƒ
- **ç”Ÿæ€å»ºè®¾** - æ’ä»¶å¸‚åœºå’Œå¼€å‘è€…ç¤¾åŒº
- **å•†ä¸šä»·å€¼** - æŠ€æœ¯æˆæƒå’Œè§£å†³æ–¹æ¡ˆè¾“å‡º

**PanelV2å°†æˆä¸ºThingsPanelçš„æŠ€æœ¯çš‡å† ï¼Œå¼•é¢†å¯è§†åŒ–æŠ€æœ¯å‘å±•æ–¹å‘ï¼**

---

*æ¶æ„è®¾è®¡å®Œæˆï¼Œå‡†å¤‡å¼€å§‹å®æ–½ï¼* ğŸš€
  search(keyword: string): ComponentDefinition[]
  
  // æ ‘å½¢ç»“æ„ç”Ÿæˆ
  generateTree(): NodeTreeItem[]
  
  // éªŒè¯æ¥å£
  validate(component: ComponentDefinition): ValidationResult
}
```

#### 3.2.3 çœ‹æ¿æ¸²æŸ“å™¨æ¥å£
```typescript
interface CanvasRenderer {
  // æ¸²æŸ“å™¨æ ‡è¯†
  readonly type: string
  
  // åˆå§‹åŒ–
  init(container: HTMLElement, config: RendererConfig): Promise<void>
  destroy(): void
  
  // èŠ‚ç‚¹ç®¡ç†
  addNode(node: NodeData): Promise<void>
  removeNode(nodeId: string): Promise<void>
  updateNode(nodeId: string, data: Partial<NodeData>): Promise<void>
  
  // å¸ƒå±€æ“ä½œ
  layout(): Promise<void>
  setViewport(viewport: Viewport): Promise<void>
  
  // é€‰æ‹©ç®¡ç†
  selectNodes(nodeIds: string[]): void
  clearSelection(): void
  
  // äº‹ä»¶å¤„ç†
  on(event: RendererEvent, handler: EventHandler): void
  off(event: RendererEvent, handler: EventHandler): void
  
  // å¯¼å‡ºèƒ½åŠ›
  exportImage(): Promise<Blob>
  exportData(): Promise<any>
}

// GridStackæ¸²æŸ“å™¨å®ç°
interface GridStackRenderer extends CanvasRenderer {
  gridstack: GridStack
  
  // GridStackç‰¹æœ‰é…ç½®
  updateGridConfig(config: {
    columns?: number
    cellHeight?: number
    margin?: number
    animate?: boolean
  }): void
}
```

#### 3.2.4 é…ç½®å™¨ï¼ˆJSONé©±åŠ¨è¡¨å•ï¼‰
```typescript
interface ConfigRenderer {
  // æ ¹æ®Schemaæ¸²æŸ“è¡¨å•
  render(schema: ConfigSchema, data: any): VNode
  
  // è¡¨å•ç»„ä»¶æ³¨å†Œ
  registerComponent(type: string, component: Component): void
  
  // éªŒè¯
  validate(schema: ConfigSchema, data: any): ValidationResult
  
  // äº‹ä»¶å¤„ç†
  onChange(path: string, value: any): void
  onValidate(errors: ValidationError[]): void
}

interface ConfigSchema {
  type: 'object' | 'array' | 'string' | 'number' | 'boolean' | 'enum'
  title?: string
  description?: string
  
  // å¯¹è±¡ç±»å‹
  properties?: Record<string, ConfigSchema>
  required?: string[]
  
  // æ•°ç»„ç±»å‹
  items?: ConfigSchema
  minItems?: number
  maxItems?: number
  
  // å­—ç¬¦ä¸²/æ•°å­—ç±»å‹
  minimum?: number
  maximum?: number
  pattern?: string
  
  // æšä¸¾ç±»å‹
  enum?: any[]
  enumLabels?: string[]
  
  // UIæ¸²æŸ“ç›¸å…³
  component?: string
  componentProps?: Record<string, any>
  
  // æ¡ä»¶æ˜¾ç¤º
  dependencies?: {
    [key: string]: {
      condition: 'equals' | 'not-equals' | 'contains'
      value: any
    }
  }
}
```

#### 3.2.5 èŠ‚ç‚¹æ¸²æŸ“å™¨ï¼ˆè‡ªé€‚åº”å®¹å™¨ï¼‰
```typescript
interface NodeRenderer {
  // å®¹å™¨ç®¡ç†
  container: HTMLElement
  
  // è‡ªé€‚åº”æœºåˆ¶
  resize(size: { width: number, height: number }): void
  getContentSize(): { width: number, height: number }
  
  // ç”Ÿå‘½å‘¨æœŸ
  mount(vueComponent: Component, props: any): void
  unmount(): void
  update(props: any): void
  
  // äº‹ä»¶ä»£ç†
  emit(event: string, data: any): void
  on(event: string, handler: Function): void
}

// è‡ªé€‚åº”ç­–ç•¥
interface ResponsiveStrategy {
  // åˆå§‹å¤§å°è®¡ç®—
  calculateInitialSize(component: ComponentDefinition): { w: number, h: number }
  
  // å®¹å™¨å˜åŒ–å“åº”
  onContainerResize(newSize: Size, oldSize: Size): void
  
  // å†…å®¹å˜åŒ–å“åº”
  onContentChange(): void
  
  // çº¦æŸæ¡ä»¶
  constraints: {
    minSize: Size
    maxSize?: Size
    aspectRatio?: number
    snapToGrid: boolean
  }
}
```

## 4. å…³é”®é—®é¢˜è§£å†³æ–¹æ¡ˆ

### 4.1 åŸºç¡€é…ç½®åˆ†å±‚ç­–ç•¥

#### ç¼–è¾‘å™¨åº•åº§å±‚é…ç½®
```typescript
interface EditorBaseConfig {
  // UIå¸ƒå±€
  layout: EditorLayout
  
  // å…¨å±€äº¤äº’è¡Œä¸º
  interaction: {
    allowDrag: boolean
    allowResize: boolean
    allowDelete: boolean
    multiSelect: boolean
    contextMenu: boolean
  }
  
  // æ€§èƒ½é…ç½®
  performance: {
    virtualScrolling: boolean
    lazyLoading: boolean
    maxNodes: number
  }
}
```

#### çœ‹æ¿æ¸²æŸ“å™¨å±‚é…ç½®
```typescript
interface RendererConfig {
  // æ¸²æŸ“å™¨é€šç”¨é…ç½®
  common: {
    background: string
    grid: boolean
    guides: boolean
    snap: boolean
  }
  
  // ç‰¹å®šæ¸²æŸ“å™¨é…ç½®
  gridstack?: GridStackConfig
  threejs?: ThreeJSConfig
  svg?: SVGConfig
  canvas?: CanvasConfig
}
```

#### èŠ‚ç‚¹å±‚é…ç½®
```typescript
interface NodeConfig {
  // å¸ƒå±€é…ç½®ï¼ˆç”±æ¸²æŸ“å™¨ç®¡ç†ï¼‰
  layout: any  // æ ¼å¼ç”±å…·ä½“æ¸²æŸ“å™¨å®šä¹‰
  
  // UIé…ç½®ï¼ˆç”±èŠ‚ç‚¹æ¸²æŸ“å™¨ç®¡ç†ï¼‰
  style: {
    border?: BorderConfig
    shadow?: ShadowConfig
    background?: BackgroundConfig
    opacity?: number
    transform?: TransformConfig
  }
  
  // ä¸šåŠ¡é…ç½®ï¼ˆç”±å…·ä½“ç»„ä»¶å®šä¹‰ï¼‰
  content: Record<string, any>
  
  // äº¤äº’é…ç½®
  interaction: {
    selectable: boolean
    draggable: boolean
    resizable: boolean
    clickThrough: boolean
    events: EventConfig[]
  }
}
```

### 4.2 è‡ªé€‚åº”æ¸²æŸ“æœºåˆ¶

#### ResizeObserverç­–ç•¥
```typescript
class AdaptiveNodeContainer {
  private resizeObserver: ResizeObserver
  private contentElement: HTMLElement
  private wrapperElement: HTMLElement
  
  constructor(private nodeRenderer: NodeRenderer) {
    this.setupResizeObserver()
    this.setupResponsiveContainer()
  }
  
  private setupResizeObserver() {
    this.resizeObserver = new ResizeObserver(entries => {
      for (const entry of entries) {
        this.handleResize(entry.contentRect)
      }
    })
  }
  
  private handleResize(rect: DOMRectReadOnly) {
    // é€šçŸ¥Vueç»„ä»¶å®¹å™¨å¤§å°å˜åŒ–
    this.nodeRenderer.emit('container-resize', {
      width: rect.width,
      height: rect.height
    })
    
    // æ›´æ–°CSSå˜é‡
    this.updateCSSVariables(rect)
  }
  
  private updateCSSVariables(rect: DOMRectReadOnly) {
    const root = this.wrapperElement
    root.style.setProperty('--container-width', `${rect.width}px`)
    root.style.setProperty('--container-height', `${rect.height}px`)
  }
}
```

#### Vueç»„ä»¶å“åº”å¼æ¥å£
```typescript
// ç»„ä»¶å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£è·å–å®¹å™¨ä¿¡æ¯
interface NodeComponentContext {
  // å®¹å™¨å°ºå¯¸ï¼ˆå“åº”å¼ï¼‰
  containerSize: Ref<{ width: number, height: number }>
  
  // æ›´æ–°å®¹å™¨éœ€æ±‚å°ºå¯¸
  requestResize(size: { width?: number, height?: number }): void
  
  // è·å–æ¸²æŸ“å™¨é…ç½®
  getRendererConfig(): RendererConfig
  
  // äº‹ä»¶å‘å°„
  emit(event: string, data: any): void
}

// ä½¿ç”¨ç¤ºä¾‹
export default defineComponent({
  setup() {
    const nodeContext = inject<NodeComponentContext>('nodeContext')
    
    // å“åº”å®¹å™¨å˜åŒ–
    watch(nodeContext.containerSize, (newSize) => {
      // ç»„ä»¶è‡ªé€‚åº”é€»è¾‘
    })
    
    return { nodeContext }
  }
})
```

## 5. æ•°æ®æµè®¾è®¡

### 5.1 é…ç½®æ•°æ®æµ
```
ç”¨æˆ·æ“ä½œé…ç½®å™¨ 
  â†’ é…ç½®SchemaéªŒè¯ 
  â†’ ç¼–è¾‘å™¨åº•åº§çŠ¶æ€æ›´æ–° 
  â†’ ç›®æ ‡æ¸²æŸ“å™¨æ¥æ”¶æ›´æ–° 
  â†’ UIé‡æ–°æ¸²æŸ“
```

### 5.2 äº¤äº’äº‹ä»¶æµ
```
ç”¨æˆ·äº¤äº’äº‹ä»¶ 
  â†’ äº‹ä»¶ç®¡ç†å™¨å¤„ç† 
  â†’ ç¼–è¾‘å™¨åº•åº§çŠ¶æ€å˜æ›´ 
  â†’ ç›¸å…³ç»„ä»¶åŒæ­¥æ›´æ–° 
  â†’ UIåé¦ˆ
```

### 5.3 èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸ
```
æ‹–æ‹½åˆ›å»º 
  â†’ èŠ‚ç‚¹æ³¨å†Œå™¨æä¾›é»˜è®¤æ•°æ® 
  â†’ çœ‹æ¿æ¸²æŸ“å™¨æ·»åŠ å¸ƒå±€ 
  â†’ èŠ‚ç‚¹æ¸²æŸ“å™¨æŒ‚è½½ç»„ä»¶ 
  â†’ é…ç½®å™¨æ˜¾ç¤ºé…ç½®è¡¨å•
```

## 6. æ‰©å±•æœºåˆ¶è®¾è®¡

### 6.1 æ’ä»¶æ¥å£
```typescript
interface PanelPlugin {
  name: string
  version: string
  
  // èŠ‚ç‚¹æ‰©å±•
  registerNodes?(): ComponentDefinition[]
  
  // å·¥å…·æ‰©å±•
  registerTools?(): ToolDefinition[]
  
  // æ¸²æŸ“å™¨æ‰©å±•
  registerRenderer?(): CanvasRenderer
  
  // é…ç½®ç»„ä»¶æ‰©å±•
  registerConfigComponents?(): ComponentDefinition[]
  
  // ç”Ÿå‘½å‘¨æœŸ
  install?(app: App): void
  uninstall?(): void
}
```

### 6.2 æ¸²æŸ“å™¨æ‰©å±•ç¤ºä¾‹
```typescript
// 3Dæ¸²æŸ“å™¨æ‰©å±•
class ThreeJSRenderer implements CanvasRenderer {
  readonly type = 'threejs'
  private scene: THREE.Scene
  private camera: THREE.Camera
  private renderer: THREE.WebGLRenderer
  
  async init(container: HTMLElement, config: RendererConfig) {
    // Three.jsåˆå§‹åŒ–é€»è¾‘
  }
  
  async addNode(node: NodeData) {
    // åœ¨3Dç©ºé—´ä¸­æ·»åŠ èŠ‚ç‚¹
  }
  
  // ... å…¶ä»–æ¥å£å®ç°
}
```

## 7. æŠ€æœ¯å®ç°å»ºè®®

### 7.1 æŠ€æœ¯æ ˆé€‰æ‹©
- **æ¡†æ¶**ï¼šVue 3 + TypeScript
- **çŠ¶æ€ç®¡ç†**ï¼šPinia
- **å¸ƒå±€æ¸²æŸ“**ï¼šGridStack.jsï¼ˆå½“å‰ï¼‰
- **æ ·å¼æ–¹æ¡ˆ**ï¼šCSS Variables + CSS-in-JS
- **æ„å»ºå·¥å…·**ï¼šVite

### 7.2 å¼€å‘é˜¶æ®µè§„åˆ’

#### Phase 1ï¼šåŸºç¡€æ¶æ„ï¼ˆ2å‘¨ï¼‰
- [ ] ç¼–è¾‘å™¨åº•åº§UIå¸ƒå±€
- [ ] åŸºç¡€çŠ¶æ€ç®¡ç†
- [ ] GridStackæ¸²æŸ“å™¨
- [ ] ç®€å•é…ç½®å™¨

#### Phase 2ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ3å‘¨ï¼‰
- [ ] JSON Schemaé…ç½®å™¨
- [ ] èŠ‚ç‚¹è‡ªé€‚åº”æœºåˆ¶
- [ ] äº‹ä»¶ç®¡ç†å™¨
- [ ] åŸºç¡€å·¥å…·é›†

#### Phase 3ï¼šæ‰©å±•èƒ½åŠ›ï¼ˆ2å‘¨ï¼‰
- [ ] æ’ä»¶ç³»ç»Ÿ
- [ ] å¤šæ¸²æŸ“å™¨æ”¯æŒ
- [ ] é«˜çº§é…ç½®åŠŸèƒ½

### 7.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- **è™šæ‹Ÿæ»šåŠ¨**ï¼šå¤§é‡èŠ‚ç‚¹æ—¶ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- **æ‡’åŠ è½½**ï¼šé…ç½®ç»„ä»¶æŒ‰éœ€åŠ è½½
- **ç¼“å­˜ç­–ç•¥**ï¼šæ¸²æŸ“ç»“æœç¼“å­˜
- **æ‰¹é‡æ›´æ–°**ï¼šçŠ¶æ€å˜æ›´æ‰¹é‡å¤„ç†

## 8. æ€»ç»“

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†ï¼š

1. **æ¸…æ™°çš„åˆ†å±‚**ï¼šæ¯å±‚èŒè´£æ˜ç¡®ï¼Œè¾¹ç•Œæ¸…æ™°
2. **é«˜å¯æ‰©å±•æ€§**ï¼šæ”¯æŒå¤šç§æ¸²æŸ“å™¨ã€å¤šç§èŠ‚ç‚¹ç±»å‹
3. **æ•°æ®é©±åŠ¨**ï¼šé…ç½®å®Œå…¨ç”±JSON Schemaé©±åŠ¨
4. **æŠ€æœ¯æ— å…³**ï¼šå¯ä»¥é›†æˆä»»ä½•å‰ç«¯æŠ€æœ¯æ ˆ
5. **æ€§èƒ½å¯æ§**ï¼šå…·å¤‡å¤šç§æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ

æ ¸å¿ƒåˆ›æ–°ç‚¹åœ¨äºå°†"åŸºç¡€é…ç½®"å’Œ"åŸºç¡€äº¤äº’"æ­£ç¡®åˆ†é…åˆ°å„ä¸ªå±‚çº§ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚