<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶æ„ä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #fafafa; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #2980b9; }
        .status { font-weight: bold; display: inline-block; width: 100px; }
        .json-display { background: #f4f4f4; border: 1px solid #ddd; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
        .property-path { background: #e8f4fd; border-left: 4px solid #3498db; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æ¶æ„ä¿®å¤éªŒè¯æµ‹è¯•</h1>
        <p>æœ¬é¡µé¢éªŒè¯æ‰€æœ‰å…³é”®æ¶æ„ä¿®å¤æ˜¯å¦æ­£ç¡®å®ç°ï¼ŒåŒ…æ‹¬é…ç½®è¿ç§»ã€æ•°æ®æºè§¦å‘æœºåˆ¶ã€å±æ€§æš´éœ²å’Œè·¯å¾„ç®¡ç†ã€‚</p>

        <div class="test-section">
            <h2>1ï¸âƒ£ é…ç½®è¿ç§»éªŒè¯</h2>
            <p>éªŒè¯ç»„ä»¶çº§è®¾å¤‡é…ç½®æ˜¯å¦æ­£ç¡®è¿ç§»åˆ°åŸºç¡€é…ç½®</p>
            <button onclick="testConfigurationMigration()">æµ‹è¯•é…ç½®è¿ç§»</button>
            <div id="config-migration-result"></div>
        </div>

        <div class="test-section">
            <h2>2ï¸âƒ£ æ•°æ®æºè§¦å‘æœºåˆ¶éªŒè¯</h2>
            <p>éªŒè¯å±æ€§å˜åŒ–æ˜¯å¦é€šè¿‡é…ç½®æ›´æ–°è§¦å‘æ‰§è¡Œå™¨ï¼ˆä¸å†ç›´æ¥åˆ·æ–°ï¼‰</p>
            <button onclick="testDataSourceTrigger()">æµ‹è¯•æ•°æ®æºè§¦å‘</button>
            <div id="datasource-trigger-result"></div>
        </div>

        <div class="test-section">
            <h2>3ï¸âƒ£ å±æ€§æš´éœ²éªŒè¯</h2>
            <p>éªŒè¯åŸºç¡€é…ç½®å±æ€§ï¼ˆdeviceIdã€metricsListï¼‰æ˜¯å¦åœ¨å±æ€§ç»‘å®šç•Œé¢å¯è§</p>
            <button onclick="testPropertyExposure()">æµ‹è¯•å±æ€§æš´éœ²</button>
            <div id="property-exposure-result"></div>
        </div>

        <div class="test-section">
            <h2>4ï¸âƒ£ å±æ€§è·¯å¾„æ ¼å¼éªŒè¯</h2>
            <p>éªŒè¯å±æ€§è·¯å¾„æ˜¯å¦ä½¿ç”¨æ­£ç¡®çš„æ ¼å¼ï¼šcomponentId.configSection.propertyPath</p>
            <button onclick="testPropertyPathFormat()">æµ‹è¯•å±æ€§è·¯å¾„æ ¼å¼</button>
            <div id="property-path-result"></div>
        </div>

        <div class="test-section">
            <h2>5ï¸âƒ£ ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•</h2>
            <p>æ¨¡æ‹Ÿå®Œæ•´çš„å±æ€§å˜åŒ– â†’ é…ç½®æ›´æ–° â†’ æ‰§è¡Œå™¨è§¦å‘æµç¨‹</p>
            <button onclick="testEndToEndFlow()">æµ‹è¯•ç«¯åˆ°ç«¯æµç¨‹</button>
            <div id="e2e-test-result"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š æ€»ä½“éªŒè¯çŠ¶æ€</h2>
            <div id="overall-status">
                <div class="info">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
            </div>
        </div>
    </div>

    <script type="module">
        let testResults = {
            configMigration: null,
            dataSourceTrigger: null,
            propertyExposure: null,
            propertyPath: null,
            endToEnd: null
        };

        // æ›´æ–°æ€»ä½“çŠ¶æ€
        function updateOverallStatus() {
            const results = Object.values(testResults);
            const completed = results.filter(r => r !== null).length;
            const passed = results.filter(r => r === true).length;
            const failed = results.filter(r => r === false).length;

            const statusDiv = document.getElementById('overall-status');
            
            if (completed === 0) {
                statusDiv.innerHTML = '<div class="info">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>';
                return;
            }

            let statusClass = 'info';
            let statusText = `æµ‹è¯•è¿›åº¦ï¼š${completed}/5`;
            
            if (completed === 5) {
                if (failed === 0) {
                    statusClass = 'success';
                    statusText = `ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ (${passed}/${completed})`;
                } else {
                    statusClass = 'error';
                    statusText = `âš ï¸ æµ‹è¯•å®Œæˆï¼Œæœ‰ ${failed} ä¸ªå¤±è´¥ (é€šè¿‡:${passed}, å¤±è´¥:${failed})`;
                }
            } else {
                statusText += ` (é€šè¿‡:${passed}, å¤±è´¥:${failed})`;
            }

            statusDiv.innerHTML = `<div class="${statusClass}">${statusText}</div>`;
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœçš„è¾…åŠ©å‡½æ•°
        function displayResult(containerId, success, title, details, data = null) {
            const container = document.getElementById(containerId);
            const resultClass = success ? 'success' : 'error';
            const icon = success ? 'âœ…' : 'âŒ';
            
            let html = `
                <div class="${resultClass}">
                    ${icon} ${title}
                    ${details}
                </div>
            `;
            
            if (data) {
                html += `<div class="json-display">${JSON.stringify(data, null, 2)}</div>`;
            }
            
            container.innerHTML = html;
        }

        // 1. æµ‹è¯•é…ç½®è¿ç§»
        window.testConfigurationMigration = async function() {
            try {
                // åŠ¨æ€å¯¼å…¥å¿…è¦æ¨¡å—
                const { configurationIntegrationBridge } = await import('./src/components/visual-editor/configuration/ConfigurationIntegrationBridge.js');
                
                console.log('ğŸ§ª [ArchitectureFixes] å¼€å§‹é…ç½®è¿ç§»æµ‹è¯•');

                // åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„æ—§æ ¼å¼é…ç½®
                const testComponentId = 'test-migration-' + Date.now();
                const oldFormatConfig = {
                    base: {},
                    component: {
                        deviceId: 'test-device-123',
                        metricsList: [
                            { id: 'temp', name: 'æ¸©åº¦', unit: 'Â°C' },
                            { id: 'humidity', name: 'æ¹¿åº¦', unit: '%' }
                        ],
                        title: 'æµ‹è¯•ç»„ä»¶'
                    },
                    dataSource: {},
                    interaction: {},
                    metadata: {
                        version: '1.0.0',
                        createdAt: Date.now()
                    }
                };

                // è®¾ç½®æ—§æ ¼å¼é…ç½®
                configurationIntegrationBridge.setConfiguration(testComponentId, oldFormatConfig);
                
                // è·å–é…ç½®ï¼Œåº”è¯¥è§¦å‘è‡ªåŠ¨è¿ç§»
                const migratedConfig = configurationIntegrationBridge.getConfiguration(testComponentId);
                
                // éªŒè¯è¿ç§»ç»“æœ
                const migrationSuccess = (
                    migratedConfig &&
                    migratedConfig.base.deviceId === 'test-device-123' &&
                    Array.isArray(migratedConfig.base.metricsList) &&
                    migratedConfig.base.metricsList.length === 2 &&
                    !migratedConfig.component.deviceId &&
                    !migratedConfig.component.metricsList &&
                    migratedConfig.metadata.migrationVersion === '2.0'
                );

                testResults.configMigration = migrationSuccess;
                
                if (migrationSuccess) {
                    displayResult('config-migration-result', true, 
                        'é…ç½®è¿ç§»æµ‹è¯•é€šè¿‡', 
                        '\n- deviceId å·²è¿ç§»åˆ°åŸºç¡€é…ç½®\n- metricsList å·²è¿ç§»åˆ°åŸºç¡€é…ç½®\n- ç»„ä»¶é…ç½®ä¸­çš„è®¾å¤‡å­—æ®µå·²æ¸…ç†\n- è¿ç§»å…ƒæ•°æ®å·²æ›´æ–°',
                        {
                            before: { component: oldFormatConfig.component },
                            after: { 
                                base: migratedConfig.base,
                                component: migratedConfig.component,
                                migrationMeta: migratedConfig.metadata 
                            }
                        }
                    );
                } else {
                    displayResult('config-migration-result', false,
                        'é…ç½®è¿ç§»æµ‹è¯•å¤±è´¥',
                        '\n- è®¾å¤‡å­—æ®µè¿ç§»ä¸å®Œæ•´æˆ–è¿ç§»é€»è¾‘æœ‰è¯¯',
                        migratedConfig
                    );
                }

            } catch (error) {
                console.error('é…ç½®è¿ç§»æµ‹è¯•å¤±è´¥:', error);
                testResults.configMigration = false;
                displayResult('config-migration-result', false,
                    'é…ç½®è¿ç§»æµ‹è¯•å¼‚å¸¸',
                    `\né”™è¯¯: ${error.message}`
                );
            }
            
            updateOverallStatus();
        };

        // 2. æµ‹è¯•æ•°æ®æºè§¦å‘æœºåˆ¶
        window.testDataSourceTrigger = async function() {
            try {
                console.log('ğŸ§ª [ArchitectureFixes] å¼€å§‹æ•°æ®æºè§¦å‘æœºåˆ¶æµ‹è¯•');

                // è¿™é‡Œä¸»è¦éªŒè¯æ¶æ„é€»è¾‘ï¼Œè€Œä¸æ˜¯å®é™…çš„HTTPè¯·æ±‚
                const { InteractionManager } = await import('./src/card2.1/core/interaction-manager.js');
                const { PropertyPathManager } = await import('./src/card2.1/core/property-path-manager.js');
                
                // æµ‹è¯•å±æ€§è·¯å¾„æ„å»º
                const componentId = 'test-component-' + Date.now();
                const deviceIdPath = PropertyPathManager.createBaseConfigBindingPath(componentId, 'deviceId');
                const metricsListPath = PropertyPathManager.createBaseConfigBindingPath(componentId, 'metricsList');
                
                // éªŒè¯è·¯å¾„æ ¼å¼
                const correctFormat = (
                    deviceIdPath === `${componentId}.base.deviceId` &&
                    metricsListPath === `${componentId}.base.metricsList`
                );

                // æµ‹è¯•è·¯å¾„è§£æ
                const deviceIdParsed = PropertyPathManager.parseBindingPath(deviceIdPath);
                const parseSuccess = (
                    deviceIdParsed.isValid &&
                    deviceIdParsed.pathInfo.componentInstanceId === componentId &&
                    deviceIdParsed.pathInfo.configSection === 'base' &&
                    deviceIdParsed.pathInfo.propertyPath === 'deviceId' &&
                    deviceIdParsed.pathInfo.hasConfigSection
                );

                testResults.dataSourceTrigger = correctFormat && parseSuccess;

                if (testResults.dataSourceTrigger) {
                    displayResult('datasource-trigger-result', true,
                        'æ•°æ®æºè§¦å‘æœºåˆ¶æµ‹è¯•é€šè¿‡',
                        '\n- å±æ€§è·¯å¾„æ„å»ºæ­£ç¡®\n- è·¯å¾„è§£æåŠŸèƒ½æ­£å¸¸\n- é…ç½®æ®µä¿¡æ¯å®Œæ•´',
                        {
                            deviceIdPath,
                            metricsListPath,
                            parsedInfo: deviceIdParsed.pathInfo
                        }
                    );
                } else {
                    displayResult('datasource-trigger-result', false,
                        'æ•°æ®æºè§¦å‘æœºåˆ¶æµ‹è¯•å¤±è´¥',
                        '\n- è·¯å¾„æ ¼å¼ä¸æ­£ç¡®æˆ–è§£æå¤±è´¥',
                        {
                            deviceIdPath,
                            expectedFormat: `${componentId}.base.deviceId`,
                            parsedResult: deviceIdParsed
                        }
                    );
                }

            } catch (error) {
                console.error('æ•°æ®æºè§¦å‘æœºåˆ¶æµ‹è¯•å¤±è´¥:', error);
                testResults.dataSourceTrigger = false;
                displayResult('datasource-trigger-result', false,
                    'æ•°æ®æºè§¦å‘æœºåˆ¶æµ‹è¯•å¼‚å¸¸',
                    `\né”™è¯¯: ${error.message}`
                );
            }
            
            updateOverallStatus();
        };

        // 3. æµ‹è¯•å±æ€§æš´éœ²
        window.testPropertyExposure = async function() {
            try {
                console.log('ğŸ§ª [ArchitectureFixes] å¼€å§‹å±æ€§æš´éœ²æµ‹è¯•');

                const { propertyExposureRegistry, getBaseConfigurationProperties } = await import('./src/card2.1/core/property-exposure.js');
                
                // è·å–åŸºç¡€é…ç½®å±æ€§
                const baseConfigProperties = getBaseConfigurationProperties();
                
                // éªŒè¯å…³é”®å±æ€§æ˜¯å¦å­˜åœ¨
                const hasDeviceId = baseConfigProperties.some(p => p.name === 'deviceId');
                const hasMetricsList = baseConfigProperties.some(p => p.name === 'metricsList');
                const hasVisibility = baseConfigProperties.some(p => p.name === 'visible');
                
                // æµ‹è¯•ç»„ä»¶æ³¨å†Œ
                const testComponentType = 'test-exposure-component';
                
                // æ¨¡æ‹Ÿç»„ä»¶å®šä¹‰å¹¶æ³¨å†Œ
                const { ComponentRegistry } = await import('./src/card2.1/core/component-registry.js');
                ComponentRegistry.register({
                    type: testComponentType,
                    label: 'æµ‹è¯•æš´éœ²ç»„ä»¶',
                    dataSources: [],
                    staticParams: {}
                });
                
                // è·å–æ³¨å†Œåçš„å±æ€§æš´éœ²é…ç½®
                const exposureConfig = propertyExposureRegistry.getComponentExposure(testComponentType);
                
                const registrationSuccess = (
                    exposureConfig &&
                    exposureConfig.listenableProperties.some(p => p.name === 'deviceId') &&
                    exposureConfig.listenableProperties.some(p => p.name === 'metricsList')
                );

                testResults.propertyExposure = hasDeviceId && hasMetricsList && hasVisibility && registrationSuccess;

                if (testResults.propertyExposure) {
                    displayResult('property-exposure-result', true,
                        'å±æ€§æš´éœ²æµ‹è¯•é€šè¿‡',
                        '\n- åŸºç¡€é…ç½®å±æ€§å®šä¹‰å®Œæ•´\n- ç»„ä»¶æ³¨å†Œæ—¶åŒ…å«åŸºç¡€é…ç½®å±æ€§\n- deviceId å’Œ metricsList å¯ç”¨äºç»‘å®š',
                        {
                            baseConfigPropertiesCount: baseConfigProperties.length,
                            coreProperties: ['deviceId', 'metricsList', 'visible'],
                            registeredComponent: exposureConfig?.componentName,
                            exposedPropertiesCount: exposureConfig?.listenableProperties.length
                        }
                    );
                } else {
                    displayResult('property-exposure-result', false,
                        'å±æ€§æš´éœ²æµ‹è¯•å¤±è´¥',
                        '\n- åŸºç¡€é…ç½®å±æ€§ç¼ºå¤±æˆ–ç»„ä»¶æ³¨å†Œå¤±è´¥',
                        {
                            baseConfigProperties: baseConfigProperties.map(p => p.name),
                            exposureConfig: exposureConfig
                        }
                    );
                }

            } catch (error) {
                console.error('å±æ€§æš´éœ²æµ‹è¯•å¤±è´¥:', error);
                testResults.propertyExposure = false;
                displayResult('property-exposure-result', false,
                    'å±æ€§æš´éœ²æµ‹è¯•å¼‚å¸¸',
                    `\né”™è¯¯: ${error.message}`
                );
            }
            
            updateOverallStatus();
        };

        // 4. æµ‹è¯•å±æ€§è·¯å¾„æ ¼å¼
        window.testPropertyPathFormat = async function() {
            try {
                console.log('ğŸ§ª [ArchitectureFixes] å¼€å§‹å±æ€§è·¯å¾„æ ¼å¼æµ‹è¯•');

                const { PropertyPathManager } = await import('./src/card2.1/core/property-path-manager.js');
                
                const testComponentId = 'simple-display_1757236004299';
                
                // æµ‹è¯•æ–°çš„æ­£ç¡®è·¯å¾„æ ¼å¼
                const baseConfigPath = PropertyPathManager.createBaseConfigBindingPath(testComponentId, 'deviceId');
                const componentConfigPath = PropertyPathManager.createComponentConfigBindingPath(testComponentId, 'title');
                
                // æœŸæœ›çš„æ­£ç¡®æ ¼å¼
                const expectedBasePath = `${testComponentId}.base.deviceId`;
                const expectedComponentPath = `${testComponentId}.component.title`;
                
                // éªŒè¯æ ¼å¼
                const formatCorrect = (
                    baseConfigPath === expectedBasePath &&
                    componentConfigPath === expectedComponentPath
                );

                // æµ‹è¯•è§£æåŠŸèƒ½
                const baseParsed = PropertyPathManager.parseBindingPath(baseConfigPath);
                const componentParsed = PropertyPathManager.parseBindingPath(componentConfigPath);
                
                const parseCorrect = (
                    baseParsed.isValid && baseParsed.pathInfo.configSection === 'base' &&
                    componentParsed.isValid && componentParsed.pathInfo.configSection === 'component'
                );

                testResults.propertyPath = formatCorrect && parseCorrect;

                if (testResults.propertyPath) {
                    displayResult('property-path-result', true,
                        'å±æ€§è·¯å¾„æ ¼å¼æµ‹è¯•é€šè¿‡',
                        '\n- åŸºç¡€é…ç½®è·¯å¾„æ ¼å¼æ­£ç¡®\n- ç»„ä»¶é…ç½®è·¯å¾„æ ¼å¼æ­£ç¡®\n- è·¯å¾„è§£æåŠŸèƒ½æ­£å¸¸',
                        {
                            examples: {
                                baseConfig: baseConfigPath,
                                componentConfig: componentConfigPath,
                                oldWrongFormat: `${testComponentId}.deviceId`,
                                newCorrectFormat: expectedBasePath
                            },
                            parseResults: {
                                base: baseParsed.pathInfo,
                                component: componentParsed.pathInfo
                            }
                        }
                    );
                } else {
                    displayResult('property-path-result', false,
                        'å±æ€§è·¯å¾„æ ¼å¼æµ‹è¯•å¤±è´¥',
                        '\n- è·¯å¾„æ ¼å¼ä¸ç¬¦åˆé¢„æœŸæˆ–è§£æå¤±è´¥',
                        {
                            generated: { baseConfigPath, componentConfigPath },
                            expected: { expectedBasePath, expectedComponentPath },
                            parsed: { baseParsed, componentParsed }
                        }
                    );
                }

            } catch (error) {
                console.error('å±æ€§è·¯å¾„æ ¼å¼æµ‹è¯•å¤±è´¥:', error);
                testResults.propertyPath = false;
                displayResult('property-path-result', false,
                    'å±æ€§è·¯å¾„æ ¼å¼æµ‹è¯•å¼‚å¸¸',
                    `\né”™è¯¯: ${error.message}`
                );
            }
            
            updateOverallStatus();
        };

        // 5. ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
        window.testEndToEndFlow = async function() {
            try {
                console.log('ğŸ§ª [ArchitectureFixes] å¼€å§‹ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•');

                // è¿™ä¸ªæµ‹è¯•éªŒè¯æ•´ä¸ªæµç¨‹çš„é›†æˆ
                const { configurationIntegrationBridge } = await import('./src/components/visual-editor/configuration/ConfigurationIntegrationBridge.js');
                const { PropertyPathManager } = await import('./src/card2.1/core/property-path-manager.js');
                
                const testComponentId = 'e2e-test-' + Date.now();
                
                // 1. åˆ›å»ºåŒ…å«è®¾å¤‡é…ç½®çš„ç»„ä»¶é…ç½®
                const initialConfig = {
                    base: {
                        deviceId: 'initial-device'
                    },
                    component: {
                        title: 'ç«¯åˆ°ç«¯æµ‹è¯•ç»„ä»¶'
                    },
                    dataSource: {
                        type: 'http',
                        config: {
                            url: 'http://api.example.com/data',
                            params: {
                                deviceId: `${testComponentId}.base.deviceId` // æ­£ç¡®çš„å±æ€§ç»‘å®š
                            }
                        }
                    },
                    interaction: {},
                    metadata: {
                        version: '2.0.0',
                        createdAt: Date.now()
                    }
                };

                // 2. è®¾ç½®é…ç½®
                configurationIntegrationBridge.setConfiguration(testComponentId, initialConfig);
                
                // 3. æ¨¡æ‹Ÿå±æ€§å˜åŒ–ï¼ˆè®¾å¤‡IDå˜æ›´ï¼‰
                const newDeviceId = 'updated-device-456';
                configurationIntegrationBridge.updateConfiguration(testComponentId, 'base', {
                    ...initialConfig.base,
                    deviceId: newDeviceId
                });

                // 4. éªŒè¯é…ç½®æ›´æ–°
                const updatedConfig = configurationIntegrationBridge.getConfiguration(testComponentId);
                
                // 5. éªŒè¯ç»“æœ
                const integrationSuccess = (
                    updatedConfig &&
                    updatedConfig.base.deviceId === newDeviceId &&
                    updatedConfig.dataSource.config.params.deviceId.includes('.base.deviceId') &&
                    updatedConfig.metadata.updatedAt
                );

                testResults.endToEnd = integrationSuccess;

                if (integrationSuccess) {
                    displayResult('e2e-test-result', true,
                        'ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•é€šè¿‡',
                        '\n- ç»„ä»¶é…ç½®åˆ›å»ºæˆåŠŸ\n- åŸºç¡€é…ç½®æ›´æ–°æˆåŠŸ\n- å±æ€§ç»‘å®šæ ¼å¼æ­£ç¡®\n- é…ç½®å˜æ›´æµç¨‹å®Œæ•´',
                        {
                            testFlow: [
                                '1. åˆ›å»ºç»„ä»¶é…ç½®ï¼ˆåŒ…å«å±æ€§ç»‘å®šï¼‰',
                                '2. è®¾ç½®åˆå§‹é…ç½®',
                                '3. æ›´æ–°åŸºç¡€é…ç½®å±æ€§',
                                '4. éªŒè¯é…ç½®æ›´æ–°ç»“æœ'
                            ],
                            finalConfig: {
                                base: updatedConfig.base,
                                dataSource: updatedConfig.dataSource
                            }
                        }
                    );
                } else {
                    displayResult('e2e-test-result', false,
                        'ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•å¤±è´¥',
                        '\n- é…ç½®æ›´æ–°æµç¨‹å­˜åœ¨é—®é¢˜',
                        updatedConfig
                    );
                }

            } catch (error) {
                console.error('ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•å¤±è´¥:', error);
                testResults.endToEnd = false;
                displayResult('e2e-test-result', false,
                    'ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•å¼‚å¸¸',
                    `\né”™è¯¯: ${error.message}`
                );
            }
            
            updateOverallStatus();
        };

        // é¡µé¢åŠ è½½å®Œæˆåçš„æç¤º
        window.addEventListener('load', function() {
            console.log('ğŸ§ª [ArchitectureFixes] æ¶æ„ä¿®å¤éªŒè¯æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('è¯·æŒ‰é¡ºåºç‚¹å‡»æµ‹è¯•æŒ‰é’®ï¼ŒéªŒè¯æ‰€æœ‰æ¶æ„ä¿®å¤æ˜¯å¦ç”Ÿæ•ˆ');
        });
    </script>
</body>
</html>