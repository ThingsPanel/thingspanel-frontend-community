# ç®€åŒ–æ•°æ®æºç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ¯ è®¾è®¡ç›®æ ‡

åŸºäºå¯¹ç°æœ‰ visual-editor å’Œ card2.1 ç³»ç»Ÿçš„æ·±å…¥å­¦ä¹ ï¼Œè®¾è®¡ä¸€ä¸ªç®€åŒ–ä½†ä¿ç•™æ ¸å¿ƒä»·å€¼çš„æ•°æ®æºç³»ç»Ÿã€‚

## ğŸ“Š æ ¸å¿ƒæ¶æ„

### 1. ç³»ç»Ÿæ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»„ä»¶å±‚ (Component Layer)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç»„ä»¶é€šè¿‡æ ‡å‡†propsæ¥æ”¶æ•°æ®ï¼Œä¸“æ³¨äºæ•°æ®å±•ç¤ºå’Œäº¤äº’              â”‚
â”‚                                                             â”‚
â”‚  Props: { dataSourceConfig: { [id]: { data: any } } }      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  é…ç½®å™¨ (ConfigGenerator)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ æ¥æ”¶ç»„ä»¶æ•°æ®éœ€æ±‚å£°æ˜                                      â”‚
â”‚  â€¢ æä¾›å¯è§†åŒ–é…ç½®ç•Œé¢                                        â”‚
â”‚  â€¢ ç”Ÿæˆæ ‡å‡†åŒ–é…ç½®æ•°æ®                                        â”‚
â”‚  â€¢ æ”¯æŒå­—æ®µæ˜ å°„å’ŒéªŒè¯                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ é…ç½®æ•°æ®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ‰§è¡Œå™¨ (DataExecutor)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ æ ¹æ®é…ç½®è·å–/ç”Ÿæˆæ•°æ®                                      â”‚
â”‚  â€¢ æ”¯æŒå¤šç§æ•°æ®æºç±»å‹                                        â”‚
â”‚  â€¢ é›†æˆè§¦å‘å™¨ç³»ç»Ÿ                                           â”‚
â”‚  â€¢ å“åº”å¼æ•°æ®æ›´æ–°                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                åŸºç¡€æœåŠ¡å±‚ (Foundation Layer)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ æ•°æ®æºå®ç° (Static, API, WebSocket, Script)              â”‚
â”‚  â€¢ è§¦å‘å™¨ç³»ç»Ÿ (Timer, WebSocket, Event, Manual)             â”‚
â”‚  â€¢ å­—æ®µæ˜ å°„å¼•æ“                                             â”‚
â”‚  â€¢ æ•°æ®éªŒè¯å™¨                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒç»„ä»¶å…³ç³»

```
ç»„ä»¶æ•°æ®éœ€æ±‚å£°æ˜ â†’ é…ç½®å™¨ â†’ é…ç½®æ•°æ® â†’ æ‰§è¡Œå™¨ â†’ ç»„ä»¶æ•°æ®
     â†‘                                        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ•°æ®ç»‘å®šç®¡ç†å™¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒæ¥å£è®¾è®¡

### 1. ç»„ä»¶æ•°æ®éœ€æ±‚æ¥å£
```typescript
interface ComponentDataRequirement {
  componentId: string
  componentName: string
  dataSources: DataSourceRequirement[]
}

interface DataSourceRequirement {
  id: string
  name: string
  structureType: 'object' | 'array'
  fields: FieldRequirement[]
  required: boolean
}

interface FieldRequirement {
  name: string
  type: 'string' | 'number' | 'boolean' | 'any'
  required: boolean
  description: string
}
```

### 2. æ•°æ®æºé…ç½®æ¥å£
```typescript
interface DataSourceConfig {
  id: string
  componentId: string
  dataSources: DataSourceDefinition[]
  triggers: TriggerConfig[]
  enabled: boolean
}

interface DataSourceDefinition {
  id: string
  type: 'static' | 'api' | 'websocket' | 'script'
  config: any
  fieldMapping?: { [targetField: string]: string }
}
```

### 3. ç»„ä»¶æ•°æ®æ¥å£
```typescript
interface ComponentData {
  [dataSourceId: string]: any
}

// ç»„ä»¶props
interface ComponentProps {
  dataSourceConfig?: {
    [dataSourceId: string]: {
      type: string
      data: any
    }
  }
}
```

## ğŸ¯ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. é…ç½®ç”Ÿæˆå™¨ (ConfigGenerator)
```typescript
class DataSourceConfigGenerator {
  /**
   * æ ¹æ®ç»„ä»¶éœ€æ±‚ç”Ÿæˆé…ç½®
   */
  generateConfig(
    requirement: ComponentDataRequirement,
    userInputs: UserDataSourceInput[]
  ): DataSourceConfig

  /**
   * éªŒè¯é…ç½®çš„æœ‰æ•ˆæ€§
   */
  validateConfig(config: DataSourceConfig): ValidationResult

  /**
   * é¢„è§ˆæ˜ å°„ç»“æœ
   */
  previewMapping(
    sourceData: any,
    fieldMapping: { [key: string]: string }
  ): MappingPreviewResult
}
```

### 2. æ•°æ®æ‰§è¡Œå™¨ (DataExecutor)
```typescript
class DataSourceExecutor {
  /**
   * æ‰§è¡Œæ•°æ®æºé…ç½®ï¼Œè¿”å›ç»„ä»¶æ•°æ®
   */
  execute(config: DataSourceConfig): Promise<ComponentData>

  /**
   * å¯åŠ¨å“åº”å¼æ•°æ®ç»‘å®š
   */
  startReactiveBinding(
    config: DataSourceConfig,
    onDataChange: (data: ComponentData) => void
  ): string

  /**
   * åœæ­¢å“åº”å¼ç»‘å®š
   */
  stopReactiveBinding(bindingId: string): void
}
```

### 3. ç»„ä»¶é›†æˆé€‚é…å™¨
```typescript
class ComponentDataAdapter {
  /**
   * é€‚é…åˆ°Visual Editorç»„ä»¶æ ¼å¼
   */
  adaptToVisualEditor(data: ComponentData): VisualEditorProps

  /**
   * é€‚é…åˆ°Card2.1ç»„ä»¶æ ¼å¼
   */
  adaptToCard21(data: ComponentData): Card21Props

  /**
   * é€šç”¨ç»„ä»¶æ•°æ®æ ¼å¼
   */
  adaptToStandard(data: ComponentData): StandardComponentProps
}
```

## ğŸ”„ æ•°æ®æµè®¾è®¡

### 1. é…ç½®é˜¶æ®µ
```
1. ç»„ä»¶æ³¨å†Œæ•°æ®éœ€æ±‚
   â†“
2. é…ç½®å™¨è¯»å–éœ€æ±‚
   â†“
3. ç”¨æˆ·é…ç½®æ•°æ®æº
   â†“
4. ç”Ÿæˆæ ‡å‡†é…ç½®
   â†“
5. ä¿å­˜é…ç½®åˆ°å­˜å‚¨
```

### 2. è¿è¡Œé˜¶æ®µ
```
1. åŠ è½½ç»„ä»¶é…ç½®
   â†“
2. æ‰§è¡Œå™¨å¤„ç†é…ç½®
   â†“
3. è·å–/ç”Ÿæˆæ•°æ®
   â†“
4. åº”ç”¨å­—æ®µæ˜ å°„
   â†“
5. ä¼ é€’ç»™ç»„ä»¶
   â†“
6. è§¦å‘å™¨ç›‘å¬å˜åŒ–
   â†“
7. å¾ªç¯æ›´æ–°æ•°æ®
```

## ğŸ”‘ å…³é”®è®¾è®¡åŸåˆ™

### 1. ç®€åŒ–åŸåˆ™
- **å‡å°‘æŠ½è±¡å±‚æ¬¡**: åªä¿ç•™å¿…è¦çš„æŠ½è±¡
- **é¿å…è¿‡åº¦è®¾è®¡**: ä¸“æ³¨äºæ ¸å¿ƒåŠŸèƒ½
- **æ˜“äºç†è§£**: ä»£ç ç»“æ„æ¸…æ™°ï¼ŒèŒè´£æ˜ç¡®

### 2. å¤ç”¨åŸåˆ™
- **è§¦å‘å™¨ç³»ç»Ÿ**: å®Œå…¨å¤ç”¨Card2.1çš„è§¦å‘å™¨å®ç°
- **å­—æ®µæ˜ å°„**: å€Ÿé‰´Visual Editorçš„JSONè·¯å¾„æ˜ å°„
- **æ•°æ®æº**: å¤ç”¨ç°æœ‰çš„æ•°æ®æºå®ç°

### 3. å…¼å®¹åŸåˆ™
- **å‘åå…¼å®¹**: æ”¯æŒç°æœ‰ç»„ä»¶çš„æ•°æ®æ ¼å¼
- **æ¸è¿›è¿ç§»**: æ–°æ—§ç³»ç»Ÿå¯ä»¥å…±å­˜
- **é€‚é…å™¨æ¨¡å¼**: é€šè¿‡é€‚é…å™¨è¿æ¥ä¸åŒç³»ç»Ÿ

### 4. æ‰©å±•åŸåˆ™
- **æ’ä»¶åŒ–æ•°æ®æº**: æ”¯æŒæ–°çš„æ•°æ®æºç±»å‹
- **å¯é…ç½®è§¦å‘å™¨**: æ”¯æŒçµæ´»çš„è§¦å‘æœºåˆ¶
- **è‡ªå®šä¹‰æ˜ å°„**: æ”¯æŒå¤æ‚çš„å­—æ®µæ˜ å°„

## ğŸš€ å®ç°ä¼˜å…ˆçº§

### Phase 1: æ ¸å¿ƒæ¡†æ¶
1. å®šä¹‰æ ¸å¿ƒæ¥å£
2. å®ç°ç®€åŒ–çš„é…ç½®ç”Ÿæˆå™¨
3. å®ç°åŸºç¡€çš„æ•°æ®æ‰§è¡Œå™¨
4. é›†æˆç°æœ‰è§¦å‘å™¨ç³»ç»Ÿ

### Phase 2: æ•°æ®æºæ”¯æŒ
1. é›†æˆé™æ€æ•°æ®æº
2. é›†æˆAPIæ•°æ®æº
3. é›†æˆWebSocketæ•°æ®æº
4. é›†æˆè„šæœ¬æ•°æ®æº

### Phase 3: ç»„ä»¶é›†æˆ
1. åˆ›å»ºç»„ä»¶é€‚é…å™¨
2. æµ‹è¯•ç°æœ‰ç»„ä»¶å…¼å®¹æ€§
3. åˆ›å»ºæ ‡å‡†ç»„ä»¶æ¥å£
4. æä¾›è¿ç§»å·¥å…·

### Phase 4: é«˜çº§åŠŸèƒ½
1. å­—æ®µæ˜ å°„å¼•æ“
2. é…ç½®éªŒè¯å’Œé¢„è§ˆ
3. æ€§èƒ½ç›‘æ§
4. é”™è¯¯å¤„ç†å’Œæ—¥å¿—

## ğŸ“¦ ç›®å½•ç»“æ„

```
src/core/data-source-system/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ config-generator.ts       # é…ç½®ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ data-executor.ts          # æ•°æ®æ‰§è¡Œå™¨
â”‚   â””â”€â”€ component-adapter.ts      # ç»„ä»¶é€‚é…å™¨
â”œâ”€â”€ data-sources/
â”‚   â”œâ”€â”€ static-data-source.ts     # é™æ€æ•°æ®æº
â”‚   â”œâ”€â”€ api-data-source.ts        # APIæ•°æ®æº
â”‚   â”œâ”€â”€ websocket-data-source.ts  # WebSocketæ•°æ®æº
â”‚   â””â”€â”€ script-data-source.ts     # è„šæœ¬æ•°æ®æº
â”œâ”€â”€ triggers/                     # å¤ç”¨Card2.1è§¦å‘å™¨
â”œâ”€â”€ mapping/
â”‚   â””â”€â”€ field-mapper.ts           # å­—æ®µæ˜ å°„å¼•æ“
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ config.ts                 # é…ç½®ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ component.ts              # ç»„ä»¶ç›¸å…³ç±»å‹
â”‚   â””â”€â”€ data-source.ts            # æ•°æ®æºç›¸å…³ç±»å‹
â”œâ”€â”€ components/                   # UIç»„ä»¶
â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â””â”€â”€ docs/                        # æ–‡æ¡£ç³»ç»Ÿ
```

è¿™ä¸ªæ¶æ„ä¿æŒäº†ç°æœ‰ç³»ç»Ÿçš„æ ¸å¿ƒä»·å€¼ï¼ŒåŒæ—¶å¤§å¹…ç®€åŒ–äº†å¤æ‚åº¦ï¼Œä¾¿äºç†è§£ã€ç»´æŠ¤å’Œæ‰©å±•ã€‚