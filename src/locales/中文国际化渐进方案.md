# ThingsPanel 中文国际化渐进方案

## 🎯 核心思想

**专注中文，分批处理，英文最后** - 避免一次性处理过多内容导致的复杂性和错误

## 📋 方案特点

- ✅ **只处理中文**: 暂时忽略英文翻译，专注中文文案国际化
- ✅ **分批处理**: 每次处理少量文件，确保质量和稳定性
- ✅ **智能生成**: 根据中文内容智能生成语义化的key
- ✅ **自动替换**: 脚本自动完成文案替换和导入添加
- ✅ **渐进式**: 可以随时停止，随时继续，不影响项目运行

## 🚀 三步工作流程

### 第一步：智能提取与键名生成
- 扫描指定的Vue/TS文件
- 提取所有中文文案
- 根据文案内容和上下文智能生成语义化key
- 生成嵌套结构的中文JSON映射文件

### 第二步：自动替换
- 将中文文案替换为 `$t('key')` 调用
- 处理Vue模板插值：`{{ "中文" }}` → `{{ $t('key') }}`
- 处理JavaScript字符串：`"中文"` → `$t('key')`
- 确保语法正确，引号完整

### 第三步：导入添加
- 检测文件是否需要 `$t` 导入
- 自动添加 `import { $t } from '@/locales'`
- 处理Vue文件的setup函数

## 📁 文件组织

```
src/
├── locales/
│   ├── 中文国际化渐进方案.md     # 本方案文档
│   └── langs/
│       └── zh-CN/
│           ├── common.json      # 通用文案 (嵌套结构)
│           ├── page.json        # 页面文案 (嵌套结构)
│           └── index.ts         # 入口文件
scripts/
├── extract-chinese.mjs      # 提取中文文案脚本
└── replace-chinese.mjs      # 替换文案脚本
```

## 🔧 使用方式

### 完整的两步流程
```bash
# 第一步：提取中文文案
node scripts/extract-chinese.mjs src/views/_builtin/login/

# 第二步：替换中文文案
node scripts/replace-chinese.mjs src/views/_builtin/login/
```

### 批量处理模式
```bash
# 处理指定文件
node scripts/extract-chinese.mjs src/views/home/index.vue src/components/common/header.vue
node scripts/replace-chinese.mjs src/views/home/index.vue src/components/common/header.vue

# 处理整个目录
node scripts/extract-chinese.mjs src/views/user/
node scripts/replace-chinese.mjs src/views/user/
```

### 单文件处理模式
```bash
# 处理单个文件
node scripts/extract-chinese.mjs src/views/_builtin/login/index.vue
node scripts/replace-chinese.mjs src/views/_builtin/login/index.vue
```

## 📊 键名生成规则

### 通用文案 (common.json)
```json
{
  "button": {
    "save": "保存",
    "cancel": "取消",
    "confirm": "确认"
  },
  "status": {
    "loading": "加载中",
    "success": "成功"
  },
  "operation": {
    "delete": "删除",
    "edit": "编辑"
  }
}
```

### 页面文案 (page.json)
```json
{
  "login": {
    "title": {
      "pwdLogin": "密码登录",
      "codeLogin": "验证码登录"
    },
    "slogan": "连接万物，智慧生活",
    "form": {
      "enterUsername": "请输入用户名"
    }
  }
}
```

### 智能识别规则
- **按钮类**: 确定、取消、保存、删除等 → `common.button.*`
- **状态类**: 成功、失败、加载中等 → `common.status.*`
- **表单类**: 请输入、请选择等 → `page.{module}.form.*`
- **标题类**: 页面标题、模块名等 → `page.{module}.title.*`
- **内容类**: 其他文案 → `page.{module}.*`

## ✅ 优势

1. **风险可控**: 每次只处理少量文件，出错影响小
2. **质量保证**: 可以仔细检查每批处理结果
3. **灵活性强**: 可以根据实际情况调整策略
4. **易于维护**: 生成的key语义清晰，便于后续维护
5. **渐进式**: 不影响现有功能，可以逐步完善

## 🎯 执行计划

### ✅ 阶段一：登录模块 (已完成)
- ✅ 登录页面 (`src/views/_builtin/login/`)
- ✅ 登录子模块 (`src/views/_builtin/login/modules/`)
- ✅ 处理文件数：5个
- ✅ 替换文案数：5处

### 阶段二：核心组件 (第2-6批)
- 通用组件 (header, footer, menu等)
- 基础表单组件
- 常用按钮和操作

### 阶段三：主要页面 (第7-16批)
- 用户管理页面
- 设备管理页面
- 数据分析页面

### 阶段四：业务页面 (第17-30批)
- 系统设置页面
- 其他业务页面

### 阶段五：英文翻译 (最后阶段)
- 基于完整的中文key结构
- 批量生成英文翻译
- 完善国际化架构

## 📝 注意事项

- 每次处理前先备份 (`git status` 检查)
- 处理后及时测试功能 (`npm run dev`)
- 发现问题立即停止并修复
- 保持键名的一致性和语义性
- 按照两步流程执行：先提取，后替换

## 🚨 常见问题与解决方案

### Vue语法错误：缺少引号
**问题**: `Unquoted attribute value cannot contain U+0022 (")`
**原因**: 替换脚本生成了 `:placeholder=$t('key')` 而不是 `:placeholder="$t('key')"`
**解决**: 
```bash
node scripts/fix-vue-syntax.mjs src/views/_builtin/login/modules/
```

### 键名不规范
**问题**: 生成了像 `"文本"` 这样的非语义化键名
**解决**: 在 `extract-chinese.mjs` 中完善 `textToKey()` 函数的映射

## 🔍 验证方法

### 检查替换效果
```bash
# 启动开发服务器
npm run dev

# 检查页面显示是否正常
# 检查控制台是否有错误
```

### 检查生成的JSON文件
```bash
# 查看生成的键名结构
cat src/locales/langs/zh-CN/common.json
cat src/locales/langs/zh-CN/page.json
```

### 检查替换后的文件
```bash
# 查看替换后的Vue文件
git diff src/views/_builtin/login/index.vue
```

## 🎉 成功案例

**登录模块处理结果**：
- 提取文案：5个
- 生成键名：规范的嵌套结构
- 替换效果：`{{ $t('page.login.slogan') }}` 正确显示
- 项目运行：正常启动，无错误 