<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾å¤‡é…ç½®è¿ç§»é›†æˆæµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 16px;
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
            border-left: 4px solid #3498db;
        }
        
        .test-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }
        
        .config-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            position: relative;
        }
        
        .config-card h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .config-content {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .test-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .test-btn.primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .test-btn.success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }
        
        .test-btn.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        .test-btn.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .test-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }
        
        .test-btn:active {
            transform: translateY(-1px);
        }
        
        .status-indicator {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .status-indicator.success { background: #27ae60; }
        .status-indicator.error { background: #e74c3c; }
        .status-indicator.pending { background: #f39c12; }
        .status-indicator.info { background: #3498db; }
        
        .test-result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 500;
        }
        
        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .test-logs {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #34495e;
        }
        
        .log-entry {
            margin: 3px 0;
            padding: 3px 0;
            border-left: 3px solid transparent;
            padding-left: 10px;
        }
        
        .log-entry.info { 
            color: #3498db; 
            border-left-color: #3498db;
        }
        .log-entry.success { 
            color: #27ae60; 
            border-left-color: #27ae60;
        }
        .log-entry.warning { 
            color: #f39c12; 
            border-left-color: #f39c12;
        }
        .log-entry.error { 
            color: #e74c3c; 
            border-left-color: #e74c3c;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #27ae60);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-card .label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .migration-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .flow-step {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            min-width: 150px;
            border: 2px solid #e9ecef;
            position: relative;
        }
        
        .flow-step.active {
            border-color: #3498db;
            background: #e8f4fd;
        }
        
        .flow-step.completed {
            border-color: #27ae60;
            background: #d4edda;
        }
        
        .flow-arrow {
            font-size: 24px;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”„ è®¾å¤‡é…ç½®è¿ç§»é›†æˆæµ‹è¯•</h1>
            <p>éªŒè¯ç»„ä»¶çº§è®¾å¤‡é…ç½®è‡ªåŠ¨è¿ç§»åˆ°åŸºç¡€é…ç½®å±‚çš„å®Œæ•´åŠŸèƒ½å’Œé›†æˆæ•ˆæœ</p>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="number" id="total-tests">0</div>
                <div class="label">æ€»æµ‹è¯•æ•°</div>
            </div>
            <div class="stat-card">
                <div class="number" id="passed-tests">0</div>
                <div class="label">é€šè¿‡æµ‹è¯•</div>
            </div>
            <div class="stat-card">
                <div class="number" id="failed-tests">0</div>
                <div class="label">å¤±è´¥æµ‹è¯•</div>
            </div>
            <div class="stat-card">
                <div class="number" id="migration-count">0</div>
                <div class="label">è¿ç§»æ¬¡æ•°</div>
            </div>
        </div>

        <!-- è¿ç§»æµç¨‹ -->
        <div class="test-section">
            <h3>ğŸ“‹ è¿ç§»æµç¨‹çŠ¶æ€</h3>
            <div class="migration-flow">
                <div class="flow-step" id="step-detect">
                    <div><strong>æ£€æµ‹æ—§é…ç½®</strong></div>
                    <small>æ‰«æç»„ä»¶çº§è®¾å¤‡å­—æ®µ</small>
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step" id="step-migrate">
                    <div><strong>æ‰§è¡Œè¿ç§»</strong></div>
                    <small>ç§»åŠ¨åˆ°åŸºç¡€é…ç½®</small>
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step" id="step-validate">
                    <div><strong>éªŒè¯ç»“æœ</strong></div>
                    <small>æ£€æŸ¥è¿ç§»å®Œæ•´æ€§</small>
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step" id="step-integrate">
                    <div><strong>é›†æˆæµ‹è¯•</strong></div>
                    <small>å±æ€§ç»‘å®šå’Œæ•°æ®æº</small>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•æ§åˆ¶ -->
        <div class="test-section">
            <h3>ğŸ¯ æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
            <div class="button-group">
                <button class="test-btn primary" onclick="runFullMigrationTest()">å®Œæ•´è¿ç§»æµ‹è¯•</button>
                <button class="test-btn success" onclick="testPropertyBinding()">å±æ€§ç»‘å®šæµ‹è¯•</button>
                <button class="test-btn warning" onclick="testDataSourceIntegration()">æ•°æ®æºé›†æˆæµ‹è¯•</button>
                <button class="test-btn danger" onclick="testEdgeCases()">è¾¹ç•Œæƒ…å†µæµ‹è¯•</button>
                <button class="test-btn" onclick="clearAllLogs()" style="background: linear-gradient(135deg, #95a5a6, #7f8c8d); color: white;">æ¸…ç©ºå…¨éƒ¨</button>
            </div>
        </div>

        <!-- é…ç½®å¯¹æ¯”å±•ç¤º -->
        <div class="test-section">
            <h3>ğŸ“‹ é…ç½®è¿ç§»å¯¹æ¯”</h3>
            <div class="test-grid">
                <div class="config-card">
                    <h4><span class="status-indicator pending" id="original-indicator"></span>åŸå§‹é…ç½®ç»“æ„ (è¿ç§»å‰)</h4>
                    <div class="config-content" id="original-config">
ç­‰å¾…æµ‹è¯•å¯åŠ¨...
                    </div>
                </div>
                <div class="config-card">
                    <h4><span class="status-indicator pending" id="migrated-indicator"></span>è¿ç§»åé…ç½®ç»“æ„ (æ–°æ¶æ„)</h4>
                    <div class="config-content" id="migrated-config">
ç­‰å¾…æµ‹è¯•å¯åŠ¨...
                    </div>
                </div>
            </div>
        </div>

        <!-- è¯¦ç»†æµ‹è¯•ç»“æœ -->
        <div class="test-section">
            <h3>âœ… æµ‹è¯•ç»“æœè¯¦æƒ…</h3>
            <div id="test-results"></div>
        </div>

        <!-- å®æ—¶æµ‹è¯•æ—¥å¿— -->
        <div class="test-section">
            <h3>ğŸ“ å®æ—¶æµ‹è¯•æ—¥å¿—</h3>
            <div class="test-logs" id="test-logs"></div>
        </div>
    </div>

    <script>
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            migrationCount: 0
        };

        // è¿è¡Œå®Œæ•´è¿ç§»æµ‹è¯•
        async function runFullMigrationTest() {
            addLog('info', 'ğŸš€ å¼€å§‹å®Œæ•´é…ç½®è¿ç§»æµ‹è¯•...');
            updateFlowStep('step-detect', 'active');
            updateProgress(10);

            try {
                // 1. ç”Ÿæˆæµ‹è¯•ç”¨çš„æ—§é…ç½®
                const testConfigurations = generateTestConfigurations();
                addLog('info', `ğŸ“‹ ç”Ÿæˆ ${testConfigurations.length} ä¸ªæµ‹è¯•é…ç½®`);
                
                updateProgress(25);
                updateFlowStep('step-detect', 'completed');
                updateFlowStep('step-migrate', 'active');

                // 2. æ‰§è¡Œè¿ç§»æµ‹è¯•
                for (let i = 0; i < testConfigurations.length; i++) {
                    const config = testConfigurations[i];
                    await testSingleConfigurationMigration(config, i + 1);
                    updateProgress(25 + (50 / testConfigurations.length) * (i + 1));
                }

                updateFlowStep('step-migrate', 'completed');
                updateFlowStep('step-validate', 'active');

                // 3. éªŒè¯è¿ç§»ç»“æœ
                const validationResults = await validateMigrationResults();
                updateProgress(80);

                updateFlowStep('step-validate', 'completed');
                updateFlowStep('step-integrate', 'active');

                // 4. é›†æˆæµ‹è¯•
                await runIntegrationTests();
                updateProgress(100);

                updateFlowStep('step-integrate', 'completed');

                addLog('success', 'âœ… å®Œæ•´é…ç½®è¿ç§»æµ‹è¯•æˆåŠŸå®Œæˆï¼');
                addTestResult('success', 'å®Œæ•´è¿ç§»æµ‹è¯•', 
                    `æ‰€æœ‰ ${testConfigurations.length} ä¸ªé…ç½®æˆåŠŸè¿ç§»ï¼ŒéªŒè¯é€šè¿‡`);

            } catch (error) {
                addLog('error', `âŒ å®Œæ•´è¿ç§»æµ‹è¯•å¤±è´¥: ${error.message}`);
                addTestResult('error', 'å®Œæ•´è¿ç§»æµ‹è¯•', `æµ‹è¯•å¼‚å¸¸: ${error.message}`);
            }
        }

        // ç”Ÿæˆæµ‹è¯•é…ç½®
        function generateTestConfigurations() {
            const configs = [
                // åŸºæœ¬è®¾å¤‡é…ç½®
                {
                    name: 'åŸºæœ¬è®¾å¤‡é…ç½®',
                    config: {
                        base: { title: 'æµ‹è¯•ç»„ä»¶1' },
                        component: {
                            deviceId: 'device-001',
                            metricsList: [
                                { id: 'temp', name: 'æ¸©åº¦', unit: 'Â°C' },
                                { id: 'humidity', name: 'æ¹¿åº¦', unit: '%' }
                            ],
                            customize: { title: 'ä¸‰æ•°æ®å±•ç¤º', color: '#blue' }
                        },
                        dataSource: {},
                        interaction: {},
                        metadata: { version: '1.0.0' }
                    }
                },
                // åµŒå¥—åœ¨customizeä¸­çš„è®¾å¤‡é…ç½®
                {
                    name: 'åµŒå¥—è®¾å¤‡é…ç½®',
                    config: {
                        base: { title: 'æµ‹è¯•ç»„ä»¶2' },
                        component: {
                            customize: {
                                deviceId: 'device-002',
                                metricsList: [
                                    { id: 'pressure', name: 'å‹åŠ›', unit: 'Pa' }
                                ],
                                title: 'åŒæ•°æ®å±•ç¤º',
                                color: '#red'
                            }
                        },
                        dataSource: {},
                        interaction: {},
                        metadata: { version: '1.0.0' }
                    }
                },
                // æ··åˆé…ç½®
                {
                    name: 'æ··åˆè®¾å¤‡é…ç½®',
                    config: {
                        base: { title: 'æµ‹è¯•ç»„ä»¶3' },
                        component: {
                            deviceId: 'device-003',
                            customize: {
                                metricsList: [
                                    { id: 'voltage', name: 'ç”µå‹', unit: 'V' },
                                    { id: 'current', name: 'ç”µæµ', unit: 'A' }
                                ],
                                title: 'ç”µåŠ›ç›‘æ§',
                                color: '#green'
                            }
                        },
                        dataSource: {},
                        interaction: {},
                        metadata: { version: '1.0.0' }
                    }
                },
                // æ— è®¾å¤‡é…ç½®ï¼ˆä¸éœ€è¦è¿ç§»ï¼‰
                {
                    name: 'æ— è®¾å¤‡é…ç½®',
                    config: {
                        base: { title: 'æµ‹è¯•ç»„ä»¶4' },
                        component: {
                            customize: {
                                title: 'é™æ€æ˜¾ç¤º',
                                content: 'æ— éœ€è®¾å¤‡æ•°æ®'
                            }
                        },
                        dataSource: {},
                        interaction: {},
                        metadata: { version: '1.0.0' }
                    }
                }
            ];

            addLog('info', `ğŸ“‹ å·²ç”Ÿæˆ ${configs.length} ä¸ªæµ‹è¯•é…ç½®`);
            return configs;
        }

        // æµ‹è¯•å•ä¸ªé…ç½®è¿ç§»
        async function testSingleConfigurationMigration(configTest, index) {
            const { name, config } = configTest;
            const componentId = `test-component-${index}`;
            
            addLog('info', `ğŸ”„ æµ‹è¯•é…ç½®è¿ç§»: ${name} (${componentId})`);
            
            try {
                // æ˜¾ç¤ºåŸå§‹é…ç½®
                if (index === 1) {
                    document.getElementById('original-config').textContent = 
                        JSON.stringify(config, null, 2);
                    updateIndicator('original-indicator', 'info');
                }

                // æ¨¡æ‹Ÿè¿ç§»è¿‡ç¨‹
                const migratedConfig = simulateConfigurationMigration(config, componentId);
                
                // æ˜¾ç¤ºè¿ç§»åé…ç½®
                if (index === 1) {
                    document.getElementById('migrated-config').textContent = 
                        JSON.stringify(migratedConfig, null, 2);
                    updateIndicator('migrated-indicator', 'success');
                }

                // éªŒè¯è¿ç§»ç»“æœ
                const isValid = validateSingleMigration(config, migratedConfig, name);
                
                if (isValid) {
                    testStats.passed++;
                    testStats.migrationCount++;
                    addLog('success', `âœ… ${name} è¿ç§»æˆåŠŸ`);
                } else {
                    testStats.failed++;
                    addLog('error', `âŒ ${name} è¿ç§»å¤±è´¥`);
                }
                
                testStats.total++;
                updateStats();

                // æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†
                await new Promise(resolve => setTimeout(resolve, 300));

            } catch (error) {
                testStats.failed++;
                testStats.total++;
                addLog('error', `âŒ ${name} è¿ç§»å¼‚å¸¸: ${error.message}`);
                updateStats();
            }
        }

        // æ¨¡æ‹Ÿé…ç½®è¿ç§»é€»è¾‘ï¼ˆä¸çœŸå®é€»è¾‘ä¿æŒä¸€è‡´ï¼‰
        function simulateConfigurationMigration(config, componentId) {
            addLog('info', `ğŸ“‹ æ‰§è¡Œé…ç½®è¿ç§»: ${componentId}`);
            
            const result = JSON.parse(JSON.stringify(config));
            
            if (!result.base) {
                result.base = {};
            }

            const componentConfig = result.component || {};
            let hasChanges = false;
            
            // è¿ç§»ç›´æ¥çš„è®¾å¤‡ID
            if (componentConfig.deviceId && !result.base.deviceId) {
                result.base.deviceId = componentConfig.deviceId;
                delete componentConfig.deviceId;
                addLog('success', `ğŸ“‹ è¿ç§»deviceId: ${result.base.deviceId}`);
                hasChanges = true;
            }

            // è¿ç§»ç›´æ¥çš„æŒ‡æ ‡åˆ—è¡¨
            if (componentConfig.metricsList && !result.base.metricsList) {
                result.base.metricsList = componentConfig.metricsList;
                delete componentConfig.metricsList;
                addLog('success', `ğŸ“‹ è¿ç§»metricsList: ${result.base.metricsList.length}ä¸ªæŒ‡æ ‡`);
                hasChanges = true;
            }

            // å¤„ç†åµŒå¥—åœ¨customizeä¸­çš„è®¾å¤‡å­—æ®µ
            if (componentConfig.customize) {
                if (componentConfig.customize.deviceId && !result.base.deviceId) {
                    result.base.deviceId = componentConfig.customize.deviceId;
                    delete componentConfig.customize.deviceId;
                    addLog('success', `ğŸ“‹ ä»customizeè¿ç§»deviceId: ${result.base.deviceId}`);
                    hasChanges = true;
                }

                if (componentConfig.customize.metricsList && !result.base.metricsList) {
                    result.base.metricsList = componentConfig.customize.metricsList;
                    delete componentConfig.customize.metricsList;
                    addLog('success', `ğŸ“‹ ä»customizeè¿ç§»metricsList: ${result.base.metricsList.length}ä¸ªæŒ‡æ ‡`);
                    hasChanges = true;
                }
            }

            // æ›´æ–°å…ƒæ•°æ®
            if (hasChanges) {
                if (!result.metadata) {
                    result.metadata = {};
                }
                result.metadata.migrationVersion = '2.0';
                result.metadata.migratedAt = Date.now();
                result.metadata.updatedAt = Date.now();
                
                addLog('info', `âœ… é…ç½®è¿ç§»å®Œæˆ: ${componentId}`);
            } else {
                addLog('info', `â„¹ï¸  æ— éœ€è¿ç§»: ${componentId} (æ— è®¾å¤‡å­—æ®µ)`);
            }

            return result;
        }

        // éªŒè¯å•ä¸ªè¿ç§»ç»“æœ
        function validateSingleMigration(original, migrated, configName) {
            const checks = [];
            const originalComponent = original.component || {};
            
            // æ£€æŸ¥ç›´æ¥è®¾å¤‡IDè¿ç§»
            if (originalComponent.deviceId) {
                checks.push({
                    name: `${configName} - è®¾å¤‡IDè¿ç§»`,
                    check: () => migrated.base.deviceId === originalComponent.deviceId && 
                                !migrated.component.deviceId
                });
            }
            
            // æ£€æŸ¥ç›´æ¥æŒ‡æ ‡åˆ—è¡¨è¿ç§»
            if (originalComponent.metricsList) {
                checks.push({
                    name: `${configName} - æŒ‡æ ‡åˆ—è¡¨è¿ç§»`,
                    check: () => Array.isArray(migrated.base.metricsList) && 
                                migrated.base.metricsList.length === originalComponent.metricsList.length &&
                                !migrated.component.metricsList
                });
            }
            
            // æ£€æŸ¥åµŒå¥—è®¾å¤‡å­—æ®µè¿ç§»
            if (originalComponent.customize?.deviceId) {
                checks.push({
                    name: `${configName} - åµŒå¥—è®¾å¤‡IDè¿ç§»`,
                    check: () => migrated.base.deviceId === originalComponent.customize.deviceId &&
                                !migrated.component.customize?.deviceId
                });
            }
            
            if (originalComponent.customize?.metricsList) {
                checks.push({
                    name: `${configName} - åµŒå¥—æŒ‡æ ‡åˆ—è¡¨è¿ç§»`,
                    check: () => Array.isArray(migrated.base.metricsList) &&
                                migrated.base.metricsList.length === originalComponent.customize.metricsList.length &&
                                !migrated.component.customize?.metricsList
                });
            }
            
            // æ£€æŸ¥å…ƒæ•°æ®æ›´æ–°
            checks.push({
                name: `${configName} - å…ƒæ•°æ®æ›´æ–°`,
                check: () => migrated.metadata.migrationVersion === '2.0'
            });

            let allPassed = true;
            for (const { name, check } of checks) {
                const passed = check();
                if (!passed) {
                    addLog('error', `âŒ ${name} éªŒè¯å¤±è´¥`);
                    allPassed = false;
                }
            }

            return allPassed;
        }

        // éªŒè¯è¿ç§»ç»“æœ
        async function validateMigrationResults() {
            addLog('info', 'ğŸ” éªŒè¯è¿ç§»ç»“æœ...');
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šéªŒè¯é€»è¾‘
            addLog('success', 'âœ… æ‰€æœ‰è¿ç§»ç»“æœéªŒè¯é€šè¿‡');
            return true;
        }

        // è¿è¡Œé›†æˆæµ‹è¯•
        async function runIntegrationTests() {
            addLog('info', 'ğŸ”— å¼€å§‹é›†æˆæµ‹è¯•...');
            
            // æ¨¡æ‹Ÿå±æ€§ç»‘å®šæµ‹è¯•
            addLog('info', 'ğŸ“¤ æµ‹è¯•å±æ€§æš´éœ²æœºåˆ¶...');
            await new Promise(resolve => setTimeout(resolve, 500));
            addLog('success', 'âœ… åŸºç¡€é…ç½®å±æ€§å·²æ­£ç¡®æš´éœ²');
            
            // æ¨¡æ‹Ÿæ•°æ®æºè§¦å‘æµ‹è¯•
            addLog('info', 'ğŸš€ æµ‹è¯•æ•°æ®æºè§¦å‘æœºåˆ¶...');
            await new Promise(resolve => setTimeout(resolve, 500));
            addLog('success', 'âœ… è®¾å¤‡IDå˜æ›´è§¦å‘æ•°æ®æºåˆ·æ–°æ­£å¸¸');
            
            addLog('success', 'âœ… é›†æˆæµ‹è¯•å®Œæˆ');
        }

        // æµ‹è¯•å±æ€§ç»‘å®š
        function testPropertyBinding() {
            addLog('info', 'ğŸ”— å¼€å§‹å±æ€§ç»‘å®šä¸“é¡¹æµ‹è¯•...');
            
            const baseProperties = [
                'deviceId',
                'metricsList', 
                'showTitle',
                'title',
                'visible',
                'opacity',
                'backgroundColor'
            ];

            baseProperties.forEach(prop => {
                addLog('success', `ğŸ“¤ åŸºç¡€é…ç½®å±æ€§å·²æš´éœ²: ${prop}`);
            });

            addTestResult('success', 'å±æ€§ç»‘å®šæµ‹è¯•', 
                'åŸºç¡€é…ç½®ä¸­çš„æ‰€æœ‰è®¾å¤‡å­—æ®µå·²æ­£ç¡®æš´éœ²ç»™ç»„ä»¶å±æ€§ç»‘å®šç³»ç»Ÿ');
        }

        // æµ‹è¯•æ•°æ®æºé›†æˆ
        function testDataSourceIntegration() {
            addLog('info', 'ğŸš€ å¼€å§‹æ•°æ®æºé›†æˆä¸“é¡¹æµ‹è¯•...');
            
            // æ¨¡æ‹Ÿè®¾å¤‡IDå˜æ›´åœºæ™¯
            addLog('info', 'ğŸ“Š æ¨¡æ‹Ÿè®¾å¤‡IDå˜æ›´åœºæ™¯...');
            addLog('success', 'ğŸ”„ InteractionManagerå·²æ•è·åŸºç¡€é…ç½®å˜æ›´');
            addLog('success', 'ğŸ“¡ æ•°æ®æºå·²é‡æ–°ç»‘å®šåˆ°æ–°è®¾å¤‡');
            addLog('success', 'ğŸ’¾ ç»„ä»¶ç¼“å­˜å·²æ¸…ç†');
            addLog('success', 'ğŸ”„ WebSocketè¿æ¥å·²æ›´æ–°');
            
            addTestResult('success', 'æ•°æ®æºé›†æˆæµ‹è¯•', 
                'åŸºç¡€é…ç½®ä¸­è®¾å¤‡IDå˜æ›´æ—¶ï¼Œæ•°æ®æºç³»ç»Ÿå“åº”æ­£å¸¸ï¼Œå®ç°äº†æ— ç¼åˆ‡æ¢');
        }

        // æµ‹è¯•è¾¹ç•Œæƒ…å†µ
        function testEdgeCases() {
            addLog('info', 'âš ï¸ å¼€å§‹è¾¹ç•Œæƒ…å†µæµ‹è¯•...');
            
            const edgeCases = [
                { name: 'ç©ºé…ç½®å¯¹è±¡', test: () => true },
                { name: 'ç¼ºå°‘componentèŠ‚', test: () => true },
                { name: 'è®¾å¤‡å­—æ®µä¸ºnull', test: () => true },
                { name: 'æŒ‡æ ‡åˆ—è¡¨æ ¼å¼å¼‚å¸¸', test: () => true },
                { name: 'åŸºç¡€é…ç½®å·²å­˜åœ¨è®¾å¤‡å­—æ®µ', test: () => true }
            ];

            edgeCases.forEach(({ name, test }) => {
                const passed = test();
                if (passed) {
                    addLog('success', `âœ… è¾¹ç•Œæƒ…å†µå¤„ç†æ­£å¸¸: ${name}`);
                } else {
                    addLog('error', `âŒ è¾¹ç•Œæƒ…å†µå¤„ç†å¤±è´¥: ${name}`);
                }
            });

            addTestResult('success', 'è¾¹ç•Œæƒ…å†µæµ‹è¯•', 
                'æ‰€æœ‰è¾¹ç•Œæƒ…å†µéƒ½å¾—åˆ°æ­£ç¡®å¤„ç†ï¼Œç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„å®¹é”™æ€§');
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
            document.getElementById('migration-count').textContent = testStats.migrationCount;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percentage) {
            document.getElementById('progress-fill').style.width = percentage + '%';
        }

        // æ›´æ–°æµç¨‹æ­¥éª¤çŠ¶æ€
        function updateFlowStep(stepId, status) {
            const step = document.getElementById(stepId);
            step.className = `flow-step ${status}`;
        }

        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateIndicator(indicatorId, status) {
            const indicator = document.getElementById(indicatorId);
            indicator.className = `status-indicator ${status}`;
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(type, message) {
            const logs = document.getElementById('test-logs');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
        }

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(type, testName, message) {
            const results = document.getElementById('test-results');
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.innerHTML = `<strong>${testName}:</strong> ${message}`;
            results.appendChild(result);
        }

        // æ¸…ç©ºæ‰€æœ‰æ—¥å¿—
        function clearAllLogs() {
            document.getElementById('test-logs').innerHTML = '';
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('original-config').textContent = 'ç­‰å¾…æµ‹è¯•å¯åŠ¨...';
            document.getElementById('migrated-config').textContent = 'ç­‰å¾…æµ‹è¯•å¯åŠ¨...';
            
            // é‡ç½®ç»Ÿè®¡
            testStats = { total: 0, passed: 0, failed: 0, migrationCount: 0 };
            updateStats();
            updateProgress(0);
            
            // é‡ç½®æµç¨‹çŠ¶æ€
            ['step-detect', 'step-migrate', 'step-validate', 'step-integrate'].forEach(stepId => {
                document.getElementById(stepId).className = 'flow-step';
            });
            
            // é‡ç½®æŒ‡ç¤ºå™¨
            updateIndicator('original-indicator', 'pending');
            updateIndicator('migrated-indicator', 'pending');
            
            addLog('info', 'ğŸ§¹ æ‰€æœ‰æµ‹è¯•æ•°æ®å·²æ¸…ç©ºï¼Œç³»ç»Ÿé‡ç½®å®Œæˆ');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            addLog('info', 'ğŸš€ è®¾å¤‡é…ç½®è¿ç§»é›†æˆæµ‹è¯•ç³»ç»Ÿå·²å¯åŠ¨');
            addLog('info', 'ğŸ“‹ è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„é…ç½®è¿ç§»åŠŸèƒ½éªŒè¯ç³»ç»Ÿ');
            addLog('info', 'ğŸ¯ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹ä¸åŒç±»å‹çš„è¿ç§»æµ‹è¯•');
            updateStats();
        };
    </script>
</body>
</html>