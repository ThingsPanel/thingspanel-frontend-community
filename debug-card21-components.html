<!DOCTYPE html>
<html>
<head>
    <title>Card 2.1 ç»„ä»¶è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .log { background: #f0f0f0; padding: 10px; font-family: monospace; }
        button { padding: 10px 15px; margin: 5px; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>Card 2.1 ç»„ä»¶åŠ è½½è°ƒè¯•å·¥å…·</h1>
    
    <div class="section">
        <h2>æ­¥éª¤1: æ£€æŸ¥å¼€å‘æœåŠ¡å™¨</h2>
        <p>å½“å‰é¡µé¢åœ°å€: <span id="currentUrl"></span></p>
        <p>è¯·ç¡®ä¿è®¿é—®: <a href="http://localhost:5006" target="_blank">http://localhost:5006</a></p>
    </div>

    <div class="section">
        <h2>æ­¥éª¤2: è¯Šæ–­Card 2.1ç³»ç»Ÿ</h2>
        <button onclick="debugCard21System()">æ£€æŸ¥Card 2.1ç³»ç»ŸçŠ¶æ€</button>
        <button onclick="debugComponentLoader()">æ£€æŸ¥ç»„ä»¶åŠ è½½å™¨</button>
        <button onclick="debugUniversalDataViz()">ä¸“é¡¹æ£€æŸ¥ universal-data-viz</button>
        <div id="debugOutput" class="log"></div>
    </div>

    <div class="section">
        <h2>æ­¥éª¤3: æ£€æŸ¥Visual Editoré›†æˆ</h2>
        <button onclick="checkVisualEditorIntegration()">æ£€æŸ¥Visual Editoré›†æˆ</button>
        <button onclick="goToVisualEditor()">æ‰“å¼€Visual Editoræµ‹è¯•é¡µé¢</button>
        <div id="editorOutput" class="log"></div>
    </div>

    <script>
        document.getElementById('currentUrl').textContent = window.location.href;

        function log(message, type = 'info') {
            const output = document.getElementById('debugOutput');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            output.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function logEditor(message, type = 'info') {
            const output = document.getElementById('editorOutput');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            output.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        async function debugCard21System() {
            log('ğŸ” å¼€å§‹æ£€æŸ¥Card 2.1ç³»ç»Ÿ...');
            try {
                // å°è¯•å¯¼å…¥Card 2.1æ¨¡å—
                const card21Module = await import('/src/card2.1/index.ts');
                log('âœ… Card 2.1 æ¨¡å—å¯¼å…¥æˆåŠŸ', 'success');
                
                // æ£€æŸ¥ç»„ä»¶æ³¨å†Œè¡¨
                const registry = card21Module.getComponentRegistry();
                log(`ğŸ“Š ç»„ä»¶æ³¨å†Œè¡¨çŠ¶æ€: ${registry ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}`, registry ? 'success' : 'warning');
                
                // åˆå§‹åŒ–ç³»ç»Ÿ
                await card21Module.initializeCard2System();
                log('âœ… Card 2.1 ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success');
                
                // è·å–æ‰€æœ‰ç»„ä»¶
                const allComponents = card21Module.getAllComponents();
                log(`ğŸ“Š æ€»ç»„ä»¶æ•°: ${allComponents.length}`);
                
                // æŸ¥æ‰¾ universal-data-viz
                const universalDataViz = allComponents.find(comp => comp.type === 'universal-data-viz');
                if (universalDataViz) {
                    log('âœ… æ‰¾åˆ° universal-data-viz ç»„ä»¶!', 'success');
                    log(`   - åç§°: ${universalDataViz.name}`);
                    log(`   - åˆ†ç±»: ${universalDataViz.category}`);
                    log(`   - æƒé™: ${universalDataViz.permission}`);
                    log(`   - å·²æ³¨å†Œ: ${universalDataViz.isRegistered}`);
                } else {
                    log('âŒ æœªæ‰¾åˆ° universal-data-viz ç»„ä»¶!', 'error');
                    log('   ç°æœ‰ç»„ä»¶åˆ—è¡¨:');
                    allComponents.forEach(comp => {
                        log(`   - ${comp.type}: ${comp.name} (${comp.category})`);
                    });
                }
                
            } catch (error) {
                log(`âŒ Card 2.1 ç³»ç»Ÿæ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                console.error('Card 2.1 debug error:', error);
            }
        }

        async function debugComponentLoader() {
            log('ğŸ” å¼€å§‹æ£€æŸ¥ç»„ä»¶åŠ è½½å™¨...');
            try {
                const { ComponentLoader } = await import('/src/card2.1/core/component-loader.ts');
                const loader = new ComponentLoader();
                
                const componentModules = await loader.loadComponents();
                const moduleCount = Object.keys(componentModules).length;
                log(`ğŸ“Š åŠ è½½çš„ç»„ä»¶æ¨¡å—æ•°: ${moduleCount}`);
                
                // æ£€æŸ¥ universal-data-viz æ˜¯å¦è¢«åŠ è½½
                const universalDataVizModule = componentModules['universal-data-viz'];
                if (universalDataVizModule) {
                    log('âœ… universal-data-viz æ¨¡å—å·²åŠ è½½', 'success');
                    log(`   - ç»„ä»¶å®šä¹‰: ${universalDataVizModule.default ? 'å­˜åœ¨' : 'ç¼ºå¤±'}`);
                    if (universalDataVizModule.default) {
                        const def = universalDataVizModule.default;
                        log(`   - ç±»å‹: ${def.type}`);
                        log(`   - åç§°: ${def.name}`);
                        log(`   - æƒé™: ${def.permission}`);
                        log(`   - å·²æ³¨å†Œ: ${def.isRegistered}`);
                    }
                } else {
                    log('âŒ universal-data-viz æ¨¡å—æœªè¢«åŠ è½½!', 'error');
                    log('   å·²åŠ è½½çš„æ¨¡å—:');
                    Object.keys(componentModules).forEach(key => {
                        log(`   - ${key}`);
                    });
                }
                
            } catch (error) {
                log(`âŒ ç»„ä»¶åŠ è½½å™¨æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                console.error('ComponentLoader debug error:', error);
            }
        }

        async function debugUniversalDataViz() {
            log('ğŸ¯ ä¸“é¡¹æ£€æŸ¥ universal-data-viz ç»„ä»¶...');
            try {
                // ç›´æ¥å¯¼å…¥ç»„ä»¶å®šä¹‰
                const componentDef = await import('/src/card2.1/components/universal-data-viz/index.ts');
                log('âœ… ç»„ä»¶å®šä¹‰æ–‡ä»¶å¯¼å…¥æˆåŠŸ', 'success');
                
                const def = componentDef.universalDataVizComponentDefinition;
                if (def) {
                    log('âœ… ç»„ä»¶å®šä¹‰å¯¹è±¡å­˜åœ¨', 'success');
                    log(`   - ç±»å‹: ${def.type}`);
                    log(`   - åç§°: ${def.name}`);
                    log(`   - æè¿°: ${def.description}`);
                    log(`   - åˆ†ç±»: ${def.category}`);
                    log(`   - æƒé™: ${def.permission}`);
                    log(`   - å·²æ³¨å†Œ: ${def.isRegistered}`);
                    log(`   - ç»„ä»¶: ${def.component ? 'å­˜åœ¨' : 'ç¼ºå¤±'}`);
                    log(`   - å›¾æ ‡: ${def.icon ? 'å­˜åœ¨' : 'ç¼ºå¤±'}`);
                    
                    // æ£€æŸ¥å¿…éœ€å­—æ®µ
                    const requiredFields = ['type', 'name', 'description', 'category', 'icon', 'component'];
                    const missingFields = requiredFields.filter(field => !def[field]);
                    if (missingFields.length === 0) {
                        log('âœ… æ‰€æœ‰å¿…éœ€å­—æ®µéƒ½å­˜åœ¨', 'success');
                    } else {
                        log(`âš ï¸ ç¼ºå°‘å­—æ®µ: ${missingFields.join(', ')}`, 'warning');
                    }
                } else {
                    log('âŒ ç»„ä»¶å®šä¹‰å¯¹è±¡ä¸å­˜åœ¨!', 'error');
                }
                
            } catch (error) {
                log(`âŒ universal-data-viz æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                console.error('Universal data viz debug error:', error);
            }
        }

        async function checkVisualEditorIntegration() {
            logEditor('ğŸ” æ£€æŸ¥Visual Editoré›†æˆ...');
            try {
                const integrationModule = await import('/src/card2.1/hooks/useVisualEditorIntegration.ts');
                logEditor('âœ… Visual Editoré›†æˆæ¨¡å—å¯¼å…¥æˆåŠŸ', 'success');
                
                // è¿™é‡Œéœ€è¦åœ¨Vueç»„ä»¶ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨hookï¼Œæš‚æ—¶åªèƒ½æ£€æŸ¥æ¨¡å—å¯¼å…¥
                logEditor('â„¹ï¸ éœ€è¦åœ¨Vueç»„ä»¶ä¸­æ£€æŸ¥hookçš„å®é™…è¿è¡Œæƒ…å†µ', 'warning');
                logEditor('è¯·è®¿é—®Visual Editoræµ‹è¯•é¡µé¢æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯');
                
            } catch (error) {
                logEditor(`âŒ Visual Editoré›†æˆæ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                console.error('Visual Editor integration debug error:', error);
            }
        }

        function goToVisualEditor() {
            // åœ¨æ–°çª—å£ä¸­æ‰“å¼€Visual Editoræµ‹è¯•é¡µé¢
            window.open('/test/editor-integration', '_blank');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºæœ¬æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨è¯Šæ–­...');
                debugCard21System();
            }, 1000);
        });
    </script>
</body>
</html>