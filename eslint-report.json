[{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\dual-data-display\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\dual-data-display\\index.vue","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":48,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":48,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":64},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":49,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":49,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":70},{"ruleId":"vue/no-undef-properties","severity":1,"message":"'previewMode' is not defined.","line":108,"column":50,"nodeType":"Identifier","messageId":"undef","endLine":108,"endColumn":61},{"ruleId":"vue/no-undef-properties","severity":1,"message":"'interactionConfigs' is not defined.","line":112,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":112,"endColumn":34},{"ruleId":"no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":130,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":130,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":130,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":130,"endColumn":22},{"ruleId":"vue/no-undef-properties","severity":1,"message":"'componentId' is not defined.","line":188,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":188,"endColumn":35},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is assigned a value but never used.","line":259,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":259,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'value' is assigned a value but never used.","line":259,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":259,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script setup lang=\"ts\">\n/**\n * dual-data-display ä¸»ç»„ä»¶\n * åŸºäºæ–°çš„ä¸‰æ–‡ä»¶ç»“æ„æ ‡å‡†ï¼Œæ”¯æŒ CustomConfig ç±»å‹é…ç½®å’Œå±æ€§ç»‘å®š\n */\n\nimport { computed, reactive, getCurrentInstance, onMounted, onUnmounted } from 'vue'\nimport type { InteractionProps, InteractionEmits } from '@/card2.1/types/interaction-component'\nimport type { DualDataDisplayConfig, DualDataDisplayCustomize } from './settingConfig'\n\n// ç»„ä»¶çŠ¶æ€æ¥å£\ninterface ComponentState {\n  isActive: boolean\n  clickCount: number\n}\n\n// äº¤äº’çŠ¶æ€æ¥å£\ninterface InteractionState {\n  lastInteractionTime: string | null\n  interactionCount: number\n}\n\n// ç»„ä»¶props - æ”¯æŒæ–°çš„CustomConfigç»“æ„\ninterface Props extends InteractionProps {\n  /** æ–°çš„CustomConfigç»“æ„é…ç½® */\n  customConfig?: DualDataDisplayConfig\n  /** å‘åå…¼å®¹ï¼šæ—§çš„configç»“æ„ */\n  config?: Partial<DualDataDisplayCustomize>\n  /** æ•°æ®æº1çš„æ•°æ® */\n  dataSource1?: any\n  /** æ•°æ®æº2çš„æ•°æ® */\n  dataSource2?: any\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  componentId: '',\n  customConfig: undefined,\n  config: () => ({}),\n  allowExternalControl: true,\n  showInteractionIndicator: false,\n  previewMode: false,\n  dataSource1: null,\n  dataSource2: null\n})\n\n// ç»„ä»¶äº‹ä»¶å®šä¹‰ - ç»§æ‰¿äº¤äº’ç³»ç»Ÿæ ‡å‡†äº‹ä»¶\ninterface Emits extends InteractionEmits {\n  (e: 'click', data: { componentId: string; timestamp: string }): void\n  (e: 'hover', data: { componentId: string; type: 'enter' | 'leave' }): void\n}\n\nconst emit = defineEmits<Emits>()\n\n// ç»„ä»¶çŠ¶æ€ç®¡ç†\nconst componentState = reactive<ComponentState>({\n  isActive: true,\n  clickCount: 0\n})\n\n// äº¤äº’çŠ¶æ€ç®¡ç†\nconst interactionState = reactive<InteractionState>({\n  lastInteractionTime: null,\n  interactionCount: 0\n})\n\n/**\n * è·å–ç»„ä»¶é…ç½® - æ”¯æŒæ–°æ—§æ ¼å¼\n * ä¼˜å…ˆä½¿ç”¨ customConfig.customizeï¼Œå›é€€åˆ° config\n */\nconst currentCustomize = computed((): DualDataDisplayCustomize => {\n  // ä¼˜å…ˆä½¿ç”¨æ–°çš„customConfigç»“æ„\n  if (props.customConfig?.customize) {\n    return props.customConfig.customize\n  }\n\n  // å›é€€åˆ°æ—§çš„configç»“æ„ï¼ˆå‘åå…¼å®¹ï¼‰\n  return {\n    title: props.config?.title || 'åŒæ•°æ®å±•ç¤º',\n    themeColor: props.config?.themeColor || '#2080f0',\n    fontSize: props.config?.fontSize || 16,\n    showBorder: props.config?.showBorder ?? true,\n    dataSource1Label: props.config?.dataSource1Label || 'æ•°æ®æºA',\n    dataSource2Label: props.config?.dataSource2Label || 'æ•°æ®æºB',\n    numberFormat: props.config?.numberFormat || 'raw',\n    unit: props.config?.unit || ''\n  }\n})\n\n/**\n * è·å–å˜æ¢é…ç½®\n */\nconst currentTransform = computed(() => {\n  return props.customConfig?.root?.transform || { rotate: 0, scale: 1 }\n})\n\n// è®¡ç®—å±æ€§ï¼šä»customizeä¸­æå–å„ä¸ªå±æ€§\nconst currentTitle = computed(() => currentCustomize.value.title)\nconst themeColor = computed(() => currentCustomize.value.themeColor)\nconst fontSize = computed(() => currentCustomize.value.fontSize)\nconst showBorder = computed(() => currentCustomize.value.showBorder)\nconst dataSource1Label = computed(() => currentCustomize.value.dataSource1Label)\nconst dataSource2Label = computed(() => currentCustomize.value.dataSource2Label)\nconst numberFormat = computed(() => currentCustomize.value.numberFormat)\nconst unit = computed(() => currentCustomize.value.unit)\n\n// è®¡ç®—å±æ€§ï¼šäº¤äº’æŒ‡ç¤ºå™¨\nconst showInteractionIndicator = computed(() => {\n  return props.showInteractionIndicator && props.previewMode && hasActiveInteractions.value\n})\n\nconst hasActiveInteractions = computed(() => {\n  return props.interactionConfigs?.some(config => config.enabled) || false\n})\n\n/**\n * æ•°æ®æ ¼å¼åŒ– - æ”¯æŒå¯¹è±¡æ•°æ®æå–\n */\nconst formatData = (data: any): string => {\n  if (data === null || data === undefined) {\n    return 'æš‚æ— æ•°æ®'\n  }\n\n  // ğŸ”¥ ä¿®å¤ï¼šå¤„ç†å¯¹è±¡ç±»å‹çš„æ•°æ®æº\n  let actualValue = data\n  if (typeof data === 'object' && data !== null) {\n    // ğŸ”¥ æ–°å¢ï¼šå¤„ç† Card2Wrapper ä¼ é€’çš„åµŒå¥—æ•°æ®ç»“æ„ {type: 'json', data: {...}}\n    if (data.type && data.data && typeof data.data === 'object') {\n      // å°è¯•ä»dataå¯¹è±¡ä¸­æå–ç¬¬ä¸€ä¸ªæ•°å€¼å­—æ®µ\n      const dataObj = data.data\n      for (const [key, val] of Object.entries(dataObj)) {\n        if (typeof val === 'number') {\n          actualValue = val\n          break\n        }\n        if (typeof val === 'string' && !isNaN(parseFloat(val as string))) {\n          actualValue = parseFloat(val as string)\n          break\n        }\n      }\n\n      // å¦‚æœdataå¯¹è±¡ä¸­æ²¡æœ‰æ‰¾åˆ°æ•°å€¼ï¼Œæ˜¾ç¤ºç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å€¼\n      if (actualValue === data && Object.keys(dataObj).length > 0) {\n        const firstValue = Object.values(dataObj)[0]\n        actualValue = String(firstValue)\n      }\n    }\n    // ğŸ”¥ ä¿æŒåŸæœ‰é€»è¾‘ï¼šå¤„ç†ç®€å•çš„æ•°æ®å­—æ®µ\n    else if (typeof data.value === 'number' || typeof data.value === 'string') {\n      actualValue = data.value\n    } else if (typeof data.data === 'number' || typeof data.data === 'string') {\n      actualValue = data.data\n    } else if (typeof data.val === 'number' || typeof data.val === 'string') {\n      actualValue = data.val\n    } else if (typeof data.number === 'number' || typeof data.number === 'string') {\n      actualValue = data.number\n    } else {\n      // å¦‚æœæ˜¯çº¯å¯¹è±¡ï¼Œæ˜¾ç¤ºå‹å¥½çš„æç¤º\n      return '[éœ€è¦é…ç½®æ•°æ®å­—æ®µ]'\n    }\n  }\n\n  if (typeof actualValue === 'number') {\n    const num = Number(actualValue)\n    switch (numberFormat.value) {\n      case 'thousands':\n        return num.toLocaleString()\n      case 'decimal2':\n        return num.toFixed(2)\n      case 'percentage':\n        return (num * 100).toFixed(1) + '%'\n      default:\n        return actualValue.toString()\n    }\n  }\n\n  return String(actualValue)\n}\n\n/**\n * æ›´æ–°äº¤äº’çŠ¶æ€\n */\nconst updateInteractionState = (eventType: string) => {\n  interactionState.lastInteractionTime = new Date().toISOString()\n  interactionState.interactionCount++\n\n  // å‘é€äº¤äº’çŠ¶æ€å˜åŒ–äº‹ä»¶\n  emit('interaction-state-change', {\n    componentId: props.componentId || '',\n    state: 'active',\n    lastEventType: eventType as any,\n    timestamp: Date.now()\n  })\n}\n\n/**\n * ç‚¹å‡»å¤„ç† - æ”¯æŒäº¤äº’ç³»ç»Ÿ\n */\nconst handleClick = () => {\n  // æ›´æ–°ç»„ä»¶çŠ¶æ€\n  componentState.clickCount++\n  updateInteractionState('click')\n\n  // å‘é€æ ‡å‡†ç‚¹å‡»äº‹ä»¶\n  emit('click', {\n    componentId: props.componentId || '',\n    timestamp: new Date().toISOString()\n  })\n\n  // å‘é€äº¤äº’äº‹ä»¶ï¼ˆç”¨äºäº¤äº’ç³»ç»Ÿå¤„ç†ï¼‰\n  if (props.previewMode) {\n    emit('interaction-event', 'click', {\n      componentId: props.componentId,\n      clickCount: componentState.clickCount,\n      timestamp: new Date().toISOString()\n    })\n  }\n}\n\n/**\n * æ‚¬åœå¤„ç† - æ”¯æŒäº¤äº’ç³»ç»Ÿ\n */\nconst handleMouseEnter = () => {\n  updateInteractionState('hover')\n\n  emit('hover', {\n    componentId: props.componentId || '',\n    type: 'enter'\n  })\n\n  if (props.previewMode) {\n    emit('interaction-event', 'hover', {\n      componentId: props.componentId,\n      hoverType: 'enter',\n      timestamp: new Date().toISOString()\n    })\n  }\n}\n\nconst handleMouseLeave = () => {\n  emit('hover', {\n    componentId: props.componentId || '',\n    type: 'leave'\n  })\n\n  if (props.previewMode) {\n    emit('interaction-event', 'hover', {\n      componentId: props.componentId,\n      hoverType: 'leave',\n      timestamp: new Date().toISOString()\n    })\n  }\n}\n\n/**\n * ğŸ”¥ æ–°å¢ï¼šç›‘å¬ç»„ä»¶å±æ€§æ›´æ–°äº‹ä»¶\n * æ”¯æŒè·¨ç»„ä»¶å±æ€§ç»‘å®š\n */\nconst handlePropertyUpdate = (event: CustomEvent) => {\n  const { propertyPath, value } = event.detail\n\n  // æ ¹æ®å±æ€§è·¯å¾„æ›´æ–°æœ¬åœ°çŠ¶æ€\n  if (propertyPath.startsWith('customize.')) {\n    // è¿™é‡Œå¯ä»¥æ·»åŠ å“åº”å¼æ›´æ–°é€»è¾‘\n    // ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯computedï¼Œpropå˜åŒ–ä¼šè‡ªåŠ¨è§¦å‘é‡æ–°æ¸²æŸ“\n  }\n}\n\n/**\n * ç»„ä»¶æŒ‚è½½æ—¶ç›‘å¬å±æ€§æ›´æ–°äº‹ä»¶\n */\nonMounted(() => {\n  const element = getCurrentInstance()?.proxy?.$el\n  if (element) {\n    element.addEventListener('componentPropertyUpdate', handlePropertyUpdate)\n  }\n})\n\n/**\n * ç»„ä»¶å¸è½½æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬\n */\nonUnmounted(() => {\n  const element = getCurrentInstance()?.proxy?.$el\n  if (element) {\n    element.removeEventListener('componentPropertyUpdate', handlePropertyUpdate)\n  }\n})\n</script>\n\n<template>\n  <div\n    class=\"dual-data-display\"\n    :class=\"{\n      'interaction-active': hasActiveInteractions,\n      'preview-mode': previewMode,\n      'show-indicator': showInteractionIndicator,\n      'show-border': showBorder\n    }\"\n    :style=\"{\n      '--theme-color': themeColor,\n      '--font-size': `${fontSize}px`,\n      transform: `rotate(${currentTransform.rotate}deg) scale(${currentTransform.scale})`\n    }\"\n    :data-component-id=\"componentId\"\n    @click=\"handleClick\"\n    @mouseenter=\"handleMouseEnter\"\n    @mouseleave=\"handleMouseLeave\"\n  >\n    <div class=\"header\">\n      <h3>{{ currentTitle }}</h3>\n    </div>\n\n    <div class=\"content-section\">\n      <div class=\"data-grid\">\n        <!-- æ•°æ®æº1 -->\n        <div class=\"data-item\">\n          <div class=\"data-label\">{{ dataSource1Label }}</div>\n          <div class=\"data-value\">\n            {{ formatData(dataSource1) }}\n            <span v-if=\"unit\" class=\"data-unit\">{{ unit }}</span>\n          </div>\n        </div>\n\n        <!-- æ•°æ®æº2 -->\n        <div class=\"data-item\">\n          <div class=\"data-label\">{{ dataSource2Label }}</div>\n          <div class=\"data-value\">\n            {{ formatData(dataSource2) }}\n            <span v-if=\"unit\" class=\"data-unit\">{{ unit }}</span>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"info-panel\">\n        <div class=\"info-item\">\n          <span class=\"label\">ç»„ä»¶ç±»å‹:</span>\n          <span class=\"value\">åŒæ•°æ®å±•ç¤º</span>\n        </div>\n        <div class=\"info-item\">\n          <span class=\"label\">æ•°æ®æ ¼å¼:</span>\n          <span class=\"value\">{{ numberFormat }}</span>\n        </div>\n        <div class=\"info-item\">\n          <span class=\"label\">çŠ¶æ€:</span>\n          <span class=\"value status-ready\">å°±ç»ª</span>\n        </div>\n      </div>\n    </div>\n\n    <!-- äº¤äº’æŒ‡ç¤ºå™¨ -->\n    <div v-if=\"showInteractionIndicator\" class=\"interaction-indicator\">\n      <div class=\"indicator-dot\"></div>\n      <span class=\"indicator-text\">æ”¯æŒäº¤äº’</span>\n    </div>\n\n    <!-- ç»„ä»¶ä¿¡æ¯å’ŒçŠ¶æ€ -->\n    <div class=\"component-info\">\n      <div class=\"basic-info\">\n        <small>ç»„ä»¶ID: {{ props.componentId || 'æœªè®¾ç½®' }}</small>\n      </div>\n\n      <!-- å¼€å‘/è°ƒè¯•æ¨¡å¼ä¸‹æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯ -->\n      <div v-if=\"previewMode\" class=\"state-info\">\n        <div class=\"state-item\">\n          <small>ç‚¹å‡»æ¬¡æ•°: {{ componentState.clickCount }}</small>\n        </div>\n        <div class=\"state-item\">\n          <small>äº¤äº’æ¬¡æ•°: {{ interactionState.interactionCount }}</small>\n        </div>\n        <div v-if=\"interactionState.lastInteractionTime\" class=\"state-item\">\n          <small>æœ€åäº¤äº’: {{ new Date(interactionState.lastInteractionTime).toLocaleTimeString() }}</small>\n        </div>\n      </div>\n\n      <!-- ğŸ”¥ æ–°å¢ï¼šé…ç½®ç»“æ„ä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼‰ -->\n      <div v-if=\"previewMode\" class=\"config-debug\">\n        <small>é…ç½®ç±»å‹: {{ customConfig ? 'CustomConfig' : 'Legacy Config' }}</small>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.dual-data-display {\n  padding: 20px;\n  background: var(--card-color);\n  border-radius: var(--border-radius);\n  font-size: var(--font-size, 16px);\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  position: relative;\n}\n\n.dual-data-display.show-border {\n  border: 1px solid var(--border-color);\n}\n\n.dual-data-display:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  border-color: var(--theme-color);\n}\n\n/* äº¤äº’æ¿€æ´»çŠ¶æ€ */\n.dual-data-display.interaction-active {\n  position: relative;\n}\n\n.dual-data-display.interaction-active:hover {\n  border-color: var(--success-color);\n  box-shadow: 0 4px 16px rgba(24, 160, 88, 0.2);\n}\n\n.header {\n  margin-bottom: 20px;\n  padding-bottom: 12px;\n  border-bottom: 2px solid var(--theme-color);\n}\n\n.header h3 {\n  margin: 0;\n  color: var(--text-color);\n  font-size: calc(var(--font-size, 16px) + 4px);\n  font-weight: bold;\n}\n\n.content-section {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.data-grid {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 20px;\n}\n\n.data-item {\n  padding: 16px;\n  background: var(--body-color);\n  border-radius: 6px;\n  border-left: 4px solid var(--theme-color);\n  text-align: center;\n}\n\n.data-label {\n  font-size: calc(var(--font-size, 16px) - 2px);\n  color: var(--text-color-2);\n  margin-bottom: 8px;\n  font-weight: 500;\n}\n\n.data-value {\n  font-size: calc(var(--font-size, 16px) + 6px);\n  color: var(--text-color);\n  font-weight: bold;\n  word-break: break-all;\n}\n\n.data-unit {\n  font-size: calc(var(--font-size, 16px) + 2px);\n  color: var(--text-color-2);\n  margin-left: 4px;\n}\n\n.info-panel {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  padding: 16px;\n  background: var(--body-color);\n  border-radius: 6px;\n}\n\n.info-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 8px 0;\n}\n\n.info-item .label {\n  color: var(--text-color-2);\n  font-weight: 500;\n}\n\n.info-item .value {\n  color: var(--text-color);\n  font-weight: bold;\n}\n\n.status-ready {\n  color: var(--success-color) !important;\n}\n\n/* äº¤äº’æŒ‡ç¤ºå™¨ */\n.interaction-indicator {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 8px;\n  background: var(--success-color);\n  color: white;\n  font-size: 10px;\n  border-radius: 12px;\n  opacity: 0.8;\n  transition: all 0.3s ease;\n}\n\n.dual-data-display:hover .interaction-indicator {\n  opacity: 1;\n  transform: scale(1.05);\n}\n\n.indicator-dot {\n  width: 6px;\n  height: 6px;\n  background: white;\n  border-radius: 50%;\n  animation: indicator-blink 1.5s infinite;\n}\n\n@keyframes indicator-blink {\n  0%,\n  50% {\n    opacity: 1;\n  }\n  51%,\n  100% {\n    opacity: 0.3;\n  }\n}\n\n.indicator-text {\n  font-weight: 500;\n  letter-spacing: 0.5px;\n}\n\n/* ç»„ä»¶ä¿¡æ¯åŒºåŸŸ */\n.component-info {\n  margin-top: 16px;\n  padding-top: 12px;\n  border-top: 1px solid var(--border-color);\n  color: var(--text-color-3);\n  font-size: calc(var(--font-size, 16px) - 4px);\n}\n\n.basic-info {\n  text-align: center;\n  margin-bottom: 8px;\n}\n\n/* çŠ¶æ€ä¿¡æ¯ */\n.state-info {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  justify-content: center;\n  padding: 8px;\n  background: var(--body-color);\n  border-radius: 4px;\n  border: 1px solid var(--border-color);\n  margin-bottom: 8px;\n}\n\n.state-item {\n  padding: 2px 6px;\n  background: var(--tag-color, var(--card-color));\n  border-radius: 3px;\n  font-size: 10px;\n  color: var(--text-color-2);\n}\n\n.state-item small {\n  font-weight: 500;\n}\n\n/* é…ç½®è°ƒè¯•ä¿¡æ¯ */\n.config-debug {\n  text-align: center;\n  padding: 4px 8px;\n  background: var(--info-color-suppl);\n  border-radius: 4px;\n  font-size: 10px;\n  color: var(--info-color);\n  font-weight: 500;\n}\n\n/* å“åº”å¼è®¾è®¡ */\n@media (max-width: 600px) {\n  .dual-data-display {\n    padding: 16px;\n  }\n\n  .data-grid {\n    grid-template-columns: 1fr;\n    gap: 16px;\n  }\n\n  .info-item {\n    flex-direction: column;\n    gap: 4px;\n    text-align: center;\n  }\n}\n</style>\n","usedDeprecatedRules":[{"ruleId":"vue/component-tags-order","replacedBy":["block-order"]}]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\dual-data-display\\setting.vue","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":32,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":32,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":57},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":33,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":33,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":53},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":34,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":34,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":45},{"ruleId":"no-unused-vars","severity":1,"message":"'oldValue' is defined but never used.","line":34,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":78},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":35,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":35,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<template>\n  <div class=\"dual-data-display-setting\">\n    <AutoFormGenerator\n      :setting-config=\"settingConfig\"\n      :model-value=\"localConfig\"\n      @update:model-value=\"handleConfigChange\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n/**\n * dual-data-display ç»„ä»¶è®¾ç½®é¢æ¿\n * åŸºäº settingConfig è‡ªåŠ¨ç”Ÿæˆè®¾ç½®ç•Œé¢\n */\n\nimport { reactive, watch, nextTick } from 'vue'\nimport { dualDataDisplaySettingConfig } from './settingConfig'\nimport type { DualDataDisplayConfig } from './settingConfig'\nimport AutoFormGenerator from '@/card2.1/core/AutoFormGenerator.vue'\n\n// Propsæ¥å£\ninterface Props {\n  modelValue?: DualDataDisplayConfig\n  config?: DualDataDisplayConfig\n  widget?: any\n  readonly?: boolean\n}\n\n// Emitsæ¥å£\ninterface Emits {\n  (e: 'update:modelValue', config: DualDataDisplayConfig): void\n  (e: 'update:config', config: DualDataDisplayConfig): void\n  (e: 'change', value: DualDataDisplayConfig, oldValue: DualDataDisplayConfig): void\n  (e: 'update', config: DualDataDisplayConfig): void\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  readonly: false\n})\n\nconst emit = defineEmits<Emits>()\n\n// è®¾ç½®é…ç½®\nconst settingConfig = dualDataDisplaySettingConfig\n\n// è·å–é»˜è®¤é…ç½®\nconst getDefaultConfig = (): DualDataDisplayConfig => ({\n  ...settingConfig.customConfig\n})\n\n// æœ¬åœ°é…ç½®çŠ¶æ€\nconst localConfig = reactive<DualDataDisplayConfig>(props.modelValue || props.config || getDefaultConfig())\n\n// é˜²å¾ªç¯æ›´æ–°æ ‡å¿—\nlet isUpdatingFromProps = false\n\n/**\n * é…ç½®å˜æ›´å¤„ç†\n */\nconst handleConfigChange = (newConfig: DualDataDisplayConfig) => {\n  if (isUpdatingFromProps) return\n\n  // æ›´æ–°æœ¬åœ°é…ç½®\n  Object.assign(localConfig, newConfig)\n\n  // å‘é€æ›´æ–°äº‹ä»¶\n  emit('update:modelValue', { ...localConfig })\n  emit('update:config', { ...localConfig })\n  emit('change', { ...localConfig }, { ...localConfig })\n  emit('update', { ...localConfig })\n}\n\n/**\n * ç›‘å¬propsé…ç½®å˜åŒ–\n */\nwatch(\n  [() => props.modelValue, () => props.config],\n  ([newModelValue, newConfig]) => {\n    if (isUpdatingFromProps) return\n\n    const sourceConfig = newModelValue || newConfig\n    if (sourceConfig) {\n      isUpdatingFromProps = true\n      try {\n        // åˆå¹¶é…ç½®ï¼Œä¿æŒå®Œæ•´çš„ç»“æ„\n        const mergedConfig = {\n          ...getDefaultConfig(),\n          ...sourceConfig,\n          customize: {\n            ...getDefaultConfig().customize,\n            ...sourceConfig.customize\n          }\n        }\n\n        Object.assign(localConfig, mergedConfig)\n      } finally {\n        nextTick(() => {\n          setTimeout(() => {\n            isUpdatingFromProps = false\n          }, 10)\n        })\n      }\n    }\n  },\n  { deep: true, immediate: true }\n)\n</script>\n\n<style scoped>\n.dual-data-display-setting {\n  padding: 16px;\n}\n\n/* ä¸ºAutoFormGeneratoræä¾›æ ·å¼æ”¯æŒ */\n:deep(.auto-form-generator) {\n  width: 100%;\n}\n\n:deep(.n-form-item) {\n  margin-bottom: 16px;\n}\n\n:deep(.n-form-item-label) {\n  font-weight: 500;\n  color: var(--text-color-2);\n}\n\n:deep(.form-group) {\n  margin-bottom: 20px;\n}\n\n:deep(.form-group-title) {\n  font-size: 14px;\n  font-weight: 600;\n  color: var(--text-color);\n  margin-bottom: 12px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid var(--border-color);\n}\n</style>\n","usedDeprecatedRules":[{"ruleId":"vue/component-tags-order","replacedBy":["block-order"]}]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\dual-data-display\\settingConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\simple-display\\definition.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\simple-display\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\simple-display\\index.vue","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":42,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":42,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":64},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":43,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":43,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":70},{"ruleId":"vue/no-undef-properties","severity":1,"message":"'previewMode' is not defined.","line":98,"column":50,"nodeType":"Identifier","messageId":"undef","endLine":98,"endColumn":61},{"ruleId":"vue/no-undef-properties","severity":1,"message":"'interactionConfigs' is not defined.","line":102,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":102,"endColumn":34},{"ruleId":"vue/no-undef-properties","severity":1,"message":"'componentId' is not defined.","line":114,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":114,"endColumn":35},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is assigned a value but never used.","line":185,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":185,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'value' is assigned a value but never used.","line":185,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":185,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<script setup lang=\"ts\">\n/**\n * simple-display ä¸»ç»„ä»¶\n * åŸºäºæ–°çš„ä¸‰æ–‡ä»¶ç»“æ„æ ‡å‡†ï¼Œæ”¯æŒ CustomConfig ç±»å‹é…ç½®å’Œå±æ€§ç»‘å®š\n */\n\nimport { computed, reactive, getCurrentInstance, onMounted, onUnmounted } from 'vue'\nimport type { InteractionProps, InteractionEmits } from '@/card2.1/types/interaction-component'\nimport type { SimpleDisplayConfig, SimpleDisplayCustomize } from './settingConfig'\n\n// ç»„ä»¶çŠ¶æ€æ¥å£\ninterface ComponentState {\n  isActive: boolean\n  clickCount: number\n}\n\n// äº¤äº’çŠ¶æ€æ¥å£\ninterface InteractionState {\n  lastInteractionTime: string | null\n  interactionCount: number\n}\n\n// ç»„ä»¶props - æ”¯æŒæ–°çš„CustomConfigç»“æ„\ninterface Props extends InteractionProps {\n  /** æ–°çš„CustomConfigç»“æ„é…ç½® */\n  customConfig?: SimpleDisplayConfig\n  /** å‘åå…¼å®¹ï¼šæ—§çš„configç»“æ„ */\n  config?: Partial<SimpleDisplayCustomize>\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  componentId: '',\n  customConfig: undefined,\n  config: () => ({}),\n  allowExternalControl: true,\n  showInteractionIndicator: false,\n  previewMode: false\n})\n\n// ç»„ä»¶äº‹ä»¶å®šä¹‰ - ç»§æ‰¿äº¤äº’ç³»ç»Ÿæ ‡å‡†äº‹ä»¶\ninterface Emits extends InteractionEmits {\n  (e: 'click', data: { componentId: string; timestamp: string }): void\n  (e: 'hover', data: { componentId: string; type: 'enter' | 'leave' }): void\n}\n\nconst emit = defineEmits<Emits>()\n\n// ç»„ä»¶çŠ¶æ€ç®¡ç†\nconst componentState = reactive<ComponentState>({\n  isActive: true,\n  clickCount: 0\n})\n\n// äº¤äº’çŠ¶æ€ç®¡ç†\nconst interactionState = reactive<InteractionState>({\n  lastInteractionTime: null,\n  interactionCount: 0\n})\n\n/**\n * è·å–ç»„ä»¶é…ç½® - æ”¯æŒæ–°æ—§æ ¼å¼\n * ä¼˜å…ˆä½¿ç”¨ customConfig.customizeï¼Œå›é€€åˆ° config\n */\nconst currentCustomize = computed((): SimpleDisplayCustomize => {\n  // ä¼˜å…ˆä½¿ç”¨æ–°çš„customConfigç»“æ„\n  if (props.customConfig?.customize) {\n    return props.customConfig.customize\n  }\n\n  // å›é€€åˆ°æ—§çš„configç»“æ„ï¼ˆå‘åå…¼å®¹ï¼‰\n  return {\n    title: props.config?.title || 'ç®€å•å±•ç¤ºç»„ä»¶',\n    content: props.config?.content || 'è¿™æ˜¯ä¸€ä¸ªé™æ€å±•ç¤ºç»„ä»¶ï¼Œä¸éœ€è¦æ•°æ®æº',\n    themeColor: props.config?.themeColor || '#2080f0',\n    fontSize: props.config?.fontSize || 16,\n    showIcon: props.config?.showIcon ?? true,\n    iconName: props.config?.iconName || 'ğŸ“Š'\n  }\n})\n\n/**\n * è·å–å˜æ¢é…ç½®\n */\nconst currentTransform = computed(() => {\n  return props.customConfig?.root?.transform || { rotate: 0, scale: 1 }\n})\n\n// è®¡ç®—å±æ€§ï¼šä»customizeä¸­æå–å„ä¸ªå±æ€§\nconst currentTitle = computed(() => currentCustomize.value.title)\nconst currentContent = computed(() => currentCustomize.value.content)\nconst themeColor = computed(() => currentCustomize.value.themeColor)\nconst fontSize = computed(() => currentCustomize.value.fontSize)\nconst showIcon = computed(() => currentCustomize.value.showIcon)\nconst iconName = computed(() => currentCustomize.value.iconName)\n\n// è®¡ç®—å±æ€§ï¼šäº¤äº’æŒ‡ç¤ºå™¨\nconst showInteractionIndicator = computed(() => {\n  return props.showInteractionIndicator && props.previewMode && hasActiveInteractions.value\n})\n\nconst hasActiveInteractions = computed(() => {\n  return props.interactionConfigs?.some(config => config.enabled) || false\n})\n\n/**\n * æ›´æ–°äº¤äº’çŠ¶æ€\n */\nconst updateInteractionState = (eventType: string) => {\n  interactionState.lastInteractionTime = new Date().toISOString()\n  interactionState.interactionCount++\n\n  // å‘é€äº¤äº’çŠ¶æ€å˜åŒ–äº‹ä»¶\n  emit('interaction-state-change', {\n    componentId: props.componentId || '',\n    state: 'active',\n    lastEventType: eventType as any,\n    timestamp: Date.now()\n  })\n}\n\n/**\n * ç‚¹å‡»å¤„ç† - æ”¯æŒäº¤äº’ç³»ç»Ÿ\n */\nconst handleClick = () => {\n  // æ›´æ–°ç»„ä»¶çŠ¶æ€\n  componentState.clickCount++\n  updateInteractionState('click')\n\n  // å‘é€æ ‡å‡†ç‚¹å‡»äº‹ä»¶\n  emit('click', {\n    componentId: props.componentId || '',\n    timestamp: new Date().toISOString()\n  })\n\n  // å‘é€äº¤äº’äº‹ä»¶ï¼ˆç”¨äºäº¤äº’ç³»ç»Ÿå¤„ç†ï¼‰\n  if (props.previewMode) {\n    emit('interaction-event', 'click', {\n      componentId: props.componentId,\n      clickCount: componentState.clickCount,\n      timestamp: new Date().toISOString()\n    })\n  }\n}\n\n/**\n * æ‚¬åœå¤„ç† - æ”¯æŒäº¤äº’ç³»ç»Ÿ\n */\nconst handleMouseEnter = () => {\n  updateInteractionState('hover')\n\n  emit('hover', {\n    componentId: props.componentId || '',\n    type: 'enter'\n  })\n\n  if (props.previewMode) {\n    emit('interaction-event', 'hover', {\n      componentId: props.componentId,\n      hoverType: 'enter',\n      timestamp: new Date().toISOString()\n    })\n  }\n}\n\nconst handleMouseLeave = () => {\n  emit('hover', {\n    componentId: props.componentId || '',\n    type: 'leave'\n  })\n\n  if (props.previewMode) {\n    emit('interaction-event', 'hover', {\n      componentId: props.componentId,\n      hoverType: 'leave',\n      timestamp: new Date().toISOString()\n    })\n  }\n}\n\n/**\n * ğŸ”¥ æ–°å¢ï¼šç›‘å¬ç»„ä»¶å±æ€§æ›´æ–°äº‹ä»¶\n * æ”¯æŒè·¨ç»„ä»¶å±æ€§ç»‘å®š\n */\nconst handlePropertyUpdate = (event: CustomEvent) => {\n  const { propertyPath, value } = event.detail\n\n  // æ ¹æ®å±æ€§è·¯å¾„æ›´æ–°æœ¬åœ°çŠ¶æ€\n  if (propertyPath.startsWith('customize.')) {\n    // è¿™é‡Œå¯ä»¥æ·»åŠ å“åº”å¼æ›´æ–°é€»è¾‘\n    // ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯computedï¼Œpropå˜åŒ–ä¼šè‡ªåŠ¨è§¦å‘é‡æ–°æ¸²æŸ“\n  }\n}\n\n/**\n * ç»„ä»¶æŒ‚è½½æ—¶ç›‘å¬å±æ€§æ›´æ–°äº‹ä»¶\n */\nonMounted(() => {\n  const element = getCurrentInstance()?.proxy?.$el\n  if (element) {\n    element.addEventListener('componentPropertyUpdate', handlePropertyUpdate)\n  }\n})\n\n/**\n * ç»„ä»¶å¸è½½æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬\n */\nonUnmounted(() => {\n  const element = getCurrentInstance()?.proxy?.$el\n  if (element) {\n    element.removeEventListener('componentPropertyUpdate', handlePropertyUpdate)\n  }\n})\n</script>\n\n<template>\n  <div\n    class=\"simple-display\"\n    :class=\"{\n      'interaction-active': hasActiveInteractions,\n      'preview-mode': previewMode,\n      'show-indicator': showInteractionIndicator\n    }\"\n    :style=\"{\n      '--theme-color': themeColor,\n      '--font-size': `${fontSize}px`,\n      transform: `rotate(${currentTransform.rotate}deg) scale(${currentTransform.scale})`\n    }\"\n    :data-component-id=\"componentId\"\n    @click=\"handleClick\"\n    @mouseenter=\"handleMouseEnter\"\n    @mouseleave=\"handleMouseLeave\"\n  >\n    <div class=\"header\">\n      <div class=\"title-section\">\n        <span v-if=\"showIcon\" class=\"icon\">{{ iconName }}</span>\n        <h3>{{ currentTitle }}</h3>\n      </div>\n    </div>\n\n    <div class=\"content-section\">\n      <p class=\"main-content\">{{ currentContent }}</p>\n\n      <div class=\"info-panel\">\n        <div class=\"info-item\">\n          <span class=\"label\">ç»„ä»¶ç±»å‹:</span>\n          <span class=\"value\">é™æ€å±•ç¤º</span>\n        </div>\n        <div class=\"info-item\">\n          <span class=\"label\">æ•°æ®æº:</span>\n          <span class=\"value\">æ— éœ€æ•°æ®æº</span>\n        </div>\n        <div class=\"info-item\">\n          <span class=\"label\">çŠ¶æ€:</span>\n          <span class=\"value status-ready\">å°±ç»ª</span>\n        </div>\n      </div>\n    </div>\n\n    <!-- äº¤äº’æŒ‡ç¤ºå™¨ -->\n    <div v-if=\"showInteractionIndicator\" class=\"interaction-indicator\">\n      <div class=\"indicator-dot\"></div>\n      <span class=\"indicator-text\">æ”¯æŒäº¤äº’</span>\n    </div>\n\n    <!-- ç»„ä»¶ä¿¡æ¯å’ŒçŠ¶æ€ -->\n    <div class=\"component-info\">\n      <div class=\"basic-info\">\n        <small>ç»„ä»¶ID: {{ props.componentId || 'æœªè®¾ç½®' }}</small>\n      </div>\n\n      <!-- å¼€å‘/è°ƒè¯•æ¨¡å¼ä¸‹æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯ -->\n      <div v-if=\"previewMode\" class=\"state-info\">\n        <div class=\"state-item\">\n          <small>ç‚¹å‡»æ¬¡æ•°: {{ componentState.clickCount }}</small>\n        </div>\n        <div class=\"state-item\">\n          <small>äº¤äº’æ¬¡æ•°: {{ interactionState.interactionCount }}</small>\n        </div>\n        <div v-if=\"interactionState.lastInteractionTime\" class=\"state-item\">\n          <small>æœ€åäº¤äº’: {{ new Date(interactionState.lastInteractionTime).toLocaleTimeString() }}</small>\n        </div>\n      </div>\n\n      <!-- ğŸ”¥ æ–°å¢ï¼šé…ç½®ç»“æ„ä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼‰ -->\n      <div v-if=\"previewMode\" class=\"config-debug\">\n        <small>é…ç½®ç±»å‹: {{ customConfig ? 'CustomConfig' : 'Legacy Config' }}</small>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.simple-display {\n  padding: 20px;\n  background: var(--card-color);\n  border: 1px solid var(--border-color);\n  border-radius: var(--border-radius);\n  font-size: var(--font-size, 16px);\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  position: relative; /* ä¸ºå±æ€§ç»‘å®šäº‹ä»¶å®šä½ */\n}\n\n.simple-display:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  border-color: var(--theme-color);\n}\n\n/* äº¤äº’æ¿€æ´»çŠ¶æ€ */\n.simple-display.interaction-active {\n  position: relative;\n}\n\n.simple-display.interaction-active:hover {\n  border-color: var(--success-color);\n  box-shadow: 0 4px 16px rgba(24, 160, 88, 0.2);\n}\n\n/* é¢„è§ˆæ¨¡å¼æ ·å¼ */\n.simple-display.preview-mode.interaction-active {\n  cursor: pointer;\n}\n\n.simple-display.preview-mode.interaction-active::before {\n  content: '';\n  position: absolute;\n  top: -2px;\n  left: -2px;\n  right: -2px;\n  bottom: -2px;\n  border: 2px solid transparent;\n  border-radius: calc(var(--border-radius) + 2px);\n  transition: all 0.3s ease;\n}\n\n.simple-display.preview-mode.interaction-active:hover::before {\n  border-color: var(--success-color);\n  animation: interaction-pulse 2s infinite;\n}\n\n@keyframes interaction-pulse {\n  0%,\n  100% {\n    border-color: var(--success-color);\n    opacity: 1;\n  }\n  50% {\n    border-color: var(--info-color);\n    opacity: 0.6;\n  }\n}\n\n.header {\n  margin-bottom: 20px;\n  padding-bottom: 12px;\n  border-bottom: 2px solid var(--theme-color);\n}\n\n.title-section {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.icon {\n  font-size: calc(var(--font-size, 16px) + 8px);\n  color: var(--theme-color);\n}\n\n.title-section h3 {\n  margin: 0;\n  color: var(--text-color);\n  font-size: calc(var(--font-size, 16px) + 4px);\n  font-weight: bold;\n}\n\n.content-section {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.main-content {\n  margin: 0;\n  color: var(--text-color);\n  line-height: 1.6;\n  padding: 16px;\n  background: var(--body-color);\n  border-radius: 6px;\n  border-left: 4px solid var(--theme-color);\n}\n\n.info-panel {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  padding: 16px;\n  background: var(--body-color);\n  border-radius: 6px;\n}\n\n.info-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 8px 0;\n}\n\n.info-item .label {\n  color: var(--text-color-2);\n  font-weight: 500;\n}\n\n.info-item .value {\n  color: var(--text-color);\n  font-weight: bold;\n}\n\n.status-ready {\n  color: var(--success-color) !important;\n}\n\n/* äº¤äº’æŒ‡ç¤ºå™¨ */\n.interaction-indicator {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 8px;\n  background: var(--success-color);\n  color: white;\n  font-size: 10px;\n  border-radius: 12px;\n  opacity: 0.8;\n  transition: all 0.3s ease;\n}\n\n.simple-display:hover .interaction-indicator {\n  opacity: 1;\n  transform: scale(1.05);\n}\n\n.indicator-dot {\n  width: 6px;\n  height: 6px;\n  background: white;\n  border-radius: 50%;\n  animation: indicator-blink 1.5s infinite;\n}\n\n@keyframes indicator-blink {\n  0%,\n  50% {\n    opacity: 1;\n  }\n  51%,\n  100% {\n    opacity: 0.3;\n  }\n}\n\n.indicator-text {\n  font-weight: 500;\n  letter-spacing: 0.5px;\n}\n\n/* ç»„ä»¶ä¿¡æ¯åŒºåŸŸ */\n.component-info {\n  margin-top: 16px;\n  padding-top: 12px;\n  border-top: 1px solid var(--border-color);\n  color: var(--text-color-3);\n  font-size: calc(var(--font-size, 16px) - 4px);\n}\n\n.basic-info {\n  text-align: center;\n  margin-bottom: 8px;\n}\n\n/* çŠ¶æ€ä¿¡æ¯ */\n.state-info {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  justify-content: center;\n  padding: 8px;\n  background: var(--body-color);\n  border-radius: 4px;\n  border: 1px solid var(--border-color);\n  margin-bottom: 8px;\n}\n\n.state-item {\n  padding: 2px 6px;\n  background: var(--tag-color, var(--card-color));\n  border-radius: 3px;\n  font-size: 10px;\n  color: var(--text-color-2);\n}\n\n.state-item small {\n  font-weight: 500;\n}\n\n/* é…ç½®è°ƒè¯•ä¿¡æ¯ */\n.config-debug {\n  text-align: center;\n  padding: 4px 8px;\n  background: var(--info-color-suppl);\n  border-radius: 4px;\n  font-size: 10px;\n  color: var(--info-color);\n  font-weight: 500;\n}\n\n/* å“åº”å¼è®¾è®¡ */\n@media (max-width: 600px) {\n  .simple-display {\n    padding: 16px;\n  }\n\n  .title-section {\n    flex-direction: column;\n    gap: 8px;\n    text-align: center;\n  }\n\n  .info-item {\n    flex-direction: column;\n    gap: 4px;\n    text-align: center;\n  }\n}\n</style>\n","usedDeprecatedRules":[{"ruleId":"vue/component-tags-order","replacedBy":["block-order"]}]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\simple-display\\setting.vue","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":32,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":32,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":33,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":33,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":51},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":34,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":34,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":43},{"ruleId":"no-unused-vars","severity":1,"message":"'oldValue' is defined but never used.","line":34,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":74},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":35,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":35,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":44}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<template>\n  <div class=\"simple-display-setting\">\n    <AutoFormGenerator\n      :setting-config=\"settingConfig\"\n      :model-value=\"localConfig\"\n      @update:model-value=\"handleConfigChange\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n/**\n * simple-display ç»„ä»¶è®¾ç½®é¢æ¿\n * åŸºäº settingConfig è‡ªåŠ¨ç”Ÿæˆè®¾ç½®ç•Œé¢\n */\n\nimport { reactive, watch, nextTick } from 'vue'\nimport { simpleDisplaySettingConfig } from './settingConfig'\nimport type { SimpleDisplayConfig } from './settingConfig'\nimport AutoFormGenerator from '@/card2.1/core/AutoFormGenerator.vue'\n\n// Propsæ¥å£\ninterface Props {\n  modelValue?: SimpleDisplayConfig\n  config?: SimpleDisplayConfig\n  widget?: any\n  readonly?: boolean\n}\n\n// Emitsæ¥å£\ninterface Emits {\n  (e: 'update:modelValue', config: SimpleDisplayConfig): void\n  (e: 'update:config', config: SimpleDisplayConfig): void\n  (e: 'change', value: SimpleDisplayConfig, oldValue: SimpleDisplayConfig): void\n  (e: 'update', config: SimpleDisplayConfig): void\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  readonly: false\n})\n\nconst emit = defineEmits<Emits>()\n\n// è®¾ç½®é…ç½®\nconst settingConfig = simpleDisplaySettingConfig\n\n// è·å–é»˜è®¤é…ç½®\nconst getDefaultConfig = (): SimpleDisplayConfig => ({\n  ...settingConfig.customConfig\n})\n\n// æœ¬åœ°é…ç½®çŠ¶æ€\nconst localConfig = reactive<SimpleDisplayConfig>(props.modelValue || props.config || getDefaultConfig())\n\n// é˜²å¾ªç¯æ›´æ–°æ ‡å¿—\nlet isUpdatingFromProps = false\n\n/**\n * é…ç½®å˜æ›´å¤„ç†\n */\nconst handleConfigChange = (newConfig: SimpleDisplayConfig) => {\n  if (isUpdatingFromProps) return\n\n  // æ›´æ–°æœ¬åœ°é…ç½®\n  Object.assign(localConfig, newConfig)\n\n  // å‘é€æ›´æ–°äº‹ä»¶\n  emit('update:modelValue', { ...localConfig })\n  emit('update:config', { ...localConfig })\n  emit('change', { ...localConfig }, { ...localConfig })\n  emit('update', { ...localConfig })\n}\n\n/**\n * ç›‘å¬propsé…ç½®å˜åŒ–\n */\nwatch(\n  [() => props.modelValue, () => props.config],\n  ([newModelValue, newConfig]) => {\n    if (isUpdatingFromProps) return\n\n    const sourceConfig = newModelValue || newConfig\n    if (sourceConfig) {\n      isUpdatingFromProps = true\n      try {\n        // åˆå¹¶é…ç½®ï¼Œä¿æŒå®Œæ•´çš„ç»“æ„\n        const mergedConfig = {\n          ...getDefaultConfig(),\n          ...sourceConfig,\n          customize: {\n            ...getDefaultConfig().customize,\n            ...sourceConfig.customize\n          }\n        }\n\n        Object.assign(localConfig, mergedConfig)\n      } finally {\n        nextTick(() => {\n          setTimeout(() => {\n            isUpdatingFromProps = false\n          }, 10)\n        })\n      }\n    }\n  },\n  { deep: true, immediate: true }\n)\n</script>\n\n<style scoped>\n.simple-display-setting {\n  padding: 16px;\n}\n\n/* ä¸ºAutoFormGeneratoræä¾›æ ·å¼æ”¯æŒ */\n:deep(.auto-form-generator) {\n  width: 100%;\n}\n\n:deep(.n-form-item) {\n  margin-bottom: 16px;\n}\n\n:deep(.n-form-item-label) {\n  font-weight: 500;\n  color: var(--text-color-2);\n}\n\n:deep(.form-group) {\n  margin-bottom: 20px;\n}\n\n:deep(.form-group-title) {\n  font-size: 14px;\n  font-weight: 600;\n  color: var(--text-color);\n  margin-bottom: 12px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid var(--border-color);\n}\n</style>\n","usedDeprecatedRules":[{"ruleId":"vue/component-tags-order","replacedBy":["block-order"]}]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\simple-display\\settingConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\triple-data-display\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\triple-data-display\\index.vue","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":92,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":92,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":59},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":93,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":93,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":93,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":93,"endColumn":76},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":94,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'componentId' is defined but never used.","line":94,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":37},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":95,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":95,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":79},{"ruleId":"no-unused-vars","severity":1,"message":"'key' is defined but never used.","line":205,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":205,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'key' is defined but never used.","line":205,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":205,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":210,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":210,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":210,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":210,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":214,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":214,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":214,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":214,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":220,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":220,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":220,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":220,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":223,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":223,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'key' is assigned a value but never used.","line":223,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":223,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":305,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":305,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":305,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":305,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9972,9972],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":317,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":317,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":317,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":317,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[10149,10149],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'newConfig' is defined but never used.","line":326,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":326,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'newConfig' is defined but never used.","line":326,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":326,"endColumn":12}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<template>\n  <div :class=\"['triple-data-display-component', layoutClass]\" :style=\"componentStyle\" @click=\"handleClick\">\n    <!-- ç»„ä»¶æ ‡é¢˜ -->\n    <div v-if=\"currentConfig.customize.title\" class=\"component-title\">\n      {{ currentConfig.customize.title }}\n    </div>\n\n    <!-- ä¸‰ä¸ªæ•°æ®æºå±•ç¤ºåŒºåŸŸ -->\n    <div class=\"data-sources-container\">\n      <!-- æ•°æ®æº1 -->\n      <div class=\"data-source-item\">\n        <div class=\"data-label\">{{ currentConfig.customize.dataSource1Label }}</div>\n        <div class=\"data-value\">\n          {{ formatNumber(dataSource1, 0) }}\n          <span v-if=\"currentConfig.customize.unit\" class=\"data-unit\">{{ currentConfig.customize.unit }}</span>\n        </div>\n      </div>\n\n      <!-- æ•°æ®æº2 -->\n      <div class=\"data-source-item\">\n        <div class=\"data-label\">{{ currentConfig.customize.dataSource2Label }}</div>\n        <div class=\"data-value\">\n          {{ formatNumber(dataSource2, 1) }}\n          <span v-if=\"currentConfig.customize.unit\" class=\"data-unit\">{{ currentConfig.customize.unit }}</span>\n        </div>\n      </div>\n\n      <!-- æ•°æ®æº3 -->\n      <div class=\"data-source-item\">\n        <div class=\"data-label\">{{ currentConfig.customize.dataSource3Label }}</div>\n        <div class=\"data-value\">\n          {{ formatNumber(dataSource3, 2) }}\n          <span v-if=\"currentConfig.customize.unit\" class=\"data-unit\">{{ currentConfig.customize.unit }}</span>\n        </div>\n      </div>\n    </div>\n\n    <!-- JSONæ•°æ®æ˜¾ç¤º -->\n    <div v-if=\"dataSource1\" class=\"json-display\">\n      <pre>{{ JSON.stringify(dataSource1, null, 2) }}</pre>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n/**\n * triple-data-display ç»„ä»¶\n * å±•ç¤ºä¸‰ä¸ªæ•°æ®æºçš„æ•°æ®å¯¹æ¯”ï¼Œæ”¯æŒå¤šç§å¸ƒå±€æ¨¡å¼å’Œä¸»é¢˜å®šåˆ¶\n */\n\nimport { ref, computed, watch, onMounted, onUnmounted } from 'vue'\nimport { interactionManager } from '@/card2.1/core/interaction-manager'\nimport type { InteractionConfig } from '@/card2.1/core/interaction-types'\nimport type { TripleDataDisplayConfig } from './settingConfig'\nimport { tripleDataDisplaySettingConfig } from './settingConfig'\n\n// ç»„ä»¶å±æ€§æ¥å£ - æ”¯æŒæ–°çš„ CustomConfig ç»“æ„\ninterface Props {\n  componentId?: string\n  // æ•°æ®æº\n  dataSource1?: any\n  dataSource2?: any\n  dataSource3?: any\n  // æ–°çš„é…ç½®ç»“æ„ï¼ˆä¼˜å…ˆï¼‰\n  modelValue?: TripleDataDisplayConfig\n  // å‘åå…¼å®¹çš„é…ç½®ç»“æ„\n  config?:\n    | TripleDataDisplayConfig\n    | {\n        title?: string\n        themeColor?: string\n        fontSize?: number\n        showBorder?: boolean\n        layout?: 'grid' | 'horizontal' | 'vertical'\n      }\n  // äº¤äº’é…ç½®\n  interactionConfigs?: InteractionConfig[]\n  // è°ƒè¯•æ¨¡å¼\n  debugMode?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  componentId: '',\n  dataSource1: null,\n  dataSource2: null,\n  dataSource3: null,\n  debugMode: false\n})\n\n// äº‹ä»¶å®šä¹‰\ninterface Emits {\n  (e: 'update:modelValue', config: TripleDataDisplayConfig): void\n  (e: 'click', data: { componentId: string; dataSource: string; data: any }): void\n  (e: 'refresh', componentId: string): void\n  (e: 'interaction', data: { type: string; componentId: string; payload: any }): void\n}\n\nconst emit = defineEmits<Emits>()\n\n/**\n * é…ç½®è®¡ç®— - æ”¯æŒæ–°æ—§é…ç½®æ ¼å¼\n */\nconst currentConfig = computed<TripleDataDisplayConfig>(() => {\n  // ä¼˜å…ˆä½¿ç”¨ modelValueï¼ˆæ–°æ ¼å¼ï¼‰\n  if (props.modelValue) {\n    return props.modelValue\n  }\n\n  // å…¶æ¬¡ä½¿ç”¨ config\n  if (props.config) {\n    // æ£€æŸ¥æ˜¯å¦æ˜¯æ–°çš„ CustomConfig æ ¼å¼\n    if ('customize' in props.config) {\n      return props.config as TripleDataDisplayConfig\n    }\n\n    // ğŸ”¥ ä¿®å¤ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯æ‰å¹³åŒ–é…ç½®ï¼ˆä»Card2Wrapperä¼ æ¥çš„ï¼‰\n    const configKeys = Object.keys(props.config)\n    const hasExpectedFlatKeys = ['title', 'dataSource1Label', 'dataSource2Label', 'dataSource3Label'].some(key =>\n      configKeys.includes(key)\n    )\n\n    if (hasExpectedFlatKeys) {\n      // æ‰å¹³åŒ–é…ç½®è½¬æ¢ä¸ºåµŒå¥—æ ¼å¼\n      const flatConfig = props.config as any\n      return {\n        ...tripleDataDisplaySettingConfig.customConfig,\n        customize: {\n          ...tripleDataDisplaySettingConfig.customConfig.customize,\n          // ä»æ‰å¹³åŒ–é…ç½®ä¸­æå–å€¼\n          title: flatConfig.title || tripleDataDisplaySettingConfig.customConfig.customize.title,\n          themeColor: flatConfig.themeColor || tripleDataDisplaySettingConfig.customConfig.customize.themeColor,\n          fontSize: flatConfig.fontSize || tripleDataDisplaySettingConfig.customConfig.customize.fontSize,\n          showBorder:\n            flatConfig.showBorder !== undefined\n              ? flatConfig.showBorder\n              : tripleDataDisplaySettingConfig.customConfig.customize.showBorder,\n          layout: flatConfig.layout || tripleDataDisplaySettingConfig.customConfig.customize.layout,\n          dataSource1Label:\n            flatConfig.dataSource1Label || tripleDataDisplaySettingConfig.customConfig.customize.dataSource1Label,\n          dataSource2Label:\n            flatConfig.dataSource2Label || tripleDataDisplaySettingConfig.customConfig.customize.dataSource2Label,\n          dataSource3Label:\n            flatConfig.dataSource3Label || tripleDataDisplaySettingConfig.customConfig.customize.dataSource3Label,\n          numberFormat: flatConfig.numberFormat || tripleDataDisplaySettingConfig.customConfig.customize.numberFormat,\n          unit: flatConfig.unit || tripleDataDisplaySettingConfig.customConfig.customize.unit\n        }\n      }\n    }\n\n    // è½¬æ¢æ—§æ ¼å¼åˆ°æ–°æ ¼å¼ï¼ˆä¿æŒå‘åå…¼å®¹ï¼‰\n    const legacyConfig = props.config as any\n    return {\n      ...tripleDataDisplaySettingConfig.customConfig,\n      customize: {\n        ...tripleDataDisplaySettingConfig.customConfig.customize,\n        title: legacyConfig.title || tripleDataDisplaySettingConfig.customConfig.customize.title,\n        themeColor: legacyConfig.themeColor || tripleDataDisplaySettingConfig.customConfig.customize.themeColor,\n        fontSize: legacyConfig.fontSize || tripleDataDisplaySettingConfig.customConfig.customize.fontSize,\n        showBorder:\n          legacyConfig.showBorder !== undefined\n            ? legacyConfig.showBorder\n            : tripleDataDisplaySettingConfig.customConfig.customize.showBorder,\n        layout: legacyConfig.layout || tripleDataDisplaySettingConfig.customConfig.customize.layout\n      }\n    }\n  }\n\n  // ä½¿ç”¨é»˜è®¤é…ç½®\n  return tripleDataDisplaySettingConfig.customConfig\n})\n\n/**\n * å¸ƒå±€æ ·å¼ç±»å\n */\nconst layoutClass = computed(() => {\n  const layout = currentConfig.value.customize.layout\n  return `layout-${layout}`\n})\n\n/**\n * ç»„ä»¶æ ·å¼è®¡ç®—\n */\nconst componentStyle = computed(() => {\n  const customize = currentConfig.value.customize\n  return {\n    '--theme-color': customize.themeColor,\n    '--font-size': `${customize.fontSize}px`,\n    border: customize.showBorder ? '1px solid var(--border-color)' : 'none'\n  }\n})\n\n/**\n * æ•°å­—æ ¼å¼åŒ–å·¥å…· - æ”¯æŒå¯¹è±¡æ•°æ®æå–å’Œå¤šå­—æ®µæ™ºèƒ½åˆ†é…\n */\nconst formatNumber = (value: any, dataSourceIndex: number = 0): string => {\n  if (value === null || value === undefined || value === '') return '--'\n\n  // ğŸ”¥ ä¿®å¤ï¼šå¤„ç†å¯¹è±¡ç±»å‹çš„æ•°æ®æº\n  let actualValue = value\n  if (typeof value === 'object' && value !== null) {\n    // ğŸ”¥ æ–°å¢ï¼šå¤„ç† Card2Wrapper ä¼ é€’çš„åµŒå¥—æ•°æ®ç»“æ„ {type: 'json', data: {...}}\n    if (value.type && value.data && typeof value.data === 'object') {\n      const dataObj = value.data\n      const numericEntries = Object.entries(dataObj).filter(\n        ([key, val]) => typeof val === 'number' || (typeof val === 'string' && !isNaN(parseFloat(val as string)))\n      )\n\n      // ğŸ¯ æ™ºèƒ½å­—æ®µåˆ†é…ï¼šæ ¹æ®æ•°æ®æºç´¢å¼•åˆ†é…ä¸åŒå­—æ®µ\n      if (numericEntries.length > dataSourceIndex) {\n        const [key, val] = numericEntries[dataSourceIndex]\n        actualValue = typeof val === 'number' ? val : parseFloat(val as string)\n      } else if (numericEntries.length > 0) {\n        // å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ•°å­—å­—æ®µï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ª\n        const [key, val] = numericEntries[0]\n        actualValue = typeof val === 'number' ? val : parseFloat(val as string)\n      } else {\n        // å¦‚æœæ²¡æœ‰æ•°å­—å­—æ®µï¼Œä½¿ç”¨æ‰€æœ‰å­—æ®µä¸­çš„æŸä¸ª\n        const allEntries = Object.entries(dataObj)\n        if (allEntries.length > dataSourceIndex) {\n          const [key, val] = allEntries[dataSourceIndex]\n          actualValue = String(val)\n        } else if (allEntries.length > 0) {\n          const [key, val] = allEntries[0]\n          actualValue = String(val)\n        }\n      }\n    }\n    // ğŸ”¥ ä¿æŒåŸæœ‰é€»è¾‘ï¼šå¤„ç†ç®€å•çš„æ•°æ®å­—æ®µ\n    else if (typeof value.value === 'number' || typeof value.value === 'string') {\n      actualValue = value.value\n    } else if (typeof value.data === 'number' || typeof value.data === 'string') {\n      actualValue = value.data\n    } else if (typeof value.val === 'number' || typeof value.val === 'string') {\n      actualValue = value.val\n    } else if (typeof value.number === 'number' || typeof value.number === 'string') {\n      actualValue = value.number\n    } else {\n      return '[éœ€è¦é…ç½®æ•°æ®å­—æ®µ]'\n    }\n  }\n\n  const numValue = typeof actualValue === 'number' ? actualValue : parseFloat(String(actualValue))\n  if (isNaN(numValue)) {\n    return String(actualValue)\n  }\n\n  const format = currentConfig.value.customize.numberFormat\n\n  switch (format) {\n    case 'thousands':\n      return numValue.toLocaleString()\n    case 'decimal2':\n      return numValue.toFixed(2)\n    case 'percentage':\n      return `${(numValue * 100).toFixed(1)}%`\n    default:\n      return String(numValue)\n  }\n}\n\n// äº¤äº’ç³»ç»ŸçŠ¶æ€\nconst isInteractionEnabled = ref(false)\nconst registeredEvents = ref<Set<string>>(new Set())\n\n/**\n * ç‚¹å‡»äº‹ä»¶å¤„ç†\n */\nconst handleClick = () => {\n  // å‘é€ç‚¹å‡»äº‹ä»¶\n  emit('click', {\n    componentId: props.componentId,\n    dataSource: 'triple-data-display',\n    data: {\n      dataSource1: props.dataSource1,\n      dataSource2: props.dataSource2,\n      dataSource3: props.dataSource3\n    }\n  })\n}\n\n/**\n * ç›‘å¬å±æ€§æ›´æ–°äº‹ä»¶ï¼ˆç”¨äºè·¨ç»„ä»¶å±æ€§ç»‘å®šï¼‰\n */\nconst handlePropertyUpdate = (data: any) => {\n  if (data && typeof data === 'object') {\n    // æ›´æ–°é…ç½®å¹¶è§¦å‘äº‹ä»¶\n    const newConfig = { ...currentConfig.value, ...data }\n    emit('update:modelValue', newConfig)\n  }\n}\n\n/**\n * ç»„ä»¶æŒ‚è½½æ—¶çš„åˆå§‹åŒ–\n */\nonMounted(() => {\n  // æ³¨å†Œå±æ€§æ›´æ–°ç›‘å¬å™¨ï¼ˆç”¨äºè·¨ç»„ä»¶å±æ€§ç»‘å®šï¼‰\n  if (props.componentId) {\n    interactionManager.watchComponentProperty(props.componentId, handlePropertyUpdate)\n  }\n\n  // åˆå§‹åŒ–äº¤äº’é…ç½®\n  if (props.interactionConfigs && props.interactionConfigs.length > 0) {\n    try {\n      isInteractionEnabled.value = true\n    } catch (error) {}\n  }\n})\n\n/**\n * ç»„ä»¶å¸è½½æ—¶æ¸…ç†\n */\nonUnmounted(() => {\n  // æ¸…ç†äº¤äº’ç³»ç»Ÿç›‘å¬å™¨\n  if (props.componentId && registeredEvents.value.size > 0) {\n    try {\n      // è¿™é‡Œå¯ä»¥æ·»åŠ æ¸…ç†é€»è¾‘\n    } catch (error) {}\n  }\n})\n\n/**\n * ç›‘å¬é…ç½®å˜åŒ–\n */\nwatch(\n  () => currentConfig.value,\n  newConfig => {},\n  { deep: true }\n)\n</script>\n\n<style scoped>\n.triple-data-display-component {\n  width: 100%;\n  height: 100%;\n  padding: 16px;\n  background: var(--card-color);\n  border-radius: var(--border-radius);\n  display: flex;\n  flex-direction: column;\n  font-size: var(--font-size, 16px);\n  color: var(--text-color);\n  position: relative;\n  cursor: pointer;\n  transition: all 0.3s ease;\n}\n\n.triple-data-display-component:hover {\n  box-shadow: var(--box-shadow);\n}\n\n.component-title {\n  font-size: calc(var(--font-size, 16px) + 2px);\n  font-weight: 600;\n  color: var(--theme-color);\n  margin-bottom: 16px;\n  text-align: center;\n}\n\n.data-sources-container {\n  flex: 1;\n  display: flex;\n  gap: 12px;\n  align-items: center;\n  justify-content: space-between;\n}\n\n/* ç½‘æ ¼å¸ƒå±€ */\n.layout-grid .data-sources-container {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 16px;\n  align-items: stretch;\n}\n\n/* æ°´å¹³å¸ƒå±€ */\n.layout-horizontal .data-sources-container {\n  flex-direction: row;\n}\n\n/* å‚ç›´å¸ƒå±€ */\n.layout-vertical .data-sources-container {\n  flex-direction: column;\n  align-items: stretch;\n}\n\n.data-source-item {\n  flex: 1;\n  padding: 12px;\n  background: var(--body-color);\n  border-radius: calc(var(--border-radius) * 0.5);\n  border: 1px solid var(--border-color);\n  text-align: center;\n  transition: all 0.2s ease;\n}\n\n.data-source-item:hover {\n  border-color: var(--theme-color);\n  transform: translateY(-1px);\n}\n\n.data-label {\n  font-size: calc(var(--font-size, 16px) - 2px);\n  color: var(--text-color-2);\n  margin-bottom: 8px;\n}\n\n.data-value {\n  font-size: calc(var(--font-size, 16px) + 6px);\n  font-weight: 600;\n  color: var(--theme-color);\n}\n\n.data-unit {\n  font-size: calc(var(--font-size, 16px) - 2px);\n  font-weight: 400;\n  color: var(--text-color-3);\n  margin-left: 4px;\n}\n\n.json-display {\n  position: absolute;\n  top: 8px;\n  left: 8px;\n  right: 8px;\n  background: var(--body-color);\n  border: 1px solid var(--border-color);\n  border-radius: 6px;\n  padding: 12px;\n  z-index: 10;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.json-display pre {\n  font-size: 10px;\n  margin: 0;\n  color: var(--text-color-2);\n  overflow: auto;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n/* å“åº”å¼è°ƒæ•´ */\n@media (max-width: 600px) {\n  .layout-grid .data-sources-container,\n  .layout-horizontal .data-sources-container {\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .data-source-item {\n    margin-bottom: 8px;\n  }\n}\n\n/* æš—è‰²ä¸»é¢˜é€‚é… */\n[data-theme='dark'] .triple-data-display-component {\n  border-color: var(--border-color);\n}\n\n[data-theme='dark'] .data-source-item {\n  background: var(--modal-color);\n}\n</style>\n","usedDeprecatedRules":[{"ruleId":"vue/component-tags-order","replacedBy":["block-order"]}]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\triple-data-display\\setting.vue","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":32,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":32,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":59},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":33,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":33,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":34,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":34,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'oldValue' is defined but never used.","line":34,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":82},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":35,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":35,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<template>\n  <div class=\"triple-data-display-setting\">\n    <AutoFormGenerator\n      :setting-config=\"settingConfig\"\n      :model-value=\"localConfig\"\n      @update:model-value=\"handleConfigChange\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n/**\n * triple-data-display ç»„ä»¶è®¾ç½®é¢æ¿\n * åŸºäº settingConfig è‡ªåŠ¨ç”Ÿæˆè®¾ç½®ç•Œé¢\n */\n\nimport { reactive, watch, nextTick } from 'vue'\nimport { tripleDataDisplaySettingConfig } from './settingConfig'\nimport type { TripleDataDisplayConfig } from './settingConfig'\nimport AutoFormGenerator from '@/card2.1/core/AutoFormGenerator.vue'\n\n// Propsæ¥å£\ninterface Props {\n  modelValue?: TripleDataDisplayConfig\n  config?: TripleDataDisplayConfig\n  widget?: any\n  readonly?: boolean\n}\n\n// Emitsæ¥å£\ninterface Emits {\n  (e: 'update:modelValue', config: TripleDataDisplayConfig): void\n  (e: 'update:config', config: TripleDataDisplayConfig): void\n  (e: 'change', value: TripleDataDisplayConfig, oldValue: TripleDataDisplayConfig): void\n  (e: 'update', config: TripleDataDisplayConfig): void\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  readonly: false\n})\n\nconst emit = defineEmits<Emits>()\n\n// è®¾ç½®é…ç½®\nconst settingConfig = tripleDataDisplaySettingConfig\n\n// è·å–é»˜è®¤é…ç½®\nconst getDefaultConfig = (): TripleDataDisplayConfig => ({\n  ...settingConfig.customConfig\n})\n\n// æœ¬åœ°é…ç½®çŠ¶æ€\nconst localConfig = reactive<TripleDataDisplayConfig>(props.modelValue || props.config || getDefaultConfig())\n\n// é˜²å¾ªç¯æ›´æ–°æ ‡å¿—\nlet isUpdatingFromProps = false\n\n/**\n * é…ç½®å˜æ›´å¤„ç†\n */\nconst handleConfigChange = (newConfig: TripleDataDisplayConfig) => {\n  if (isUpdatingFromProps) return\n\n  // æ›´æ–°æœ¬åœ°é…ç½®\n  Object.assign(localConfig, newConfig)\n\n  // å‘é€æ›´æ–°äº‹ä»¶\n  emit('update:modelValue', { ...localConfig })\n  emit('update:config', { ...localConfig })\n  emit('change', { ...localConfig }, { ...localConfig })\n  emit('update', { ...localConfig })\n}\n\n/**\n * ç›‘å¬propsé…ç½®å˜åŒ–\n */\nwatch(\n  [() => props.modelValue, () => props.config],\n  ([newModelValue, newConfig]) => {\n    if (isUpdatingFromProps) return\n\n    const sourceConfig = newModelValue || newConfig\n    if (sourceConfig) {\n      isUpdatingFromProps = true\n      try {\n        // åˆå¹¶é…ç½®ï¼Œä¿æŒå®Œæ•´çš„ç»“æ„\n        const mergedConfig = {\n          ...getDefaultConfig(),\n          ...sourceConfig,\n          customize: {\n            ...getDefaultConfig().customize,\n            ...sourceConfig.customize\n          }\n        }\n\n        Object.assign(localConfig, mergedConfig)\n      } finally {\n        nextTick(() => {\n          setTimeout(() => {\n            isUpdatingFromProps = false\n          }, 10)\n        })\n      }\n    }\n  },\n  { deep: true, immediate: true }\n)\n</script>\n\n<style scoped>\n.triple-data-display-setting {\n  padding: 16px;\n}\n\n/* ä¸ºAutoFormGeneratoræä¾›æ ·å¼æ”¯æŒ */\n:deep(.auto-form-generator) {\n  width: 100%;\n}\n\n:deep(.n-form-item) {\n  margin-bottom: 16px;\n}\n\n:deep(.n-form-item-label) {\n  font-weight: 500;\n  color: var(--text-color-2);\n}\n\n:deep(.form-group) {\n  margin-bottom: 20px;\n}\n\n:deep(.form-group-title) {\n  font-size: 14px;\n  font-weight: 600;\n  color: var(--text-color);\n  margin-bottom: 12px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid var(--border-color);\n}\n</style>\n","usedDeprecatedRules":[{"ruleId":"vue/component-tags-order","replacedBy":["block-order"]}]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\components\\triple-data-display\\settingConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\AutoFormGenerator.vue","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'FormValidationError' is defined but never used.","line":195,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":195,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FormValidationError' is defined but never used.","line":195,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":195,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":216,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":216,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":216,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":216,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validationErrors' is defined but never used.","line":396,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":396,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<template>\n  <div class=\"auto-form-generator\">\n    <n-form\n      ref=\"formRef\"\n      :model=\"localValue\"\n      :label-placement=\"labelPlacement\"\n      :label-width=\"labelWidth\"\n      :disabled=\"disabled\"\n    >\n      <!-- æŒ‰ç»„åˆ†ç»„æ˜¾ç¤ºè®¾ç½®é¡¹ -->\n      <div v-for=\"groupName in groupNames\" :key=\"groupName\" class=\"form-group\">\n        <!-- ç»„æ ‡é¢˜ -->\n        <div v-if=\"groupName !== 'default'\" class=\"form-group-title\">\n          {{ groupName }}\n        </div>\n\n        <!-- ç»„å†…çš„è¡¨å•é¡¹ -->\n        <n-form-item\n          v-for=\"setting in getSettingsByGroup(groupName)\"\n          :key=\"setting.path\"\n          :label=\"setting.label\"\n          :path=\"setting.path\"\n          :rule=\"getValidationRules(setting)\"\n        >\n          <!-- è¾“å…¥æ¡† -->\n          <n-input\n            v-if=\"setting.controlType === 'INPUT' || setting.controlType === 'input'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :placeholder=\"setting.options?.placeholder\"\n            :disabled=\"setting.options?.disabled\"\n            :clearable=\"setting.options?.clearable ?? true\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          />\n\n          <!-- æ–‡æœ¬åŸŸ -->\n          <n-input\n            v-else-if=\"setting.controlType === 'TEXTAREA' || setting.controlType === 'textarea'\"\n            type=\"textarea\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :placeholder=\"setting.options?.placeholder\"\n            :rows=\"setting.options?.rows || 3\"\n            :disabled=\"setting.options?.disabled\"\n            :clearable=\"setting.options?.clearable ?? true\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          />\n\n          <!-- æ•°å­—è¾“å…¥ -->\n          <n-input-number\n            v-else-if=\"setting.controlType === 'INPUT_NUMBER' || setting.controlType === 'input-number'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :min=\"setting.options?.min\"\n            :max=\"setting.options?.max\"\n            :step=\"setting.options?.step\"\n            :precision=\"setting.options?.precision\"\n            :disabled=\"setting.options?.disabled\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          />\n\n          <!-- å¼€å…³ -->\n          <n-switch\n            v-else-if=\"setting.controlType === 'SWITCH' || setting.controlType === 'switch'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :disabled=\"setting.options?.disabled\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          />\n\n          <!-- é€‰æ‹©å™¨ -->\n          <n-select\n            v-else-if=\"setting.controlType === 'SELECT' || setting.controlType === 'select'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :options=\"setting.options?.options || []\"\n            :placeholder=\"setting.options?.placeholder\"\n            :disabled=\"setting.options?.disabled\"\n            :clearable=\"setting.options?.clearable ?? true\"\n            :multiple=\"setting.options?.multiple\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          />\n\n          <!-- é¢œè‰²é€‰æ‹©å™¨ -->\n          <n-color-picker\n            v-else-if=\"setting.controlType === 'COLOR_PICKER' || setting.controlType === 'color-picker'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :disabled=\"setting.options?.disabled\"\n            :show-alpha=\"setting.options?.showAlpha\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          />\n\n          <!-- æ»‘å— -->\n          <n-slider\n            v-else-if=\"setting.controlType === 'SLIDER' || setting.controlType === 'slider'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :min=\"setting.options?.min || 0\"\n            :max=\"setting.options?.max || 100\"\n            :step=\"setting.options?.step || 1\"\n            :disabled=\"setting.options?.disabled\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          />\n\n          <!-- æ—¥æœŸé€‰æ‹©å™¨ -->\n          <n-date-picker\n            v-else-if=\"setting.controlType === 'DATE_PICKER' || setting.controlType === 'date-picker'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :type=\"setting.options?.type || 'date'\"\n            :placeholder=\"setting.options?.placeholder\"\n            :disabled=\"setting.options?.disabled\"\n            :clearable=\"setting.options?.clearable ?? true\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          />\n\n          <!-- æ—¶é—´é€‰æ‹©å™¨ -->\n          <n-time-picker\n            v-else-if=\"setting.controlType === 'TIME_PICKER' || setting.controlType === 'time-picker'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :placeholder=\"setting.options?.placeholder\"\n            :disabled=\"setting.options?.disabled\"\n            :clearable=\"setting.options?.clearable ?? true\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          />\n\n          <!-- è¯„åˆ† -->\n          <n-rate\n            v-else-if=\"setting.controlType === 'RATE' || setting.controlType === 'rate'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :count=\"setting.options?.count || 5\"\n            :disabled=\"setting.options?.disabled\"\n            :allow-half=\"setting.options?.allowHalf\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          />\n\n          <!-- å¤é€‰æ¡†ç»„ -->\n          <n-checkbox-group\n            v-else-if=\"setting.controlType === 'CHECKBOX_GROUP' || setting.controlType === 'checkbox-group'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :disabled=\"setting.options?.disabled\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          >\n            <n-space>\n              <n-checkbox\n                v-for=\"option in setting.options?.options || []\"\n                :key=\"option.value\"\n                :value=\"option.value\"\n                :label=\"option.label\"\n              />\n            </n-space>\n          </n-checkbox-group>\n\n          <!-- å•é€‰æ¡†ç»„ -->\n          <n-radio-group\n            v-else-if=\"setting.controlType === 'RADIO_GROUP' || setting.controlType === 'radio-group'\"\n            :value=\"getNestedValue(localValue, setting.path)\"\n            :disabled=\"setting.options?.disabled\"\n            @update:value=\"val => updateNestedValue(setting.path, val)\"\n          >\n            <n-space>\n              <n-radio v-for=\"option in setting.options?.options || []\" :key=\"option.value\" :value=\"option.value\">\n                {{ option.label }}\n              </n-radio>\n            </n-space>\n          </n-radio-group>\n\n          <!-- æœªçŸ¥æ§ä»¶ç±»å‹æç¤º -->\n          <n-text v-else type=\"warning\">æœªæ”¯æŒçš„æ§ä»¶ç±»å‹: {{ setting.controlType }}</n-text>\n        </n-form-item>\n      </div>\n    </n-form>\n  </div>\n</template>\n\n<script setup lang=\"ts\" generic=\"T extends Record<string, any>\">\n/**\n * è‡ªåŠ¨è¡¨å•ç”Ÿæˆå™¨\n * æ ¹æ® ComponentSettingConfig è‡ªåŠ¨ç”Ÿæˆé…ç½®è¡¨å•\n */\n\nimport { computed, reactive, watch, nextTick, ref } from 'vue'\nimport {\n  NForm,\n  NFormItem,\n  NInput,\n  NInputNumber,\n  NSwitch,\n  NSelect,\n  NColorPicker,\n  NSlider,\n  NDatePicker,\n  NTimePicker,\n  NRate,\n  NCheckboxGroup,\n  NCheckbox,\n  NRadioGroup,\n  NRadio,\n  NSpace,\n  NText,\n  type FormInst,\n  type FormValidationError,\n  type FormItemRule\n} from 'naive-ui'\nimport type { ComponentSettingConfig, Setting } from '@/card2.1/types/setting-config'\n\n// Propsæ¥å£\ninterface Props<T extends Record<string, any> = Record<string, any>> {\n  /** è®¾ç½®é…ç½® */\n  settingConfig: ComponentSettingConfig<T>\n  /** å½“å‰å€¼ */\n  modelValue?: T\n  /** è¡¨å•æ ‡ç­¾ä½ç½® */\n  labelPlacement?: 'left' | 'top'\n  /** æ ‡ç­¾å®½åº¦ */\n  labelWidth?: number | string\n  /** æ˜¯å¦ç¦ç”¨ */\n  disabled?: boolean\n}\n\n// Emitsæ¥å£\ninterface Emits<T extends Record<string, any> = Record<string, any>> {\n  (e: 'update:modelValue', value: T): void\n}\n\nconst props = withDefaults(defineProps<Props<T>>(), {\n  labelPlacement: 'left',\n  labelWidth: 120,\n  disabled: false\n})\n\nconst emit = defineEmits<Emits<T>>()\n\n// è¡¨å•å¼•ç”¨\nconst formRef = ref<FormInst>()\n\n// æœ¬åœ°å€¼ç®¡ç†\nconst localValue = reactive<T>(\n  (props.modelValue ? { ...props.modelValue } : { ...props.settingConfig.customConfig }) as T\n)\n\n// é˜²å¾ªç¯æ›´æ–°æ ‡å¿—\nlet isUpdatingFromProps = false\n\n/**\n * è·å–è®¾ç½®é¡¹åˆ†ç»„\n */\nconst settingGroups = computed(() => {\n  const groups: Record<string, Setting[]> = {}\n\n  for (const setting of props.settingConfig.settings) {\n    const groupName = setting.options?.group || 'default'\n    if (!groups[groupName]) {\n      groups[groupName] = []\n    }\n\n    // è½¬æ¢è®¾ç½®é¡¹ï¼Œå°† type æ˜ å°„ä¸º controlTypeï¼Œpath æ˜ å°„ä¸º field\n    const transformedSetting = {\n      ...setting,\n      controlType: setting.type, // æ˜ å°„å­—æ®µå\n      path: setting.field, // æ˜ å°„å­—æ®µå\n      label: setting.label,\n      options: setting.options\n    }\n\n    groups[groupName].push(transformedSetting as Setting)\n  }\n\n  return groups\n})\n\n/**\n * è·å–æ‰€æœ‰åˆ†ç»„åç§°\n */\nconst groupNames = computed(() => {\n  const names = Object.keys(settingGroups.value)\n  // å°† 'default' ç»„æ”¾åœ¨æœ€å‰é¢ï¼Œå…¶ä»–æŒ‰å­—æ¯é¡ºåºæ’åº\n  return names.sort((a, b) => {\n    if (a === 'default') return -1\n    if (b === 'default') return 1\n    return a.localeCompare(b)\n  })\n})\n\n/**\n * æ ¹æ®åˆ†ç»„è·å–è®¾ç½®é¡¹\n */\nconst getSettingsByGroup = (groupName: string): Setting[] => {\n  return settingGroups.value[groupName] || []\n}\n\n/**\n * è·å–åµŒå¥—å¯¹è±¡çš„å€¼\n */\nconst getNestedValue = <V = any,>(obj: Record<string, any>, path: string): V => {\n  return path.split('.').reduce((current, key) => {\n    return current && typeof current === 'object' ? current[key] : undefined\n  }, obj)\n}\n\n/**\n * è®¾ç½®åµŒå¥—å¯¹è±¡çš„å€¼\n */\nconst setNestedValue = (obj: Record<string, any>, path: string, value: any) => {\n  const keys = path.split('.')\n  const lastKey = keys.pop()!\n\n  const target = keys.reduce((current, key) => {\n    if (!current[key] || typeof current[key] !== 'object') {\n      current[key] = {}\n    }\n    return current[key]\n  }, obj)\n\n  target[lastKey] = value\n}\n\n/**\n * æ›´æ–°åµŒå¥—å€¼å¹¶è§¦å‘äº‹ä»¶\n */\nconst updateNestedValue = (path: string, value: any) => {\n  if (isUpdatingFromProps) return\n\n  setNestedValue(localValue, path, value)\n\n  // å‘é€æ›´æ–°äº‹ä»¶\n  emit('update:modelValue', { ...localValue } as T)\n}\n\n/**\n * è·å–è¡¨å•éªŒè¯è§„åˆ™\n */\nconst getValidationRules = (setting: Setting): FormItemRule[] => {\n  const rules: FormItemRule[] = []\n\n  // å¿…å¡«éªŒè¯\n  if (setting.options?.required) {\n    rules.push({\n      required: true,\n      message: `è¯·${setting.controlType === 'SELECT' ? 'é€‰æ‹©' : 'è¾“å…¥'}${setting.label}`,\n      trigger: ['blur', 'change']\n    })\n  }\n\n  // é•¿åº¦éªŒè¯\n  if (setting.options?.minLength !== undefined || setting.options?.maxLength !== undefined) {\n    rules.push({\n      validator: (rule, value: string) => {\n        if (!value && !setting.options?.required) return true\n\n        const len = value?.length || 0\n        const min = setting.options?.minLength\n        const max = setting.options?.maxLength\n\n        if (min !== undefined && len < min) {\n          return new Error(`${setting.label}é•¿åº¦ä¸èƒ½å°‘äº${min}ä¸ªå­—ç¬¦`)\n        }\n        if (max !== undefined && len > max) {\n          return new Error(`${setting.label}é•¿åº¦ä¸èƒ½è¶…è¿‡${max}ä¸ªå­—ç¬¦`)\n        }\n\n        return true\n      },\n      trigger: ['blur', 'change']\n    })\n  }\n\n  // æ•°å€¼èŒƒå›´éªŒè¯\n  if (\n    setting.controlType === 'INPUT_NUMBER' &&\n    (setting.options?.min !== undefined || setting.options?.max !== undefined)\n  ) {\n    rules.push({\n      validator: (rule, value: number) => {\n        if (value == null && !setting.options?.required) return true\n\n        const min = setting.options?.min\n        const max = setting.options?.max\n\n        if (min !== undefined && value < min) {\n          return new Error(`${setting.label}ä¸èƒ½å°äº${min}`)\n        }\n        if (max !== undefined && value > max) {\n          return new Error(`${setting.label}ä¸èƒ½å¤§äº${max}`)\n        }\n\n        return true\n      },\n      trigger: ['blur', 'change']\n    })\n  }\n\n  return rules\n}\n\n/**\n * è¡¨å•éªŒè¯\n */\nconst validate = async (): Promise<boolean> => {\n  try {\n    await formRef.value?.validate()\n    return true\n  } catch (validationErrors: any) {\n    return false\n  }\n}\n\n/**\n * é‡ç½®è¡¨å•\n */\nconst resetForm = () => {\n  // é‡ç½®ä¸ºé»˜è®¤é…ç½®\n  Object.assign(localValue, props.settingConfig.customConfig)\n  emit('update:modelValue', { ...localValue } as T)\n}\n\n/**\n * ç›‘å¬propså˜åŒ–\n */\nwatch(\n  () => props.modelValue,\n  newValue => {\n    if (isUpdatingFromProps || !newValue) return\n\n    isUpdatingFromProps = true\n    try {\n      Object.assign(localValue, newValue)\n    } finally {\n      nextTick(() => {\n        setTimeout(() => {\n          isUpdatingFromProps = false\n        }, 10)\n      })\n    }\n  },\n  { deep: true, immediate: true }\n)\n\n// æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶\ndefineExpose({\n  validate,\n  resetForm,\n  formRef\n})\n</script>\n\n<style scoped>\n.auto-form-generator {\n  width: 100%;\n}\n\n.form-group {\n  margin-bottom: 20px;\n}\n\n.form-group:last-child {\n  margin-bottom: 0;\n}\n\n.form-group-title {\n  font-size: 14px;\n  font-weight: 600;\n  color: var(--text-color);\n  margin-bottom: 12px;\n  padding-bottom: 8px;\n  border-bottom: 1px solid var(--border-color);\n}\n\n:deep(.n-form-item) {\n  margin-bottom: 16px;\n}\n\n:deep(.n-form-item:last-child) {\n  margin-bottom: 0;\n}\n\n:deep(.n-form-item-label) {\n  font-weight: 500;\n  color: var(--text-color-2);\n}\n\n/* å“åº”å¼è®¾è®¡ */\n@media (max-width: 600px) {\n  .auto-form-generator {\n    padding: 0 8px;\n  }\n\n  .form-group-title {\n    font-size: 13px;\n  }\n\n  :deep(.n-form-item) {\n    margin-bottom: 12px;\n  }\n}\n</style>\n","usedDeprecatedRules":[{"ruleId":"vue/component-tags-order","replacedBy":["block-order"]}]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\FlexibleConfigForm.vue","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'event' is defined but never used.","line":50,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":50,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":51},{"ruleId":"no-unused-vars","severity":1,"message":"'event' is defined but never used.","line":51,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":51,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":40},{"ruleId":"no-unused-vars","severity":1,"message":"'event' is defined but never used.","line":52,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'result' is defined but never used.","line":52,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":119,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":119,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":119,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":119,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2723,2723],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":129,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":129,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":129,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":129,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3015,3015],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":130,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":130,"endColumn":17},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":130,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":130,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3036,3036],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<template>\n  <div class=\"flexible-config-form\">\n    <!-- æ¨¡å¼æŒ‡ç¤ºå™¨ -->\n    <div v-if=\"showModeIndicator\" class=\"mode-indicator\">\n      <n-tag :type=\"getModeTagType()\" size=\"small\">\n        {{ getModeLabel() }}\n      </n-tag>\n    </div>\n\n    <!-- è‡ªåŠ¨è¡¨å•ç”Ÿæˆå™¨ -->\n    <AutoFormGenerator\n      v-model=\"configValues\"\n      :ts-config=\"tsConfig\"\n      :vue-config=\"vueConfig\"\n      :mode=\"detectedMode\"\n      :readonly=\"readonly\"\n      @change=\"handleConfigChange\"\n      @validate=\"handleValidate\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, watch, onMounted } from 'vue'\nimport { NTag } from 'naive-ui'\nimport type { Component } from 'vue'\nimport AutoFormGenerator from './AutoFormGenerator.vue'\nimport type { TSConfig, ConfigMode, ConfigValues } from './config-types'\nimport { FlexibleConfigManager } from './config-manager'\n\ninterface Props {\n  // ç»„ä»¶ç±»å‹ï¼ˆç”¨äºè‡ªåŠ¨æ£€æµ‹é…ç½®ï¼‰\n  componentType?: string\n\n  // ç›´æ¥ä¼ å…¥é…ç½®ï¼ˆå¯é€‰ï¼‰\n  tsConfig?: TSConfig\n  vueConfig?: Component\n\n  // å½“å‰é…ç½®å€¼\n  modelValue?: ConfigValues\n\n  // æ˜¯å¦åªè¯»\n  readonly?: boolean\n\n  // æ˜¯å¦æ˜¾ç¤ºæ¨¡å¼æŒ‡ç¤ºå™¨\n  showModeIndicator?: boolean\n}\n\ninterface Emits {\n  (event: 'update:modelValue', value: ConfigValues): void\n  (event: 'change', value: ConfigValues): void\n  (event: 'validate', result: { valid: boolean; errors: string[] }): void\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  modelValue: () => ({}),\n  readonly: false,\n  showModeIndicator: false\n})\n\nconst emit = defineEmits<Emits>()\n\n// å“åº”å¼æ•°æ®\nconst configValues = ref<ConfigValues>({})\nconst tsConfig = ref<TSConfig>()\nconst vueConfig = ref<Component>()\n\n// æ£€æµ‹åˆ°çš„é…ç½®æ¨¡å¼\nconst detectedMode = computed<ConfigMode>(() => {\n  try {\n    return FlexibleConfigManager.detectConfigMode(vueConfig.value, tsConfig.value)\n  } catch {\n    return 'vue-only'\n  }\n})\n\n// æ¨¡å¼æ ‡ç­¾ç±»å‹\nconst getModeTagType = () => {\n  switch (detectedMode.value) {\n    case 'ts-only':\n      return 'info'\n    case 'vue-only':\n      return 'success'\n    case 'hybrid':\n      return 'warning'\n    default:\n      return 'default'\n  }\n}\n\n// æ¨¡å¼æ ‡ç­¾æ–‡æœ¬\nconst getModeLabel = () => {\n  switch (detectedMode.value) {\n    case 'ts-only':\n      return 'TSé…ç½®'\n    case 'vue-only':\n      return 'Vueé…ç½®'\n    case 'hybrid':\n      return 'æ··åˆé…ç½®'\n    default:\n      return 'æœªçŸ¥æ¨¡å¼'\n  }\n}\n\n// è‡ªåŠ¨æ£€æµ‹ç»„ä»¶é…ç½®\nconst detectComponentConfig = async () => {\n  if (!props.componentType) return\n\n  try {\n    // å°è¯•åŠ¨æ€å¯¼å…¥TSé…ç½®\n    try {\n      // ä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼Œæ”¯æŒä»»æ„ç»„ä»¶ç±»å‹\n      const tsConfigPath = `/src/card2.1/components/${props.componentType}/config.ts`\n      const tsModule = await import(/* @vite-ignore */ tsConfigPath)\n\n      if (tsModule.testComponentTSConfig || tsModule.default) {\n        tsConfig.value = tsModule.testComponentTSConfig || tsModule.default\n      }\n    } catch (e) {}\n\n    // å°è¯•åŠ¨æ€å¯¼å…¥Vueé…ç½®\n    try {\n      const vueConfigPath = `/src/card2.1/components/${props.componentType}/config.vue`\n      const vueModule = await import(/* @vite-ignore */ vueConfigPath)\n\n      if (vueModule.default) {\n        vueConfig.value = vueModule.default\n      }\n    } catch (e) {}\n  } catch (error) {}\n}\n\n// å¤„ç†é…ç½®å˜åŒ–\nconst handleConfigChange = (newValues: ConfigValues) => {\n  configValues.value = { ...newValues }\n  emit('update:modelValue', newValues)\n  emit('change', newValues)\n}\n\n// å¤„ç†éªŒè¯ç»“æœ\nconst handleValidate = (result: { valid: boolean; errors: string[] }) => {\n  emit('validate', result)\n}\n\n// ç›‘å¬å¤–éƒ¨å€¼å˜åŒ–\nwatch(\n  () => props.modelValue,\n  newValue => {\n    if (newValue) {\n      configValues.value = { ...newValue }\n    }\n  },\n  { immediate: true, deep: true }\n)\n\n// ç›‘å¬ç»„ä»¶ç±»å‹å˜åŒ–\nwatch(\n  () => props.componentType,\n  () => {\n    detectComponentConfig()\n  },\n  { immediate: true }\n)\n\n// ç›‘å¬ç›´æ¥ä¼ å…¥çš„é…ç½®\nwatch(\n  () => [props.tsConfig, props.vueConfig],\n  () => {\n    if (props.tsConfig) tsConfig.value = props.tsConfig\n    if (props.vueConfig) vueConfig.value = props.vueConfig\n  },\n  { immediate: true }\n)\n\n// ç»„ä»¶æŒ‚è½½\nonMounted(() => {\n  // è®¾ç½®åˆå§‹å€¼\n  if (props.modelValue) {\n    configValues.value = { ...props.modelValue }\n  }\n})\n</script>\n\n<style scoped>\n.flexible-config-form {\n  width: 100%;\n}\n\n.mode-indicator {\n  margin-bottom: 12px;\n  text-align: right;\n}\n</style>\n","usedDeprecatedRules":[{"ruleId":"vue/component-tags-order","replacedBy":["block-order"]}]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\auto-registry.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'filterComponentsByPermission' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filterComponentsByPermission' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":65,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":65,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":65,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1914,1914],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card 2.1 è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿ\n * æ”¯æŒç›®å½•æ‰«æã€è‡ªåŠ¨åˆ†ç±»å’Œæ ‘å½¢ç»“æ„ç”Ÿæˆ\n */\n\nimport type { ComponentDefinition, IComponentRegistry } from './types'\nimport { filterComponentsByPermission, getUserAuthorityFromStorage } from './permission-utils'\n\nexport interface ComponentCategory {\n  id: string\n  name: string\n  description?: string\n  icon?: string\n  children?: ComponentCategory[]\n}\n\nexport interface ComponentTree {\n  categories: ComponentCategory[]\n  components: ComponentDefinition[]\n  totalCount: number\n}\n\nexport class AutoRegistry {\n  private registry: IComponentRegistry\n  private componentModules: Map<string, any> = new Map()\n  private categoryTree: ComponentCategory[] = []\n  private allComponents: ComponentDefinition[] = [] // å­˜å‚¨æ‰€æœ‰ç»„ä»¶ï¼ˆåŒ…æ‹¬æ— æƒé™çš„ï¼‰\n\n  constructor(registry: IComponentRegistry) {\n    this.registry = registry\n  }\n\n  /**\n   * è‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œç»„ä»¶\n   * @param componentModules ç»„ä»¶æ¨¡å—æ˜ å°„\n   */\n  async autoRegister(componentModules: Record<string, any>) {\n    const registeredComponents: ComponentDefinition[] = []\n    const userAuthority = getUserAuthorityFromStorage()\n    for (const [componentId, module] of Object.entries(componentModules)) {\n      try {\n        // è·å–é»˜è®¤å¯¼å‡ºï¼ˆç»„ä»¶å®šä¹‰ï¼‰\n        const definition = module.default || module\n\n        if (this.isValidComponentDefinition(definition)) {\n          // æ£€æŸ¥æƒé™\n          const hasPermission = this.checkComponentPermission(definition, userAuthority)\n\n          if (hasPermission) {\n            // æ£€æŸ¥æ˜¯å¦åº”è¯¥æ³¨å†Œ\n            if (this.shouldRegisterComponent(definition)) {\n              // è‡ªåŠ¨ç”Ÿæˆåˆ†ç±»ä¿¡æ¯\n              this.autoGenerateCategories(definition)\n\n              // æ³¨å†Œç»„ä»¶\n              this.registry.register(componentId, definition)\n              registeredComponents.push(definition)\n              this.allComponents.push(definition)\n            }\n          } else {\n            // è®°å½•è¢«æƒé™è¿‡æ»¤çš„ç»„ä»¶\n            this.allComponents.push(definition)\n          }\n        }\n      } catch (error) {}\n    }\n    return registeredComponents\n  }\n\n  /**\n   * æ£€æŸ¥ç»„ä»¶æƒé™\n   */\n  private checkComponentPermission(definition: ComponentDefinition, userAuthority: string): boolean {\n    const permission = definition.permission || 'ä¸é™'\n\n    // å¦‚æœç»„ä»¶æƒé™æ˜¯\"ä¸é™\"ï¼Œåˆ™æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®\n    if (permission === 'ä¸é™') {\n      return true\n    }\n\n    // å¦‚æœç”¨æˆ·æƒé™æ˜¯\"ä¸é™\"ï¼Œåˆ™ä¸èƒ½è®¿é—®ä»»ä½•æœ‰æƒé™é™åˆ¶çš„ç»„ä»¶\n    if (userAuthority === 'ä¸é™') {\n      return false\n    }\n\n    // æƒé™ç­‰çº§æ£€æŸ¥\n    const permissionLevels = {\n      SYS_ADMIN: 4,\n      TENANT_ADMIN: 3,\n      TENANT_USER: 2,\n      ä¸é™: 1\n    }\n\n    const componentLevel = permissionLevels[permission]\n    const userLevel = permissionLevels[userAuthority as keyof typeof permissionLevels] || 0\n    const hasPermission = userLevel >= componentLevel\n    return hasPermission\n  }\n\n  /**\n   * æ£€æŸ¥ç»„ä»¶æ˜¯å¦åº”è¯¥æ³¨å†Œ\n   */\n  private shouldRegisterComponent(definition: ComponentDefinition): boolean {\n    // æ£€æŸ¥æ³¨å†Œè®¾ç½®ï¼Œé»˜è®¤ä¸ºtrueï¼ˆæ³¨å†Œï¼‰\n    const isRegistered = definition.isRegistered !== false // åªæœ‰æ˜ç¡®è®¾ç½®ä¸ºfalseæ‰ä¸æ³¨å†Œ\n\n    // ç‰¹åˆ«è®°å½• universal-data-viz çš„æ³¨å†Œæ£€æŸ¥\n    if (!isRegistered) {\n      return false\n    }\n    return true\n  }\n\n  /**\n   * éªŒè¯ç»„ä»¶å®šä¹‰æ˜¯å¦æœ‰æ•ˆ\n   */\n  private isValidComponentDefinition(definition: any): definition is ComponentDefinition {\n    return (\n      definition &&\n      typeof definition.type === 'string' &&\n      typeof definition.name === 'string' &&\n      typeof definition.component === 'object'\n    )\n  }\n\n  /**\n   * è‡ªåŠ¨ç”Ÿæˆåˆ†ç±»æ ‘\n   */\n  private autoGenerateCategories(definition: ComponentDefinition) {\n    const { mainCategory = 'å…¶ä»–', subCategory = 'æœªåˆ†ç±»' } = definition\n\n    // æŸ¥æ‰¾æˆ–åˆ›å»ºä¸»åˆ†ç±»\n    let mainCat = this.categoryTree.find(cat => cat.id === mainCategory)\n    if (!mainCat) {\n      mainCat = {\n        id: mainCategory,\n        name: this.getCategoryDisplayName(mainCategory),\n        description: this.getCategoryDescription(mainCategory)\n      }\n      this.categoryTree.push(mainCat)\n    }\n\n    // æŸ¥æ‰¾æˆ–åˆ›å»ºå­åˆ†ç±»\n    if (!mainCat.children) {\n      mainCat.children = []\n    }\n\n    let subCat = mainCat.children.find(cat => cat.id === subCategory)\n    if (!subCat) {\n      subCat = {\n        id: subCategory,\n        name: this.getCategoryDisplayName(subCategory),\n        description: this.getCategoryDescription(subCategory)\n      }\n      mainCat.children.push(subCat)\n    }\n  }\n\n  /**\n   * è·å–åˆ†ç±»æ˜¾ç¤ºåç§°\n   */\n  private getCategoryDisplayName(categoryId: string): string {\n    const displayNames: Record<string, string> = {\n      ç³»ç»Ÿ: 'ç³»ç»Ÿç»„ä»¶',\n      æ›²çº¿: 'å›¾è¡¨ç»„ä»¶',\n      å…¶ä»–: 'å…¶ä»–ç»„ä»¶',\n      æœªåˆ†ç±»: 'æœªåˆ†ç±»ç»„ä»¶'\n    }\n    return displayNames[categoryId] || categoryId\n  }\n\n  /**\n   * è·å–åˆ†ç±»æè¿°\n   */\n  private getCategoryDescription(categoryId: string): string {\n    const descriptions: Record<string, string> = {\n      ç³»ç»Ÿ: 'ç³»ç»Ÿç›‘æ§å’ŒçŠ¶æ€æ˜¾ç¤ºç»„ä»¶',\n      æ›²çº¿: 'æ•°æ®å¯è§†åŒ–å’Œå›¾è¡¨ç»„ä»¶',\n      å…¶ä»–: 'å…¶ä»–åŠŸèƒ½ç»„ä»¶',\n      æœªåˆ†ç±»: 'å¾…åˆ†ç±»çš„ç»„ä»¶'\n    }\n    return descriptions[categoryId] || ''\n  }\n\n  /**\n   * è·å–ç»„ä»¶æ ‘å½¢ç»“æ„ï¼ˆæƒé™è¿‡æ»¤åï¼‰\n   */\n  getComponentTree(): ComponentTree {\n    const components = this.registry.getAll()\n    return {\n      categories: this.categoryTree,\n      components,\n      totalCount: components.length\n    }\n  }\n\n  /**\n   * è·å–æ‰€æœ‰ç»„ä»¶ï¼ˆåŒ…æ‹¬æ— æƒé™çš„ï¼Œç”¨äºè°ƒè¯•ï¼‰\n   */\n  getAllComponents(): ComponentDefinition[] {\n    return this.allComponents\n  }\n\n  /**\n   * æŒ‰åˆ†ç±»è·å–ç»„ä»¶ï¼ˆæƒé™è¿‡æ»¤åï¼‰\n   */\n  getComponentsByCategory(mainCategory?: string, subCategory?: string): ComponentDefinition[] {\n    const components = this.registry.getAll()\n\n    if (!mainCategory) {\n      return components\n    }\n\n    let filtered = components.filter(comp => comp.mainCategory === mainCategory)\n\n    if (subCategory) {\n      filtered = filtered.filter(comp => comp.subCategory === subCategory)\n    }\n\n    return filtered\n  }\n\n  /**\n   * è·å–æ‰€æœ‰åˆ†ç±»\n   */\n  getCategories(): ComponentCategory[] {\n    return this.categoryTree\n  }\n\n  /**\n   * é‡æ–°åº”ç”¨æƒé™è¿‡æ»¤ï¼ˆå½“ç”¨æˆ·æƒé™å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨ï¼‰\n   */\n  reapplyPermissionFilter(): void {\n    const userAuthority = getUserAuthorityFromStorage()\n    // æ¸…ç©ºæ³¨å†Œè¡¨\n    this.registry = new (this.registry.constructor as any)()\n\n    // é‡æ–°æ³¨å†Œæœ‰æƒé™çš„ç»„ä»¶\n    for (const component of this.allComponents) {\n      if (this.checkComponentPermission(component, userAuthority)) {\n        this.registry.register(component.type, component)\n      }\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\component-data-requirements.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":39,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ç»„ä»¶æ•°æ®éœ€æ±‚å£°æ˜ç³»ç»Ÿ\n * ä¸º Card2.1 ç»„ä»¶æä¾›æ•°æ®éœ€æ±‚å£°æ˜å’Œæ³¨å†ŒåŠŸèƒ½\n *\n * è¿™æ˜¯å¯¹ data-binding ç³»ç»Ÿçš„æ‰©å±•ï¼Œä¸“æ³¨äºç»„ä»¶æ•°æ®éœ€æ±‚çš„å£°æ˜å¼å®šä¹‰\n */\n\nimport type { ComponentDataRequirement, DataFieldRequirement } from './data-binding/types'\nimport { ComponentRequirementManager } from './data-binding/component-requirement-manager'\n\n// åˆ›å»ºå…¨å±€å®ä¾‹\nexport const componentDataRequirementsRegistry = new ComponentRequirementManager()\n\n/**\n * æ•°æ®å­—æ®µç±»å‹å®šä¹‰\n */\nexport type DataFieldType = 'string' | 'number' | 'boolean' | 'date' | 'array' | 'object'\n\n/**\n * æ•°æ®å­—æ®µæšä¸¾é€‰é¡¹\n */\nexport interface DataFieldEnumOption {\n  label: string\n  value: any\n  description?: string\n}\n\n/**\n * æ•°æ®å­—æ®µéªŒè¯è§„åˆ™\n */\nexport interface DataFieldValidation {\n  required?: boolean\n  min?: number\n  max?: number\n  minLength?: number\n  maxLength?: number\n  pattern?: string\n  enum?: any[]\n  custom?: (value: any) => boolean | string\n}\n\n/**\n * æ•°æ®å­—æ®µé…ç½®é€‰é¡¹\n */\nexport interface DataFieldOptions {\n  description?: string\n  required?: boolean\n  defaultValue?: any\n  example?: any\n  validation?: DataFieldValidation\n  enum?: DataFieldEnumOption[]\n  itemSchema?: any // ç”¨äºæ•°ç»„ç±»å‹çš„é¡¹ç›®æ¨¡å¼\n  tags?: string[]\n  group?: string\n  [key: string]: any\n}\n\n/**\n * æ•°æ®æ›´æ–°é…ç½®\n */\nexport interface DataUpdateConfig {\n  supportedTriggers: ('timer' | 'websocket' | 'manual' | 'event' | 'mqtt')[]\n  recommendedInterval?: number\n  minInterval?: number\n  maxInterval?: number\n  validation?: {\n    requiredFields?: string[]\n    stringFields?: string[]\n    numericFields?: string[]\n    booleanFields?: string[]\n    enumFields?: Array<{ field: string; values: any[] }>\n  }\n}\n\n/**\n * ä½¿ç”¨åœºæ™¯å®šä¹‰\n */\nexport interface UseCase {\n  name: string\n  description: string\n  exampleData: Record<string, any>\n  tags?: string[]\n}\n\n/**\n * ä¸»è¦æ•°æ®éœ€æ±‚å®šä¹‰\n */\nexport interface PrimaryDataRequirement {\n  name: string\n  label: string\n  description: string\n  type: DataFieldType\n  required: boolean\n  defaultValue?: any\n  validation?: DataFieldValidation\n  example?: any\n  tags?: string[]\n}\n\n/**\n * ç»„ä»¶æ•°æ®éœ€æ±‚é…ç½®\n */\nexport interface ComponentDataRequirementConfig {\n  description: string\n  category?: string\n  version?: string\n  primaryData: PrimaryDataRequirement\n  dataFields: DataFieldRequirement[]\n  updateConfig?: DataUpdateConfig\n  useCases?: UseCase[]\n  tags?: string[]\n  metadata?: Record<string, any>\n}\n\n/**\n * åˆ›å»ºæ•°æ®å­—æ®µå®šä¹‰\n */\nexport function createDataField(\n  name: string,\n  label: string,\n  type: DataFieldType,\n  options: DataFieldOptions = {}\n): DataFieldRequirement {\n  return {\n    name,\n    label,\n    type,\n    description: options.description || '',\n    required: options.required || false,\n    defaultValue: options.defaultValue,\n    validation: options.validation || {},\n    example: options.example,\n    enum: options.enum,\n    itemSchema: options.itemSchema,\n    tags: options.tags || [],\n    group: options.group,\n    metadata: {\n      ...options\n    }\n  }\n}\n\n/**\n * åˆ›å»ºç»„ä»¶æ•°æ®éœ€æ±‚å£°æ˜\n */\nexport function createDataRequirement(\n  componentType: string,\n  displayName: string,\n  config: ComponentDataRequirementConfig\n): ComponentDataRequirement {\n  return {\n    componentType,\n    displayName,\n    description: config.description,\n    category: config.category || 'default',\n    version: config.version || '1.0.0',\n\n    // ä¸»è¦æ•°æ®å­—æ®µ\n    primaryData: {\n      name: config.primaryData.name,\n      label: config.primaryData.label,\n      description: config.primaryData.description,\n      type: config.primaryData.type,\n      required: config.primaryData.required,\n      defaultValue: config.primaryData.defaultValue,\n      validation: config.primaryData.validation || {},\n      example: config.primaryData.example,\n      tags: config.primaryData.tags || []\n    },\n\n    // æ•°æ®å­—æ®µåˆ—è¡¨\n    dataFields: config.dataFields,\n\n    // æ•°æ®å…³ç³»ï¼ˆæš‚æ—¶ä¸ºç©ºï¼Œåç»­å¯æ‰©å±•ï¼‰\n    relationships: [],\n\n    // æ›´æ–°é…ç½®\n    updateConfig: config.updateConfig || {\n      supportedTriggers: ['timer', 'manual'],\n      recommendedInterval: 5000,\n      minInterval: 1000\n    },\n\n    // ä½¿ç”¨åœºæ™¯\n    useCases: config.useCases || [],\n\n    // æ ‡ç­¾å’Œå…ƒæ•°æ®\n    tags: config.tags || [],\n    metadata: {\n      ...config.metadata,\n      createdAt: new Date().toISOString(),\n      dataFieldsCount: config.dataFields.length,\n      hasValidation: config.dataFields.some(field => field.validation && Object.keys(field.validation).length > 0),\n      supportedTriggers: config.updateConfig?.supportedTriggers || ['timer', 'manual']\n    }\n  }\n}\n\n/**\n * å¸¸ç”¨æ•°æ®å­—æ®µé¢„è®¾\n */\nexport const CommonDataFields = {\n  /**\n   * æ ‡é¢˜å­—æ®µ\n   */\n  title: (options: Partial<DataFieldOptions> = {}) =>\n    createDataField('title', 'æ ‡é¢˜', 'string', {\n      description: 'ç»„ä»¶çš„æ ‡é¢˜æ–‡å­—',\n      required: false,\n      defaultValue: '',\n      maxLength: 100,\n      tags: ['title', 'display'],\n      ...options\n    }),\n\n  /**\n   * å†…å®¹å­—æ®µ\n   */\n  content: (options: Partial<DataFieldOptions> = {}) =>\n    createDataField('content', 'å†…å®¹', 'string', {\n      description: 'ç»„ä»¶çš„ä¸»è¦å†…å®¹',\n      required: false,\n      defaultValue: '',\n      maxLength: 500,\n      tags: ['content', 'text'],\n      ...options\n    }),\n\n  /**\n   * æ•°å€¼å­—æ®µ\n   */\n  value: (options: Partial<DataFieldOptions> = {}) =>\n    createDataField('value', 'æ•°å€¼', 'number', {\n      description: 'ç»„ä»¶æ˜¾ç¤ºçš„æ•°å€¼',\n      required: false,\n      defaultValue: 0,\n      tags: ['value', 'number'],\n      ...options\n    }),\n\n  /**\n   * çŠ¶æ€å­—æ®µ\n   */\n  status: (options: Partial<DataFieldOptions> = {}) =>\n    createDataField('status', 'çŠ¶æ€', 'string', {\n      description: 'ç»„ä»¶çš„çŠ¶æ€',\n      required: false,\n      defaultValue: 'normal',\n      enum: [\n        { label: 'æ­£å¸¸', value: 'normal' },\n        { label: 'è­¦å‘Š', value: 'warning' },\n        { label: 'é”™è¯¯', value: 'error' }\n      ],\n      tags: ['status', 'state'],\n      ...options\n    }),\n\n  /**\n   * æ—¶é—´æˆ³å­—æ®µ\n   */\n  timestamp: (options: Partial<DataFieldOptions> = {}) =>\n    createDataField('timestamp', 'æ—¶é—´æˆ³', 'date', {\n      description: 'æ•°æ®çš„æ—¶é—´æˆ³',\n      required: false,\n      defaultValue: new Date(),\n      tags: ['timestamp', 'time'],\n      ...options\n    }),\n\n  /**\n   * é…ç½®å¯¹è±¡å­—æ®µ\n   */\n  config: (options: Partial<DataFieldOptions> = {}) =>\n    createDataField('config', 'é…ç½®', 'object', {\n      description: 'ç»„ä»¶çš„é…ç½®å¯¹è±¡',\n      required: false,\n      defaultValue: {},\n      tags: ['config', 'settings'],\n      ...options\n    }),\n\n  /**\n   * æ•°æ®åˆ—è¡¨å­—æ®µ\n   */\n  dataList: (options: Partial<DataFieldOptions> = {}) =>\n    createDataField('dataList', 'æ•°æ®åˆ—è¡¨', 'array', {\n      description: 'ç»„ä»¶çš„æ•°æ®åˆ—è¡¨',\n      required: false,\n      defaultValue: [],\n      itemSchema: {\n        type: 'object',\n        properties: {\n          label: { type: 'string' },\n          value: { type: 'number' }\n        }\n      },\n      tags: ['list', 'data'],\n      ...options\n    })\n}\n\n/**\n * æ•°æ®éœ€æ±‚éªŒè¯å™¨\n */\nexport class DataRequirementValidator {\n  /**\n   * éªŒè¯æ•°æ®å­—æ®µå®šä¹‰\n   */\n  static validateDataField(field: DataFieldRequirement): { valid: boolean; errors: string[] } {\n    const errors: string[] = []\n\n    if (!field.name || typeof field.name !== 'string') {\n      errors.push('æ•°æ®å­—æ®µåç§°ä¸èƒ½ä¸ºç©º')\n    }\n\n    if (!field.label || typeof field.label !== 'string') {\n      errors.push('æ•°æ®å­—æ®µæ ‡ç­¾ä¸èƒ½ä¸ºç©º')\n    }\n\n    if (!field.type) {\n      errors.push('æ•°æ®å­—æ®µç±»å‹ä¸èƒ½ä¸ºç©º')\n    }\n\n    const validTypes: DataFieldType[] = ['string', 'number', 'boolean', 'date', 'array', 'object']\n    if (field.type && !validTypes.includes(field.type)) {\n      errors.push(`æ— æ•ˆçš„æ•°æ®å­—æ®µç±»å‹: ${field.type}`)\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors\n    }\n  }\n\n  /**\n   * éªŒè¯ç»„ä»¶æ•°æ®éœ€æ±‚\n   */\n  static validateDataRequirement(requirement: ComponentDataRequirement): { valid: boolean; errors: string[] } {\n    const errors: string[] = []\n\n    if (!requirement.componentType) {\n      errors.push('ç»„ä»¶ç±»å‹ä¸èƒ½ä¸ºç©º')\n    }\n\n    if (!requirement.displayName) {\n      errors.push('ç»„ä»¶æ˜¾ç¤ºåç§°ä¸èƒ½ä¸ºç©º')\n    }\n\n    if (!requirement.primaryData) {\n      errors.push('ä¸»è¦æ•°æ®å­—æ®µä¸èƒ½ä¸ºç©º')\n    } else {\n      const primaryValidation = this.validateDataField(requirement.primaryData as DataFieldRequirement)\n      if (!primaryValidation.valid) {\n        errors.push(`ä¸»è¦æ•°æ®å­—æ®µéªŒè¯å¤±è´¥: ${primaryValidation.errors.join(', ')}`)\n      }\n    }\n\n    if (requirement.dataFields) {\n      requirement.dataFields.forEach((field, index) => {\n        const fieldValidation = this.validateDataField(field)\n        if (!fieldValidation.valid) {\n          errors.push(`æ•°æ®å­—æ®µ ${index + 1} éªŒè¯å¤±è´¥: ${fieldValidation.errors.join(', ')}`)\n        }\n      })\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors\n    }\n  }\n}\n\n/**\n * å·¥å…·å‡½æ•°ï¼šè·å–ç»„ä»¶çš„æ•°æ®éœ€æ±‚ç»Ÿè®¡\n */\nexport function getDataRequirementStats(requirement: ComponentDataRequirement) {\n  return {\n    totalFields: requirement.dataFields.length + 1, // +1 for primaryData\n    requiredFields:\n      requirement.dataFields.filter(field => field.required).length + (requirement.primaryData.required ? 1 : 0),\n    fieldTypes: {\n      string: requirement.dataFields.filter(field => field.type === 'string').length,\n      number: requirement.dataFields.filter(field => field.type === 'number').length,\n      boolean: requirement.dataFields.filter(field => field.type === 'boolean').length,\n      date: requirement.dataFields.filter(field => field.type === 'date').length,\n      array: requirement.dataFields.filter(field => field.type === 'array').length,\n      object: requirement.dataFields.filter(field => field.type === 'object').length\n    },\n    hasValidation: requirement.dataFields.some(field => field.validation && Object.keys(field.validation).length > 0),\n    supportedTriggers: requirement.updateConfig?.supportedTriggers || [],\n    useCasesCount: requirement.useCases?.length || 0\n  }\n}\n\n/**\n * å·¥å…·å‡½æ•°ï¼šç”Ÿæˆæ•°æ®éœ€æ±‚çš„ç¤ºä¾‹æ•°æ®\n */\nexport function generateExampleData(requirement: ComponentDataRequirement): Record<string, any> {\n  const exampleData: Record<string, any> = {}\n\n  // æ·»åŠ ä¸»è¦æ•°æ®å­—æ®µçš„ç¤ºä¾‹\n  if (requirement.primaryData && requirement.primaryData.example !== undefined) {\n    exampleData[requirement.primaryData.name] = requirement.primaryData.example\n  }\n\n  // æ·»åŠ å…¶ä»–æ•°æ®å­—æ®µçš„ç¤ºä¾‹\n  requirement.dataFields.forEach(field => {\n    if (field.example !== undefined) {\n      exampleData[field.name] = field.example\n    } else if (field.defaultValue !== undefined) {\n      exampleData[field.name] = field.defaultValue\n    }\n  })\n\n  return exampleData\n}\n\n// å¯¼å‡ºä¾¿æ·å‡½æ•°\nexport { componentDataRequirementsRegistry as registry }\n\n// é»˜è®¤å¯¼å‡º\nexport default {\n  componentDataRequirementsRegistry,\n  createDataRequirement,\n  createDataField,\n  CommonDataFields,\n  DataRequirementValidator,\n  getDataRequirementStats,\n  generateExampleData\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\component-loader.ts","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":51,"column":18,"nodeType":"BlockStatement","messageId":"unexpected","endLine":52,"endColumn":12,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1445,1456],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":53,"column":16,"nodeType":"BlockStatement","messageId":"unexpected","endLine":54,"endColumn":10,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1474,1483],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":57,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":88,"column":22,"nodeType":"BlockStatement","messageId":"unexpected","endLine":89,"endColumn":8,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2407,2414],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":106,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":106,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":106,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":106,"endColumn":19}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card 2.1 ç»„ä»¶åŠ è½½å™¨\n * æ”¯æŒåŠ¨æ€å¯¼å…¥å’Œç›®å½•æ‰«æ\n */\n\nimport type { ComponentDefinition } from './types'\n\nexport interface ComponentModule {\n  default: ComponentDefinition\n  [key: string]: any\n}\n\nexport interface ComponentLoaderOptions {\n  basePath?: string\n  pattern?: string\n  exclude?: string[]\n}\n\nexport class ComponentLoader {\n  private basePath: string\n  private pattern: string\n  private exclude: string[]\n\n  constructor(options: ComponentLoaderOptions = {}) {\n    this.basePath = options.basePath || '../components'\n    this.pattern = options.pattern || '**/index.ts'\n    this.exclude = options.exclude || ['node_modules', '.git', 'dist']\n  }\n\n  /**\n   * åŠ¨æ€å¯¼å…¥ç»„ä»¶æ¨¡å—\n   * ä½¿ç”¨ Vite çš„ import.meta.glob è¿›è¡ŒåŠ¨æ€å¯¼å…¥\n   */\n  async loadComponents(): Promise<Record<string, ComponentModule>> {\n    try {\n      // ä½¿ç”¨ Vite çš„åŠ¨æ€å¯¼å…¥åŠŸèƒ½ - æ”¯æŒå¤šç§æ‰«ææ¨¡å¼\n      // ä½¿ç”¨ Vite çš„åŠ¨æ€å¯¼å…¥åŠŸèƒ½ - æ”¯æŒé€’å½’æ‰«æ\n      const allModules = import.meta.glob('../components/**/index.{ts,js}', { eager: true })\n\n      const componentModules: Record<string, ComponentModule> = {}\n\n      for (const [path, module] of Object.entries(allModules)) {\n        // ä»è·¯å¾„ä¸­æå–ç»„ä»¶ID\n        const componentId = this.extractComponentId(path)\n\n        if (componentId && this.shouldIncludeComponent(componentId)) {\n          // è·å–é»˜è®¤å¯¼å‡ºæˆ–æ•´ä¸ªæ¨¡å—\n          const definition = module.default || module\n          if (definition && definition.type) {\n            componentModules[componentId] = { default: definition }\n          } else {\n          }\n        } else {\n        }\n      }\n      return componentModules\n    } catch (error) {\n      return {}\n    }\n  }\n\n  /**\n   * ä»è·¯å¾„ä¸­æå–ç»„ä»¶ID\n   */\n  private extractComponentId(path: string): string | null {\n    // åŒ¹é…æ›´çµæ´»çš„è·¯å¾„æ ¼å¼ï¼Œæ”¯æŒè¿å­—ç¬¦å’Œä¸‹åˆ’çº¿\n    // ä¼˜å…ˆåŒ¹é…: ../components/universal-data-viz/index.ts\n    const match = path.match(/\\.\\.\\/components\\/(?:.*\\/)?([^/]+)\\/index\\.(ts|js)$/)\n    const componentId = match ? match[1] : null\n    return componentId\n  }\n\n  /**\n   * åˆ¤æ–­æ˜¯å¦åº”è¯¥åŒ…å«è¯¥ç»„ä»¶\n   */\n  private shouldIncludeComponent(componentId: string): boolean {\n    return !this.exclude.some(pattern => componentId.includes(pattern) || pattern.includes(componentId))\n  }\n\n  /**\n   * éªŒè¯ç»„ä»¶å®šä¹‰\n   */\n  validateComponentDefinition(definition: any): definition is ComponentDefinition {\n    const requiredFields = ['type', 'name', 'component']\n\n    return requiredFields.every(field => {\n      const hasField = definition && definition[field] !== undefined\n      if (!hasField) {\n      }\n      return hasField\n    })\n  }\n\n  /**\n   * è·å–ç»„ä»¶ç»Ÿè®¡ä¿¡æ¯\n   */\n  getComponentStats(modules: Record<string, ComponentModule>) {\n    const stats = {\n      total: Object.keys(modules).length,\n      valid: 0,\n      invalid: 0,\n      categories: new Set<string>(),\n      subCategories: new Set<string>()\n    }\n\n    for (const [id, module] of Object.entries(modules)) {\n      const definition = module.default || module\n\n      if (this.validateComponentDefinition(definition)) {\n        stats.valid++\n        if (definition.mainCategory) {\n          stats.categories.add(definition.mainCategory)\n        }\n        if (definition.subCategory) {\n          stats.subCategories.add(definition.subCategory)\n        }\n      } else {\n        stats.invalid++\n      }\n    }\n\n    return {\n      ...stats,\n      categories: Array.from(stats.categories),\n      subCategories: Array.from(stats.subCategories)\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\component-registry.ts","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":34,"column":22,"nodeType":"BlockStatement","messageId":"unexpected","endLine":35,"endColumn":6,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[822,827],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":156,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":156,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":156,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":156,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3695,3695],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'definition' is defined but never used.","line":194,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":194,"endColumn":43},{"ruleId":"no-unused-vars","severity":1,"message":"'componentType' is defined but never used.","line":195,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":195,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'componentType' is defined but never used.","line":197,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":197,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'componentType' is defined but never used.","line":198,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":198,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'componentType' is defined but never used.","line":199,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":199,"endColumn":43},{"ruleId":"no-unused-vars","severity":1,"message":"'componentType' is defined but never used.","line":200,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":200,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'settingConfig' is defined but never used.","line":201,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":201,"endColumn":96},{"ruleId":"no-unused-vars","severity":1,"message":"'settingConfigs' is defined but never used.","line":202,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":202,"endColumn":71},{"ruleId":"no-unused-vars","severity":1,"message":"'definition' is defined but never used.","line":204,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":204,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'settingConfig' is defined but never used.","line":205,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":205,"endColumn":46},{"ruleId":"no-unused-vars","severity":1,"message":"'args' is defined but never used.","line":218,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":218,"endColumn":44}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card2.1 ç»„ä»¶æ³¨å†Œè¡¨\n * æä¾›ç»„ä»¶å®šä¹‰çš„ç»Ÿä¸€ç®¡ç†å’ŒæŸ¥è¯¢æœåŠ¡\n * æ”¯æŒ settingConfig çš„è‡ªåŠ¨å±æ€§æš´éœ²æ³¨å†Œ\n */\n\nimport type { ComponentDefinition } from './types'\nimport type { ComponentSettingConfig } from '../types/setting-config'\nimport { autoRegisterFromSettingConfig } from './property-exposure'\n\n/**\n * ç»„ä»¶æ³¨å†Œè¡¨ç±»\n * è´Ÿè´£ç®¡ç†æ‰€æœ‰ Card2.1 ç»„ä»¶çš„å®šä¹‰ä¿¡æ¯\n */\nexport class ComponentRegistry {\n  private static definitions = new Map<string, ComponentDefinition>()\n\n  /**\n   * æ³¨å†Œç»„ä»¶å®šä¹‰\n   * @param definition ç»„ä»¶å®šä¹‰\n   */\n  static register(definition: ComponentDefinition): void {\n    this.definitions.set(definition.type, definition)\n  }\n\n  /**\n   * è·å–ç»„ä»¶å®šä¹‰\n   * @param componentType ç»„ä»¶ç±»å‹\n   * @returns ç»„ä»¶å®šä¹‰æˆ– undefined\n   */\n  static get(componentType: string): ComponentDefinition | undefined {\n    const definition = this.definitions.get(componentType)\n\n    if (!definition) {\n    }\n\n    return definition\n  }\n\n  /**\n   * è·å–æ‰€æœ‰ç»„ä»¶å®šä¹‰\n   * @returns æ‰€æœ‰ç»„ä»¶å®šä¹‰æ•°ç»„\n   */\n  static getAll(): ComponentDefinition[] {\n    return Array.from(this.definitions.values())\n  }\n\n  /**\n   * æ£€æŸ¥ç»„ä»¶æ˜¯å¦å·²æ³¨å†Œ\n   * @param componentType ç»„ä»¶ç±»å‹\n   * @returns æ˜¯å¦å·²æ³¨å†Œ\n   */\n  static has(componentType: string): boolean {\n    return this.definitions.has(componentType)\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„æ•°æ®æºé”®åˆ—è¡¨\n   * @param componentType ç»„ä»¶ç±»å‹\n   * @returns æ•°æ®æºé”®æ•°ç»„\n   */\n  static getDataSourceKeys(componentType: string): string[] {\n    const definition = this.get(componentType)\n    let keys: string[] = []\n\n    if (definition?.dataSources) {\n      // å¤„ç†æ•°ç»„æ ¼å¼çš„ dataSources (æ–°çš„ä¸‰æ–‡ä»¶æ¶æ„)\n      if (Array.isArray(definition.dataSources)) {\n        keys = definition.dataSources.map(ds => ds.key)\n      }\n      // å¤„ç†å¯¹è±¡æ ¼å¼çš„ dataSources (æ—§çš„æ¶æ„å…¼å®¹)\n      else if (typeof definition.dataSources === 'object') {\n        keys = Object.keys(definition.dataSources)\n      }\n    }\n\n    return keys\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„é™æ€å‚æ•°é”®åˆ—è¡¨\n   * @param componentType ç»„ä»¶ç±»å‹\n   * @returns é™æ€å‚æ•°é”®æ•°ç»„\n   */\n  static getStaticParamKeys(componentType: string): string[] {\n    const definition = this.get(componentType)\n    const keys = definition?.staticParams ? Object.keys(definition.staticParams) : []\n    return keys\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„æ•°æ®æºé…ç½®\n   * @param componentType ç»„ä»¶ç±»å‹\n   * @returns æ•°æ®æºé…ç½®å¯¹è±¡\n   */\n  static getDataSourcesConfig(componentType: string): Record<string, any> | undefined {\n    const definition = this.get(componentType)\n    return definition?.dataSources\n  }\n\n  /**\n   * æ£€æŸ¥ç»„ä»¶æ˜¯å¦æ”¯æŒå¤šæ•°æ®æº\n   * @param componentType ç»„ä»¶ç±»å‹\n   * @returns æ˜¯å¦æ”¯æŒå¤šæ•°æ®æº\n   */\n  static isMultiDataSource(componentType: string): boolean {\n    const dataSourceKeys = this.getDataSourceKeys(componentType)\n    const isMulti = dataSourceKeys.length > 1\n    return isMulti\n  }\n\n  /**\n   * è·å–æ³¨å†Œè¡¨ç»Ÿè®¡ä¿¡æ¯\n   * @returns ç»Ÿè®¡ä¿¡æ¯\n   */\n  static getStats(): {\n    totalComponents: number\n    multiDataSourceComponents: number\n    componentTypes: string[]\n  } {\n    const componentTypes = Array.from(this.definitions.keys())\n    const multiDataSourceComponents = componentTypes.filter(type => this.isMultiDataSource(type))\n\n    return {\n      totalComponents: componentTypes.length,\n      multiDataSourceComponents: multiDataSourceComponents.length,\n      componentTypes\n    }\n  }\n\n  /**\n   * æ¸…ç©ºæ³¨å†Œè¡¨ï¼ˆä¸»è¦ç”¨äºæµ‹è¯•ï¼‰\n   */\n  static clear(): void {\n    this.definitions.clear()\n  }\n\n  /**\n   * æ‰¹é‡æ³¨å†Œç»„ä»¶\n   * @param definitions ç»„ä»¶å®šä¹‰æ•°ç»„\n   */\n  static registerBatch(definitions: ComponentDefinition[]): void {\n    definitions.forEach(definition => {\n      this.register(definition)\n    })\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šä» settingConfig æ³¨å†Œç»„ä»¶çš„å±æ€§æš´éœ²é…ç½®\n   * @param settingConfig ç»„ä»¶è®¾ç½®é…ç½®\n   */\n  static registerSettingConfig<T extends Record<string, any>>(settingConfig: ComponentSettingConfig<T>): void {\n    try {\n      // è‡ªåŠ¨æ³¨å†Œåˆ°å±æ€§æš´éœ²ç³»ç»Ÿ\n      autoRegisterFromSettingConfig(settingConfig)\n    } catch (error) {}\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šæ‰¹é‡æ³¨å†Œ settingConfig\n   * @param settingConfigs settingConfig æ•°ç»„\n   */\n  static registerSettingConfigs(settingConfigs: ComponentSettingConfig<any>[]): void {\n    settingConfigs.forEach(config => {\n      this.registerSettingConfig(config)\n    })\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šæ³¨å†Œå®Œæ•´çš„ç»„ä»¶ï¼ˆåŒ…æ‹¬å®šä¹‰å’Œ settingConfigï¼‰\n   * @param definition ç»„ä»¶å®šä¹‰\n   * @param settingConfig è®¾ç½®é…ç½®ï¼ˆå¯é€‰ï¼‰\n   */\n  static registerComponent<T extends Record<string, any>>(\n    definition: ComponentDefinition,\n    settingConfig?: ComponentSettingConfig<T>\n  ): void {\n    // æ³¨å†Œç»„ä»¶å®šä¹‰\n    this.register(definition)\n\n    // å¦‚æœæœ‰ settingConfigï¼ŒåŒæ—¶æ³¨å†Œå±æ€§æš´éœ²\n    if (settingConfig) {\n      // éªŒè¯ç»„ä»¶ç±»å‹ä¸€è‡´æ€§\n\n      this.registerSettingConfig(settingConfig)\n    }\n  }\n}\n\n/**\n * ç»„ä»¶æ³¨å†Œè¡¨æ¥å£ï¼ˆç”¨äºä¾èµ–æ³¨å…¥ç­‰åœºæ™¯ï¼‰\n */\nexport interface IComponentRegistry {\n  register(definition: ComponentDefinition): void\n  get(componentType: string): ComponentDefinition | undefined\n  getAll(): ComponentDefinition[]\n  has(componentType: string): boolean\n  getDataSourceKeys(componentType: string): string[]\n  getStaticParamKeys(componentType: string): string[]\n  isMultiDataSource(componentType: string): boolean\n  registerSettingConfig<T extends Record<string, any>>(settingConfig: ComponentSettingConfig<T>): void\n  registerSettingConfigs(settingConfigs: ComponentSettingConfig<any>[]): void\n  registerComponent<T extends Record<string, any>>(\n    definition: ComponentDefinition,\n    settingConfig?: ComponentSettingConfig<T>\n  ): void\n}\n\n/**\n * é»˜è®¤ç»„ä»¶æ³¨å†Œè¡¨å®ä¾‹\n */\nexport const componentRegistry: IComponentRegistry = ComponentRegistry\n\n/**\n * ç»„ä»¶æ³¨å†Œè£…é¥°å™¨ï¼ˆå¯é€‰ï¼Œç”¨äºè‡ªåŠ¨æ³¨å†Œï¼‰\n */\nexport function RegisterComponent(definition: ComponentDefinition) {\n  return function <T extends { new (...args: any[]): {} }>(constructor: T) {\n    // è‡ªåŠ¨æ³¨å†Œç»„ä»¶\n    ComponentRegistry.register(definition)\n    return constructor\n  }\n}\n\n// å¯¼å‡ºç±»å‹\nexport type { ComponentDefinition }\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\config-manager.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'FlexibleConfigDefinition' is defined but never used.","line":6,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FlexibleConfigDefinition' is defined but never used.","line":6,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card2.1 çµæ´»é…ç½®ç®¡ç†å™¨\n * è´Ÿè´£æ£€æµ‹é…ç½®æ¨¡å¼å’Œç”Ÿæˆè¡¨å•\n */\nimport type { Component } from 'vue'\nimport type { TSConfig, FlexibleConfigDefinition, ConfigMode, ConfigValues } from './config-types'\n\nexport class FlexibleConfigManager {\n  /**\n   * æ£€æµ‹é…ç½®æ¨¡å¼\n   */\n  static detectConfigMode(vueConfig?: Component, tsConfig?: TSConfig): ConfigMode {\n    if (vueConfig && tsConfig) {\n      return 'hybrid'\n    } else if (tsConfig) {\n      return 'ts-only'\n    } else if (vueConfig) {\n      return 'vue-only'\n    }\n\n    throw new Error('è‡³å°‘éœ€è¦æä¾›ä¸€ç§é…ç½®æ–¹å¼')\n  }\n\n  /**\n   * è·å–é»˜è®¤é…ç½®å€¼\n   */\n  static getDefaultValues(tsConfig?: TSConfig): ConfigValues {\n    if (!tsConfig) return {}\n\n    const defaults: ConfigValues = {}\n\n    tsConfig.fields.forEach(field => {\n      if (field.defaultValue !== undefined) {\n        defaults[field.key] = field.defaultValue\n      }\n    })\n\n    return defaults\n  }\n\n  /**\n   * éªŒè¯é…ç½®å€¼\n   */\n  static validateValues(\n    values: ConfigValues,\n    tsConfig?: TSConfig\n  ): {\n    valid: boolean\n    errors: string[]\n  } {\n    const errors: string[] = []\n\n    if (!tsConfig) {\n      return { valid: true, errors: [] }\n    }\n\n    tsConfig.fields.forEach(field => {\n      const value = values[field.key]\n\n      // å¿…å¡«æ£€æŸ¥\n      if (field.required && (value === undefined || value === null || value === '')) {\n        errors.push(`${field.label} æ˜¯å¿…å¡«å­—æ®µ`)\n        return\n      }\n\n      // ç±»å‹æ£€æŸ¥\n      if (value !== undefined) {\n        switch (field.type) {\n          case 'number':\n            if (typeof value !== 'number' || isNaN(value)) {\n              errors.push(`${field.label} å¿…é¡»æ˜¯æ•°å­—`)\n            } else {\n              if (field.min !== undefined && value < field.min) {\n                errors.push(`${field.label} ä¸èƒ½å°äº ${field.min}`)\n              }\n              if (field.max !== undefined && value > field.max) {\n                errors.push(`${field.label} ä¸èƒ½å¤§äº ${field.max}`)\n              }\n            }\n            break\n\n          case 'string':\n          case 'textarea':\n            if (typeof value !== 'string') {\n              errors.push(`${field.label} å¿…é¡»æ˜¯æ–‡æœ¬`)\n            }\n            break\n\n          case 'boolean':\n            if (typeof value !== 'boolean') {\n              errors.push(`${field.label} å¿…é¡»æ˜¯å¸ƒå°”å€¼`)\n            }\n            break\n\n          case 'select':\n            if (field.options && !field.options.some(opt => opt.value === value)) {\n              errors.push(`${field.label} çš„å€¼ä¸åœ¨å¯é€‰èŒƒå›´å†…`)\n            }\n            break\n        }\n      }\n    })\n\n    return {\n      valid: errors.length === 0,\n      errors\n    }\n  }\n\n  /**\n   * åˆå¹¶é…ç½®å€¼ï¼ˆç”¨äºæ··åˆæ¨¡å¼ï¼‰\n   */\n  static mergeValues(tsValues: ConfigValues, vueValues: ConfigValues): ConfigValues {\n    return {\n      ...tsValues,\n      ...vueValues\n    }\n  }\n\n  /**\n   * è·å–åˆ†ç»„åçš„å­—æ®µ\n   */\n  static getGroupedFields(tsConfig: TSConfig): Array<{\n    name: string\n    label: string\n    fields: TSConfig['fields']\n  }> {\n    if (!tsConfig.groups || tsConfig.groups.length === 0) {\n      return [\n        {\n          name: 'default',\n          label: 'åŸºæœ¬é…ç½®',\n          fields: tsConfig.fields\n        }\n      ]\n    }\n\n    return tsConfig.groups.map(group => ({\n      name: group.name,\n      label: group.label,\n      fields: tsConfig.fields.filter(field => group.fields.includes(field.key) || field.group === group.name)\n    }))\n  }\n}\n\n// å¯¼å‡ºå•ä¾‹\nexport const configManager = new FlexibleConfigManager()\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\config-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-binding\\component-requirement-manager.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":38,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'componentId' is defined but never used.","line":48,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'componentId' is defined but never used.","line":48,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":134,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":134,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":134,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":134,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":135,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":135,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":135,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":135,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":146,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":146,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":146,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":146,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":147,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":147,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":147,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":147,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":186,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":186,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'relation' is defined but never used.","line":322,"column":73,"nodeType":"Identifier","messageId":"unusedVar","endLine":322,"endColumn":81},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'relation' is defined but never used.","line":322,"column":73,"nodeType":null,"messageId":"unusedVar","endLine":322,"endColumn":81},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":326,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":326,"endColumn":23},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":326,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":326,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9055,9055],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":365,"column":90,"nodeType":"Identifier","messageId":"unusedVar","endLine":365,"endColumn":91},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":365,"column":90,"nodeType":null,"messageId":"unusedVar","endLine":365,"endColumn":91},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":365,"column":93,"nodeType":"Identifier","messageId":"unusedVar","endLine":365,"endColumn":98},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":365,"column":93,"nodeType":null,"messageId":"unusedVar","endLine":365,"endColumn":98},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":430,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":430,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":430,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":430,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11568,11568],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ç»„ä»¶æ•°æ®éœ€æ±‚ç®¡ç†å™¨\n * è´Ÿè´£ç»„ä»¶æ•°æ®éœ€æ±‚çš„æ³¨å†Œã€éªŒè¯å’ŒæŸ¥è¯¢\n */\n\nimport type { ComponentDataRequirement, DataFieldRequirement, DataRelationship } from './types'\n\nexport class ComponentRequirementManager {\n  private requirements = new Map<string, ComponentDataRequirement>()\n  private relationshipCache = new Map<string, Map<string, any>>()\n\n  /**\n   * æ³¨å†Œç»„ä»¶çš„æ•°æ®éœ€æ±‚\n   */\n  registerRequirement(componentId: string, requirement: ComponentDataRequirement): void {\n    try {\n      // å¯¹äºæ®‹ç•™æ•°æ®æˆ–æ— æ•ˆæ•°æ®ï¼Œå°è¯•ä¿®å¤æˆ–ä½¿ç”¨é»˜è®¤å€¼\n      if (!requirement || typeof requirement !== 'object') {\n        requirement = this.createDefaultRequirement(componentId)\n      }\n\n      // éªŒè¯éœ€æ±‚å®šä¹‰\n      const validation = this.validateRequirement(requirement)\n      if (!validation.valid) {\n        requirement = this.createDefaultRequirement(componentId)\n      }\n\n      this.requirements.set(componentId, requirement)\n\n      // ğŸ”¥ æ€§èƒ½ä¼˜åŒ–ï¼šåªåœ¨éœ€æ±‚çœŸæ­£æ”¹å˜æ—¶æ¸…é™¤ç¼“å­˜\n      const existingRequirement = this.requirements.get(componentId)\n      const requirementChanged =\n        !existingRequirement || JSON.stringify(existingRequirement) !== JSON.stringify(requirement)\n\n      if (requirementChanged) {\n        this.relationshipCache.delete(componentId)\n      }\n    } catch (error) {\n      // ä½¿ç”¨é»˜è®¤éœ€æ±‚é¿å…ç³»ç»Ÿå´©æºƒ\n      const defaultRequirement = this.createDefaultRequirement(componentId)\n      this.requirements.set(componentId, defaultRequirement)\n    }\n  }\n\n  /**\n   * åˆ›å»ºé»˜è®¤æ•°æ®éœ€æ±‚ï¼ˆç”¨äºå¤„ç†æ®‹ç•™æ•°æ®ï¼‰\n   */\n  private createDefaultRequirement(componentId: string): ComponentDataRequirement {\n    return {\n      componentType: 'unknown',\n      displayName: 'æœªçŸ¥ç»„ä»¶',\n      description: 'ç”±äºæ®‹ç•™æ•°æ®å¯¼è‡´çš„é»˜è®¤é…ç½®',\n      category: 'default',\n      version: '1.0.0',\n      primaryData: {\n        name: 'data',\n        label: 'æ•°æ®',\n        description: 'ç»„ä»¶æ•°æ®',\n        type: 'object',\n        required: false,\n        defaultValue: {},\n        validation: {},\n        example: {},\n        tags: ['default']\n      },\n      fields: {\n        data: {\n          name: 'data',\n          label: 'æ•°æ®',\n          description: 'ç»„ä»¶é»˜è®¤æ•°æ®å­—æ®µ',\n          type: 'object',\n          required: false,\n          defaultValue: {},\n          validation: {},\n          example: {},\n          tags: ['default']\n        }\n      },\n      relationships: {},\n      updateConfig: {\n        supportedTriggers: ['manual'],\n        recommendedInterval: 5000,\n        minInterval: 1000\n      }\n    }\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„æ•°æ®éœ€æ±‚\n   */\n  getRequirement(componentId: string): ComponentDataRequirement | null {\n    return this.requirements.get(componentId) || null\n  }\n\n  /**\n   * è·å–æ‰€æœ‰å·²æ³¨å†Œçš„ç»„ä»¶éœ€æ±‚\n   */\n  getAllRequirements(): Record<string, ComponentDataRequirement> {\n    const result: Record<string, ComponentDataRequirement> = {}\n    this.requirements.forEach((requirement, componentId) => {\n      result[componentId] = requirement\n    })\n    return result\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„å­—æ®µéœ€æ±‚\n   */\n  getFieldRequirement(componentId: string, fieldName: string): DataFieldRequirement | null {\n    const requirement = this.requirements.get(componentId)\n    if (!requirement) return null\n\n    return requirement.fields[fieldName] || null\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„æ‰€æœ‰å­—æ®µå\n   */\n  getFieldNames(componentId: string): string[] {\n    const requirement = this.requirements.get(componentId)\n    if (!requirement) return []\n\n    return Object.keys(requirement.fields)\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„å¿…å¡«å­—æ®µ\n   */\n  getRequiredFields(componentId: string): string[] {\n    const requirement = this.requirements.get(componentId)\n    if (!requirement) return []\n\n    return Object.entries(requirement.fields)\n      .filter(([_, fieldReq]) => fieldReq.required)\n      .map(([fieldName, _]) => fieldName)\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„å¯é€‰å­—æ®µ\n   */\n  getOptionalFields(componentId: string): string[] {\n    const requirement = this.requirements.get(componentId)\n    if (!requirement) return []\n\n    return Object.entries(requirement.fields)\n      .filter(([_, fieldReq]) => !fieldReq.required)\n      .map(([fieldName, _]) => fieldName)\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„æ•°æ®å…³ç³»\n   */\n  getRelationships(componentId: string): Record<string, DataRelationship> {\n    const requirement = this.requirements.get(componentId)\n    if (!requirement || !requirement.relationships) return {}\n\n    return requirement.relationships\n  }\n\n  /**\n   * è®¡ç®—å­—æ®µçš„æ•°æ®å…³ç³»å€¼\n   */\n  calculateRelationshipValue(componentId: string, relationshipName: string, inputData: Record<string, any>): any {\n    const relationships = this.getRelationships(componentId)\n    const relationship = relationships[relationshipName]\n\n    if (!relationship) {\n      throw new Error(`æœªæ‰¾åˆ°æ•°æ®å…³ç³»: ${relationshipName}`)\n    }\n\n    if (relationship.type === 'independent') {\n      // ç‹¬ç«‹å­—æ®µï¼Œç›´æ¥è¿”å›å¯¹åº”çš„è¾“å…¥å€¼\n      const inputField = relationship.inputs[0]\n      return inputData[inputField]\n    }\n\n    if (relationship.type === 'calculated' && relationship.calculator) {\n      // è®¡ç®—å­—æ®µï¼Œæ‰§è¡Œè®¡ç®—å‡½æ•°\n      const inputs: Record<string, any> = {}\n      relationship.inputs.forEach(inputField => {\n        inputs[inputField] = inputData[inputField]\n      })\n\n      try {\n        return relationship.calculator(inputs)\n      } catch (error) {\n        return undefined\n      }\n    }\n\n    if (relationship.type === 'derived') {\n      // æ´¾ç”Ÿå­—æ®µï¼ŒåŸºäºå…¶ä»–å­—æ®µçš„ç®€å•æ˜ å°„\n      const inputField = relationship.inputs[0]\n      return inputData[inputField]\n    }\n\n    return undefined\n  }\n\n  /**\n   * éªŒè¯æ•°æ®éœ€æ±‚å®šä¹‰\n   */\n  validateRequirement(requirement: ComponentDataRequirement): { valid: boolean; errors: string[] } {\n    const errors: string[] = []\n\n    // å¯¹äºæ®‹ç•™æ•°æ®ï¼Œå¦‚æœ requirement ä¸º null æˆ– undefinedï¼Œè¿”å›é»˜è®¤æœ‰æ•ˆçŠ¶æ€\n    if (!requirement || typeof requirement !== 'object') {\n      return { valid: true, errors: [] }\n    }\n\n    // éªŒè¯å­—æ®µå®šä¹‰\n    if (!requirement.fields || Object.keys(requirement.fields).length === 0) {\n      errors.push('ç»„ä»¶å¿…é¡»å®šä¹‰è‡³å°‘ä¸€ä¸ªæ•°æ®å­—æ®µ')\n    }\n\n    // éªŒè¯æ¯ä¸ªå­—æ®µ\n    if (requirement.fields && typeof requirement.fields === 'object') {\n      Object.entries(requirement.fields).forEach(([fieldName, fieldReq]) => {\n        const fieldErrors = this.validateFieldRequirement(fieldName, fieldReq)\n        errors.push(...fieldErrors)\n      })\n    }\n\n    // éªŒè¯æ•°æ®å…³ç³»\n    if (requirement.relationships && typeof requirement.relationships === 'object') {\n      Object.entries(requirement.relationships).forEach(([relationName, relation]) => {\n        const relationErrors = this.validateRelationship(relationName, relation, requirement.fields || {})\n        errors.push(...relationErrors)\n      })\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors\n    }\n  }\n\n  /**\n   * éªŒè¯å­—æ®µéœ€æ±‚å®šä¹‰\n   */\n  private validateFieldRequirement(fieldName: string, fieldReq: DataFieldRequirement): string[] {\n    const errors: string[] = []\n\n    // éªŒè¯å­—æ®µç±»å‹\n    if (!['value', 'object', 'array'].includes(fieldReq.type)) {\n      errors.push(`å­—æ®µ ${fieldName} çš„ç±»å‹æ— æ•ˆ: ${fieldReq.type}`)\n    }\n\n    // éªŒè¯å€¼ç±»å‹\n    if (fieldReq.type === 'value' && fieldReq.valueType) {\n      if (!['number', 'string', 'boolean', 'any'].includes(fieldReq.valueType)) {\n        errors.push(`å­—æ®µ ${fieldName} çš„å€¼ç±»å‹æ— æ•ˆ: ${fieldReq.valueType}`)\n      }\n    }\n\n    // éªŒè¯åµŒå¥—ç»“æ„\n    if ((fieldReq.type === 'object' || fieldReq.type === 'array') && fieldReq.structure) {\n      const structureValidation = this.validateRequirement(fieldReq.structure)\n      if (!structureValidation.valid) {\n        errors.push(`å­—æ®µ ${fieldName} çš„åµŒå¥—ç»“æ„æ— æ•ˆ: ${structureValidation.errors.join(', ')}`)\n      }\n    }\n\n    // éªŒè¯æè¿°\n    if (!fieldReq.description || fieldReq.description.trim() === '') {\n      errors.push(`å­—æ®µ ${fieldName} å¿…é¡»æä¾›æè¿°`)\n    }\n\n    return errors\n  }\n\n  /**\n   * éªŒè¯æ•°æ®å…³ç³»å®šä¹‰\n   */\n  private validateRelationship(\n    relationName: string,\n    relation: DataRelationship,\n    fields: Record<string, DataFieldRequirement>\n  ): string[] {\n    const errors: string[] = []\n\n    // éªŒè¯å…³ç³»ç±»å‹\n    if (!['independent', 'calculated', 'derived'].includes(relation.type)) {\n      errors.push(`å…³ç³» ${relationName} çš„ç±»å‹æ— æ•ˆ: ${relation.type}`)\n    }\n\n    // éªŒè¯è¾“å…¥å­—æ®µ\n    if (!relation.inputs || relation.inputs.length === 0) {\n      errors.push(`å…³ç³» ${relationName} å¿…é¡»å®šä¹‰è¾“å…¥å­—æ®µ`)\n    } else {\n      relation.inputs.forEach(inputField => {\n        if (!fields[inputField]) {\n          errors.push(`å…³ç³» ${relationName} å¼•ç”¨äº†ä¸å­˜åœ¨çš„å­—æ®µ: ${inputField}`)\n        }\n      })\n    }\n\n    // éªŒè¯è®¡ç®—å‡½æ•°\n    if (relation.type === 'calculated' && !relation.calculator) {\n      errors.push(`è®¡ç®—å…³ç³» ${relationName} å¿…é¡»æä¾›è®¡ç®—å‡½æ•°`)\n    }\n\n    return errors\n  }\n\n  /**\n   * ç”Ÿæˆç»„ä»¶æ•°æ®éœ€æ±‚çš„ç¤ºä¾‹æ•°æ®\n   */\n  generateSampleData(componentId: string): Record<string, any> {\n    const requirement = this.requirements.get(componentId)\n    if (!requirement) return {}\n\n    const sampleData: Record<string, any> = {}\n\n    // ç”Ÿæˆå­—æ®µç¤ºä¾‹æ•°æ®\n    Object.entries(requirement.fields).forEach(([fieldName, fieldReq]) => {\n      sampleData[fieldName] = this.generateFieldSampleData(fieldReq)\n    })\n\n    // è®¡ç®—å…³ç³»å­—æ®µçš„å€¼\n    if (requirement.relationships) {\n      Object.entries(requirement.relationships).forEach(([relationName, relation]) => {\n        try {\n          const calculatedValue = this.calculateRelationshipValue(componentId, relationName, sampleData)\n          sampleData[relationName] = calculatedValue\n        } catch (error) {}\n      })\n    }\n\n    return sampleData\n  }\n\n  /**\n   * ç”Ÿæˆå­—æ®µç¤ºä¾‹æ•°æ®\n   */\n  private generateFieldSampleData(fieldReq: DataFieldRequirement): any {\n    // å¦‚æœæœ‰ç¤ºä¾‹æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨\n    if (fieldReq.example !== undefined) {\n      return fieldReq.example\n    }\n\n    // å¦‚æœæœ‰é»˜è®¤å€¼ï¼Œä½¿ç”¨é»˜è®¤å€¼\n    if (fieldReq.defaultValue !== undefined) {\n      return fieldReq.defaultValue\n    }\n\n    // æ ¹æ®ç±»å‹ç”Ÿæˆç¤ºä¾‹æ•°æ®\n    switch (fieldReq.type) {\n      case 'value':\n        return this.generateValueSampleData(fieldReq.valueType || 'any')\n\n      case 'object':\n        if (fieldReq.structure) {\n          const objectSample: Record<string, any> = {}\n          Object.entries(fieldReq.structure.fields).forEach(([key, subFieldReq]) => {\n            objectSample[key] = this.generateFieldSampleData(subFieldReq)\n          })\n          return objectSample\n        }\n        return {}\n\n      case 'array':\n        if (fieldReq.structure) {\n          // ç”ŸæˆåŒ…å«2ä¸ªç¤ºä¾‹å…ƒç´ çš„æ•°ç»„\n          return [this.generateSampleData('temp'), this.generateSampleData('temp')].map((_, index) => {\n            const elementSample: Record<string, any> = {}\n            Object.entries(fieldReq.structure!.fields).forEach(([key, subFieldReq]) => {\n              elementSample[key] = this.generateFieldSampleData(subFieldReq)\n            })\n            return elementSample\n          })\n        }\n        return []\n\n      default:\n        return null\n    }\n  }\n\n  /**\n   * ç”Ÿæˆå€¼ç±»å‹ç¤ºä¾‹æ•°æ®\n   */\n  private generateValueSampleData(valueType: string): any {\n    switch (valueType) {\n      case 'number':\n        return Math.round(Math.random() * 100)\n      case 'string':\n        return 'ç¤ºä¾‹æ–‡æœ¬'\n      case 'boolean':\n        return Math.random() > 0.5\n      case 'any':\n      default:\n        return 'ç¤ºä¾‹æ•°æ®'\n    }\n  }\n\n  /**\n   * è·å–å·²æ³¨å†Œç»„ä»¶æ•°é‡\n   */\n  getRegisteredCount(): number {\n    return this.requirements.size\n  }\n\n  /**\n   * æ¸…ç©ºæ‰€æœ‰éœ€æ±‚\n   */\n  clear(): void {\n    this.requirements.clear()\n    this.relationshipCache.clear()\n  }\n\n  /**\n   * å¯¼å‡ºæ‰€æœ‰éœ€æ±‚\n   */\n  exportRequirements(): Record<string, ComponentDataRequirement> {\n    const exported: Record<string, ComponentDataRequirement> = {}\n    this.requirements.forEach((requirement, componentId) => {\n      exported[componentId] = { ...requirement }\n    })\n    return exported\n  }\n\n  /**\n   * å¯¼å…¥éœ€æ±‚\n   */\n  importRequirements(requirements: Record<string, ComponentDataRequirement>): void {\n    Object.entries(requirements).forEach(([componentId, requirement]) => {\n      try {\n        this.registerRequirement(componentId, requirement)\n      } catch (error) {}\n    })\n  }\n}\n\n// åˆ›å»ºå…¨å±€å®ä¾‹\nexport const componentRequirementManager = new ComponentRequirementManager()\n\nexport default componentRequirementManager\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-binding\\data-processors.ts","messages":[{"ruleId":"no-useless-catch","severity":2,"message":"Unnecessary try/catch wrapper.","line":28,"column":5,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":65,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":119,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":119,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":170,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":170,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":228,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":228,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":322,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":322,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":363,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":363,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":429,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":429,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * æ•°æ®å¤„ç†å™¨å®ç°\n * æ”¯æŒè„šæœ¬å¤„ç†ã€æ ¼å¼åŒ–ã€è¿‡æ»¤ã€è½¬æ¢ç­‰å¤šç§æ•°æ®å¤„ç†æ–¹å¼\n */\n\nimport type { DataProcessor, DataMappingRule, DataMapper } from './types'\n\n// ========== åŸºç¡€æ•°æ®å¤„ç†å™¨ ==========\n\n/**\n * è„šæœ¬å¤„ç†å™¨ - æ‰§è¡ŒJavaScriptä»£ç å¤„ç†æ•°æ®\n */\nexport class ScriptProcessor implements DataProcessor {\n  id: string\n  name: string = 'è„šæœ¬å¤„ç†å™¨'\n  type = 'script' as const\n  config: {\n    script: string\n    timeout?: number\n  }\n\n  constructor(id: string, script: string, timeout = 5000) {\n    this.id = id\n    this.config = { script, timeout }\n  }\n\n  async process(input: any): Promise<any> {\n    try {\n      // åˆ›å»ºå®‰å…¨çš„æ‰§è¡Œç¯å¢ƒ\n      const context = {\n        data: input,\n        console: {\n          log: console.log,\n          warn: console.warn,\n          error: console.error\n        },\n        Math,\n        Date,\n        JSON,\n        // å¸¸ç”¨çš„æ•°æ®å¤„ç†å‡½æ•°\n        utils: {\n          round: (num: number, digits = 2) => Math.round(num * Math.pow(10, digits)) / Math.pow(10, digits),\n          formatNumber: (num: number) => new Intl.NumberFormat().format(num),\n          formatDate: (date: Date | string) => new Date(date).toLocaleString()\n        }\n      }\n\n      // åˆ›å»ºå‡½æ•°å¹¶æ‰§è¡Œ\n      const processFunction = new Function(\n        'context',\n        `\n        with(context) {\n          ${this.config.script}\n        }\n      `\n      )\n\n      const result = await Promise.race([\n        Promise.resolve(processFunction(context)),\n        new Promise((_, reject) => setTimeout(() => reject(new Error('è„šæœ¬æ‰§è¡Œè¶…æ—¶')), this.config.timeout))\n      ])\n      return result\n    } catch (error) {\n      throw error\n    }\n  }\n\n  validateConfig(): boolean {\n    return typeof this.config.script === 'string' && this.config.script.trim() !== ''\n  }\n}\n\n/**\n * æ ¼å¼åŒ–å¤„ç†å™¨ - æ ¼å¼åŒ–æ•°æ®çš„æ˜¾ç¤º\n */\nexport class FormatProcessor implements DataProcessor {\n  id: string\n  name: string = 'æ ¼å¼åŒ–å¤„ç†å™¨'\n  type = 'format' as const\n  config: {\n    formatType: 'number' | 'date' | 'currency' | 'percentage'\n    options?: any\n  }\n\n  constructor(id: string, formatType: 'number' | 'date' | 'currency' | 'percentage', options?: any) {\n    this.id = id\n    this.config = { formatType, options }\n  }\n\n  async process(input: any): Promise<any> {\n    try {\n      if (input === null || input === undefined) {\n        return input\n      }\n\n      switch (this.config.formatType) {\n        case 'number':\n          return new Intl.NumberFormat('zh-CN', this.config.options).format(Number(input))\n\n        case 'date':\n          return new Intl.DateTimeFormat('zh-CN', this.config.options).format(new Date(input))\n\n        case 'currency':\n          return new Intl.NumberFormat('zh-CN', {\n            style: 'currency',\n            currency: 'CNY',\n            ...this.config.options\n          }).format(Number(input))\n\n        case 'percentage':\n          return new Intl.NumberFormat('zh-CN', {\n            style: 'percent',\n            ...this.config.options\n          }).format(Number(input))\n\n        default:\n          return input\n      }\n    } catch (error) {\n      return input // æ ¼å¼åŒ–å¤±è´¥æ—¶è¿”å›åŸå€¼\n    }\n  }\n\n  validateConfig(): boolean {\n    return ['number', 'date', 'currency', 'percentage'].includes(this.config.formatType)\n  }\n}\n\n/**\n * è¿‡æ»¤å¤„ç†å™¨ - è¿‡æ»¤æ•°æ®\n */\nexport class FilterProcessor implements DataProcessor {\n  id: string\n  name: string = 'è¿‡æ»¤å¤„ç†å™¨'\n  type = 'filter' as const\n  config: {\n    filterType: 'include' | 'exclude' | 'condition'\n    criteria: any\n  }\n\n  constructor(id: string, filterType: 'include' | 'exclude' | 'condition', criteria: any) {\n    this.id = id\n    this.config = { filterType, criteria }\n  }\n\n  async process(input: any): Promise<any> {\n    try {\n      if (!Array.isArray(input)) {\n        return input\n      }\n\n      switch (this.config.filterType) {\n        case 'include':\n          return input.filter(item => this.matchesCriteria(item, this.config.criteria, true))\n\n        case 'exclude':\n          return input.filter(item => !this.matchesCriteria(item, this.config.criteria, true))\n\n        case 'condition':\n          // ä½¿ç”¨å‡½æ•°å­—ç¬¦ä¸²è¿›è¡Œæ¡ä»¶è¿‡æ»¤\n          if (typeof this.config.criteria === 'string') {\n            const conditionFn = new Function('item', `return ${this.config.criteria}`)\n            return input.filter(conditionFn)\n          }\n          return input\n\n        default:\n          return input\n      }\n    } catch (error) {\n      return input\n    }\n  }\n\n  private matchesCriteria(item: any, criteria: any, defaultResult: boolean): boolean {\n    if (typeof criteria === 'object' && criteria !== null) {\n      return Object.entries(criteria).every(([key, value]) => {\n        return item && item[key] === value\n      })\n    }\n    return defaultResult\n  }\n\n  validateConfig(): boolean {\n    return ['include', 'exclude', 'condition'].includes(this.config.filterType)\n  }\n}\n\n/**\n * è½¬æ¢å¤„ç†å™¨ - è½¬æ¢æ•°æ®ç»“æ„\n */\nexport class TransformProcessor implements DataProcessor {\n  id: string\n  name: string = 'è½¬æ¢å¤„ç†å™¨'\n  type = 'transform' as const\n  config: {\n    transformType: 'flatten' | 'group' | 'pivot' | 'custom'\n    options?: any\n  }\n\n  constructor(id: string, transformType: 'flatten' | 'group' | 'pivot' | 'custom', options?: any) {\n    this.id = id\n    this.config = { transformType, options }\n  }\n\n  async process(input: any): Promise<any> {\n    try {\n      switch (this.config.transformType) {\n        case 'flatten':\n          return this.flatten(input)\n\n        case 'group':\n          return this.groupBy(input, this.config.options?.groupKey)\n\n        case 'pivot':\n          return this.pivot(input, this.config.options)\n\n        case 'custom':\n          // è‡ªå®šä¹‰è½¬æ¢é€»è¾‘\n          if (this.config.options?.transformer) {\n            return this.config.options.transformer(input)\n          }\n          return input\n\n        default:\n          return input\n      }\n    } catch (error) {\n      return input\n    }\n  }\n\n  private flatten(obj: any, prefix = ''): any {\n    const result: any = {}\n\n    for (const key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        const newKey = prefix ? `${prefix}.${key}` : key\n\n        if (typeof obj[key] === 'object' && obj[key] !== null && !Array.isArray(obj[key])) {\n          Object.assign(result, this.flatten(obj[key], newKey))\n        } else {\n          result[newKey] = obj[key]\n        }\n      }\n    }\n\n    return result\n  }\n\n  private groupBy(array: any[], key: string): any {\n    if (!Array.isArray(array)) return array\n\n    return array.reduce((groups, item) => {\n      const groupKey = item[key]\n      if (!groups[groupKey]) {\n        groups[groupKey] = []\n      }\n      groups[groupKey].push(item)\n      return groups\n    }, {})\n  }\n\n  private pivot(array: any[], options: any): any {\n    // ç®€åŒ–çš„é€è§†è¡¨å®ç°\n    if (!Array.isArray(array) || !options) return array\n\n    const { rowKey, colKey, valueKey } = options\n    const result: any = {}\n\n    array.forEach(item => {\n      const row = item[rowKey]\n      const col = item[colKey]\n      const value = item[valueKey]\n\n      if (!result[row]) result[row] = {}\n      result[row][col] = value\n    })\n\n    return result\n  }\n\n  validateConfig(): boolean {\n    return ['flatten', 'group', 'pivot', 'custom'].includes(this.config.transformType)\n  }\n}\n\n// ========== æ•°æ®æ˜ å°„å™¨å®ç° ==========\n\n/**\n * è·¯å¾„è§£ææ•°æ®æ˜ å°„å™¨\n */\nexport class PathDataMapper implements DataMapper {\n  rules: DataMappingRule[]\n\n  constructor(rules: DataMappingRule[]) {\n    this.rules = rules\n  }\n\n  map(sourceData: any): Record<string, any> {\n    const result: Record<string, any> = {}\n\n    this.rules.forEach(rule => {\n      try {\n        let value = this.extractValueByPath(sourceData, rule.sourcePath)\n\n        // åº”ç”¨è½¬æ¢\n        if (rule.type === 'calculated' && rule.transformer) {\n          value = rule.transformer(value)\n        } else if (rule.type === 'conditional' && rule.condition) {\n          if (!rule.condition(value)) {\n            value = rule.defaultValue\n          }\n        }\n\n        // ä½¿ç”¨é»˜è®¤å€¼\n        if (value === undefined && rule.defaultValue !== undefined) {\n          value = rule.defaultValue\n        }\n\n        result[rule.targetField] = value\n      } catch (error) {\n        result[rule.targetField] = rule.defaultValue\n      }\n    })\n    return result\n  }\n\n  /**\n   * æ ¹æ®è·¯å¾„æå–å€¼ï¼Œæ”¯æŒå¤æ‚è·¯å¾„å¦‚ 'data[0].sensor.value'\n   */\n  private extractValueByPath(data: any, path: string): any {\n    if (!path || path === '') return data\n\n    try {\n      // è§£æè·¯å¾„\n      const pathParts = this.parsePath(path)\n      let current = data\n\n      for (const part of pathParts) {\n        if (current === null || current === undefined) {\n          return undefined\n        }\n\n        if (typeof part === 'number') {\n          // æ•°ç»„ç´¢å¼•\n          if (Array.isArray(current)) {\n            current = current[part]\n          } else {\n            return undefined\n          }\n        } else {\n          // å¯¹è±¡å±æ€§\n          if (typeof current === 'object' && part in current) {\n            current = current[part]\n          } else {\n            return undefined\n          }\n        }\n      }\n\n      return current\n    } catch (error) {\n      return undefined\n    }\n  }\n\n  /**\n   * è§£æè·¯å¾„å­—ç¬¦ä¸²ï¼Œæ”¯æŒæ•°ç»„ç´¢å¼•å’Œå¯¹è±¡å±æ€§\n   */\n  private parsePath(path: string): (string | number)[] {\n    const parts: (string | number)[] = []\n    let current = ''\n    let inBrackets = false\n    let bracketContent = ''\n\n    for (let i = 0; i < path.length; i++) {\n      const char = path[i]\n\n      if (char === '[') {\n        if (current) {\n          parts.push(current)\n          current = ''\n        }\n        inBrackets = true\n        bracketContent = ''\n      } else if (char === ']') {\n        inBrackets = false\n        const index = parseInt(bracketContent, 10)\n        if (!isNaN(index)) {\n          parts.push(index)\n        }\n        bracketContent = ''\n      } else if (char === '.') {\n        if (inBrackets) {\n          bracketContent += char\n        } else {\n          if (current) {\n            parts.push(current)\n            current = ''\n          }\n        }\n      } else {\n        if (inBrackets) {\n          bracketContent += char\n        } else {\n          current += char\n        }\n      }\n    }\n\n    if (current) {\n      parts.push(current)\n    }\n\n    return parts\n  }\n\n  validateRules(): boolean {\n    return this.rules.every(rule => {\n      return rule.sourcePath && rule.targetField && ['direct', 'calculated', 'conditional'].includes(rule.type)\n    })\n  }\n\n  preview(sourceData: any): Record<string, any> {\n    // é¢„è§ˆåŠŸèƒ½ä¸å®é™…æ˜ å°„ç›¸åŒï¼Œä½†ä¸ä¼šæŠ›å‡ºé”™è¯¯\n    try {\n      return this.map(sourceData)\n    } catch (error) {\n      return {}\n    }\n  }\n}\n\n// ========== å¤„ç†å™¨å·¥å‚ ==========\n\n/**\n * æ•°æ®å¤„ç†å™¨å·¥å‚\n */\nexport class DataProcessorFactory {\n  /**\n   * åˆ›å»ºè„šæœ¬å¤„ç†å™¨\n   */\n  static createScriptProcessor(id: string, script: string, timeout?: number): ScriptProcessor {\n    return new ScriptProcessor(id, script, timeout)\n  }\n\n  /**\n   * åˆ›å»ºæ ¼å¼åŒ–å¤„ç†å™¨\n   */\n  static createFormatProcessor(\n    id: string,\n    formatType: 'number' | 'date' | 'currency' | 'percentage',\n    options?: any\n  ): FormatProcessor {\n    return new FormatProcessor(id, formatType, options)\n  }\n\n  /**\n   * åˆ›å»ºè¿‡æ»¤å¤„ç†å™¨\n   */\n  static createFilterProcessor(\n    id: string,\n    filterType: 'include' | 'exclude' | 'condition',\n    criteria: any\n  ): FilterProcessor {\n    return new FilterProcessor(id, filterType, criteria)\n  }\n\n  /**\n   * åˆ›å»ºè½¬æ¢å¤„ç†å™¨\n   */\n  static createTransformProcessor(\n    id: string,\n    transformType: 'flatten' | 'group' | 'pivot' | 'custom',\n    options?: any\n  ): TransformProcessor {\n    return new TransformProcessor(id, transformType, options)\n  }\n\n  /**\n   * æ ¹æ®é…ç½®åˆ›å»ºå¤„ç†å™¨\n   */\n  static createFromConfig(config: any): DataProcessor {\n    switch (config.type) {\n      case 'script':\n        return new ScriptProcessor(config.id, config.script, config.timeout)\n\n      case 'format':\n        return new FormatProcessor(config.id, config.formatType, config.options)\n\n      case 'filter':\n        return new FilterProcessor(config.id, config.filterType, config.criteria)\n\n      case 'transform':\n        return new TransformProcessor(config.id, config.transformType, config.options)\n\n      default:\n        throw new Error(`ä¸æ”¯æŒçš„å¤„ç†å™¨ç±»å‹: ${config.type}`)\n    }\n  }\n}\n\nexport default DataProcessorFactory\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-binding\\data-sources.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":39,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":184,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":184,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":223,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":223,"endColumn":25},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":223,"column":27,"nodeType":"BlockStatement","messageId":"unexpected","endLine":223,"endColumn":29,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5714,5714],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":244,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":244,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":244,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":244,"endColumn":35},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":246,"column":12,"nodeType":"BlockStatement","messageId":"unexpected","endLine":247,"endColumn":6,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6231,6236],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":269,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":269,"endColumn":30},{"ruleId":"no-useless-catch","severity":2,"message":"Unnecessary try/catch wrapper.","line":325,"column":5,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":336,"endColumn":6}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * æ•°æ®æºå®ç°\n * æ”¯æŒå¤šç§æ•°æ®æºç±»å‹ï¼šé™æ€æ•°æ®ã€APIã€WebSocketã€è„šæœ¬ã€æ•°æ®åº“ç­‰\n */\n\nimport type { DataSource } from './types'\nimport { defaultScriptEngine } from '@/core/script-engine'\n\n// ========== é™æ€æ•°æ®æº ==========\n\nexport interface StaticDataSourceConfig {\n  data: any\n  refreshInterval?: number\n}\n\nexport class StaticDataSource implements DataSource {\n  id: string\n  type = 'static' as const\n  name: string\n  description?: string\n  private config: StaticDataSourceConfig\n\n  constructor(id: string, name: string, config: StaticDataSourceConfig, description?: string) {\n    this.id = id\n    this.name = name\n    this.config = config\n    this.description = description\n  }\n\n  async fetchData(): Promise<any> {\n    // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ\n    await new Promise(resolve => setTimeout(resolve, 10))\n\n    // å¦‚æœæ•°æ®æ˜¯å‡½æ•°ï¼Œæ‰§è¡Œå®ƒä»¥è·å¾—åŠ¨æ€æ•°æ®\n    if (typeof this.config.data === 'function') {\n      try {\n        const result = await this.config.data()\n        return result\n      } catch (error) {\n        return null\n      }\n    }\n    return this.config.data\n  }\n\n  validateConfig(): boolean {\n    return this.config.data !== undefined\n  }\n\n  getConfig(): StaticDataSourceConfig {\n    return { ...this.config }\n  }\n\n  updateConfig(config: Partial<StaticDataSourceConfig>): void {\n    this.config = { ...this.config, ...config }\n  }\n}\n\n// ========== APIæ•°æ®æº ==========\n\nexport interface ApiDataSourceConfig {\n  url: string\n  method?: 'GET' | 'POST' | 'PUT' | 'DELETE'\n  headers?: Record<string, string>\n  params?: Record<string, any>\n  body?: any\n  timeout?: number\n  retryCount?: number\n  retryDelay?: number\n}\n\nexport class ApiDataSource implements DataSource {\n  id: string\n  type = 'api' as const\n  name: string\n  description?: string\n  private config: ApiDataSourceConfig\n\n  constructor(id: string, name: string, config: ApiDataSourceConfig, description?: string) {\n    this.id = id\n    this.name = name\n    this.config = {\n      method: 'GET',\n      timeout: 10000,\n      retryCount: 3,\n      retryDelay: 1000,\n      ...config\n    }\n    this.description = description\n  }\n\n  async fetchData(): Promise<any> {\n    let lastError: Error | null = null\n\n    for (let attempt = 0; attempt <= this.config.retryCount!; attempt++) {\n      try {\n        const controller = new AbortController()\n        const timeoutId = setTimeout(() => controller.abort(), this.config.timeout)\n\n        const requestInit: RequestInit = {\n          method: this.config.method,\n          headers: {\n            'Content-Type': 'application/json',\n            ...this.config.headers\n          },\n          signal: controller.signal\n        }\n\n        // å¤„ç†è¯·æ±‚å‚æ•°\n        let url = this.config.url\n        if (this.config.params && this.config.method === 'GET') {\n          const searchParams = new URLSearchParams(this.config.params)\n          url += (url.includes('?') ? '&' : '?') + searchParams.toString()\n        }\n\n        // å¤„ç†è¯·æ±‚ä½“\n        if (this.config.body && this.config.method !== 'GET') {\n          requestInit.body = typeof this.config.body === 'string' ? this.config.body : JSON.stringify(this.config.body)\n        }\n\n        const response = await fetch(url, requestInit)\n        clearTimeout(timeoutId)\n\n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n        }\n\n        const contentType = response.headers.get('content-type')\n        let data: any\n\n        if (contentType && contentType.includes('application/json')) {\n          data = await response.json()\n        } else {\n          data = await response.text()\n        }\n        return data\n      } catch (error) {\n        lastError = error as Error\n        if (attempt < this.config.retryCount!) {\n          await new Promise(resolve => setTimeout(resolve, this.config.retryDelay))\n        }\n      }\n    }\n    throw lastError || new Error('APIè°ƒç”¨å¤±è´¥')\n  }\n\n  validateConfig(): boolean {\n    try {\n      new URL(this.config.url)\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  getConfig(): ApiDataSourceConfig {\n    return { ...this.config }\n  }\n\n  updateConfig(config: Partial<ApiDataSourceConfig>): void {\n    this.config = { ...this.config, ...config }\n  }\n}\n\n// ========== WebSocketæ•°æ®æº ==========\n\nexport interface WebSocketDataSourceConfig {\n  url: string\n  protocols?: string[]\n  reconnectInterval?: number\n  maxReconnectAttempts?: number\n  heartbeatInterval?: number\n  heartbeatMessage?: string\n}\n\nexport class WebSocketDataSource implements DataSource {\n  id: string\n  type = 'websocket' as const\n  name: string\n  description?: string\n  private config: WebSocketDataSourceConfig\n  private ws: WebSocket | null = null\n  private lastData: any = null\n  private dataListeners: ((data: any) => void)[] = []\n  private reconnectAttempts = 0\n\n  constructor(id: string, name: string, config: WebSocketDataSourceConfig, description?: string) {\n    this.id = id\n    this.name = name\n    this.config = {\n      reconnectInterval: 5000,\n      maxReconnectAttempts: 5,\n      heartbeatInterval: 30000,\n      ...config\n    }\n    this.description = description\n  }\n\n  async fetchData(): Promise<any> {\n    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n      await this.connect()\n    }\n\n    return this.lastData\n  }\n\n  private async connect(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      try {\n        this.ws = new WebSocket(this.config.url, this.config.protocols)\n\n        this.ws.onopen = () => {\n          this.reconnectAttempts = 0\n          this.startHeartbeat()\n          resolve()\n        }\n\n        this.ws.onmessage = event => {\n          try {\n            const data = JSON.parse(event.data)\n            this.lastData = data\n            this.dataListeners.forEach(listener => listener(data))\n          } catch (error) {}\n        }\n\n        this.ws.onerror = error => {\n          reject(error)\n        }\n\n        this.ws.onclose = () => {\n          this.stopHeartbeat()\n          this.attemptReconnect()\n        }\n      } catch (error) {\n        reject(error)\n      }\n    })\n  }\n\n  private attemptReconnect(): void {\n    if (this.reconnectAttempts < this.config.maxReconnectAttempts!) {\n      this.reconnectAttempts++\n      setTimeout(() => {\n        this.connect().catch(error => {})\n      }, this.config.reconnectInterval)\n    } else {\n    }\n  }\n\n  private heartbeatTimer: NodeJS.Timeout | null = null\n\n  private startHeartbeat(): void {\n    if (this.config.heartbeatInterval && this.config.heartbeatMessage) {\n      this.heartbeatTimer = setInterval(() => {\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          this.ws.send(this.config.heartbeatMessage!)\n        }\n      }, this.config.heartbeatInterval)\n    }\n  }\n\n  private stopHeartbeat(): void {\n    if (this.heartbeatTimer) {\n      clearInterval(this.heartbeatTimer)\n      this.heartbeatTimer = null\n    }\n  }\n\n  onData(listener: (data: any) => void): void {\n    this.dataListeners.push(listener)\n  }\n\n  disconnect(): void {\n    this.stopHeartbeat()\n    if (this.ws) {\n      this.ws.close()\n      this.ws = null\n    }\n  }\n\n  validateConfig(): boolean {\n    try {\n      new URL(this.config.url)\n      return this.config.url.startsWith('ws://') || this.config.url.startsWith('wss://')\n    } catch {\n      return false\n    }\n  }\n\n  getConfig(): WebSocketDataSourceConfig {\n    return { ...this.config }\n  }\n\n  updateConfig(config: Partial<WebSocketDataSourceConfig>): void {\n    this.config = { ...this.config, ...config }\n  }\n}\n\n// ========== è„šæœ¬æ•°æ®æº ==========\n\nexport interface ScriptDataSourceConfig {\n  script: string\n  context?: Record<string, any>\n  timeout?: number\n}\n\nexport class ScriptDataSource implements DataSource {\n  id: string\n  type = 'script' as const\n  name: string\n  description?: string\n  private config: ScriptDataSourceConfig\n\n  constructor(id: string, name: string, config: ScriptDataSourceConfig, description?: string) {\n    this.id = id\n    this.name = name\n    this.config = {\n      timeout: 5000,\n      ...config\n    }\n    this.description = description\n  }\n\n  async fetchData(): Promise<any> {\n    try {\n      // ä½¿ç”¨å…¨å±€è„šæœ¬å¼•æ“æ‰§è¡Œè„šæœ¬\n      const result = await defaultScriptEngine.execute(this.config.script, this.config.context)\n\n      if (result.success) {\n        return result.data\n      } else {\n        throw result.error || new Error('è„šæœ¬æ‰§è¡Œå¤±è´¥')\n      }\n    } catch (error) {\n      throw error\n    }\n  }\n\n  validateConfig(): boolean {\n    return typeof this.config.script === 'string' && this.config.script.trim() !== ''\n  }\n\n  getConfig(): ScriptDataSourceConfig {\n    return { ...this.config }\n  }\n\n  updateConfig(config: Partial<ScriptDataSourceConfig>): void {\n    this.config = { ...this.config, ...config }\n  }\n}\n\n// ========== æ•°æ®æºå·¥å‚ ==========\n\nexport class DataSourceFactory {\n  /**\n   * åˆ›å»ºé™æ€æ•°æ®æº\n   */\n  static createStaticDataSource(id: string, name: string, data: any, description?: string): StaticDataSource {\n    return new StaticDataSource(id, name, { data }, description)\n  }\n\n  /**\n   * åˆ›å»ºAPIæ•°æ®æº\n   */\n  static createApiDataSource(\n    id: string,\n    name: string,\n    config: ApiDataSourceConfig,\n    description?: string\n  ): ApiDataSource {\n    return new ApiDataSource(id, name, config, description)\n  }\n\n  /**\n   * åˆ›å»ºWebSocketæ•°æ®æº\n   */\n  static createWebSocketDataSource(\n    id: string,\n    name: string,\n    config: WebSocketDataSourceConfig,\n    description?: string\n  ): WebSocketDataSource {\n    return new WebSocketDataSource(id, name, config, description)\n  }\n\n  /**\n   * åˆ›å»ºè„šæœ¬æ•°æ®æº\n   */\n  static createScriptDataSource(\n    id: string,\n    name: string,\n    script: string,\n    context?: Record<string, any>,\n    description?: string\n  ): ScriptDataSource {\n    return new ScriptDataSource(id, name, { script, context }, description)\n  }\n\n  /**\n   * æ ¹æ®é…ç½®åˆ›å»ºæ•°æ®æº\n   */\n  static createFromConfig(config: any): DataSource {\n    switch (config.type) {\n      case 'static':\n        return new StaticDataSource(config.id, config.name, config.config, config.description)\n\n      case 'api':\n        return new ApiDataSource(config.id, config.name, config.config, config.description)\n\n      case 'websocket':\n        return new WebSocketDataSource(config.id, config.name, config.config, config.description)\n\n      case 'script':\n        return new ScriptDataSource(config.id, config.name, config.config, config.description)\n\n      default:\n        throw new Error(`ä¸æ”¯æŒçš„æ•°æ®æºç±»å‹: ${config.type}`)\n    }\n  }\n\n  /**\n   * åˆ›å»ºç¤ºä¾‹æ•°æ®æº\n   */\n  static createSampleDataSources(): DataSource[] {\n    const sources: DataSource[] = []\n\n    // é™æ€æ•°æ®æºç¤ºä¾‹\n    sources.push(\n      DataSourceFactory.createStaticDataSource(\n        'sample-static-001',\n        'æ¸©åº¦ä¼ æ„Ÿå™¨æ•°æ®',\n        {\n          temperature: 25.6,\n          humidity: 68.2,\n          pressure: 1013.25,\n          timestamp: new Date().toISOString(),\n          sensor: {\n            id: 'temp-001',\n            name: 'ç¯å¢ƒæ¸©åº¦ä¼ æ„Ÿå™¨',\n            location: 'æœºæˆ¿AåŒº'\n          },\n          readings: [\n            { time: '14:00', value: 24.5 },\n            { time: '14:30', value: 25.1 },\n            { time: '15:00', value: 25.6 }\n          ]\n        },\n        'æ¨¡æ‹Ÿæ¸©åº¦ä¼ æ„Ÿå™¨çš„é™æ€æ•°æ®'\n      )\n    )\n\n    // è„šæœ¬æ•°æ®æºç¤ºä¾‹\n    sources.push(\n      DataSourceFactory.createScriptDataSource(\n        'sample-script-001',\n        'åŠ¨æ€æ¨¡æ‹Ÿæ•°æ®',\n        `\n        return {\n          value: mockData.randomNumber(0, 100),\n          title: 'å®æ—¶æ•°æ®',\n          unit: '%',\n          timestamp: new Date().toISOString(),\n          trend: mockData.randomBoolean() ? 'up' : 'down',\n          history: Array.from({length: 10}, (_, i) => ({\n            time: new Date(Date.now() - (9-i) * 60000).toISOString(),\n            value: mockData.randomNumber(0, 100)\n          }))\n        };\n        `,\n        {},\n        'ç”ŸæˆåŠ¨æ€æ¨¡æ‹Ÿæ•°æ®çš„è„šæœ¬æ•°æ®æº'\n      )\n    )\n\n    return sources\n  }\n}\n\nexport default DataSourceFactory\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-binding\\data-transform-pipeline.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'beforeProcessing' is assigned a value but never used.","line":245,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":245,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'beforeProcessing' is assigned a value but never used.","line":245,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":245,"endColumn":31},{"ruleId":"no-unused-vars","severity":1,"message":"'afterProcessing' is assigned a value but never used.","line":247,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":247,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'afterProcessing' is assigned a value but never used.","line":247,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":247,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'executionTime' is assigned a value but never used.","line":257,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":257,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'executionTime' is assigned a value but never used.","line":257,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":257,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'executionTime' is assigned a value but never used.","line":261,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":261,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'executionTime' is assigned a value but never used.","line":261,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":261,"endColumn":26},{"ruleId":"no-useless-catch","severity":2,"message":"Unnecessary try/catch wrapper.","line":330,"column":5,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":345,"endColumn":6}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * æ•°æ®è½¬æ¢ç®¡é“å®ç°\n * æ•´åˆæ•°æ®æºã€å¤„ç†å™¨å’Œæ˜ å°„å™¨ï¼Œæä¾›å®Œæ•´çš„æ•°æ®è½¬æ¢æµç¨‹\n */\n\nimport type {\n  DataSource,\n  DataProcessor,\n  DataMapper,\n  DataValidator,\n  DataTransformPipeline,\n  ComponentDataRequirement,\n  DataValidationResult\n} from './types'\n\nimport { PathDataMapper } from './data-processors'\n\n// ========== æ•°æ®éªŒè¯å™¨å®ç° ==========\n\nexport class ComponentDataValidator implements DataValidator {\n  validate(data: any, requirement: ComponentDataRequirement): DataValidationResult {\n    const errors: string[] = []\n    const warnings: string[] = []\n    const details: Record<string, any> = {}\n    // éªŒè¯æ¯ä¸ªå­—æ®µ\n    Object.entries(requirement.fields).forEach(([fieldName, fieldReq]) => {\n      const fieldValue = data?.[fieldName]\n      const fieldValidation = this.validateField(fieldValue, fieldReq)\n\n      details[fieldName] = {\n        value: fieldValue,\n        required: fieldReq.required,\n        valid: fieldValidation.valid,\n        errors: fieldValidation.errors,\n        warnings: fieldValidation.warnings\n      }\n\n      if (!fieldValidation.valid) {\n        if (fieldReq.required) {\n          errors.push(`å¿…å¡«å­—æ®µ ${fieldName} éªŒè¯å¤±è´¥: ${fieldValidation.errors.join(', ')}`)\n        } else {\n          warnings.push(`å¯é€‰å­—æ®µ ${fieldName} éªŒè¯å¤±è´¥: ${fieldValidation.errors.join(', ')}`)\n        }\n      }\n    })\n\n    // éªŒè¯æ•°æ®å…³ç³»\n    if (requirement.relationships) {\n      Object.entries(requirement.relationships).forEach(([relationName, relation]) => {\n        const inputsValid = relation.inputs.every(inputField => data?.[inputField] !== undefined)\n        details[`relationship_${relationName}`] = {\n          type: relation.type,\n          inputs: relation.inputs,\n          inputsValid\n        }\n\n        if (!inputsValid) {\n          warnings.push(`æ•°æ®å…³ç³» ${relationName} çš„è¾“å…¥å­—æ®µä¸å®Œæ•´`)\n        }\n      })\n    }\n\n    const result: DataValidationResult = {\n      valid: errors.length === 0,\n      errors,\n      warnings,\n      details\n    }\n    return result\n  }\n\n  validateField(value: any, fieldRequirement: DataFieldRequirement): DataValidationResult {\n    const errors: string[] = []\n    const warnings: string[] = []\n\n    // æ£€æŸ¥å¿…å¡«å­—æ®µ\n    if (fieldRequirement.required && (value === undefined || value === null)) {\n      errors.push('å­—æ®µå€¼ä¸èƒ½ä¸ºç©º')\n      return { valid: false, errors, warnings, details: {} }\n    }\n\n    // å¦‚æœå€¼ä¸ºç©ºä¸”å­—æ®µä¸æ˜¯å¿…å¡«çš„ï¼Œåˆ™éªŒè¯é€šè¿‡\n    if (value === undefined || value === null) {\n      return { valid: true, errors: [], warnings: [], details: {} }\n    }\n\n    // éªŒè¯å­—æ®µç±»å‹\n    switch (fieldRequirement.type) {\n      case 'value':\n        this.validateValueType(value, fieldRequirement.valueType || 'any', errors, warnings)\n        break\n\n      case 'object':\n        if (typeof value !== 'object' || Array.isArray(value)) {\n          errors.push('å­—æ®µå€¼å¿…é¡»æ˜¯å¯¹è±¡ç±»å‹')\n        } else if (fieldRequirement.structure) {\n          // é€’å½’éªŒè¯åµŒå¥—ç»“æ„\n          const nestedValidation = this.validate(value, fieldRequirement.structure)\n          if (!nestedValidation.valid) {\n            errors.push(...nestedValidation.errors.map(err => `åµŒå¥—å¯¹è±¡: ${err}`))\n          }\n        }\n        break\n\n      case 'array':\n        if (!Array.isArray(value)) {\n          errors.push('å­—æ®µå€¼å¿…é¡»æ˜¯æ•°ç»„ç±»å‹')\n        } else if (fieldRequirement.structure && value.length > 0) {\n          // éªŒè¯æ•°ç»„å…ƒç´ ç»“æ„\n          const sampleElement = value[0]\n          const elementValidation = this.validate(sampleElement, fieldRequirement.structure)\n          if (!elementValidation.valid) {\n            warnings.push(`æ•°ç»„å…ƒç´ ç»“æ„ä¸åŒ¹é…: ${elementValidation.errors.join(', ')}`)\n          }\n        }\n        break\n    }\n\n    // éªŒè¯è‡ªå®šä¹‰è§„åˆ™\n    if (fieldRequirement.validation) {\n      this.validateCustomRules(value, fieldRequirement.validation, errors, warnings)\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n      warnings,\n      details: { value, type: typeof value }\n    }\n  }\n\n  private validateValueType(value: any, expectedType: string, errors: string[], warnings: string[]): void {\n    const actualType = typeof value\n\n    switch (expectedType) {\n      case 'number':\n        if (actualType !== 'number' || isNaN(value)) {\n          errors.push(`æœŸæœ›æ•°å­—ç±»å‹ï¼Œå®é™…ç±»å‹: ${actualType}`)\n        }\n        break\n\n      case 'string':\n        if (actualType !== 'string') {\n          errors.push(`æœŸæœ›å­—ç¬¦ä¸²ç±»å‹ï¼Œå®é™…ç±»å‹: ${actualType}`)\n        }\n        break\n\n      case 'boolean':\n        if (actualType !== 'boolean') {\n          errors.push(`æœŸæœ›å¸ƒå°”ç±»å‹ï¼Œå®é™…ç±»å‹: ${actualType}`)\n        }\n        break\n\n      case 'any':\n        // ä»»ä½•ç±»å‹éƒ½å¯ä»¥\n        break\n\n      default:\n        warnings.push(`æœªçŸ¥çš„å€¼ç±»å‹è¦æ±‚: ${expectedType}`)\n    }\n  }\n\n  private validateCustomRules(value: any, validation: any, errors: string[], warnings: string[]): void {\n    if (validation.min !== undefined) {\n      if (typeof value === 'number' && value < validation.min) {\n        errors.push(`å€¼ ${value} å°äºæœ€å°å€¼ ${validation.min}`)\n      } else if (typeof value === 'string' && value.length < validation.min) {\n        errors.push(`å­—ç¬¦ä¸²é•¿åº¦ ${value.length} å°äºæœ€å°é•¿åº¦ ${validation.min}`)\n      }\n    }\n\n    if (validation.max !== undefined) {\n      if (typeof value === 'number' && value > validation.max) {\n        errors.push(`å€¼ ${value} å¤§äºæœ€å¤§å€¼ ${validation.max}`)\n      } else if (typeof value === 'string' && value.length > validation.max) {\n        errors.push(`å­—ç¬¦ä¸²é•¿åº¦ ${value.length} å¤§äºæœ€å¤§é•¿åº¦ ${validation.max}`)\n      }\n    }\n\n    if (validation.pattern && typeof value === 'string') {\n      const regex = new RegExp(validation.pattern)\n      if (!regex.test(value)) {\n        errors.push(`å€¼ä¸åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼: ${validation.pattern}`)\n      }\n    }\n\n    if (validation.enum && !validation.enum.includes(value)) {\n      errors.push(`å€¼ä¸åœ¨å…è®¸çš„æšä¸¾å€¼ä¸­: ${validation.enum.join(', ')}`)\n    }\n\n    if (validation.custom && typeof validation.custom === 'function') {\n      try {\n        const customResult = validation.custom(value)\n        if (customResult === false) {\n          errors.push('è‡ªå®šä¹‰éªŒè¯å¤±è´¥')\n        } else if (typeof customResult === 'string') {\n          errors.push(customResult)\n        }\n      } catch (error) {\n        warnings.push(`è‡ªå®šä¹‰éªŒè¯æ‰§è¡Œå¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`)\n      }\n    }\n  }\n}\n\n// ========== æ•°æ®è½¬æ¢ç®¡é“å®ç° ==========\n\nexport class DataTransformPipelineImpl implements DataTransformPipeline {\n  id: string\n  source: DataSource\n  processors: DataProcessor[]\n  mapper: DataMapper\n  validator?: DataValidator\n\n  private lastExecutionTime: Date | null = null\n  private lastResult: any = null\n  private executionCount = 0\n\n  constructor(\n    id: string,\n    source: DataSource,\n    processors: DataProcessor[] = [],\n    mapper: DataMapper,\n    validator?: DataValidator\n  ) {\n    this.id = id\n    this.source = source\n    this.processors = processors\n    this.mapper = mapper\n    this.validator = validator\n  }\n\n  async execute(): Promise<Record<string, any>> {\n    const startTime = Date.now()\n    this.executionCount++\n\n    try {\n      // æ­¥éª¤1: ä»æ•°æ®æºè·å–åŸå§‹æ•°æ®\n      let currentData = await this.source.fetchData()\n\n      // æ­¥éª¤2: é€šè¿‡å¤„ç†å™¨é“¾å¤„ç†æ•°æ®\n      for (let i = 0; i < this.processors.length; i++) {\n        const processor = this.processors[i]\n\n        const beforeProcessing = JSON.stringify(currentData)\n        currentData = await processor.process(currentData)\n        const afterProcessing = JSON.stringify(currentData)\n      }\n\n      // æ­¥éª¤3: æ‰§è¡Œå­—æ®µæ˜ å°„\n      const mappedData = this.mapper.map(currentData)\n\n      // è®°å½•æ‰§è¡Œç»“æœ\n      this.lastExecutionTime = new Date()\n      this.lastResult = mappedData\n\n      const executionTime = Date.now() - startTime\n\n      return mappedData\n    } catch (error) {\n      const executionTime = Date.now() - startTime\n      throw error\n    }\n  }\n\n  validate(): boolean {\n    const errors: string[] = []\n\n    // éªŒè¯æ•°æ®æº\n    if (!this.source.validateConfig()) {\n      errors.push('æ•°æ®æºé…ç½®æ— æ•ˆ')\n    }\n\n    // éªŒè¯å¤„ç†å™¨\n    this.processors.forEach((processor, index) => {\n      if (!processor.validateConfig || !processor.validateConfig()) {\n        errors.push(`å¤„ç†å™¨ ${index + 1} (${processor.name}) é…ç½®æ— æ•ˆ`)\n      }\n    })\n\n    // éªŒè¯æ˜ å°„å™¨\n    if (!this.mapper.validateRules()) {\n      errors.push('æ•°æ®æ˜ å°„è§„åˆ™æ— æ•ˆ')\n    }\n\n    if (errors.length > 0) {\n      return false\n    }\n    return true\n  }\n\n  /**\n   * è·å–ç®¡é“ç»Ÿè®¡ä¿¡æ¯\n   */\n  getStats(): {\n    id: string\n    executionCount: number\n    lastExecutionTime: Date | null\n    lastResult: any\n    isValid: boolean\n    sourceType: string\n    processorCount: number\n    mappingRulesCount: number\n  } {\n    return {\n      id: this.id,\n      executionCount: this.executionCount,\n      lastExecutionTime: this.lastExecutionTime,\n      lastResult: this.lastResult,\n      isValid: this.validate(),\n      sourceType: this.source.type,\n      processorCount: this.processors.length,\n      mappingRulesCount: this.mapper.rules.length\n    }\n  }\n\n  /**\n   * é‡ç½®ç»Ÿè®¡ä¿¡æ¯\n   */\n  resetStats(): void {\n    this.executionCount = 0\n    this.lastExecutionTime = null\n    this.lastResult = null\n  }\n\n  /**\n   * é¢„è§ˆç®¡é“æ‰§è¡Œç»“æœï¼ˆä¸æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼‰\n   */\n  async preview(): Promise<Record<string, any>> {\n    try {\n      // è·å–æ•°æ®æºæ•°æ®\n      let currentData = await this.source.fetchData()\n\n      // å¤„ç†å™¨é“¾å¤„ç†\n      for (const processor of this.processors) {\n        currentData = await processor.process(currentData)\n      }\n\n      // å­—æ®µæ˜ å°„\n      const mappedData = this.mapper.map(currentData)\n\n      return mappedData\n    } catch (error) {\n      throw error\n    }\n  }\n}\n\n// ========== ç®¡é“å·¥å‚ ==========\n\nexport class DataTransformPipelineFactory {\n  /**\n   * åˆ›å»ºåŸºç¡€ç®¡é“\n   */\n  static create(\n    id: string,\n    source: DataSource,\n    mappingRules: any[],\n    processors: DataProcessor[] = []\n  ): DataTransformPipelineImpl {\n    const mapper = new PathDataMapper(mappingRules)\n    const validator = new ComponentDataValidator()\n\n    return new DataTransformPipelineImpl(id, source, processors, mapper, validator)\n  }\n\n  /**\n   * æ ¹æ®é…ç½®åˆ›å»ºç®¡é“\n   */\n  static createFromConfig(config: {\n    id: string\n    source: DataSource\n    processors?: DataProcessor[]\n    mappingRules: any[]\n    enableValidation?: boolean\n  }): DataTransformPipelineImpl {\n    const mapper = new PathDataMapper(config.mappingRules)\n    const validator = config.enableValidation ? new ComponentDataValidator() : undefined\n\n    return new DataTransformPipelineImpl(config.id, config.source, config.processors || [], mapper, validator)\n  }\n\n  /**\n   * åˆ›å»ºç¤ºä¾‹ç®¡é“\n   */\n  static createSamplePipeline(): DataTransformPipelineImpl {\n    // è¿™é‡Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç¤ºä¾‹ç®¡é“ç”¨äºæµ‹è¯•\n    // å…·ä½“å®ç°ä¼šåœ¨æµ‹è¯•ç»„ä»¶ä¸­å®Œæˆ\n    throw new Error('ç¤ºä¾‹ç®¡é“éœ€è¦åœ¨å…·ä½“ä½¿ç”¨æ—¶åˆ›å»º')\n  }\n}\n\nexport default DataTransformPipelineImpl\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-binding\\integration-test.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'totalFailed' is assigned a value but never used.","line":662,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":662,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalFailed' is assigned a value but never used.","line":662,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":662,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'totalDuration' is assigned a value but never used.","line":663,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":663,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalDuration' is assigned a value but never used.","line":663,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":663,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'passRate' is assigned a value but never used.","line":671,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":671,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'passRate' is assigned a value but never used.","line":671,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":671,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'test' is defined but never used.","line":673,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":673,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'test' is defined but never used.","line":673,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":673,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'overallPassRate' is assigned a value but never used.","line":675,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":675,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'overallPassRate' is assigned a value but never used.","line":675,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":675,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * æ•°æ®ç»‘å®šç³»ç»Ÿé›†æˆæµ‹è¯•\n * éªŒè¯å®Œæ•´çš„æ•°æ®æµï¼šç»„ä»¶éœ€æ±‚å£°æ˜ â†’ æ•°æ®æº â†’ è½¬æ¢ç®¡é“ â†’ å“åº”å¼ç»‘å®š\n */\n\nimport { componentRequirementManager } from './component-requirement-manager'\nimport { DataSourceFactory } from './data-sources'\nimport { DataTransformPipelineFactory } from './data-transform-pipeline'\nimport { ReactiveDataBindingImpl, UpdateTriggerFactory } from './reactive-binding'\nimport type { ComponentDataRequirement } from './types'\n\nexport interface TestResult {\n  testName: string\n  success: boolean\n  message: string\n  data?: any\n  error?: Error\n  duration: number\n}\n\nexport interface TestSuite {\n  name: string\n  tests: TestResult[]\n  totalTests: number\n  passedTests: number\n  failedTests: number\n  totalDuration: number\n}\n\nexport class DataBindingIntegrationTester {\n  private testResults: TestSuite[] = []\n\n  /**\n   * è¿è¡Œå®Œæ•´çš„é›†æˆæµ‹è¯•å¥—ä»¶\n   */\n  async runFullTestSuite(): Promise<TestSuite[]> {\n    this.testResults = []\n    // æµ‹è¯•å¥—ä»¶1: åŸºç¡€åŠŸèƒ½æµ‹è¯•\n    await this.runBasicFunctionalityTests()\n\n    // æµ‹è¯•å¥—ä»¶2: æ•°æ®ç±»å‹æµ‹è¯•\n    await this.runDataTypeTests()\n\n    // æµ‹è¯•å¥—ä»¶3: æ•°æ®å…³ç³»æµ‹è¯•\n    await this.runDataRelationshipTests()\n\n    // æµ‹è¯•å¥—ä»¶4: å“åº”å¼æ›´æ–°æµ‹è¯•\n    await this.runReactiveUpdateTests()\n\n    // æµ‹è¯•å¥—ä»¶5: é”™è¯¯å¤„ç†æµ‹è¯•\n    await this.runErrorHandlingTests()\n\n    // è¾“å‡ºæµ‹è¯•æ€»ç»“\n    this.printTestSummary()\n\n    return this.testResults\n  }\n\n  /**\n   * åŸºç¡€åŠŸèƒ½æµ‹è¯•å¥—ä»¶\n   */\n  private async runBasicFunctionalityTests(): Promise<void> {\n    const testSuite: TestSuite = {\n      name: 'åŸºç¡€åŠŸèƒ½æµ‹è¯•',\n      tests: [],\n      totalTests: 0,\n      passedTests: 0,\n      failedTests: 0,\n      totalDuration: 0\n    }\n\n    // æµ‹è¯•1: ç»„ä»¶éœ€æ±‚æ³¨å†Œ\n    testSuite.tests.push(\n      await this.runTest('ç»„ä»¶éœ€æ±‚æ³¨å†Œ', async () => {\n        const requirement: ComponentDataRequirement = {\n          fields: {\n            temperature: {\n              type: 'value',\n              valueType: 'number',\n              required: true,\n              description: 'æ¸©åº¦å€¼'\n            },\n            status: {\n              type: 'value',\n              valueType: 'string',\n              required: false,\n              description: 'çŠ¶æ€ä¿¡æ¯'\n            }\n          }\n        }\n\n        componentRequirementManager.registerRequirement('test-component-1', requirement)\n        const retrieved = componentRequirementManager.getRequirement('test-component-1')\n\n        if (!retrieved) {\n          throw new Error('æ— æ³•è·å–å·²æ³¨å†Œçš„ç»„ä»¶éœ€æ±‚')\n        }\n\n        return { registeredFields: Object.keys(retrieved.fields) }\n      })\n    )\n\n    // æµ‹è¯•2: é™æ€æ•°æ®æºåˆ›å»ºå’Œè·å–\n    testSuite.tests.push(\n      await this.runTest('é™æ€æ•°æ®æº', async () => {\n        const dataSource = DataSourceFactory.createStaticDataSource('test-static-1', 'æµ‹è¯•é™æ€æ•°æ®æº', {\n          temperature: 25.5,\n          status: 'normal'\n        })\n\n        const data = await dataSource.fetchData()\n\n        if (!data || data.temperature !== 25.5) {\n          throw new Error('é™æ€æ•°æ®æºè¿”å›çš„æ•°æ®ä¸æ­£ç¡®')\n        }\n\n        return data\n      })\n    )\n\n    // æµ‹è¯•3: è„šæœ¬æ•°æ®æºåˆ›å»ºå’Œæ‰§è¡Œ\n    testSuite.tests.push(\n      await this.runTest('è„šæœ¬æ•°æ®æº', async () => {\n        const dataSource = DataSourceFactory.createScriptDataSource(\n          'test-script-1',\n          'æµ‹è¯•è„šæœ¬æ•°æ®æº',\n          'return { temperature: 20 + Math.random() * 10, status: \"active\" };'\n        )\n\n        const data = await dataSource.fetchData()\n\n        if (!data || typeof data.temperature !== 'number' || data.status !== 'active') {\n          throw new Error('è„šæœ¬æ•°æ®æºè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®')\n        }\n\n        return data\n      })\n    )\n\n    // æµ‹è¯•4: æ•°æ®è½¬æ¢ç®¡é“\n    testSuite.tests.push(\n      await this.runTest('æ•°æ®è½¬æ¢ç®¡é“', async () => {\n        const dataSource = DataSourceFactory.createStaticDataSource('test-pipeline-1', 'ç®¡é“æµ‹è¯•æ•°æ®æº', {\n          sensor: { temp: 23.5, online: true },\n          location: 'room-a'\n        })\n\n        const mappingRules = [\n          { sourcePath: 'sensor.temp', targetField: 'temperature', type: 'direct' as const },\n          { sourcePath: 'sensor.online', targetField: 'isOnline', type: 'direct' as const },\n          { sourcePath: 'location', targetField: 'location', type: 'direct' as const }\n        ]\n\n        const pipeline = DataTransformPipelineFactory.create('test-pipeline-1', dataSource, mappingRules)\n\n        if (!pipeline.validate()) {\n          throw new Error('æ•°æ®è½¬æ¢ç®¡é“éªŒè¯å¤±è´¥')\n        }\n\n        const result = await pipeline.execute()\n\n        if (result.temperature !== 23.5 || result.isOnline !== true || result.location !== 'room-a') {\n          throw new Error('æ•°æ®è½¬æ¢ç®¡é“è¾“å‡ºä¸æ­£ç¡®')\n        }\n\n        return result\n      })\n    )\n\n    this.calculateTestSuiteStats(testSuite)\n    this.testResults.push(testSuite)\n  }\n\n  /**\n   * æ•°æ®ç±»å‹æµ‹è¯•å¥—ä»¶\n   */\n  private async runDataTypeTests(): Promise<void> {\n    const testSuite: TestSuite = {\n      name: 'æ•°æ®ç±»å‹æµ‹è¯•',\n      tests: [],\n      totalTests: 0,\n      passedTests: 0,\n      failedTests: 0,\n      totalDuration: 0\n    }\n\n    // æµ‹è¯•1: åŸºç¡€å€¼ç±»å‹ï¼ˆnumber, string, booleanï¼‰\n    testSuite.tests.push(\n      await this.runTest('åŸºç¡€å€¼ç±»å‹', async () => {\n        const requirement: ComponentDataRequirement = {\n          fields: {\n            temperature: { type: 'value', valueType: 'number', required: true, description: 'æ¸©åº¦' },\n            deviceName: { type: 'value', valueType: 'string', required: true, description: 'è®¾å¤‡åç§°' },\n            isOnline: { type: 'value', valueType: 'boolean', required: true, description: 'åœ¨çº¿çŠ¶æ€' }\n          }\n        }\n\n        componentRequirementManager.registerRequirement('test-values', requirement)\n\n        const testData = {\n          temperature: 25.6,\n          deviceName: 'ä¼ æ„Ÿå™¨001',\n          isOnline: true\n        }\n\n        const sampleData = componentRequirementManager.generateSampleData('test-values')\n\n        if (!sampleData || typeof sampleData.temperature !== 'number') {\n          throw new Error('æ•°å€¼ç±»å‹ç”Ÿæˆå¤±è´¥')\n        }\n\n        return { original: testData, sample: sampleData }\n      })\n    )\n\n    // æµ‹è¯•2: å¯¹è±¡ç±»å‹\n    testSuite.tests.push(\n      await this.runTest('å¯¹è±¡ç±»å‹', async () => {\n        const requirement: ComponentDataRequirement = {\n          fields: {\n            sensorInfo: {\n              type: 'object',\n              required: true,\n              description: 'ä¼ æ„Ÿå™¨ä¿¡æ¯',\n              structure: {\n                fields: {\n                  id: { type: 'value', valueType: 'string', required: true, description: 'ID' },\n                  name: { type: 'value', valueType: 'string', required: true, description: 'åç§°' },\n                  location: { type: 'value', valueType: 'string', required: false, description: 'ä½ç½®' }\n                }\n              }\n            }\n          }\n        }\n\n        componentRequirementManager.registerRequirement('test-object', requirement)\n\n        const dataSource = DataSourceFactory.createStaticDataSource('test-object-data', 'å¯¹è±¡æ•°æ®æº', {\n          device: {\n            id: 'sensor-001',\n            name: 'ç¯å¢ƒä¼ æ„Ÿå™¨',\n            location: 'æœºæˆ¿AåŒº'\n          }\n        })\n\n        const mappingRules = [{ sourcePath: 'device', targetField: 'sensorInfo', type: 'direct' as const }]\n\n        const pipeline = DataTransformPipelineFactory.create('test-object-pipeline', dataSource, mappingRules)\n        const result = await pipeline.execute()\n\n        if (!result.sensorInfo || result.sensorInfo.id !== 'sensor-001') {\n          throw new Error('å¯¹è±¡ç±»å‹æ˜ å°„å¤±è´¥')\n        }\n\n        return result\n      })\n    )\n\n    // æµ‹è¯•3: æ•°ç»„ç±»å‹\n    testSuite.tests.push(\n      await this.runTest('æ•°ç»„ç±»å‹', async () => {\n        const requirement: ComponentDataRequirement = {\n          fields: {\n            readings: {\n              type: 'array',\n              required: true,\n              description: 'è¯»æ•°æ•°ç»„',\n              structure: {\n                fields: {\n                  time: { type: 'value', valueType: 'string', required: true, description: 'æ—¶é—´' },\n                  value: { type: 'value', valueType: 'number', required: true, description: 'æ•°å€¼' }\n                }\n              }\n            }\n          }\n        }\n\n        componentRequirementManager.registerRequirement('test-array', requirement)\n\n        const dataSource = DataSourceFactory.createStaticDataSource('test-array-data', 'æ•°ç»„æ•°æ®æº', {\n          measurements: [\n            { time: '14:00', value: 24.5 },\n            { time: '14:30', value: 25.1 },\n            { time: '15:00', value: 25.6 }\n          ]\n        })\n\n        const mappingRules = [{ sourcePath: 'measurements', targetField: 'readings', type: 'direct' as const }]\n\n        const pipeline = DataTransformPipelineFactory.create('test-array-pipeline', dataSource, mappingRules)\n        const result = await pipeline.execute()\n\n        if (!Array.isArray(result.readings) || result.readings.length !== 3) {\n          throw new Error('æ•°ç»„ç±»å‹æ˜ å°„å¤±è´¥')\n        }\n\n        return { count: result.readings.length, sample: result.readings[0] }\n      })\n    )\n\n    this.calculateTestSuiteStats(testSuite)\n    this.testResults.push(testSuite)\n  }\n\n  /**\n   * æ•°æ®å…³ç³»æµ‹è¯•å¥—ä»¶\n   */\n  private async runDataRelationshipTests(): Promise<void> {\n    const testSuite: TestSuite = {\n      name: 'æ•°æ®å…³ç³»æµ‹è¯•',\n      tests: [],\n      totalTests: 0,\n      passedTests: 0,\n      failedTests: 0,\n      totalDuration: 0\n    }\n\n    // æµ‹è¯•1: ç‹¬ç«‹å…³ç³»\n    testSuite.tests.push(\n      await this.runTest('ç‹¬ç«‹å…³ç³»', async () => {\n        const requirement: ComponentDataRequirement = {\n          fields: {\n            temperature: { type: 'value', valueType: 'number', required: true, description: 'æ¸©åº¦' }\n          },\n          relationships: {\n            tempDisplay: {\n              type: 'independent',\n              inputs: ['temperature'],\n              description: 'æ¸©åº¦æ˜¾ç¤ºå€¼'\n            }\n          }\n        }\n\n        componentRequirementManager.registerRequirement('test-independent', requirement)\n\n        const inputData = { temperature: 25.6 }\n        const result = componentRequirementManager.calculateRelationshipValue(\n          'test-independent',\n          'tempDisplay',\n          inputData\n        )\n\n        if (result !== 25.6) {\n          throw new Error('ç‹¬ç«‹å…³ç³»è®¡ç®—å¤±è´¥')\n        }\n\n        return { input: inputData, result }\n      })\n    )\n\n    // æµ‹è¯•2: è®¡ç®—å…³ç³»\n    testSuite.tests.push(\n      await this.runTest('è®¡ç®—å…³ç³»', async () => {\n        const requirement: ComponentDataRequirement = {\n          fields: {\n            temperature: { type: 'value', valueType: 'number', required: true, description: 'æ¸©åº¦' },\n            humidity: { type: 'value', valueType: 'number', required: true, description: 'æ¹¿åº¦' }\n          },\n          relationships: {\n            comfortIndex: {\n              type: 'calculated',\n              inputs: ['temperature', 'humidity'],\n              calculator: inputs => {\n                const temp = inputs.temperature || 0\n                const hum = inputs.humidity || 0\n                if (temp >= 20 && temp <= 26 && hum >= 40 && hum <= 70) {\n                  return 'èˆ’é€‚'\n                } else {\n                  return 'ä¸é€‚'\n                }\n              },\n              description: 'èˆ’é€‚åº¦æŒ‡æ•°'\n            }\n          }\n        }\n\n        componentRequirementManager.registerRequirement('test-calculated', requirement)\n\n        const inputData = { temperature: 23, humidity: 60 }\n        const result = componentRequirementManager.calculateRelationshipValue(\n          'test-calculated',\n          'comfortIndex',\n          inputData\n        )\n\n        if (result !== 'èˆ’é€‚') {\n          throw new Error('è®¡ç®—å…³ç³»è®¡ç®—å¤±è´¥')\n        }\n\n        return { input: inputData, result }\n      })\n    )\n\n    // æµ‹è¯•3: æ´¾ç”Ÿå…³ç³»\n    testSuite.tests.push(\n      await this.runTest('æ´¾ç”Ÿå…³ç³»', async () => {\n        const requirement: ComponentDataRequirement = {\n          fields: {\n            isOnline: { type: 'value', valueType: 'boolean', required: true, description: 'åœ¨çº¿çŠ¶æ€' }\n          },\n          relationships: {\n            statusText: {\n              type: 'derived',\n              inputs: ['isOnline'],\n              description: 'çŠ¶æ€æ–‡æœ¬'\n            }\n          }\n        }\n\n        componentRequirementManager.registerRequirement('test-derived', requirement)\n\n        const inputData = { isOnline: true }\n        const result = componentRequirementManager.calculateRelationshipValue('test-derived', 'statusText', inputData)\n\n        if (result !== true) {\n          throw new Error('æ´¾ç”Ÿå…³ç³»è®¡ç®—å¤±è´¥')\n        }\n\n        return { input: inputData, result }\n      })\n    )\n\n    this.calculateTestSuiteStats(testSuite)\n    this.testResults.push(testSuite)\n  }\n\n  /**\n   * å“åº”å¼æ›´æ–°æµ‹è¯•å¥—ä»¶\n   */\n  private async runReactiveUpdateTests(): Promise<void> {\n    const testSuite: TestSuite = {\n      name: 'å“åº”å¼æ›´æ–°æµ‹è¯•',\n      tests: [],\n      totalTests: 0,\n      passedTests: 0,\n      failedTests: 0,\n      totalDuration: 0\n    }\n\n    // æµ‹è¯•1: æ‰‹åŠ¨è§¦å‘å™¨\n    testSuite.tests.push(\n      await this.runTest('æ‰‹åŠ¨è§¦å‘å™¨', async () => {\n        const dataSource = DataSourceFactory.createScriptDataSource(\n          'test-manual-source',\n          'æ‰‹åŠ¨è§¦å‘æµ‹è¯•',\n          'return { value: Math.random(), timestamp: Date.now() };'\n        )\n\n        const mappingRules = [\n          { sourcePath: 'value', targetField: 'value', type: 'direct' as const },\n          { sourcePath: 'timestamp', targetField: 'timestamp', type: 'direct' as const }\n        ]\n\n        const pipeline = DataTransformPipelineFactory.create('test-manual-pipeline', dataSource, mappingRules)\n        const trigger = UpdateTriggerFactory.createManualTrigger()\n\n        let updateCount = 0\n        let lastData: any = null\n\n        const binding = new ReactiveDataBindingImpl(\n          'test-manual-binding',\n          'test-component',\n          pipeline,\n          [trigger],\n          newData => {\n            updateCount++\n            lastData = newData\n          }\n        )\n\n        // å¯åŠ¨ç»‘å®š\n        binding.start()\n\n        // æ‰‹åŠ¨è§¦å‘æ›´æ–°\n        if ('trigger' in trigger) {\n          ;(trigger as any).trigger()\n          await new Promise(resolve => setTimeout(resolve, 100)) // ç­‰å¾…å¼‚æ­¥æ›´æ–°\n        }\n\n        // åœæ­¢ç»‘å®š\n        binding.stop()\n\n        if (updateCount === 0 || !lastData) {\n          throw new Error('æ‰‹åŠ¨è§¦å‘å™¨æœªæ­£å¸¸å·¥ä½œ')\n        }\n\n        return { updateCount, lastData }\n      })\n    )\n\n    // æµ‹è¯•2: å®šæ—¶å™¨è§¦å‘å™¨\n    testSuite.tests.push(\n      await this.runTest('å®šæ—¶å™¨è§¦å‘å™¨', async () => {\n        const dataSource = DataSourceFactory.createScriptDataSource(\n          'test-timer-source',\n          'å®šæ—¶å™¨æµ‹è¯•',\n          'return { counter: Math.floor(Math.random() * 100) };'\n        )\n\n        const mappingRules = [{ sourcePath: 'counter', targetField: 'counter', type: 'direct' as const }]\n\n        const pipeline = DataTransformPipelineFactory.create('test-timer-pipeline', dataSource, mappingRules)\n        const trigger = UpdateTriggerFactory.createTimerTrigger(500, true) // 500msé—´éš”ï¼Œç«‹å³æ‰§è¡Œ\n\n        let updateCount = 0\n        const updateData: any[] = []\n\n        const binding = new ReactiveDataBindingImpl(\n          'test-timer-binding',\n          'test-component',\n          pipeline,\n          [trigger],\n          newData => {\n            updateCount++\n            updateData.push(newData)\n          }\n        )\n\n        // å¯åŠ¨ç»‘å®šå¹¶ç­‰å¾…å‡ æ¬¡æ›´æ–°\n        binding.start()\n        await new Promise(resolve => setTimeout(resolve, 1200)) // ç­‰å¾…è‡³å°‘2æ¬¡æ›´æ–°\n        binding.stop()\n\n        if (updateCount < 2) {\n          throw new Error('å®šæ—¶å™¨è§¦å‘å™¨æ›´æ–°æ¬¡æ•°ä¸è¶³')\n        }\n\n        return { updateCount, dataCount: updateData.length }\n      })\n    )\n\n    this.calculateTestSuiteStats(testSuite)\n    this.testResults.push(testSuite)\n  }\n\n  /**\n   * é”™è¯¯å¤„ç†æµ‹è¯•å¥—ä»¶\n   */\n  private async runErrorHandlingTests(): Promise<void> {\n    const testSuite: TestSuite = {\n      name: 'é”™è¯¯å¤„ç†æµ‹è¯•',\n      tests: [],\n      totalTests: 0,\n      passedTests: 0,\n      failedTests: 0,\n      totalDuration: 0\n    }\n\n    // æµ‹è¯•1: æ— æ•ˆçš„ç»„ä»¶éœ€æ±‚\n    testSuite.tests.push(\n      await this.runTest('æ— æ•ˆç»„ä»¶éœ€æ±‚å¤„ç†', async () => {\n        try {\n          const invalidRequirement = {\n            fields: {} // ç©ºå­—æ®µå®šä¹‰ï¼Œåº”è¯¥å¯¼è‡´éªŒè¯å¤±è´¥\n          }\n\n          componentRequirementManager.registerRequirement('test-invalid', invalidRequirement as any)\n          throw new Error('åº”è¯¥æŠ›å‡ºéªŒè¯é”™è¯¯')\n        } catch (error) {\n          if (error instanceof Error && error.message.includes('éªŒè¯å¤±è´¥')) {\n            return { handled: true, error: error.message }\n          }\n          throw error\n        }\n      })\n    )\n\n    // æµ‹è¯•2: æ•°æ®æºæ‰§è¡Œé”™è¯¯\n    testSuite.tests.push(\n      await this.runTest('æ•°æ®æºé”™è¯¯å¤„ç†', async () => {\n        const dataSource = DataSourceFactory.createScriptDataSource(\n          'test-error-source',\n          'é”™è¯¯è„šæœ¬',\n          'throw new Error(\"è„šæœ¬æ‰§è¡Œé”™è¯¯\");'\n        )\n\n        try {\n          await dataSource.fetchData()\n          throw new Error('åº”è¯¥æŠ›å‡ºè„šæœ¬æ‰§è¡Œé”™è¯¯')\n        } catch (error) {\n          if (error instanceof Error && error.message.includes('è„šæœ¬æ‰§è¡Œé”™è¯¯')) {\n            return { handled: true, error: error.message }\n          }\n          throw error\n        }\n      })\n    )\n\n    // æµ‹è¯•3: æ˜ å°„è·¯å¾„é”™è¯¯\n    testSuite.tests.push(\n      await this.runTest('æ˜ å°„è·¯å¾„é”™è¯¯å¤„ç†', async () => {\n        const dataSource = DataSourceFactory.createStaticDataSource('test-mapping-error', 'æ˜ å°„é”™è¯¯æµ‹è¯•', {\n          temperature: 25.5\n        })\n\n        const mappingRules = [\n          { sourcePath: 'nonexistent.path', targetField: 'value', type: 'direct' as const, defaultValue: 'default' }\n        ]\n\n        const pipeline = DataTransformPipelineFactory.create('test-mapping-error-pipeline', dataSource, mappingRules)\n        const result = await pipeline.execute()\n\n        // åº”è¯¥è¿”å›é»˜è®¤å€¼è€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯\n        if (result.value !== 'default') {\n          throw new Error('æ˜ å°„é”™è¯¯æœªæ­£ç¡®å¤„ç†')\n        }\n\n        return { result, handled: true }\n      })\n    )\n\n    this.calculateTestSuiteStats(testSuite)\n    this.testResults.push(testSuite)\n  }\n\n  /**\n   * è¿è¡Œå•ä¸ªæµ‹è¯•\n   */\n  private async runTest(testName: string, testFn: () => Promise<any>): Promise<TestResult> {\n    const startTime = Date.now()\n\n    try {\n      const data = await testFn()\n      const duration = Date.now() - startTime\n\n      return {\n        testName,\n        success: true,\n        message: 'æµ‹è¯•é€šè¿‡',\n        data,\n        duration\n      }\n    } catch (error) {\n      const duration = Date.now() - startTime\n\n      return {\n        testName,\n        success: false,\n        message: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯',\n        error: error instanceof Error ? error : new Error(String(error)),\n        duration\n      }\n    }\n  }\n\n  /**\n   * è®¡ç®—æµ‹è¯•å¥—ä»¶ç»Ÿè®¡ä¿¡æ¯\n   */\n  private calculateTestSuiteStats(testSuite: TestSuite): void {\n    testSuite.totalTests = testSuite.tests.length\n    testSuite.passedTests = testSuite.tests.filter(t => t.success).length\n    testSuite.failedTests = testSuite.tests.filter(t => !t.success).length\n    testSuite.totalDuration = testSuite.tests.reduce((sum, t) => sum + t.duration, 0)\n  }\n\n  /**\n   * æ‰“å°æµ‹è¯•æ€»ç»“\n   */\n  private printTestSummary(): void {\n    let totalTests = 0\n    let totalPassed = 0\n    let totalFailed = 0\n    let totalDuration = 0\n\n    this.testResults.forEach(suite => {\n      totalTests += suite.totalTests\n      totalPassed += suite.passedTests\n      totalFailed += suite.failedTests\n      totalDuration += suite.totalDuration\n\n      const passRate = ((suite.passedTests / suite.totalTests) * 100).toFixed(1)\n      // æ˜¾ç¤ºå¤±è´¥çš„æµ‹è¯•\n      suite.tests.filter(t => !t.success).forEach(test => {})\n    })\n    const overallPassRate = ((totalPassed / totalTests) * 100).toFixed(1)\n  }\n\n  /**\n   * è·å–æµ‹è¯•ç»“æœ\n   */\n  getTestResults(): TestSuite[] {\n    return this.testResults\n  }\n\n  /**\n   * æ¸…é™¤æµ‹è¯•ç»“æœ\n   */\n  clearTestResults(): void {\n    this.testResults = []\n  }\n}\n\n// åˆ›å»ºå…¨å±€æµ‹è¯•å®ä¾‹\nexport const dataBindingTester = new DataBindingIntegrationTester()\n\nexport default DataBindingIntegrationTester\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-binding\\reactive-binding.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":101,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":101,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":102,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'event' is defined but never used.","line":146,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":146,"endColumn":39},{"ruleId":"no-unused-vars","severity":1,"message":"'newData' is defined but never used.","line":219,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":219,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'oldData' is defined but never used.","line":219,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":219,"endColumn":45},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":220,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":220,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'newData' is defined but never used.","line":232,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":232,"endColumn":32},{"ruleId":"no-unused-vars","severity":1,"message":"'oldData' is defined but never used.","line":232,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":232,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":233,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":233,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":250,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":250,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":250,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":250,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":263,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":263,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":263,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":263,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'triggerType' is defined but never used.","line":294,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":294,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'triggerType' is defined but never used.","line":294,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":294,"endColumn":39},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":346,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":346,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":346,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":346,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * å“åº”å¼æ•°æ®ç»‘å®šç³»ç»Ÿ\n * å®ç°æ•°æ®çš„å“åº”å¼æ›´æ–°ï¼Œæ”¯æŒå¤šç§è§¦å‘æœºåˆ¶\n */\n\nimport type {\n  UpdateTrigger,\n  UpdateTriggerType,\n  ReactiveDataBinding,\n  DataTransformPipeline,\n  DataBindingManager,\n  DataBindingConfig\n} from './types'\n\n// ========== æ›´æ–°è§¦å‘å™¨å®ç° ==========\n\n/**\n * å®šæ—¶å™¨è§¦å‘å™¨\n */\nexport class TimerTrigger implements UpdateTrigger {\n  type: UpdateTriggerType = 'timer'\n  config: {\n    interval: number // æ¯«ç§’\n    immediate?: boolean // æ˜¯å¦ç«‹å³æ‰§è¡Œä¸€æ¬¡\n  }\n\n  private timer: NodeJS.Timeout | null = null\n  private callback: (() => void) | null = null\n\n  constructor(interval: number, immediate = false) {\n    this.config = { interval, immediate }\n  }\n\n  start(callback: () => void): void {\n    // ğŸ”¥ æ€§èƒ½ä¼˜åŒ–ï¼šä»…åœ¨å¼€å‘ç¯å¢ƒè¾“å‡ºå®šæ—¶å™¨æ—¥å¿—\n\n    this.callback = callback\n\n    // ğŸ”¥ æ€§èƒ½ä¼˜åŒ–ï¼šç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼ˆå¦‚æœé…ç½®äº†ï¼‰ï¼Œé¿å…ä¸å¿…è¦çš„setTimeout\n    if (this.config.immediate) {\n      callback()\n    }\n\n    // å¯åŠ¨å®šæ—¶å™¨\n    this.timer = setInterval(callback, this.config.interval)\n  }\n\n  stop(): void {\n    // ğŸ”¥ æ€§èƒ½ä¼˜åŒ–ï¼šä»…åœ¨å¼€å‘ç¯å¢ƒè¾“å‡ºå®šæ—¶å™¨æ—¥å¿—\n\n    if (this.timer) {\n      clearInterval(this.timer)\n      this.timer = null\n    }\n    this.callback = null\n  }\n\n  isActive(): boolean {\n    return this.timer !== null\n  }\n}\n\n/**\n * WebSocketè§¦å‘å™¨\n */\nexport class WebSocketTrigger implements UpdateTrigger {\n  type: UpdateTriggerType = 'websocket'\n  config: {\n    url: string\n    protocols?: string[]\n    reconnectInterval?: number\n  }\n\n  private ws: WebSocket | null = null\n  private callback: (() => void) | null = null\n  private reconnectTimer: NodeJS.Timeout | null = null\n\n  constructor(url: string, protocols?: string[], reconnectInterval = 5000) {\n    this.config = { url, protocols, reconnectInterval }\n  }\n\n  start(callback: () => void): void {\n    this.callback = callback\n    this.connect()\n  }\n\n  private connect(): void {\n    try {\n      this.ws = new WebSocket(this.config.url, this.config.protocols)\n\n      this.ws.onmessage = () => {\n        if (this.callback) {\n          this.callback()\n        }\n      }\n\n      this.ws.onclose = () => {\n        this.scheduleReconnect()\n      }\n\n      this.ws.onerror = error => {}\n    } catch (error) {\n      this.scheduleReconnect()\n    }\n  }\n\n  private scheduleReconnect(): void {\n    if (this.reconnectTimer) return\n\n    this.reconnectTimer = setTimeout(() => {\n      this.reconnectTimer = null\n      this.connect()\n    }, this.config.reconnectInterval)\n  }\n\n  stop(): void {\n    if (this.reconnectTimer) {\n      clearTimeout(this.reconnectTimer)\n      this.reconnectTimer = null\n    }\n\n    if (this.ws) {\n      this.ws.close()\n      this.ws = null\n    }\n\n    this.callback = null\n  }\n\n  isActive(): boolean {\n    return this.ws !== null && this.ws.readyState === WebSocket.OPEN\n  }\n}\n\n/**\n * äº‹ä»¶è§¦å‘å™¨\n */\nexport class EventTrigger implements UpdateTrigger {\n  type: UpdateTriggerType = 'event'\n  config: {\n    eventName: string\n    target?: EventTarget\n  }\n\n  private callback: (() => void) | null = null\n  private eventHandler: ((event: Event) => void) | null = null\n\n  constructor(eventName: string, target: EventTarget = window) {\n    this.config = { eventName, target }\n  }\n\n  start(callback: () => void): void {\n    this.callback = callback\n    this.eventHandler = () => {\n      callback()\n    }\n\n    this.config.target?.addEventListener(this.config.eventName, this.eventHandler)\n  }\n\n  stop(): void {\n    if (this.eventHandler) {\n      this.config.target?.removeEventListener(this.config.eventName, this.eventHandler)\n      this.eventHandler = null\n    }\n\n    this.callback = null\n  }\n\n  isActive(): boolean {\n    return this.eventHandler !== null\n  }\n}\n\n/**\n * æ‰‹åŠ¨è§¦å‘å™¨\n */\nexport class ManualTrigger implements UpdateTrigger {\n  type: UpdateTriggerType = 'manual'\n  config: any = {}\n\n  private callback: (() => void) | null = null\n  private active = false\n\n  start(callback: () => void): void {\n    // ğŸ”¥ æ€§èƒ½ä¼˜åŒ–ï¼šä»…åœ¨å¼€å‘ç¯å¢ƒè¾“å‡ºæ‰‹åŠ¨è§¦å‘å™¨æ—¥å¿—\n    this.callback = callback\n    this.active = true\n  }\n\n  stop(): void {\n    // ğŸ”¥ æ€§èƒ½ä¼˜åŒ–ï¼šä»…åœ¨å¼€å‘ç¯å¢ƒè¾“å‡ºæ‰‹åŠ¨è§¦å‘å™¨æ—¥å¿—\n    this.callback = null\n    this.active = false\n  }\n\n  isActive(): boolean {\n    return this.active\n  }\n\n  /**\n   * æ‰‹åŠ¨è§¦å‘æ›´æ–°\n   */\n  trigger(): void {\n    if (this.callback && this.active) {\n      // ğŸ”¥ æ€§èƒ½ä¼˜åŒ–ï¼šä»…åœ¨å¼€å‘ç¯å¢ƒè¾“å‡ºæ‰‹åŠ¨è§¦å‘æ—¥å¿—\n      this.callback()\n    }\n  }\n}\n\n// ========== å“åº”å¼æ•°æ®ç»‘å®šå®ç° ==========\n\nexport class ReactiveDataBindingImpl implements ReactiveDataBinding {\n  id: string\n  componentId: string\n  pipeline: DataTransformPipeline\n  triggers: UpdateTrigger[]\n  onDataChange: (newData: any, oldData?: any) => void\n  onError?: (error: Error) => void\n\n  private currentData: any = null\n  private active = false\n  private updateCount = 0\n  private lastUpdateTime: Date | null = null\n\n  constructor(\n    id: string,\n    componentId: string,\n    pipeline: DataTransformPipeline,\n    triggers: UpdateTrigger[],\n    onDataChange: (newData: any, oldData?: any) => void,\n    onError?: (error: Error) => void\n  ) {\n    this.id = id\n    this.componentId = componentId\n    this.pipeline = pipeline\n    this.triggers = triggers\n    this.onDataChange = onDataChange\n    this.onError = onError\n  }\n\n  start(): void {\n    if (this.active) {\n      return\n    }\n    this.active = true\n\n    // å¯åŠ¨æ‰€æœ‰è§¦å‘å™¨\n    this.triggers.forEach((trigger, index) => {\n      trigger.start(() => this.handleTrigger(trigger))\n    })\n  }\n\n  stop(): void {\n    if (!this.active) {\n      return\n    }\n\n    this.active = false\n\n    // åœæ­¢æ‰€æœ‰è§¦å‘å™¨\n    this.triggers.forEach((trigger, index) => {\n      trigger.stop()\n    })\n  }\n\n  async refresh(): Promise<void> {\n    if (!this.active) {\n      return\n    }\n    await this.updateData('manual')\n  }\n\n  getCurrentData(): any {\n    return this.currentData\n  }\n\n  isActive(): boolean {\n    return this.active\n  }\n\n  /**\n   * å¤„ç†è§¦å‘å™¨äº‹ä»¶\n   */\n  private async handleTrigger(trigger: UpdateTrigger): Promise<void> {\n    if (!this.active) return\n    await this.updateData(trigger.type)\n  }\n\n  /**\n   * æ›´æ–°æ•°æ®\n   */\n  private async updateData(triggerType: string): Promise<void> {\n    try {\n      const oldData = this.currentData\n      const newData = await this.pipeline.execute()\n\n      this.updateCount++\n      this.lastUpdateTime = new Date()\n\n      // æ£€æŸ¥æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–\n      const dataChanged = JSON.stringify(oldData) !== JSON.stringify(newData)\n\n      if (dataChanged) {\n        this.currentData = newData\n        this.onDataChange(newData, oldData)\n      }\n    } catch (error) {\n      if (this.onError) {\n        this.onError(error as Error)\n      }\n    }\n  }\n\n  /**\n   * è·å–ç»‘å®šç»Ÿè®¡ä¿¡æ¯\n   */\n  getStats(): {\n    id: string\n    componentId: string\n    active: boolean\n    updateCount: number\n    lastUpdateTime: Date | null\n    triggerCount: number\n    activeTriggers: number\n  } {\n    return {\n      id: this.id,\n      componentId: this.componentId,\n      active: this.active,\n      updateCount: this.updateCount,\n      lastUpdateTime: this.lastUpdateTime,\n      triggerCount: this.triggers.length,\n      activeTriggers: this.triggers.filter(t => t.isActive()).length\n    }\n  }\n}\n\n// ========== æ•°æ®ç»‘å®šç®¡ç†å™¨å®ç° ==========\n\nexport class DataBindingManagerImpl implements DataBindingManager {\n  private bindings = new Map<string, ReactiveDataBinding>()\n  private componentBindings = new Map<string, Set<string>>()\n\n  createBinding(config: DataBindingConfig): ReactiveDataBinding {\n    // è¿™é‡Œéœ€è¦æ ¹æ®é…ç½®åˆ›å»ºå®Œæ•´çš„ç®¡é“å’Œè§¦å‘å™¨\n    // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™ä¼šæ˜¯ä¸€ä¸ªå¤æ‚çš„å·¥å‚æ–¹æ³•\n    // ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬å…ˆè¿”å›ä¸€ä¸ªåŸºç¡€çš„ç»‘å®š\n\n    throw new Error('createBindingéœ€è¦åœ¨å…·ä½“ä½¿ç”¨æ—¶å®ç°ï¼Œéœ€è¦å®Œæ•´çš„ç®¡é“é…ç½®')\n  }\n\n  getBinding(id: string): ReactiveDataBinding | null {\n    return this.bindings.get(id) || null\n  }\n\n  removeBinding(id: string): void {\n    const binding = this.bindings.get(id)\n    if (binding) {\n      // åœæ­¢ç»‘å®š\n      if (binding.isActive()) {\n        binding.stop()\n      }\n\n      // ä»æ˜ å°„ä¸­ç§»é™¤\n      this.bindings.delete(id)\n\n      // ä»ç»„ä»¶ç»‘å®šæ˜ å°„ä¸­ç§»é™¤\n      const componentBindingSet = this.componentBindings.get(binding.componentId)\n      if (componentBindingSet) {\n        componentBindingSet.delete(id)\n        if (componentBindingSet.size === 0) {\n          this.componentBindings.delete(binding.componentId)\n        }\n      }\n    }\n  }\n\n  getComponentBindings(componentId: string): ReactiveDataBinding[] {\n    const bindingIds = this.componentBindings.get(componentId)\n    if (!bindingIds) return []\n\n    const bindings: ReactiveDataBinding[] = []\n    bindingIds.forEach(bindingId => {\n      const binding = this.bindings.get(bindingId)\n      if (binding) {\n        bindings.push(binding)\n      }\n    })\n\n    return bindings\n  }\n\n  getActiveBindings(): ReactiveDataBinding[] {\n    const activeBindings: ReactiveDataBinding[] = []\n    this.bindings.forEach(binding => {\n      if (binding.isActive()) {\n        activeBindings.push(binding)\n      }\n    })\n    return activeBindings\n  }\n\n  cleanup(): void {\n    // åœæ­¢æ‰€æœ‰æ´»è·ƒçš„ç»‘å®š\n    this.bindings.forEach(binding => {\n      if (binding.isActive()) {\n        binding.stop()\n      }\n    })\n\n    // æ¸…ç©ºæ‰€æœ‰æ˜ å°„\n    this.bindings.clear()\n    this.componentBindings.clear()\n  }\n\n  /**\n   * æ³¨å†Œæ•°æ®ç»‘å®šï¼ˆç”¨äºæ‰‹åŠ¨åˆ›å»ºçš„ç»‘å®šï¼‰\n   */\n  registerBinding(binding: ReactiveDataBinding): void {\n    this.bindings.set(binding.id, binding)\n\n    // æ›´æ–°ç»„ä»¶ç»‘å®šæ˜ å°„\n    if (!this.componentBindings.has(binding.componentId)) {\n      this.componentBindings.set(binding.componentId, new Set())\n    }\n    this.componentBindings.get(binding.componentId)!.add(binding.id)\n  }\n\n  /**\n   * è·å–ç®¡ç†å™¨ç»Ÿè®¡ä¿¡æ¯\n   */\n  getStats(): {\n    totalBindings: number\n    activeBindings: number\n    componentCount: number\n    bindingsByComponent: Record<string, number>\n  } {\n    const stats = {\n      totalBindings: this.bindings.size,\n      activeBindings: this.getActiveBindings().length,\n      componentCount: this.componentBindings.size,\n      bindingsByComponent: {} as Record<string, number>\n    }\n\n    this.componentBindings.forEach((bindingIds, componentId) => {\n      stats.bindingsByComponent[componentId] = bindingIds.size\n    })\n\n    return stats\n  }\n}\n\n// ========== è§¦å‘å™¨å·¥å‚ ==========\n\nexport class UpdateTriggerFactory {\n  /**\n   * åˆ›å»ºå®šæ—¶å™¨è§¦å‘å™¨\n   */\n  static createTimerTrigger(interval: number, immediate = false): TimerTrigger {\n    return new TimerTrigger(interval, immediate)\n  }\n\n  /**\n   * åˆ›å»ºWebSocketè§¦å‘å™¨\n   */\n  static createWebSocketTrigger(url: string, protocols?: string[]): WebSocketTrigger {\n    return new WebSocketTrigger(url, protocols)\n  }\n\n  /**\n   * åˆ›å»ºäº‹ä»¶è§¦å‘å™¨\n   */\n  static createEventTrigger(eventName: string, target?: EventTarget): EventTrigger {\n    return new EventTrigger(eventName, target)\n  }\n\n  /**\n   * åˆ›å»ºæ‰‹åŠ¨è§¦å‘å™¨\n   */\n  static createManualTrigger(): ManualTrigger {\n    return new ManualTrigger()\n  }\n\n  /**\n   * æ ¹æ®é…ç½®åˆ›å»ºè§¦å‘å™¨\n   */\n  static createFromConfig(config: any): UpdateTrigger {\n    switch (config.type) {\n      case 'timer':\n        return new TimerTrigger(config.interval, config.immediate)\n\n      case 'websocket':\n        return new WebSocketTrigger(config.url, config.protocols)\n\n      case 'event':\n        return new EventTrigger(config.eventName, config.target)\n\n      case 'manual':\n        return new ManualTrigger()\n\n      default:\n        throw new Error(`ä¸æ”¯æŒçš„è§¦å‘å™¨ç±»å‹: ${config.type}`)\n    }\n  }\n}\n\n// åˆ›å»ºå…¨å±€å®ä¾‹\nexport const dataBindingManager = new DataBindingManagerImpl()\n\nexport default {\n  ReactiveDataBindingImpl,\n  DataBindingManagerImpl,\n  UpdateTriggerFactory,\n  TimerTrigger,\n  WebSocketTrigger,\n  EventTrigger,\n  ManualTrigger,\n  dataBindingManager\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-binding\\types.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":79,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'inputs' is defined but never used.","line":98,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":44},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":195,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":195,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'input' is defined but never used.","line":214,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":214,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":237,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":237,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":240,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":240,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'sourceData' is defined but never used.","line":254,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":254,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'sourceData' is defined but never used.","line":260,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":260,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":313,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":313,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'requirement' is defined but never used.","line":313,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":313,"endColumn":60},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":316,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":316,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'fieldRequirement' is defined but never used.","line":316,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":316,"endColumn":67},{"ruleId":"no-unused-vars","severity":1,"message":"'callback' is defined but never used.","line":337,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":337,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'newData' is defined but never used.","line":363,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":363,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'oldData' is defined but never used.","line":363,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":363,"endColumn":45},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":366,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":366,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":391,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":391,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":394,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":394,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":397,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":397,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'componentId' is defined but never used.","line":400,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":400,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * é‡æ–°è®¾è®¡çš„æ•°æ®ç»‘å®šç³»ç»Ÿç±»å‹å®šä¹‰\n * ä¸“æ³¨äºè§£å†³ç»„ä»¶æ•°æ®éœ€æ±‚å£°æ˜å’Œå¤–éƒ¨æ•°æ®ç»‘å®šçš„æ ¸å¿ƒé—®é¢˜\n */\n\n// ========== ç»„ä»¶æ•°æ®éœ€æ±‚å£°æ˜ ==========\n\n/**\n * æ•°æ®å­—æ®µç±»å‹å®šä¹‰\n * æ‰©å±•æ”¯æŒæ›´å¤šç±»å‹ä»¥å…¼å®¹æ–°çš„æ•°æ®éœ€æ±‚ç³»ç»Ÿ\n */\nexport type DataFieldType = 'value' | 'object' | 'array' | 'string' | 'number' | 'boolean' | 'date'\nexport type ValueDataType = 'number' | 'string' | 'boolean' | 'date' | 'any'\n\n/**\n * æ•°æ®å­—æ®µéœ€æ±‚å®šä¹‰\n * æ‰©å±•æ¥å£ä»¥æ”¯æŒæ›´ä¸°å¯Œçš„å­—æ®µå®šä¹‰\n */\nexport interface DataFieldRequirement {\n  /** å­—æ®µåç§° */\n  name: string\n\n  /** å­—æ®µæ ‡ç­¾ */\n  label: string\n\n  /** æ•°æ®å­—æ®µç±»å‹ */\n  type: DataFieldType\n\n  /** å½“typeä¸º'value'æ—¶çš„å…·ä½“å€¼ç±»å‹ */\n  valueType?: ValueDataType\n\n  /** å½“typeä¸º'object'æˆ–'array'æ—¶çš„åµŒå¥—ç»“æ„ */\n  structure?: ComponentDataRequirement\n\n  /** æ˜¯å¦å¿…å¡« */\n  required: boolean\n\n  /** å­—æ®µæè¿° */\n  description: string\n\n  /** é»˜è®¤å€¼ */\n  defaultValue?: any\n\n  /** æ•°æ®ç¤ºä¾‹ */\n  example?: any\n\n  /** éªŒè¯è§„åˆ™ */\n  validation?: DataValidationRule\n\n  /** æšä¸¾é€‰é¡¹ï¼ˆç”¨äºä¸‹æ‹‰é€‰æ‹©ç­‰ï¼‰ */\n  enum?: Array<{ label: string; value: any; description?: string }>\n\n  /** æ•°ç»„é¡¹æ¨¡å¼ï¼ˆå½“ type ä¸º 'array' æ—¶ï¼‰ */\n  itemSchema?: any\n\n  /** å­—æ®µæ ‡ç­¾ */\n  tags?: string[]\n\n  /** å­—æ®µåˆ†ç»„ */\n  group?: string\n\n  /** æ‰©å±•å…ƒæ•°æ® */\n  metadata?: Record<string, any>\n}\n\n/**\n * æ•°æ®éªŒè¯è§„åˆ™\n */\nexport interface DataValidationRule {\n  /** æœ€å°å€¼/æœ€å°é•¿åº¦ */\n  min?: number\n  /** æœ€å¤§å€¼/æœ€å¤§é•¿åº¦ */\n  max?: number\n  /** æ­£åˆ™è¡¨è¾¾å¼éªŒè¯ */\n  pattern?: string\n  /** æšä¸¾å€¼é™åˆ¶ */\n  enum?: any[]\n  /** è‡ªå®šä¹‰éªŒè¯å‡½æ•° */\n  custom?: (value: any) => boolean | string\n}\n\n/**\n * æ•°æ®å…³ç³»ç±»å‹\n */\nexport type DataRelationType = 'independent' | 'calculated' | 'derived'\n\n/**\n * æ•°æ®å…³ç³»å®šä¹‰\n */\nexport interface DataRelationship {\n  /** å…³ç³»ç±»å‹ */\n  type: DataRelationType\n\n  /** ä¾èµ–çš„è¾“å…¥å­—æ®µ */\n  inputs: string[]\n\n  /** è®¡ç®—å‡½æ•° */\n  calculator?: (inputs: Record<string, any>) => any\n\n  /** å…³ç³»æè¿° */\n  description?: string\n\n  /** å®æ—¶è®¡ç®—ï¼ˆè¾“å…¥å˜åŒ–æ—¶ç«‹å³é‡ç®—ï¼‰ */\n  realtime?: boolean\n}\n\n/**\n * ç»„ä»¶æ•°æ®éœ€æ±‚å®Œæ•´å®šä¹‰\n * æ‰©å±•ä»¥æ”¯æŒæ›´ä¸°å¯Œçš„ç»„ä»¶å®šä¹‰\n */\nexport interface ComponentDataRequirement {\n  /** ç»„ä»¶ç±»å‹ */\n  componentType: string\n\n  /** ç»„ä»¶æ˜¾ç¤ºåç§° */\n  displayName: string\n\n  /** ç»„ä»¶æè¿° */\n  description: string\n\n  /** ç»„ä»¶åˆ†ç±» */\n  category?: string\n\n  /** éœ€æ±‚ç‰ˆæœ¬ï¼ˆç”¨äºå…¼å®¹æ€§ï¼‰ */\n  version?: string\n\n  /** ä¸»è¦æ•°æ®å­—æ®µ */\n  primaryData: DataFieldRequirement\n\n  /** æ•°æ®å­—æ®µéœ€æ±‚åˆ—è¡¨ */\n  dataFields: DataFieldRequirement[]\n\n  /** æ•°æ®å…³ç³»å®šä¹‰ */\n  relationships?: DataRelationship[]\n\n  /** æ•°æ®æ›´æ–°é…ç½® */\n  updateConfig?: {\n    supportedTriggers: string[]\n    recommendedInterval?: number\n    minInterval?: number\n    validation?: any\n  }\n\n  /** ä½¿ç”¨åœºæ™¯ */\n  useCases?: Array<{\n    name: string\n    description: string\n    exampleData: Record<string, any>\n  }>\n\n  /** ç»„ä»¶æ ‡ç­¾ */\n  tags?: string[]\n\n  /** æ‰©å±•å…ƒæ•°æ® */\n  metadata?: Record<string, any>\n\n  // ä¿æŒå‘åå…¼å®¹\n  /** @deprecated ä½¿ç”¨ dataFields æ›¿ä»£ */\n  fields?: Record<string, DataFieldRequirement>\n}\n\n// ========== æ•°æ®æºå®šä¹‰ ==========\n\n/**\n * æ•°æ®æºç±»å‹\n */\nexport type DataSourceType = 'static' | 'api' | 'websocket' | 'script' | 'database'\n\n/**\n * åŸºç¡€æ•°æ®æºæ¥å£\n */\nexport interface DataSource {\n  /** æ•°æ®æºå”¯ä¸€ID */\n  id: string\n\n  /** æ•°æ®æºç±»å‹ */\n  type: DataSourceType\n\n  /** æ•°æ®æºåç§° */\n  name: string\n\n  /** æ•°æ®æºæè¿° */\n  description?: string\n\n  /** è·å–æ•°æ® */\n  fetchData(): Promise<any>\n\n  /** éªŒè¯æ•°æ®æºé…ç½® */\n  validateConfig(): boolean\n\n  /** è·å–æ•°æ®æºé…ç½® */\n  getConfig(): any\n\n  /** æ›´æ–°æ•°æ®æºé…ç½® */\n  updateConfig(config: any): void\n}\n\n// ========== æ•°æ®å¤„ç†ç®¡é“ ==========\n\n/**\n * æ•°æ®å¤„ç†å™¨æ¥å£\n */\nexport interface DataProcessor {\n  /** å¤„ç†å™¨ID */\n  id: string\n\n  /** å¤„ç†å™¨åç§° */\n  name: string\n\n  /** å¤„ç†å™¨ç±»å‹ */\n  type: 'script' | 'format' | 'filter' | 'transform' | 'validate'\n\n  /** å¤„ç†æ•°æ® */\n  process(input: any): Promise<any>\n\n  /** å¤„ç†å™¨é…ç½® */\n  config?: any\n\n  /** éªŒè¯å¤„ç†å™¨é…ç½® */\n  validateConfig?(): boolean\n}\n\n/**\n * æ•°æ®æ˜ å°„è§„åˆ™\n */\nexport interface DataMappingRule {\n  /** æºæ•°æ®è·¯å¾„ */\n  sourcePath: string\n\n  /** ç›®æ ‡å­—æ®µå */\n  targetField: string\n\n  /** æ˜ å°„ç±»å‹ */\n  type: 'direct' | 'calculated' | 'conditional'\n\n  /** è½¬æ¢å‡½æ•°ï¼ˆå½“typeä¸º'calculated'æ—¶ï¼‰ */\n  transformer?: (value: any) => any\n\n  /** æ¡ä»¶åˆ¤æ–­ï¼ˆå½“typeä¸º'conditional'æ—¶ï¼‰ */\n  condition?: (value: any) => boolean\n\n  /** é»˜è®¤å€¼ */\n  defaultValue?: any\n}\n\n/**\n * æ•°æ®æ˜ å°„å™¨\n */\nexport interface DataMapper {\n  /** æ˜ å°„è§„åˆ™ */\n  rules: DataMappingRule[]\n\n  /** æ‰§è¡Œæ˜ å°„ */\n  map(sourceData: any): Record<string, any>\n\n  /** éªŒè¯æ˜ å°„è§„åˆ™ */\n  validateRules(): boolean\n\n  /** é¢„è§ˆæ˜ å°„ç»“æœ */\n  preview(sourceData: any): Record<string, any>\n}\n\n/**\n * å®Œæ•´çš„æ•°æ®è½¬æ¢ç®¡é“\n */\nexport interface DataTransformPipeline {\n  /** ç®¡é“ID */\n  id: string\n\n  /** æ•°æ®æº */\n  source: DataSource\n\n  /** å¤„ç†å™¨é“¾ */\n  processors: DataProcessor[]\n\n  /** æ•°æ®æ˜ å°„å™¨ */\n  mapper: DataMapper\n\n  /** æ•°æ®éªŒè¯å™¨ */\n  validator?: DataValidator\n\n  /** æ‰§è¡Œå®Œæ•´çš„è½¬æ¢æµç¨‹ */\n  execute(): Promise<Record<string, any>>\n\n  /** éªŒè¯ç®¡é“é…ç½® */\n  validate(): boolean\n}\n\n// ========== æ•°æ®éªŒè¯ ==========\n\n/**\n * æ•°æ®éªŒè¯ç»“æœ\n */\nexport interface DataValidationResult {\n  /** æ˜¯å¦éªŒè¯é€šè¿‡ */\n  valid: boolean\n\n  /** é”™è¯¯ä¿¡æ¯ */\n  errors: string[]\n\n  /** è­¦å‘Šä¿¡æ¯ */\n  warnings: string[]\n\n  /** éªŒè¯è¯¦æƒ… */\n  details: Record<string, any>\n}\n\n/**\n * æ•°æ®éªŒè¯å™¨\n */\nexport interface DataValidator {\n  /** éªŒè¯æ•°æ®æ˜¯å¦ç¬¦åˆç»„ä»¶éœ€æ±‚ */\n  validate(data: any, requirement: ComponentDataRequirement): DataValidationResult\n\n  /** éªŒè¯å•ä¸ªå­—æ®µ */\n  validateField(value: any, fieldRequirement: DataFieldRequirement): DataValidationResult\n}\n\n// ========== å“åº”å¼æ›´æ–°æœºåˆ¶ ==========\n\n/**\n * æ›´æ–°è§¦å‘å™¨ç±»å‹\n */\nexport type UpdateTriggerType = 'timer' | 'websocket' | 'mqtt' | 'event' | 'manual'\n\n/**\n * æ›´æ–°è§¦å‘å™¨\n */\nexport interface UpdateTrigger {\n  /** è§¦å‘å™¨ç±»å‹ */\n  type: UpdateTriggerType\n\n  /** è§¦å‘å™¨é…ç½® */\n  config: any\n\n  /** å¯åŠ¨è§¦å‘å™¨ */\n  start(callback: () => void): void\n\n  /** åœæ­¢è§¦å‘å™¨ */\n  stop(): void\n\n  /** è§¦å‘å™¨çŠ¶æ€ */\n  isActive(): boolean\n}\n\n/**\n * å“åº”å¼æ•°æ®ç»‘å®š\n */\nexport interface ReactiveDataBinding {\n  /** ç»‘å®šID */\n  id: string\n\n  /** ç»„ä»¶ID */\n  componentId: string\n\n  /** æ•°æ®è½¬æ¢ç®¡é“ */\n  pipeline: DataTransformPipeline\n\n  /** æ›´æ–°è§¦å‘å™¨ */\n  triggers: UpdateTrigger[]\n\n  /** æ•°æ®å˜åŒ–å›è°ƒ */\n  onDataChange: (newData: any, oldData?: any) => void\n\n  /** é”™è¯¯å¤„ç†å›è°ƒ */\n  onError?: (error: Error) => void\n\n  /** å¯åŠ¨æ•°æ®ç»‘å®š */\n  start(): void\n\n  /** åœæ­¢æ•°æ®ç»‘å®š */\n  stop(): void\n\n  /** æ‰‹åŠ¨è§¦å‘æ•°æ®æ›´æ–° */\n  refresh(): Promise<void>\n\n  /** è·å–å½“å‰æ•°æ® */\n  getCurrentData(): any\n\n  /** ç»‘å®šçŠ¶æ€ */\n  isActive(): boolean\n}\n\n// ========== æ•°æ®ç»‘å®šç®¡ç†å™¨ ==========\n\n/**\n * æ•°æ®ç»‘å®šç®¡ç†å™¨\n */\nexport interface DataBindingManager {\n  /** åˆ›å»ºæ•°æ®ç»‘å®š */\n  createBinding(config: DataBindingConfig): ReactiveDataBinding\n\n  /** è·å–ç»‘å®š */\n  getBinding(id: string): ReactiveDataBinding | null\n\n  /** ç§»é™¤ç»‘å®š */\n  removeBinding(id: string): void\n\n  /** è·å–ç»„ä»¶çš„æ‰€æœ‰ç»‘å®š */\n  getComponentBindings(componentId: string): ReactiveDataBinding[]\n\n  /** è·å–æ‰€æœ‰æ´»è·ƒçš„ç»‘å®š */\n  getActiveBindings(): ReactiveDataBinding[]\n\n  /** æ¸…ç†æ‰€æœ‰ç»‘å®š */\n  cleanup(): void\n}\n\n/**\n * æ•°æ®ç»‘å®šé…ç½®\n */\nexport interface DataBindingConfig {\n  /** ç»‘å®šID */\n  id: string\n\n  /** ç»„ä»¶ID */\n  componentId: string\n\n  /** ç»„ä»¶æ•°æ®éœ€æ±‚ */\n  requirement: ComponentDataRequirement\n\n  /** æ•°æ®è½¬æ¢ç®¡é“é…ç½® */\n  pipelineConfig: {\n    source: DataSourceConfig\n    processors?: DataProcessorConfig[]\n    mappingRules: DataMappingRule[]\n  }\n\n  /** æ›´æ–°è§¦å‘å™¨é…ç½® */\n  triggerConfigs: UpdateTriggerConfig[]\n\n  /** æ˜¯å¦è‡ªåŠ¨å¯åŠ¨ */\n  autoStart?: boolean\n}\n\n/**\n * æ•°æ®æºé…ç½®\n */\nexport interface DataSourceConfig {\n  type: DataSourceType\n  config: any\n}\n\n/**\n * æ•°æ®å¤„ç†å™¨é…ç½®\n */\nexport interface DataProcessorConfig {\n  type: string\n  config: any\n}\n\n/**\n * æ›´æ–°è§¦å‘å™¨é…ç½®\n */\nexport interface UpdateTriggerConfig {\n  type: UpdateTriggerType\n  config: any\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-source-center.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'callback' is defined but never used.","line":24,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":24,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":33},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":27,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":30,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'args' is defined but never used.","line":42,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":57},{"ruleId":"no-unused-vars","severity":1,"message":"'args' is defined but never used.","line":49,"column":62,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":69,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":91,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":91,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":91,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1893,1893],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":102,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":102,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":102,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":105,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":105,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":105,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":105,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2186,2186],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":123,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":123,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":131,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":140,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":140,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":140,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":140,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":143,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":143,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":143,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":143,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2898,2898],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * æ•°æ®æºä¸­å¿ƒ\n * è´Ÿè´£æ•°æ®æºçš„æ³¨å†Œã€ç®¡ç†å’ŒæœåŠ¡æä¾›\n * å®ç°é…ç½®é©±åŠ¨çš„åŠ¨æ€æ•°æ®æºé‡æ„æ–¹æ¡ˆçš„æ ¸å¿ƒç»„ä»¶\n */\n\nimport type { DataSourceInfo } from './types'\n\nexport interface DataSourceSubscription {\n  /** å–æ¶ˆè®¢é˜…çš„æ–¹æ³• */\n  unsubscribe: () => void\n  /** è®¢é˜…ID */\n  id: string\n}\n\nexport interface DataSourceService {\n  /** è·å–æ•°æ®æºä¿¡æ¯ */\n  getInfo(): DataSourceInfo\n\n  /** è·å–å½“å‰æ•°æ® */\n  getCurrentData(): Promise<any>\n\n  /** è®¢é˜…æ•°æ®å˜åŒ– */\n  subscribe(callback: (data: any) => void): DataSourceSubscription\n\n  /** éªŒè¯æ•°æ®æºé…ç½® */\n  validateConfig(config: any): { valid: boolean; errors: string[] }\n\n  /** æ›´æ–°æ•°æ®æºé…ç½® */\n  updateConfig(config: any): void\n\n  /** é”€æ¯æ•°æ®æº */\n  destroy(): void\n}\n\n/**\n * æ•°æ®æºä¸­å¿ƒç®¡ç†å™¨\n * å®ç°æ•°æ®æºçš„ç»Ÿä¸€æ³¨å†Œã€å‘ç°å’ŒæœåŠ¡æä¾›\n */\nexport class DataSourceCenter {\n  private dataSources = new Map<string, DataSourceService>()\n  private dataSourceTypes = new Map<string, new (...args: any[]) => DataSourceService>()\n\n  /**\n   * æ³¨å†Œæ•°æ®æºç±»å‹\n   * @param type æ•°æ®æºç±»å‹åç§°\n   * @param serviceClass æ•°æ®æºæœåŠ¡ç±»\n   */\n  registerDataSourceType(type: string, serviceClass: new (...args: any[]) => DataSourceService) {\n    this.dataSourceTypes.set(type, serviceClass)\n  }\n\n  /**\n   * åˆ›å»ºæ•°æ®æºå®ä¾‹\n   * @param id æ•°æ®æºID\n   * @param type æ•°æ®æºç±»å‹\n   * @param config æ•°æ®æºé…ç½®\n   */\n  createDataSource(id: string, type: string, config: any): DataSourceService | null {\n    const ServiceClass = this.dataSourceTypes.get(type)\n    if (!ServiceClass) {\n      return null\n    }\n\n    try {\n      const service = new ServiceClass(id, config)\n      this.dataSources.set(id, service)\n      return service\n    } catch (error) {\n      return null\n    }\n  }\n\n  /**\n   * è·å–æ•°æ®æºæœåŠ¡\n   * @param id æ•°æ®æºID\n   */\n  getDataSource(id: string): DataSourceService | null {\n    return this.dataSources.get(id) || null\n  }\n\n  /**\n   * ç§»é™¤æ•°æ®æº\n   * @param id æ•°æ®æºID\n   */\n  removeDataSource(id: string): void {\n    const service = this.dataSources.get(id)\n    if (service) {\n      try {\n        service.destroy()\n      } catch (error) {}\n      this.dataSources.delete(id)\n    }\n  }\n\n  /**\n   * è·å–æ‰€æœ‰æ•°æ®æºä¿¡æ¯\n   */\n  getAllDataSources(): DataSourceInfo[] {\n    const result: DataSourceInfo[] = []\n\n    for (const [id, service] of this.dataSources.entries()) {\n      try {\n        result.push(service.getInfo())\n      } catch (error) {}\n    }\n\n    return result\n  }\n\n  /**\n   * è·å–æ”¯æŒçš„æ•°æ®æºç±»å‹\n   */\n  getSupportedTypes(): string[] {\n    return Array.from(this.dataSourceTypes.keys())\n  }\n\n  /**\n   * è®¢é˜…æ•°æ®æºå˜åŒ–\n   * @param dataSourceId æ•°æ®æºID\n   * @param callback æ•°æ®å˜åŒ–å›è°ƒ\n   */\n  subscribeToDataSource(dataSourceId: string, callback: (data: any) => void): DataSourceSubscription | null {\n    const service = this.getDataSource(dataSourceId)\n    if (!service) {\n      return null\n    }\n\n    try {\n      return service.subscribe(callback)\n    } catch (error) {\n      return null\n    }\n  }\n\n  /**\n   * æ¸…ç†æ‰€æœ‰æ•°æ®æº\n   */\n  cleanup(): void {\n    for (const [id, service] of this.dataSources.entries()) {\n      try {\n        service.destroy()\n      } catch (error) {}\n    }\n\n    this.dataSources.clear()\n  }\n\n  /**\n   * éªŒè¯æ•°æ®æºé…ç½®\n   * @param type æ•°æ®æºç±»å‹\n   * @param config é…ç½®ä¿¡æ¯\n   */\n  validateDataSourceConfig(type: string, config: any): { valid: boolean; errors: string[] } {\n    const ServiceClass = this.dataSourceTypes.get(type)\n    if (!ServiceClass) {\n      return {\n        valid: false,\n        errors: [`æœªçŸ¥çš„æ•°æ®æºç±»å‹: ${type}`]\n      }\n    }\n\n    try {\n      // åˆ›å»ºä¸´æ—¶å®ä¾‹è¿›è¡ŒéªŒè¯\n      const tempService = new ServiceClass('temp', config)\n      const result = tempService.validateConfig(config)\n      tempService.destroy()\n      return result\n    } catch (error) {\n      return {\n        valid: false,\n        errors: [`æ•°æ®æºé…ç½®éªŒè¯å¤±è´¥: ${error.message}`]\n      }\n    }\n  }\n}\n\n// å¯¼å‡ºå•ä¾‹\nexport const dataSourceCenter = new DataSourceCenter()\nexport default dataSourceCenter\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-source-mapper.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'componentType' is defined but never used.","line":273,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":273,"endColumn":39},{"ruleId":"no-unused-vars","severity":1,"message":"'executorData' is defined but never used.","line":273,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":273,"endColumn":86},{"ruleId":"no-unused-vars","severity":1,"message":"'componentType' is defined but never used.","line":274,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":274,"endColumn":40},{"ruleId":"no-unused-vars","severity":1,"message":"'staticParams' is defined but never used.","line":274,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":274,"endColumn":94},{"ruleId":"no-unused-vars","severity":1,"message":"'componentType' is defined but never used.","line":276,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":276,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'mappingResult' is defined but never used.","line":277,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":277,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card2.1 æ•°æ®æºæ˜ å°„å™¨\n * æä¾›é€šç”¨çš„æ•°æ®æºæ˜ å°„å’Œè½¬æ¢æœåŠ¡ï¼Œæ¶ˆé™¤ç¡¬ç¼–ç ä¾èµ–\n */\n\nimport { ComponentRegistry } from './component-registry'\nimport type { ComponentDefinition } from './types'\n\n/**\n * æ‰§è¡Œå™¨æ•°æ®æ ¼å¼\n */\nexport interface ExecutorData {\n  [key: string]: any\n  main?: {\n    [dataSourceKey: string]: any\n  }\n}\n\n/**\n * æ•°æ®æºæ˜ å°„ç»“æœ\n */\nexport interface DataSourceMappingResult {\n  [propName: string]: any\n}\n\n/**\n * æ•°æ®æºæ˜ å°„å™¨ç±»\n * è´Ÿè´£å°†æ‰§è¡Œå™¨æ•°æ®è½¬æ¢ä¸ºç»„ä»¶æ‰€éœ€çš„ props\n */\nexport class DataSourceMapper {\n  /**\n   * æ˜ å°„ç»„ä»¶æ•°æ®æº\n   * @param componentType ç»„ä»¶ç±»å‹\n   * @param executorData æ‰§è¡Œå™¨æ•°æ®\n   * @returns æ˜ å°„åçš„ç»„ä»¶ props\n   */\n  static mapDataSources(componentType: string, executorData: ExecutorData | null | undefined): DataSourceMappingResult {\n    // è·å–ç»„ä»¶å®šä¹‰\n    const definition = ComponentRegistry.get(componentType)\n    if (!definition) {\n      return {}\n    }\n\n    // è·å–ç»„ä»¶çš„æ•°æ®æºé…ç½®\n    const dataSourceKeys = ComponentRegistry.getDataSourceKeys(componentType)\n    if (dataSourceKeys.length === 0) {\n      return {}\n    }\n\n    // å¦‚æœæ²¡æœ‰æ‰§è¡Œå™¨æ•°æ®ï¼Œè¿”å›ç©ºå€¼æ˜ å°„\n    if (!executorData) {\n      return this.createNullMapping(dataSourceKeys)\n    }\n\n    // æ‰§è¡Œæ•°æ®æºæ˜ å°„\n    const mappingResult = this.performMapping(dataSourceKeys, executorData)\n    return mappingResult\n  }\n\n  /**\n   * åˆ›å»ºç©ºå€¼æ˜ å°„\n   * @param dataSourceKeys æ•°æ®æºé”®åˆ—è¡¨\n   * @returns ç©ºå€¼æ˜ å°„å¯¹è±¡\n   */\n  private static createNullMapping(dataSourceKeys: string[]): DataSourceMappingResult {\n    const nullMapping: DataSourceMappingResult = {}\n\n    dataSourceKeys.forEach(key => {\n      nullMapping[key] = null\n    })\n    return nullMapping\n  }\n\n  /**\n   * æ‰§è¡Œæ•°æ®æºæ˜ å°„\n   * @param dataSourceKeys æ•°æ®æºé”®åˆ—è¡¨\n   * @param executorData æ‰§è¡Œå™¨æ•°æ®\n   * @returns æ˜ å°„ç»“æœ\n   */\n  private static performMapping(dataSourceKeys: string[], executorData: ExecutorData): DataSourceMappingResult {\n    const result: DataSourceMappingResult = {}\n\n    // ç­–ç•¥1: ä¼˜å…ˆä» main å­—æ®µä¸­æå–æ•°æ®\n    if (executorData.main && typeof executorData.main === 'object') {\n      dataSourceKeys.forEach(key => {\n        if (key in executorData.main!) {\n          result[key] = executorData.main![key]\n        } else {\n          result[key] = null\n        }\n      })\n\n      return result\n    }\n\n    // ç­–ç•¥2: ç›´æ¥ä» executorData æ ¹çº§åˆ«æå–æ•°æ®\n    dataSourceKeys.forEach(key => {\n      if (key in executorData) {\n        result[key] = executorData[key]\n      } else {\n        result[key] = null\n      }\n    })\n\n    // ğŸ”¥ ç­–ç•¥3: å¤„ç†å¤šæ•°æ®é¡¹åˆå¹¶åœºæ™¯ï¼ˆå·²è¢«æ‰§è¡Œå™¨åˆå¹¶åçš„æ•°æ®ï¼‰\n    // ç°åœ¨æ‰§è¡Œå™¨åº”è¯¥å·²ç»å®Œæˆäº†åˆå¹¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰åˆå¹¶åçš„æ•°æ®\n    const hasAnyValidData = dataSourceKeys.some(key => key in executorData && executorData[key] !== null)\n\n    if (hasAnyValidData) {\n      return result // ä½¿ç”¨ç­–ç•¥2çš„ç»“æœ\n    }\n\n    return result\n  }\n\n  /**\n   * æ˜ å°„é™æ€å‚æ•°\n   * @param componentType ç»„ä»¶ç±»å‹\n   * @param staticParams é™æ€å‚æ•°å¯¹è±¡\n   * @returns æ˜ å°„åçš„é™æ€å‚æ•°\n   */\n  static mapStaticParams(\n    componentType: string,\n    staticParams: Record<string, any> | null | undefined\n  ): Record<string, any> {\n    // è·å–ç»„ä»¶å®šä¹‰\n    const definition = ComponentRegistry.get(componentType)\n    if (!definition) {\n      return {}\n    }\n\n    // è·å–ç»„ä»¶çš„é™æ€å‚æ•°é…ç½®\n    const staticParamKeys = ComponentRegistry.getStaticParamKeys(componentType)\n    if (staticParamKeys.length === 0) {\n      return {}\n    }\n\n    // å¦‚æœæ²¡æœ‰é™æ€å‚æ•°ï¼Œè¿”å›é»˜è®¤å€¼\n    if (!staticParams) {\n      return this.getDefaultStaticParams(definition, staticParamKeys)\n    }\n\n    // è¿‡æ»¤å’Œæ˜ å°„é™æ€å‚æ•°\n    const result: Record<string, any> = {}\n    staticParamKeys.forEach(key => {\n      if (key in staticParams) {\n        result[key] = staticParams[key]\n      } else {\n        // ä½¿ç”¨é»˜è®¤å€¼\n        const defaultValue = this.getDefaultStaticParamValue(definition, key)\n        result[key] = defaultValue\n      }\n    })\n    return result\n  }\n\n  /**\n   * è·å–é»˜è®¤é™æ€å‚æ•°\n   * @param definition ç»„ä»¶å®šä¹‰\n   * @param staticParamKeys é™æ€å‚æ•°é”®åˆ—è¡¨\n   * @returns é»˜è®¤é™æ€å‚æ•°å¯¹è±¡\n   */\n  private static getDefaultStaticParams(\n    definition: ComponentDefinition,\n    staticParamKeys: string[]\n  ): Record<string, any> {\n    const defaults: Record<string, any> = {}\n\n    staticParamKeys.forEach(key => {\n      defaults[key] = this.getDefaultStaticParamValue(definition, key)\n    })\n\n    return defaults\n  }\n\n  /**\n   * è·å–é»˜è®¤é™æ€å‚æ•°å€¼\n   * @param definition ç»„ä»¶å®šä¹‰\n   * @param key å‚æ•°é”®\n   * @returns é»˜è®¤å€¼\n   */\n  private static getDefaultStaticParamValue(definition: ComponentDefinition, key: string): any {\n    // ä»ç»„ä»¶å®šä¹‰çš„é»˜è®¤é…ç½®ä¸­è·å–\n    if (definition?.defaultConfig?.staticParams?.[key] !== undefined) {\n      return definition.defaultConfig.staticParams[key]\n    }\n\n    // ä»é™æ€å‚æ•°å®šä¹‰ä¸­è·å–é»˜è®¤å€¼\n    if (definition.staticParams?.[key]?.default !== undefined) {\n      return definition.staticParams[key].default\n    }\n\n    // æ ¹æ®ç±»å‹è¿”å›åˆé€‚çš„é»˜è®¤å€¼\n    const paramType = definition.staticParams?.[key]?.type\n    switch (paramType) {\n      case 'string':\n        return ''\n      case 'number':\n        return 0\n      case 'boolean':\n        return false\n      case 'array':\n        return []\n      case 'object':\n        return {}\n      default:\n        return null\n    }\n  }\n\n  /**\n   * éªŒè¯æ•°æ®æºæ˜ å°„ç»“æœ\n   * @param componentType ç»„ä»¶ç±»å‹\n   * @param mappingResult æ˜ å°„ç»“æœ\n   * @returns éªŒè¯ç»“æœ\n   */\n  static validateMapping(\n    componentType: string,\n    mappingResult: DataSourceMappingResult\n  ): {\n    isValid: boolean\n    missingKeys: string[]\n    extraKeys: string[]\n  } {\n    const expectedKeys = ComponentRegistry.getDataSourceKeys(componentType)\n    const actualKeys = Object.keys(mappingResult)\n\n    const missingKeys = expectedKeys.filter(key => !(key in mappingResult))\n    const extraKeys = actualKeys.filter(key => !expectedKeys.includes(key))\n\n    const isValid = missingKeys.length === 0\n    return { isValid, missingKeys, extraKeys }\n  }\n\n  /**\n   * è·å–æ˜ å°„ç»Ÿè®¡ä¿¡æ¯\n   * @param componentType ç»„ä»¶ç±»å‹\n   * @param executorData æ‰§è¡Œå™¨æ•°æ®\n   * @returns ç»Ÿè®¡ä¿¡æ¯\n   */\n  static getMappingStats(\n    componentType: string,\n    executorData: ExecutorData | null | undefined\n  ): {\n    componentType: string\n    isRegistered: boolean\n    dataSourceCount: number\n    staticParamCount: number\n    hasExecutorData: boolean\n    executorDataKeys: string[]\n  } {\n    const isRegistered = ComponentRegistry.has(componentType)\n    const dataSourceCount = ComponentRegistry.getDataSourceKeys(componentType).length\n    const staticParamCount = ComponentRegistry.getStaticParamKeys(componentType).length\n    const hasExecutorData = !!executorData\n    const executorDataKeys = executorData ? Object.keys(executorData) : []\n\n    return {\n      componentType,\n      isRegistered,\n      dataSourceCount,\n      staticParamCount,\n      hasExecutorData,\n      executorDataKeys\n    }\n  }\n}\n\n/**\n * æ•°æ®æºæ˜ å°„å™¨æ¥å£ï¼ˆç”¨äºä¾èµ–æ³¨å…¥ç­‰åœºæ™¯ï¼‰\n */\nexport interface IDataSourceMapper {\n  mapDataSources(componentType: string, executorData: ExecutorData | null | undefined): DataSourceMappingResult\n  mapStaticParams(componentType: string, staticParams: Record<string, any> | null | undefined): Record<string, any>\n  validateMapping(\n    componentType: string,\n    mappingResult: DataSourceMappingResult\n  ): {\n    isValid: boolean\n    missingKeys: string[]\n    extraKeys: string[]\n  }\n}\n\n/**\n * é»˜è®¤æ•°æ®æºæ˜ å°„å™¨å®ä¾‹\n */\nexport const dataSourceMapper: IDataSourceMapper = DataSourceMapper\n\n// å¯¼å‡ºç±»å‹\nexport type { ExecutorData, DataSourceMappingResult }\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-source\\component-schema.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":30,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ç»„ä»¶æ•°æ®éœ€æ±‚å£°æ˜ç³»ç»Ÿ\n * å®šä¹‰ç»„ä»¶å¦‚ä½•å£°æ˜å…¶æ•°æ®éœ€æ±‚\n */\n\nexport interface ComponentDataField {\n  type: 'string' | 'number' | 'boolean' | 'object' | 'array'\n  required: boolean\n  description: string\n  defaultValue?: any\n  validation?: {\n    min?: number\n    max?: number\n    pattern?: string\n    enum?: any[]\n  }\n  examples?: any[]\n}\n\nexport interface ComponentDataSchema {\n  [fieldName: string]: ComponentDataField\n}\n\nexport interface ComponentDataRequirement {\n  componentId: string\n  schema: ComponentDataSchema\n  // ç»„ä»¶è‡ªå·±å£°æ˜çš„æ•°æ®éœ€æ±‚\n  getDataRequirements(): ComponentDataSchema\n  // éªŒè¯æ•°æ®æ˜¯å¦æ»¡è¶³éœ€æ±‚\n  validateData(data: any): ComponentDataValidationResult\n}\n\nexport interface ComponentDataValidationResult {\n  isValid: boolean\n  errors: Array<{\n    field: string\n    message: string\n    type: 'missing' | 'type-mismatch' | 'validation-failed'\n  }>\n  warnings: Array<{\n    field: string\n    message: string\n  }>\n}\n\n/**\n * ç»„ä»¶æ•°æ®éœ€æ±‚ç®¡ç†å™¨\n */\nexport class ComponentSchemaManager {\n  private schemas = new Map<string, ComponentDataSchema>()\n\n  /**\n   * æ³¨å†Œç»„ä»¶æ•°æ®éœ€æ±‚\n   */\n  registerSchema(componentId: string, schema: ComponentDataSchema) {\n    this.schemas.set(componentId, schema)\n  }\n\n  /**\n   * è·å–ç»„ä»¶æ•°æ®éœ€æ±‚\n   */\n  getSchema(componentId: string): ComponentDataSchema | undefined {\n    return this.schemas.get(componentId)\n  }\n\n  /**\n   * éªŒè¯æ•°æ®æ˜¯å¦æ»¡è¶³ç»„ä»¶éœ€æ±‚\n   */\n  validateComponentData(componentId: string, data: any): ComponentDataValidationResult {\n    const schema = this.schemas.get(componentId)\n    if (!schema) {\n      return {\n        isValid: false,\n        errors: [{ field: 'schema', message: `ç»„ä»¶ ${componentId} æ²¡æœ‰æ³¨å†Œæ•°æ®éœ€æ±‚`, type: 'missing' }],\n        warnings: []\n      }\n    }\n\n    return this.validateDataAgainstSchema(data, schema)\n  }\n\n  /**\n   * æ ¹æ®schemaéªŒè¯æ•°æ®\n   */\n  private validateDataAgainstSchema(data: any, schema: ComponentDataSchema): ComponentDataValidationResult {\n    const errors: ComponentDataValidationResult['errors'] = []\n    const warnings: ComponentDataValidationResult['warnings'] = []\n\n    for (const [fieldName, fieldDef] of Object.entries(schema)) {\n      const fieldValue = data?.[fieldName]\n\n      // æ£€æŸ¥å¿…å¡«å­—æ®µ\n      if (fieldDef.required && (fieldValue === undefined || fieldValue === null)) {\n        errors.push({\n          field: fieldName,\n          message: `å¿…å¡«å­—æ®µ ${fieldName} ç¼ºå¤±`,\n          type: 'missing'\n        })\n        continue\n      }\n\n      // å¦‚æœå­—æ®µå­˜åœ¨ï¼Œæ£€æŸ¥ç±»å‹\n      if (fieldValue !== undefined && fieldValue !== null) {\n        const actualType = Array.isArray(fieldValue) ? 'array' : typeof fieldValue\n        if (actualType !== fieldDef.type) {\n          errors.push({\n            field: fieldName,\n            message: `å­—æ®µ ${fieldName} ç±»å‹é”™è¯¯ï¼ŒæœŸæœ› ${fieldDef.type}ï¼Œå®é™… ${actualType}`,\n            type: 'type-mismatch'\n          })\n        }\n\n        // éªŒè¯è§„åˆ™\n        if (fieldDef.validation) {\n          const validationError = this.validateFieldValue(fieldName, fieldValue, fieldDef.validation)\n          if (validationError) {\n            errors.push({\n              field: fieldName,\n              message: validationError,\n              type: 'validation-failed'\n            })\n          }\n        }\n      } else if (!fieldDef.required && fieldDef.defaultValue !== undefined) {\n        // éå¿…å¡«å­—æ®µæœ‰é»˜è®¤å€¼çš„æƒ…å†µ\n        warnings.push({\n          field: fieldName,\n          message: `å­—æ®µ ${fieldName} ä½¿ç”¨é»˜è®¤å€¼: ${JSON.stringify(fieldDef.defaultValue)}`\n        })\n      }\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors,\n      warnings\n    }\n  }\n\n  /**\n   * éªŒè¯å­—æ®µå€¼\n   */\n  private validateFieldValue(\n    fieldName: string,\n    value: any,\n    validation: ComponentDataField['validation']\n  ): string | null {\n    if (!validation) return null\n\n    // æ•°å€¼èŒƒå›´éªŒè¯\n    if (typeof value === 'number') {\n      if (validation.min !== undefined && value < validation.min) {\n        return `å­—æ®µ ${fieldName} å€¼ ${value} å°äºæœ€å°å€¼ ${validation.min}`\n      }\n      if (validation.max !== undefined && value > validation.max) {\n        return `å­—æ®µ ${fieldName} å€¼ ${value} å¤§äºæœ€å¤§å€¼ ${validation.max}`\n      }\n    }\n\n    // å­—ç¬¦ä¸²æ¨¡å¼éªŒè¯\n    if (typeof value === 'string' && validation.pattern) {\n      const regex = new RegExp(validation.pattern)\n      if (!regex.test(value)) {\n        return `å­—æ®µ ${fieldName} å€¼ \"${value}\" ä¸ç¬¦åˆæ¨¡å¼ ${validation.pattern}`\n      }\n    }\n\n    // æšä¸¾å€¼éªŒè¯\n    if (validation.enum && !validation.enum.includes(value)) {\n      return `å­—æ®µ ${fieldName} å€¼ \"${value}\" ä¸åœ¨å…è®¸çš„æšä¸¾å€¼ä¸­: ${validation.enum.join(', ')}`\n    }\n\n    return null\n  }\n\n  /**\n   * ä¸ºç»„ä»¶æ•°æ®å¡«å……é»˜è®¤å€¼\n   */\n  fillDefaultValues(componentId: string, data: any = {}): any {\n    const schema = this.schemas.get(componentId)\n    if (!schema) return data\n\n    const result = { ...data }\n\n    for (const [fieldName, fieldDef] of Object.entries(schema)) {\n      if (result[fieldName] === undefined && fieldDef.defaultValue !== undefined) {\n        result[fieldName] = fieldDef.defaultValue\n      }\n    }\n\n    return result\n  }\n\n  /**\n   * è·å–ç»„ä»¶æ•°æ®éœ€æ±‚çš„å¯è¯»æè¿°\n   */\n  getSchemaDescription(componentId: string): Array<{\n    field: string\n    type: string\n    required: boolean\n    description: string\n    defaultValue?: any\n  }> {\n    const schema = this.schemas.get(componentId)\n    if (!schema) return []\n\n    return Object.entries(schema).map(([fieldName, fieldDef]) => ({\n      field: fieldName,\n      type: fieldDef.type,\n      required: fieldDef.required,\n      description: fieldDef.description,\n      defaultValue: fieldDef.defaultValue\n    }))\n  }\n\n  /**\n   * è·å–æ‰€æœ‰å·²æ³¨å†Œçš„ç»„ä»¶åˆ—è¡¨\n   */\n  getRegisteredComponents(): string[] {\n    return Array.from(this.schemas.keys())\n  }\n}\n\n// å¯¼å‡ºå•ä¾‹\nexport const componentSchemaManager = new ComponentSchemaManager()\nexport default componentSchemaManager\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-source\\data-binding-manager.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":19,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":42,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":61},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":112,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":112,"endColumn":52},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":129,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":129,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":207,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":207,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'validation' is assigned a value but never used.","line":244,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":244,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validation' is assigned a value but never used.","line":244,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":244,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":251,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":251,"endColumn":25},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":251,"column":27,"nodeType":"BlockStatement","messageId":"unexpected","endLine":251,"endColumn":29,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6226,6226],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":254,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":254,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":254,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":254,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6268,6268],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * æ•°æ®ç»‘å®šç®¡ç†å™¨\n * è´Ÿè´£å°†æ•°æ®æºä¸ç»„ä»¶è¿›è¡Œç»‘å®šå’ŒåŒæ­¥\n */\n\nimport type { StaticDataSource } from './static-data-source'\nimport type { DeviceApiDataSource } from './device-api-data-source'\nimport { componentSchemaManager } from './component-schema'\n\ntype DataSource = StaticDataSource | DeviceApiDataSource\n\nexport interface ComponentDataBinding {\n  componentId: string\n  componentInstanceId?: string // åŒä¸€ç»„ä»¶å¯èƒ½æœ‰å¤šä¸ªå®ä¾‹\n  dataSourceId: string\n  bindingConfig: {\n    [componentField: string]: {\n      dataPath: string\n      transform?: (value: any) => any // å¯é€‰çš„æ•°æ®è½¬æ¢å‡½æ•°\n      fallbackValue?: any\n    }\n  }\n}\n\nexport interface DataBindingStatus {\n  [fieldName: string]: {\n    isBound: boolean\n    isValid: boolean\n    currentValue: any\n    lastUpdated?: Date\n    error?: string\n  }\n}\n\n/**\n * æ•°æ®ç»‘å®šç®¡ç†å™¨\n */\nexport class DataBindingManager {\n  private dataSources = new Map<string, DataSource>()\n  private bindings = new Map<string, ComponentDataBinding>()\n  private bindingStatuses = new Map<string, DataBindingStatus>()\n  private updateCallbacks = new Map<string, Array<(data: any) => void>>()\n\n  /**\n   * æ³¨å†Œæ•°æ®æº\n   */\n  registerDataSource(dataSource: DataSource) {\n    this.dataSources.set(dataSource.getId(), dataSource)\n  }\n\n  /**\n   * ç§»é™¤æ•°æ®æº\n   */\n  removeDataSource(dataSourceId: string) {\n    this.dataSources.delete(dataSourceId)\n\n    // æ¸…ç†ç›¸å…³ç»‘å®š\n    const bindingsToRemove: string[] = []\n    for (const [bindingId, binding] of this.bindings.entries()) {\n      if (binding.dataSourceId === dataSourceId) {\n        bindingsToRemove.push(bindingId)\n      }\n    }\n\n    bindingsToRemove.forEach(bindingId => {\n      this.removeBinding(bindingId)\n    })\n  }\n\n  /**\n   * åˆ›å»ºç»„ä»¶æ•°æ®ç»‘å®š\n   */\n  createBinding(binding: ComponentDataBinding): string {\n    const bindingId = `${binding.componentId}-${binding.componentInstanceId || 'default'}`\n\n    this.bindings.set(bindingId, binding)\n    this.bindingStatuses.set(bindingId, {})\n\n    // ç«‹å³æ›´æ–°ç»‘å®šçŠ¶æ€\n    this.updateBinding(bindingId)\n\n    return bindingId\n  }\n\n  /**\n   * ç§»é™¤ç»‘å®š\n   */\n  removeBinding(bindingId: string) {\n    this.bindings.delete(bindingId)\n    this.bindingStatuses.delete(bindingId)\n    this.updateCallbacks.delete(bindingId)\n  }\n\n  /**\n   * æ›´æ–°ç»‘å®šé…ç½®\n   */\n  updateBindingConfig(bindingId: string, newConfig: Partial<ComponentDataBinding>) {\n    const existingBinding = this.bindings.get(bindingId)\n    if (!existingBinding) {\n      return\n    }\n\n    const updatedBinding = { ...existingBinding, ...newConfig }\n    this.bindings.set(bindingId, updatedBinding)\n    // ç«‹å³æ›´æ–°ç»‘å®šçŠ¶æ€\n    this.updateBinding(bindingId)\n  }\n\n  /**\n   * è®¢é˜…æ•°æ®æ›´æ–°\n   */\n  subscribe(bindingId: string, callback: (data: any) => void) {\n    if (!this.updateCallbacks.has(bindingId)) {\n      this.updateCallbacks.set(bindingId, [])\n    }\n\n    this.updateCallbacks.get(bindingId)!.push(callback)\n\n    // ç«‹å³è§¦å‘ä¸€æ¬¡å›è°ƒ\n    const currentData = this.getCurrentData(bindingId)\n    if (currentData) {\n      callback(currentData)\n    }\n  }\n\n  /**\n   * å–æ¶ˆè®¢é˜…\n   */\n  unsubscribe(bindingId: string, callback: (data: any) => void) {\n    const callbacks = this.updateCallbacks.get(bindingId)\n    if (callbacks) {\n      const index = callbacks.indexOf(callback)\n      if (index > -1) {\n        callbacks.splice(index, 1)\n      }\n    }\n  }\n\n  /**\n   * æ‰‹åŠ¨åˆ·æ–°ç»‘å®šæ•°æ®\n   */\n  async refreshBinding(bindingId: string) {\n    await this.updateBinding(bindingId)\n  }\n\n  /**\n   * è·å–ç»‘å®šçŠ¶æ€\n   */\n  getBindingStatus(bindingId: string): DataBindingStatus | undefined {\n    return this.bindingStatuses.get(bindingId)\n  }\n\n  /**\n   * è·å–å½“å‰ç»‘å®šæ•°æ®\n   */\n  getCurrentData(bindingId: string): any {\n    const status = this.bindingStatuses.get(bindingId)\n    if (!status) return null\n\n    const data: any = {}\n    for (const [field, fieldStatus] of Object.entries(status)) {\n      if (fieldStatus.isValid) {\n        data[field] = fieldStatus.currentValue\n      }\n    }\n\n    return data\n  }\n\n  /**\n   * æ›´æ–°ç»‘å®šçŠ¶æ€ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰\n   */\n  private async updateBinding(bindingId: string) {\n    const binding = this.bindings.get(bindingId)\n    if (!binding) return\n\n    const dataSource = this.dataSources.get(binding.dataSourceId)\n    if (!dataSource) {\n      return\n    }\n\n    try {\n      // è·å–ç»„ä»¶æ•°æ®éœ€æ±‚\n      const componentSchema = componentSchemaManager.getSchema(binding.componentId)\n      if (!componentSchema) {\n        return\n      }\n\n      // ä»æ•°æ®æºè·å–åŸå§‹æ•°æ®\n      const sourceData = await dataSource.getValue()\n      const newStatus: DataBindingStatus = {}\n      const componentData: any = {}\n\n      // å¤„ç†æ¯ä¸ªç»„ä»¶å­—æ®µ\n      for (const [componentField, fieldDef] of Object.entries(componentSchema)) {\n        const bindingConfig = binding.bindingConfig[componentField]\n\n        if (bindingConfig) {\n          // æœ‰ç»‘å®šé…ç½®ï¼Œä»æ•°æ®æºæå–å€¼\n          const rawValue = sourceData[componentField]\n          let finalValue = rawValue\n\n          // åº”ç”¨æ•°æ®è½¬æ¢\n          if (bindingConfig.transform && rawValue !== undefined) {\n            try {\n              finalValue = bindingConfig.transform(rawValue)\n            } catch (error) {\n              finalValue = bindingConfig.fallbackValue ?? fieldDef.defaultValue\n            }\n          }\n\n          // å¦‚æœå€¼ä¸ºundefinedï¼Œä½¿ç”¨fallbackæˆ–é»˜è®¤å€¼\n          if (finalValue === undefined) {\n            finalValue = bindingConfig.fallbackValue ?? fieldDef.defaultValue\n          }\n\n          newStatus[componentField] = {\n            isBound: true,\n            isValid: finalValue !== undefined,\n            currentValue: finalValue,\n            lastUpdated: new Date()\n          }\n\n          componentData[componentField] = finalValue\n        } else {\n          // æ²¡æœ‰ç»‘å®šé…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼\n          const defaultValue = fieldDef.defaultValue\n\n          newStatus[componentField] = {\n            isBound: false,\n            isValid: true,\n            currentValue: defaultValue,\n            lastUpdated: new Date()\n          }\n\n          componentData[componentField] = defaultValue\n        }\n      }\n\n      // æ›´æ–°ç»‘å®šçŠ¶æ€\n      this.bindingStatuses.set(bindingId, newStatus)\n\n      // éªŒè¯æ•°æ®\n      const validation = componentSchemaManager.validateComponentData(binding.componentId, componentData)\n      // é€šçŸ¥è®¢é˜…è€…\n      const callbacks = this.updateCallbacks.get(bindingId)\n      if (callbacks) {\n        callbacks.forEach(callback => {\n          try {\n            callback(componentData)\n          } catch (error) {}\n        })\n      }\n    } catch (error) {}\n  }\n\n  /**\n   * è·å–æ‰€æœ‰ç»‘å®š\n   */\n  getAllBindings(): Array<{ id: string; binding: ComponentDataBinding; status: DataBindingStatus }> {\n    const result: Array<{ id: string; binding: ComponentDataBinding; status: DataBindingStatus }> = []\n\n    for (const [bindingId, binding] of this.bindings.entries()) {\n      const status = this.bindingStatuses.get(bindingId) || {}\n      result.push({ id: bindingId, binding, status })\n    }\n\n    return result\n  }\n\n  /**\n   * è·å–æ•°æ®æºåˆ—è¡¨\n   */\n  getDataSourceList(): Array<{ id: string; type: string; name?: string }> {\n    return Array.from(this.dataSources.values()).map(ds => ({\n      id: ds.getId(),\n      type: ds.getType(),\n      name: ds.exportConfig().name\n    }))\n  }\n}\n\n// å¯¼å‡ºå•ä¾‹\nexport const dataBindingManager = new DataBindingManager()\nexport default dataBindingManager\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-source\\device-api-data-source.ts","messages":[{"ruleId":"no-useless-catch","severity":2,"message":"Unnecessary try/catch wrapper.","line":82,"column":5,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":101,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":116,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":238,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":238,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":305,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":305,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * è®¾å¤‡APIæ•°æ®æºå®ç°\n * æ”¯æŒtelemetryDataCurrentKeysç­‰è®¾å¤‡APIçš„è°ƒç”¨\n */\n\nimport { telemetryDataCurrentKeys } from '@/service/api/device'\n\nexport interface DeviceApiDataSourceConfig {\n  id: string\n  type: 'device-api'\n  name?: string\n  apiType: 'telemetryDataCurrentKeys' // ç›®å‰åªæ”¯æŒè¿™ä¸€ä¸ªAPI\n  parameters: {\n    device_id: string\n    keys: string\n  }\n  fieldMappings: {\n    [componentField: string]: string // æ•°æ®è·¯å¾„ï¼Œå¦‚ 'data[0].value'\n  }\n}\n\nexport interface DeviceApiResponse {\n  data: Array<{\n    value: any\n    name?: string\n    unit?: string\n    timestamp?: string\n  }>\n}\n\n/**\n * è®¾å¤‡APIæ•°æ®æºå¤„ç†å™¨\n */\nexport class DeviceApiDataSource {\n  private config: DeviceApiDataSourceConfig\n  private lastResponse: DeviceApiResponse | null = null\n  private lastFetchTime: Date | null = null\n\n  constructor(config: DeviceApiDataSourceConfig) {\n    this.config = config\n  }\n\n  /**\n   * è·å–æ•°æ®æºID\n   */\n  getId(): string {\n    return this.config.id\n  }\n\n  /**\n   * è·å–æ•°æ®æºç±»å‹\n   */\n  getType(): string {\n    return this.config.type\n  }\n\n  /**\n   * è·å–APIç±»å‹\n   */\n  getApiType(): string {\n    return this.config.apiType\n  }\n\n  /**\n   * è·å–APIå‚æ•°\n   */\n  getParameters(): any {\n    return this.config.parameters\n  }\n\n  /**\n   * è·å–å­—æ®µæ˜ å°„é…ç½®\n   */\n  getFieldMappings(): Record<string, string> {\n    return this.config.fieldMappings\n  }\n\n  /**\n   * è°ƒç”¨è®¾å¤‡APIè·å–æ•°æ®\n   */\n  async fetchData(): Promise<DeviceApiResponse> {\n    try {\n      let response: any\n\n      switch (this.config.apiType) {\n        case 'telemetryDataCurrentKeys':\n          response = await telemetryDataCurrentKeys({\n            device_id: this.config.parameters.device_id,\n            keys: this.config.parameters.keys\n          })\n          break\n        default:\n          throw new Error(`ä¸æ”¯æŒçš„APIç±»å‹: ${this.config.apiType}`)\n      }\n\n      this.lastResponse = response\n      this.lastFetchTime = new Date()\n      return response\n    } catch (error) {\n      throw error\n    }\n  }\n\n  /**\n   * æ ¹æ®æ˜ å°„é…ç½®æå–æ•°æ®\n   */\n  async getValue(): Promise<Record<string, any>> {\n    // è·å–æœ€æ–°æ•°æ®\n    const response = await this.fetchData()\n    const result: Record<string, any> = {}\n\n    for (const [componentField, dataPath] of Object.entries(this.config.fieldMappings)) {\n      try {\n        const value = this.extractValueByPath(response, dataPath)\n        result[componentField] = value\n      } catch (error) {\n        result[componentField] = undefined\n      }\n    }\n\n    return result\n  }\n\n  /**\n   * æ ¹æ®è·¯å¾„æå–å€¼ï¼ˆæ”¯æŒæ•°ç»„ç´¢å¼•ï¼‰\n   */\n  private extractValueByPath(data: any, path: string): any {\n    if (!path || path === '') {\n      return data\n    }\n\n    // è§£æè·¯å¾„ï¼Œæ”¯æŒ 'data[0].value' æ ¼å¼\n    const pathParts = this.parsePath(path)\n    let current = data\n\n    for (const part of pathParts) {\n      if (current === null || current === undefined) {\n        return undefined\n      }\n\n      if (typeof part === 'number') {\n        // æ•°ç»„ç´¢å¼•\n        if (Array.isArray(current)) {\n          current = current[part]\n        } else {\n          return undefined\n        }\n      } else {\n        // å¯¹è±¡å±æ€§\n        if (typeof current === 'object' && part in current) {\n          current = current[part]\n        } else {\n          return undefined\n        }\n      }\n    }\n\n    return current\n  }\n\n  /**\n   * è§£æè·¯å¾„å­—ç¬¦ä¸²ï¼Œæ”¯æŒæ•°ç»„ç´¢å¼•\n   */\n  private parsePath(path: string): (string | number)[] {\n    const parts: (string | number)[] = []\n    let current = ''\n    let inBrackets = false\n    let bracketContent = ''\n\n    for (let i = 0; i < path.length; i++) {\n      const char = path[i]\n\n      if (char === '[') {\n        if (current) {\n          parts.push(current)\n          current = ''\n        }\n        inBrackets = true\n        bracketContent = ''\n      } else if (char === ']') {\n        inBrackets = false\n        const index = parseInt(bracketContent, 10)\n        if (!isNaN(index)) {\n          parts.push(index)\n        }\n        bracketContent = ''\n      } else if (char === '.') {\n        if (inBrackets) {\n          bracketContent += char\n        } else {\n          if (current) {\n            parts.push(current)\n            current = ''\n          }\n        }\n      } else {\n        if (inBrackets) {\n          bracketContent += char\n        } else {\n          current += char\n        }\n      }\n    }\n\n    if (current) {\n      parts.push(current)\n    }\n\n    return parts\n  }\n\n  /**\n   * éªŒè¯æ•°æ®è·¯å¾„æ˜¯å¦æœ‰æ•ˆ\n   */\n  async validatePath(path: string): Promise<boolean> {\n    try {\n      // ä½¿ç”¨ç¼“å­˜çš„å“åº”æˆ–è·å–æ–°æ•°æ®\n      const response = this.lastResponse || (await this.fetchData())\n      const value = this.extractValueByPath(response, path)\n      return value !== undefined\n    } catch {\n      return false\n    }\n  }\n\n  /**\n   * è·å–å¯ç”¨çš„æ•°æ®è·¯å¾„\n   */\n  async getAvailablePaths(): Promise<Array<{ path: string; type: string; value: any }>> {\n    try {\n      // ä½¿ç”¨ç¼“å­˜çš„å“åº”æˆ–è·å–æ–°æ•°æ®\n      const response = this.lastResponse || (await this.fetchData())\n      const paths: Array<{ path: string; type: string; value: any }> = []\n\n      this.collectPaths(response, '', paths)\n\n      return paths\n    } catch (error) {\n      return []\n    }\n  }\n\n  /**\n   * é€’å½’æ”¶é›†æ‰€æœ‰å¯ç”¨è·¯å¾„\n   */\n  private collectPaths(obj: any, currentPath: string, paths: Array<{ path: string; type: string; value: any }>) {\n    if (obj === null || obj === undefined) {\n      return\n    }\n\n    if (Array.isArray(obj)) {\n      // æ•°ç»„ï¼šåªå¤„ç†å‰å‡ ä¸ªå…ƒç´ é¿å…è·¯å¾„è¿‡å¤š\n      const maxItems = Math.min(obj.length, 3)\n      for (let i = 0; i < maxItems; i++) {\n        const newPath = currentPath ? `${currentPath}[${i}]` : `[${i}]`\n        const item = obj[i]\n\n        paths.push({\n          path: newPath,\n          type: Array.isArray(item) ? 'array' : typeof item,\n          value: item\n        })\n\n        // å¦‚æœæ•°ç»„å…ƒç´ æ˜¯å¯¹è±¡ï¼Œç»§ç»­é€’å½’\n        if (typeof item === 'object' && item !== null && !Array.isArray(item)) {\n          this.collectPaths(item, newPath, paths)\n        }\n      }\n    } else if (typeof obj === 'object') {\n      // å¯¹è±¡\n      for (const [key, value] of Object.entries(obj)) {\n        const newPath = currentPath ? `${currentPath}.${key}` : key\n\n        paths.push({\n          path: newPath,\n          type: Array.isArray(value) ? 'array' : typeof value,\n          value: value\n        })\n\n        // å¦‚æœå€¼æ˜¯å¯¹è±¡æˆ–æ•°ç»„ï¼Œç»§ç»­é€’å½’\n        if (typeof value === 'object' && value !== null) {\n          this.collectPaths(value, newPath, paths)\n        }\n      }\n    }\n  }\n\n  /**\n   * é¢„è§ˆå­—æ®µæ˜ å°„ç»“æœ\n   */\n  async previewMapping(fieldMappings: Record<string, string>): Promise<Record<string, any>> {\n    try {\n      const response = this.lastResponse || (await this.fetchData())\n      const preview: Record<string, any> = {}\n\n      for (const [componentField, dataPath] of Object.entries(fieldMappings)) {\n        try {\n          preview[componentField] = this.extractValueByPath(response, dataPath)\n        } catch {\n          preview[componentField] = undefined\n        }\n      }\n\n      return preview\n    } catch (error) {\n      return {}\n    }\n  }\n\n  /**\n   * æ›´æ–°é…ç½®\n   */\n  updateConfig(newConfig: Partial<DeviceApiDataSourceConfig>) {\n    this.config = { ...this.config, ...newConfig }\n    // æ¸…é™¤ç¼“å­˜ï¼Œå¼ºåˆ¶é‡æ–°è·å–æ•°æ®\n    this.lastResponse = null\n    this.lastFetchTime = null\n  }\n\n  /**\n   * è·å–æœ€åè·å–æ•°æ®çš„æ—¶é—´\n   */\n  getLastFetchTime(): Date | null {\n    return this.lastFetchTime\n  }\n\n  /**\n   * å¯¼å‡ºé…ç½®\n   */\n  exportConfig(): DeviceApiDataSourceConfig {\n    return { ...this.config }\n  }\n}\n\n/**\n * è®¾å¤‡APIæ•°æ®æºå·¥å‚\n */\nexport class DeviceApiDataSourceFactory {\n  /**\n   * åˆ›å»ºè®¾å¤‡APIæ•°æ®æº\n   */\n  static create(config: DeviceApiDataSourceConfig): DeviceApiDataSource {\n    return new DeviceApiDataSource(config)\n  }\n\n  /**\n   * åˆ›å»ºtelemetryDataCurrentKeysæ•°æ®æº\n   */\n  static createTelemetryDataSource(\n    id: string,\n    deviceId: string,\n    keys: string,\n    fieldMappings: Record<string, string> = {}\n  ): DeviceApiDataSource {\n    return new DeviceApiDataSource({\n      id,\n      type: 'device-api',\n      name: `è®¾å¤‡${deviceId}é¥æµ‹æ•°æ®`,\n      apiType: 'telemetryDataCurrentKeys',\n      parameters: {\n        device_id: deviceId,\n        keys: keys\n      },\n      fieldMappings\n    })\n  }\n\n  /**\n   * åˆ›å»ºç¤ºä¾‹è®¾å¤‡APIæ•°æ®æº\n   */\n  static createSample(id: string): DeviceApiDataSource {\n    return new DeviceApiDataSource({\n      id,\n      type: 'device-api',\n      name: 'ç¤ºä¾‹è®¾å¤‡API',\n      apiType: 'telemetryDataCurrentKeys',\n      parameters: {\n        device_id: 'sample-device-001',\n        keys: 'temperature,humidity'\n      },\n      fieldMappings: {\n        value: 'data[0].value',\n        title: 'data[0].name',\n        unit: 'data[0].unit'\n      }\n    })\n  }\n}\n\nexport default DeviceApiDataSource\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-source\\reactive-data-manager.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'dataBindingManager' is defined but never used.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dataBindingManager' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":22,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":68,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":68,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * å“åº”å¼æ•°æ®ç®¡ç†å™¨\n * æ”¯æŒè½®è¯¢æ›´æ–°ã€å®æ—¶è®¢é˜…ç­‰å“åº”å¼æ•°æ®è·å–\n */\n\nimport type { StaticDataSource } from './static-data-source'\nimport type { DeviceApiDataSource } from './device-api-data-source'\nimport { dataBindingManager } from './data-binding-manager'\n\ntype DataSource = StaticDataSource | DeviceApiDataSource\n\nexport interface ReactiveDataSourceConfig {\n  dataSourceId: string\n  updateStrategy: 'static' | 'polling' | 'realtime'\n  updateInterval?: number // è½®è¯¢é—´éš”ï¼Œå•ä½ï¼šæ¯«ç§’\n  autoStart?: boolean\n}\n\nexport interface ReactiveSubscription {\n  id: string\n  dataSourceId: string\n  callback: (data: any) => void\n  config: ReactiveDataSourceConfig\n  isActive: boolean\n  lastUpdate?: Date\n  errorCount: number\n}\n\n/**\n * å“åº”å¼æ•°æ®ç®¡ç†å™¨\n */\nexport class ReactiveDataManager {\n  private subscriptions = new Map<string, ReactiveSubscription>()\n  private pollingTimers = new Map<string, NodeJS.Timeout>()\n  private dataSources = new Map<string, DataSource>()\n\n  /**\n   * æ³¨å†Œæ•°æ®æº\n   */\n  registerDataSource(dataSource: DataSource) {\n    this.dataSources.set(dataSource.getId(), dataSource)\n  }\n\n  /**\n   * ç§»é™¤æ•°æ®æº\n   */\n  removeDataSource(dataSourceId: string) {\n    // åœæ­¢ç›¸å…³è®¢é˜…\n    const subscriptionsToRemove: string[] = []\n    for (const [subId, subscription] of this.subscriptions.entries()) {\n      if (subscription.dataSourceId === dataSourceId) {\n        subscriptionsToRemove.push(subId)\n      }\n    }\n\n    subscriptionsToRemove.forEach(subId => {\n      this.unsubscribe(subId)\n    })\n\n    this.dataSources.delete(dataSourceId)\n  }\n\n  /**\n   * åˆ›å»ºå“åº”å¼è®¢é˜…\n   */\n  subscribe(\n    dataSourceId: string,\n    callback: (data: any) => void,\n    config: Omit<ReactiveDataSourceConfig, 'dataSourceId'>\n  ): string {\n    const subscriptionId = `${dataSourceId}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n\n    const subscription: ReactiveSubscription = {\n      id: subscriptionId,\n      dataSourceId,\n      callback,\n      config: { ...config, dataSourceId },\n      isActive: false,\n      errorCount: 0\n    }\n\n    this.subscriptions.set(subscriptionId, subscription)\n\n    // å¦‚æœé…ç½®ä¸ºè‡ªåŠ¨å¯åŠ¨ï¼Œç«‹å³å¼€å§‹\n    if (config.autoStart !== false) {\n      this.startSubscription(subscriptionId)\n    }\n\n    return subscriptionId\n  }\n\n  /**\n   * å–æ¶ˆè®¢é˜…\n   */\n  unsubscribe(subscriptionId: string) {\n    const subscription = this.subscriptions.get(subscriptionId)\n    if (!subscription) return\n\n    this.stopSubscription(subscriptionId)\n    this.subscriptions.delete(subscriptionId)\n  }\n\n  /**\n   * å¯åŠ¨è®¢é˜…\n   */\n  startSubscription(subscriptionId: string) {\n    const subscription = this.subscriptions.get(subscriptionId)\n    if (!subscription || subscription.isActive) return\n\n    const dataSource = this.dataSources.get(subscription.dataSourceId)\n    if (!dataSource) {\n      return\n    }\n\n    subscription.isActive = true\n\n    switch (subscription.config.updateStrategy) {\n      case 'static':\n        // é™æ€æ•°æ®ï¼šåªè·å–ä¸€æ¬¡\n        this.fetchDataOnce(subscriptionId)\n        break\n\n      case 'polling':\n        // è½®è¯¢æ›´æ–°ï¼šæŒ‰é—´éš”å®šæœŸè·å–\n        this.startPolling(subscriptionId)\n        break\n\n      case 'realtime':\n        // å®æ—¶æ›´æ–°ï¼šWebSocketç­‰ï¼ˆæš‚æœªå®ç°ï¼‰\n        this.fetchDataOnce(subscriptionId)\n        break\n\n      default:\n    }\n  }\n\n  /**\n   * åœæ­¢è®¢é˜…\n   */\n  stopSubscription(subscriptionId: string) {\n    const subscription = this.subscriptions.get(subscriptionId)\n    if (!subscription || !subscription.isActive) return\n\n    subscription.isActive = false\n\n    // æ¸…é™¤è½®è¯¢å®šæ—¶å™¨\n    const timer = this.pollingTimers.get(subscriptionId)\n    if (timer) {\n      clearInterval(timer)\n      this.pollingTimers.delete(subscriptionId)\n    }\n  }\n\n  /**\n   * è·å–å•æ¬¡æ•°æ®\n   */\n  private async fetchDataOnce(subscriptionId: string) {\n    const subscription = this.subscriptions.get(subscriptionId)\n    if (!subscription) return\n\n    const dataSource = this.dataSources.get(subscription.dataSourceId)\n    if (!dataSource) return\n\n    try {\n      const data = await dataSource.getValue()\n      subscription.lastUpdate = new Date()\n      subscription.errorCount = 0\n\n      // è§¦å‘å›è°ƒ\n      subscription.callback(data)\n    } catch (error) {\n      subscription.errorCount++\n      // å¦‚æœé”™è¯¯æ¬¡æ•°è¿‡å¤šï¼Œæš‚åœè®¢é˜…\n      if (subscription.errorCount >= 3) {\n        this.stopSubscription(subscriptionId)\n      }\n\n      // è§¦å‘å›è°ƒï¼Œä¼ é€’é”™è¯¯ä¿¡æ¯\n      subscription.callback({ error: error instanceof Error ? error.message : 'æ•°æ®è·å–å¤±è´¥' })\n    }\n  }\n\n  /**\n   * å¼€å§‹è½®è¯¢\n   */\n  private startPolling(subscriptionId: string) {\n    const subscription = this.subscriptions.get(subscriptionId)\n    if (!subscription) return\n\n    const interval = subscription.config.updateInterval || 5000 // é»˜è®¤5ç§’\n\n    // ç«‹å³è·å–ä¸€æ¬¡æ•°æ®\n    this.fetchDataOnce(subscriptionId)\n\n    // è®¾ç½®å®šæ—¶å™¨\n    const timer = setInterval(() => {\n      if (subscription.isActive) {\n        this.fetchDataOnce(subscriptionId)\n      }\n    }, interval)\n\n    this.pollingTimers.set(subscriptionId, timer)\n  }\n\n  /**\n   * æ›´æ–°è®¢é˜…é…ç½®\n   */\n  updateSubscriptionConfig(subscriptionId: string, newConfig: Partial<ReactiveDataSourceConfig>) {\n    const subscription = this.subscriptions.get(subscriptionId)\n    if (!subscription) return\n\n    const wasActive = subscription.isActive\n\n    // åœæ­¢å½“å‰è®¢é˜…\n    if (wasActive) {\n      this.stopSubscription(subscriptionId)\n    }\n\n    // æ›´æ–°é…ç½®\n    subscription.config = { ...subscription.config, ...newConfig }\n\n    // å¦‚æœä¹‹å‰æ˜¯æ´»è·ƒçš„ï¼Œé‡æ–°å¯åŠ¨\n    if (wasActive) {\n      this.startSubscription(subscriptionId)\n    }\n  }\n\n  /**\n   * æ‰‹åŠ¨åˆ·æ–°è®¢é˜…æ•°æ®\n   */\n  async refreshSubscription(subscriptionId: string) {\n    const subscription = this.subscriptions.get(subscriptionId)\n    if (!subscription) return\n\n    await this.fetchDataOnce(subscriptionId)\n  }\n\n  /**\n   * è·å–è®¢é˜…çŠ¶æ€\n   */\n  getSubscriptionStatus(subscriptionId: string): ReactiveSubscription | undefined {\n    return this.subscriptions.get(subscriptionId)\n  }\n\n  /**\n   * è·å–æ‰€æœ‰è®¢é˜…\n   */\n  getAllSubscriptions(): ReactiveSubscription[] {\n    return Array.from(this.subscriptions.values())\n  }\n\n  /**\n   * æš‚åœæ‰€æœ‰è®¢é˜…\n   */\n  pauseAll() {\n    for (const subscriptionId of this.subscriptions.keys()) {\n      this.stopSubscription(subscriptionId)\n    }\n  }\n\n  /**\n   * æ¢å¤æ‰€æœ‰è®¢é˜…\n   */\n  resumeAll() {\n    for (const subscriptionId of this.subscriptions.keys()) {\n      this.startSubscription(subscriptionId)\n    }\n  }\n\n  /**\n   * æ¸…ç†èµ„æº\n   */\n  dispose() {\n    // åœæ­¢æ‰€æœ‰è®¢é˜…\n    for (const subscriptionId of this.subscriptions.keys()) {\n      this.unsubscribe(subscriptionId)\n    }\n\n    // æ¸…ç†æ•°æ®æº\n    this.dataSources.clear()\n  }\n}\n\n// å¯¼å‡ºå•ä¾‹\nexport const reactiveDataManager = new ReactiveDataManager()\nexport default reactiveDataManager\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-source\\static-data-source.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":70,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * é™æ€æ•°æ®æºå®ç°\n * æ”¯æŒJSONæ•°æ®çš„è§£æå’Œå­—æ®µæ˜ å°„\n */\n\nimport { smartDeepClone } from '@/utils/deep-clone'\n\nexport interface StaticDataSourceConfig {\n  id: string\n  type: 'static'\n  name?: string\n  data: any\n  fieldMappings: {\n    [componentField: string]: string // æ•°æ®è·¯å¾„ï¼Œå¦‚ 'temperature' æˆ– 'sensor.value'\n  }\n}\n\nexport interface DataSourceValue {\n  [fieldName: string]: any\n}\n\n/**\n * é™æ€æ•°æ®æºå¤„ç†å™¨\n */\nexport class StaticDataSource {\n  private config: StaticDataSourceConfig\n\n  constructor(config: StaticDataSourceConfig) {\n    this.config = config\n  }\n\n  /**\n   * è·å–æ•°æ®æºID\n   */\n  getId(): string {\n    return this.config.id\n  }\n\n  /**\n   * è·å–æ•°æ®æºç±»å‹\n   */\n  getType(): string {\n    return this.config.type\n  }\n\n  /**\n   * è·å–åŸå§‹æ•°æ®\n   */\n  getRawData(): any {\n    return this.config.data\n  }\n\n  /**\n   * è·å–å­—æ®µæ˜ å°„é…ç½®\n   */\n  getFieldMappings(): Record<string, string> {\n    return this.config.fieldMappings\n  }\n\n  /**\n   * æ ¹æ®æ˜ å°„é…ç½®æå–æ•°æ®\n   */\n  async getValue(): Promise<DataSourceValue> {\n    const result: DataSourceValue = {}\n\n    for (const [componentField, dataPath] of Object.entries(this.config.fieldMappings)) {\n      try {\n        const value = this.extractValueByPath(this.config.data, dataPath)\n        result[componentField] = value\n      } catch (error) {\n        result[componentField] = undefined\n      }\n    }\n\n    return result\n  }\n\n  /**\n   * æ ¹æ®è·¯å¾„æå–å€¼ï¼ˆæ”¯æŒåµŒå¥—å¯¹è±¡ï¼‰\n   */\n  private extractValueByPath(data: any, path: string): any {\n    if (!path || path === '') {\n      return data\n    }\n\n    // ç®€å•çš„è·¯å¾„è§£æï¼šæ”¯æŒ 'field' å’Œ 'field.subfield' æ ¼å¼\n    const pathParts = path.split('.')\n    let current = data\n\n    for (const part of pathParts) {\n      if (current === null || current === undefined) {\n        return undefined\n      }\n\n      if (typeof current === 'object' && part in current) {\n        current = current[part]\n      } else {\n        return undefined\n      }\n    }\n\n    return current\n  }\n\n  /**\n   * æ›´æ–°æ•°æ®æºé…ç½®\n   */\n  updateConfig(newConfig: Partial<StaticDataSourceConfig>) {\n    this.config = { ...this.config, ...newConfig }\n  }\n\n  /**\n   * éªŒè¯æ•°æ®è·¯å¾„æ˜¯å¦æœ‰æ•ˆ\n   */\n  validatePath(path: string): boolean {\n    try {\n      const value = this.extractValueByPath(this.config.data, path)\n      return value !== undefined\n    } catch {\n      return false\n    }\n  }\n\n  /**\n   * è·å–å¯ç”¨çš„æ•°æ®è·¯å¾„\n   */\n  getAvailablePaths(): Array<{ path: string; type: string; value: any }> {\n    const paths: Array<{ path: string; type: string; value: any }> = []\n\n    this.collectPaths(this.config.data, '', paths)\n\n    return paths\n  }\n\n  /**\n   * é€’å½’æ”¶é›†æ‰€æœ‰å¯ç”¨è·¯å¾„\n   */\n  private collectPaths(obj: any, currentPath: string, paths: Array<{ path: string; type: string; value: any }>) {\n    if (obj === null || obj === undefined) {\n      return\n    }\n\n    if (typeof obj === 'object' && !Array.isArray(obj)) {\n      for (const [key, value] of Object.entries(obj)) {\n        const newPath = currentPath ? `${currentPath}.${key}` : key\n\n        // æ·»åŠ å½“å‰è·¯å¾„\n        paths.push({\n          path: newPath,\n          type: Array.isArray(value) ? 'array' : typeof value,\n          value: value\n        })\n\n        // å¦‚æœæ˜¯å¯¹è±¡ï¼Œç»§ç»­é€’å½’ï¼ˆé™åˆ¶æ·±åº¦é¿å…æ— é™é€’å½’ï¼‰\n        if (typeof value === 'object' && value !== null && !Array.isArray(value) && currentPath.split('.').length < 5) {\n          this.collectPaths(value, newPath, paths)\n        }\n      }\n    }\n  }\n\n  /**\n   * é¢„è§ˆå­—æ®µæ˜ å°„ç»“æœ\n   */\n  previewMapping(fieldMappings: Record<string, string>): Record<string, any> {\n    const preview: Record<string, any> = {}\n\n    for (const [componentField, dataPath] of Object.entries(fieldMappings)) {\n      try {\n        preview[componentField] = this.extractValueByPath(this.config.data, dataPath)\n      } catch {\n        preview[componentField] = undefined\n      }\n    }\n\n    return preview\n  }\n\n  /**\n   * å…‹éš†æ•°æ®æº\n   */\n  clone(): StaticDataSource {\n    return new StaticDataSource({\n      ...this.config,\n      data: smartDeepClone(this.config.data) // ä½¿ç”¨æ™ºèƒ½æ·±æ‹·è´\n    })\n  }\n\n  /**\n   * å¯¼å‡ºé…ç½®\n   */\n  exportConfig(): StaticDataSourceConfig {\n    return { ...this.config }\n  }\n}\n\n/**\n * é™æ€æ•°æ®æºå·¥å‚\n */\nexport class StaticDataSourceFactory {\n  /**\n   * åˆ›å»ºé™æ€æ•°æ®æº\n   */\n  static create(config: StaticDataSourceConfig): StaticDataSource {\n    return new StaticDataSource(config)\n  }\n\n  /**\n   * ä»JSONå­—ç¬¦ä¸²åˆ›å»ºæ•°æ®æº\n   */\n  static createFromJson(id: string, jsonString: string, fieldMappings: Record<string, string> = {}): StaticDataSource {\n    try {\n      const data = JSON.parse(jsonString)\n      return new StaticDataSource({\n        id,\n        type: 'static',\n        data,\n        fieldMappings\n      })\n    } catch (error) {\n      throw new Error(`æ— æ•ˆçš„JSONæ•°æ®: ${error instanceof Error ? error.message : 'è§£æé”™è¯¯'}`)\n    }\n  }\n\n  /**\n   * åˆ›å»ºç¤ºä¾‹æ•°æ®æº\n   */\n  static createSample(id: string): StaticDataSource {\n    return new StaticDataSource({\n      id,\n      type: 'static',\n      name: 'ç¤ºä¾‹æ•°æ®æº',\n      data: {\n        temperature: 25.6,\n        humidity: 68.2,\n        title: 'æ¸©åº¦ä¼ æ„Ÿå™¨',\n        unit: 'Â°C',\n        status: 'normal',\n        sensor: {\n          name: 'ä¼ æ„Ÿå™¨001',\n          location: 'æœºæˆ¿A',\n          value: 42.5\n        }\n      },\n      fieldMappings: {\n        value: 'temperature',\n        title: 'title',\n        unit: 'unit'\n      }\n    })\n  }\n}\n\nexport default StaticDataSource\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-sources\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\data-sources\\static-data-source-service.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":22,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":51},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":47,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":33},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":109,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":109,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is assigned a value but never used.","line":109,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":109,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":112,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":23},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":112,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":112,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2584,2584],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * é™æ€æ•°æ®æºæœåŠ¡å®ç°\n * æä¾›é™æ€æ•°æ®çš„æ•°æ®æºæœåŠ¡\n */\n\nimport type { DataSourceInfo } from '../types'\nimport type { DataSourceService, DataSourceSubscription } from '../data-source-center'\n\nexport interface StaticDataSourceConfig {\n  name: string\n  description?: string\n  data: any\n}\n\n/**\n * é™æ€æ•°æ®æºæœåŠ¡\n * æä¾›é™æ€æ•°æ®ï¼Œæ”¯æŒæ‰‹åŠ¨æ›´æ–°\n */\nexport class StaticDataSourceService implements DataSourceService {\n  private id: string\n  private config: StaticDataSourceConfig\n  private subscribers = new Map<string, (data: any) => void>()\n  private subscriptionCounter = 0\n\n  constructor(id: string, config: StaticDataSourceConfig) {\n    this.id = id\n    this.config = config\n  }\n\n  getInfo(): DataSourceInfo {\n    return {\n      id: this.id,\n      name: this.config.name,\n      type: 'static',\n      description: this.config.description,\n      status: 'active',\n      schema: this.config.data,\n      config: this.config,\n      lastUpdated: new Date()\n    }\n  }\n\n  async getCurrentData(): Promise<any> {\n    return Promise.resolve(this.config.data)\n  }\n\n  subscribe(callback: (data: any) => void): DataSourceSubscription {\n    const subscriptionId = `static_${this.id}_${++this.subscriptionCounter}`\n    this.subscribers.set(subscriptionId, callback)\n\n    // ç«‹å³å‘é€å½“å‰æ•°æ®\n    setTimeout(() => {\n      callback(this.config.data)\n    }, 0)\n\n    return {\n      id: subscriptionId,\n      unsubscribe: () => {\n        this.subscribers.delete(subscriptionId)\n      }\n    }\n  }\n\n  validateConfig(config: any): { valid: boolean; errors: string[] } {\n    const errors: string[] = []\n\n    if (!config) {\n      errors.push('é…ç½®ä¸èƒ½ä¸ºç©º')\n    } else {\n      if (!config.name || typeof config.name !== 'string') {\n        errors.push('name å­—æ®µå¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²')\n      }\n      if (config.data === undefined) {\n        errors.push('data å­—æ®µæ˜¯å¿…éœ€çš„')\n      }\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors\n    }\n  }\n\n  updateConfig(config: StaticDataSourceConfig): void {\n    const oldData = this.config.data\n    this.config = config\n    // å¦‚æœæ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…\n    if (JSON.stringify(oldData) !== JSON.stringify(config.data)) {\n      this.notifySubscribers(config.data)\n    }\n  }\n\n  /**\n   * æ‰‹åŠ¨æ›´æ–°æ•°æ®\n   * @param newData æ–°æ•°æ®\n   */\n  updateData(newData: any): void {\n    this.config.data = newData\n    this.notifySubscribers(newData)\n  }\n\n  destroy(): void {\n    this.subscribers.clear()\n  }\n\n  private notifySubscribers(data: any): void {\n    const subscriberCount = this.subscribers.size\n    if (subscriberCount > 0) {\n      for (const [id, callback] of this.subscribers.entries()) {\n        try {\n          callback(data)\n        } catch (error) {}\n      }\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":32,"column":23,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":32,"endColumn":54},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":35,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":35,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card2.1 æ ¸å¿ƒåŠŸèƒ½å¯¼å‡º\n */\n\nexport * from './types'\nexport * from './registry'\nexport * from './interaction-types'\nexport * from './interaction-manager'\n\n// ğŸ”¥ æ–°å¢ï¼šç»„ä»¶æ³¨å†Œè¡¨å’Œæ•°æ®æºæ˜ å°„å™¨\nexport * from './component-registry'\nexport * from './data-source-mapper'\n\n// æ•°æ®æºä¸­å¿ƒç›¸å…³å¯¼å‡º\nexport * from './data-source-center'\nexport * from './data-sources'\n\n// åˆå§‹åŒ–æ•°æ®æºç³»ç»Ÿ\nimport { initializeDataSources } from './data-sources'\n// ğŸ”¥ æ–°å¢ï¼šå¯¼å…¥ç»„ä»¶æ³¨å†Œè¡¨åˆå§‹åŒ–\nimport { ComponentRegistry } from './component-registry'\n\n// è‡ªåŠ¨åˆå§‹åŒ–æ•°æ®æº\ninitializeDataSources()\n\n// ğŸ”¥ æ–°å¢ï¼šåˆå§‹åŒ–ç»„ä»¶æ³¨å†Œè¡¨\n\n// ğŸ”¥ æ–°å¢ï¼šè°ƒè¯•æ¥å£ï¼ˆä»…åœ¨å¼€å‘ç¯å¢ƒä¸­å¯ç”¨ï¼‰\nif (typeof window !== 'undefined' && process.env.NODE_ENV === 'development') {\n  window.__CARD2_DEBUG__ = {\n    ComponentRegistry,\n    DataSourceMapper: require('./data-source-mapper').DataSourceMapper,\n    getCard2CoreStatus,\n    validateCard2Core,\n    triggerDataUpdate: (data: any) => {\n      // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ•°æ®æ›´æ–°é€»è¾‘\n    }\n  }\n}\n\n/**\n * è·å–ç³»ç»ŸçŠ¶æ€\n */\nexport function getCard2CoreStatus(): {\n  isInitialized: boolean\n  componentCount: number\n  registeredComponents: string[]\n} {\n  const stats = ComponentRegistry.getStats()\n\n  return {\n    isInitialized: stats.totalComponents > 0,\n    componentCount: stats.totalComponents,\n    registeredComponents: stats.componentTypes\n  }\n}\n\n/**\n * éªŒè¯ç³»ç»Ÿå®Œæ•´æ€§\n */\nexport function validateCard2Core(): {\n  isValid: boolean\n  errors: string[]\n  warnings: string[]\n} {\n  const errors: string[] = []\n  const warnings: string[] = []\n\n  // æ£€æŸ¥ç»„ä»¶æ³¨å†Œæƒ…å†µ\n  const stats = ComponentRegistry.getStats()\n  if (stats.totalComponents === 0) {\n    errors.push('æ²¡æœ‰æ³¨å†Œä»»ä½•ç»„ä»¶')\n  }\n\n  // æ£€æŸ¥å¿…è¦ç»„ä»¶\n  const requiredComponents = ['dual-data-display', 'triple-data-display']\n  requiredComponents.forEach(componentType => {\n    if (!ComponentRegistry.has(componentType)) {\n      errors.push(`ç¼ºå°‘å¿…è¦ç»„ä»¶: ${componentType}`)\n    }\n  })\n\n  // æ£€æŸ¥å¤šæ•°æ®æºç»„ä»¶\n  if (stats.multiDataSourceComponents === 0) {\n    warnings.push('æ²¡æœ‰å¤šæ•°æ®æºç»„ä»¶')\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors,\n    warnings\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\interaction-adapter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\interaction-compatibility-test.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'JumpConfig' is defined but never used.","line":7,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'JumpConfig' is defined but never used.","line":7,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'ModifyConfig' is defined but never used.","line":7,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ModifyConfig' is defined but never used.","line":7,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * äº¤äº’ç³»ç»Ÿå…¼å®¹æ€§æµ‹è¯•\n * éªŒè¯æ–°æ—§é…ç½®æ ¼å¼ä¹‹é—´çš„è½¬æ¢å’Œå…¼å®¹æ€§\n */\n\nimport { InteractionAdapter } from './interaction-adapter'\nimport type { JumpConfig, ModifyConfig } from './interaction-types'\n\n/**\n * å…¼å®¹æ€§æµ‹è¯•å¥—ä»¶\n */\nexport class InteractionCompatibilityTest {\n  /**\n   * æµ‹è¯•æ—§æ ¼å¼è·³è½¬é…ç½®è½¬æ¢\n   */\n  static testLegacyJumpConversion() {\n    // æµ‹è¯•å¤–éƒ¨é“¾æ¥\n    const legacyExternalJump = {\n      action: 'navigateToUrl' as const,\n      value: 'https://example.com',\n      target: '_blank'\n    }\n\n    const convertedExternal = InteractionAdapter.convertLegacyJumpToNew(legacyExternalJump)\n\n    // éªŒè¯è½¬æ¢ç»“æœ\n    const expectedExternal = {\n      action: 'jump',\n      jumpConfig: {\n        jumpType: 'external',\n        url: 'https://example.com',\n        target: '_blank'\n      },\n      value: 'https://example.com',\n      target: '_blank'\n    }\n\n    // æµ‹è¯•å†…éƒ¨è·¯å¾„\n    const legacyInternalJump = {\n      action: 'navigateToUrl' as const,\n      value: '/dashboard/overview',\n      target: '_self'\n    }\n\n    const convertedInternal = InteractionAdapter.convertLegacyJumpToNew(legacyInternalJump)\n\n    return {\n      externalSuccess: JSON.stringify(convertedExternal) === JSON.stringify(expectedExternal),\n      internalSuccess:\n        convertedInternal.jumpConfig.jumpType === 'internal' &&\n        convertedInternal.jumpConfig.internalPath === '/dashboard/overview'\n    }\n  }\n\n  /**\n   * æµ‹è¯•æ—§æ ¼å¼ä¿®æ”¹é…ç½®è½¬æ¢\n   */\n  static testLegacyModifyConversion() {\n    const legacyModify = {\n      action: 'updateComponentData' as const,\n      targetComponentId: 'test-component-123',\n      targetProperty: 'backgroundColor',\n      updateValue: '#ff0000'\n    }\n\n    const converted = InteractionAdapter.convertLegacyModifyToNew(legacyModify)\n\n    const expected = {\n      action: 'modify',\n      modifyConfig: {\n        targetComponentId: 'test-component-123',\n        targetProperty: 'backgroundColor',\n        updateValue: '#ff0000',\n        updateMode: 'replace'\n      },\n      targetComponentId: 'test-component-123',\n      targetProperty: 'backgroundColor',\n      updateValue: '#ff0000'\n    }\n\n    return {\n      success: JSON.stringify(converted) === JSON.stringify(expected)\n    }\n  }\n\n  /**\n   * æµ‹è¯•æ–°æ ¼å¼åˆ°æ—§æ ¼å¼çš„åå‘è½¬æ¢\n   */\n  static testNewToLegacyConversion() {\n    // æµ‹è¯•è·³è½¬é…ç½®åå‘è½¬æ¢\n    const newJump = {\n      action: 'jump' as const,\n      jumpConfig: {\n        jumpType: 'external' as const,\n        url: 'https://example.com',\n        target: '_blank' as const\n      }\n    }\n\n    const legacyJump = InteractionAdapter.convertNewJumpToLegacy(newJump)\n\n    // æµ‹è¯•ä¿®æ”¹é…ç½®åå‘è½¬æ¢\n    const newModify = {\n      action: 'modify' as const,\n      modifyConfig: {\n        targetComponentId: 'test-component-456',\n        targetProperty: 'title',\n        updateValue: 'æ–°æ ‡é¢˜',\n        updateMode: 'replace' as const\n      }\n    }\n\n    const legacyModify = InteractionAdapter.convertNewModifyToLegacy(newModify)\n\n    return {\n      jumpSuccess: legacyJump.action === 'navigateToUrl' && legacyJump.value === 'https://example.com',\n      modifySuccess:\n        legacyModify.action === 'updateComponentData' && legacyModify.targetComponentId === 'test-component-456'\n    }\n  }\n\n  /**\n   * æµ‹è¯•æ ¼å¼æ£€æµ‹åŠŸèƒ½\n   */\n  static testFormatDetection() {\n    const legacyResponse = { action: 'navigateToUrl', value: '/test' }\n    const newResponse = { action: 'jump', jumpConfig: { jumpType: 'internal', internalPath: '/test' } }\n\n    const legacyDetected = InteractionAdapter.detectResponseFormat(legacyResponse as any)\n    const newDetected = InteractionAdapter.detectResponseFormat(newResponse as any)\n\n    return {\n      legacyDetected: legacyDetected === 'legacy',\n      newDetected: newDetected === 'new'\n    }\n  }\n\n  /**\n   * æµ‹è¯•æ‰¹é‡äº¤äº’é…ç½®æ ‡å‡†åŒ–\n   */\n  static testBatchNormalization() {\n    const mixedInteraction = {\n      event: 'click',\n      enabled: true,\n      responses: [\n        {\n          action: 'navigateToUrl',\n          value: 'https://example.com',\n          target: '_blank'\n        },\n        {\n          action: 'updateComponentData',\n          targetComponentId: 'test-123',\n          targetProperty: 'title',\n          updateValue: 'æµ‹è¯•æ ‡é¢˜'\n        }\n      ]\n    }\n\n    const normalizedToNew = InteractionAdapter.normalizeInteractionResponses(mixedInteraction, 'new')\n    const normalizedToLegacy = InteractionAdapter.normalizeInteractionResponses(mixedInteraction, 'legacy')\n    return {\n      newFormatValid: normalizedToNew.responses.every((r: any) => r.action === 'jump' || r.action === 'modify'),\n      legacyFormatValid: normalizedToLegacy.responses.every(\n        (r: any) => r.action === 'navigateToUrl' || r.action === 'updateComponentData'\n      )\n    }\n  }\n\n  /**\n   * è¿è¡Œå®Œæ•´çš„å…¼å®¹æ€§æµ‹è¯•å¥—ä»¶\n   */\n  static runFullCompatibilityTest() {\n    const results = {\n      legacyJumpConversion: this.testLegacyJumpConversion(),\n      legacyModifyConversion: this.testLegacyModifyConversion(),\n      newToLegacyConversion: this.testNewToLegacyConversion(),\n      formatDetection: this.testFormatDetection(),\n      batchNormalization: this.testBatchNormalization()\n    }\n\n    // è®¡ç®—æ€»ä½“æˆåŠŸç‡\n    const allTests = Object.values(results).flatMap(result => Object.values(result))\n    const successCount = allTests.filter(Boolean).length\n    const totalCount = allTests.length\n    const successRate = (successCount / totalCount) * 100\n    return {\n      success: successRate === 100,\n      successRate,\n      details: results\n    }\n  }\n}\n\n/**\n * å¯¼å‡ºæµ‹è¯•å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨\n */\nexport function runInteractionCompatibilityTest() {\n  return InteractionCompatibilityTest.runFullCompatibilityTest()\n}\n\nexport default InteractionCompatibilityTest\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\interaction-manager.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ComparisonOperator' is defined but never used.","line":13,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComparisonOperator' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'NavigationConfig' is defined but never used.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NavigationConfig' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'DataUpdateConfig' is defined but never used.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DataUpdateConfig' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'CrossComponentResponse' is defined but never used.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CrossComponentResponse' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'propertyBindingLogger' is defined but never used.","line":23,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'propertyBindingLogger' is defined but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":31},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":28,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":58},{"ruleId":"no-unused-vars","severity":1,"message":"'configs' is defined but never used.","line":46,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":72},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'configs' is defined but never used.","line":46,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":51},{"ruleId":"no-unused-vars","severity":1,"message":"'normalizedResponse' is assigned a value but never used.","line":119,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":119,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'normalizedResponse' is assigned a value but never used.","line":119,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":119,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'actionType' is assigned a value but never used.","line":120,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionType' is assigned a value but never used.","line":120,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":120,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":397,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":397,"endColumn":61},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":407,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":407,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":423,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":423,"endColumn":23},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":423,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":423,"endColumn":27,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11955,11955],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":531,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":531,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fallbackError' is defined but never used.","line":535,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":535,"endColumn":29},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":535,"column":31,"nodeType":"BlockStatement","messageId":"unexpected","endLine":535,"endColumn":33,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[14684,14684],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":568,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":568,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fallbackError' is defined but never used.","line":572,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":572,"endColumn":29},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":572,"column":31,"nodeType":"BlockStatement","messageId":"unexpected","endLine":572,"endColumn":33,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[15563,15563],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":700,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":700,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":700,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":700,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[19154,19154],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":724,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":724,"endColumn":72},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":828,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":828,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":854,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":854,"endColumn":25},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":854,"column":27,"nodeType":"BlockStatement","messageId":"unexpected","endLine":854,"endColumn":29,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[23452,23452],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":892,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":892,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":892,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":892,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[24450,24450],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'newValue' is defined but never used.","line":1057,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":1057,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'newValue' is defined but never used.","line":1057,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":1057,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'oldValue' is defined but never used.","line":1058,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":1058,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'oldValue' is defined but never used.","line":1058,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":1058,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'mappingKey' is assigned a value but never used.","line":1065,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":1065,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mappingKey' is assigned a value but never used.","line":1065,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":1065,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'mappingKey' is assigned a value but never used.","line":1074,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":1074,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mappingKey' is assigned a value but never used.","line":1074,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":1074,"endColumn":31},{"ruleId":"no-unused-vars","severity":1,"message":"'result' is assigned a value but never used.","line":1085,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":1085,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result' is assigned a value but never used.","line":1085,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":1085,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":1090,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":1090,"endColumn":25},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1090,"column":27,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1090,"endColumn":29,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[29962,29962],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":1093,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1093,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1093,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1093,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[30003,30003],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'newValue' is defined but never used.","line":1119,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":1119,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'oldValue' is defined but never used.","line":1119,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":1119,"endColumn":44},{"ruleId":"no-unused-vars","severity":1,"message":"'watchKey' is assigned a value but never used.","line":1121,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":1121,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'watchKey' is assigned a value but never used.","line":1121,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":1121,"endColumn":19}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":44,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card2.1 ç»„ä»¶äº¤äº’ç®¡ç†å™¨\n * è´Ÿè´£ç®¡ç†æ‰€æœ‰ç»„ä»¶çš„äº¤äº’é…ç½®å’ŒçŠ¶æ€\n */\n\nimport type {\n  InteractionConfig,\n  InteractionResponse,\n  ComponentInteractionState,\n  InteractionEventType,\n  InteractionResponseResult,\n  ConditionConfig,\n  ComparisonOperator,\n  NavigationConfig,\n  DataUpdateConfig,\n  FlashConfig,\n  CrossComponentResponse,\n  JumpConfig,\n  ModifyConfig\n} from './interaction-types'\nimport { InteractionAdapter } from './interaction-adapter'\nimport { VisualEditorBridge } from '@/core/data-architecture/VisualEditorBridge'\nimport { propertyBindingLogger } from '@/utils/logger'\n\nclass InteractionManager {\n  private componentConfigs = new Map<string, InteractionConfig[]>()\n  private componentStates = new Map<string, ComponentInteractionState>()\n  private eventListeners = new Map<string, Set<(data: any) => void>>()\n  private visualEditorBridge = new VisualEditorBridge()\n\n  // ğŸ”¥ æ–°å¢ï¼šå­˜å‚¨éœ€è¦å“åº”å±æ€§å˜åŒ–çš„HTTPæ•°æ®æºæ˜ å°„\n  private httpDataSourceMappings = new Map<string, { componentId: string; componentType: string; config: any }>()\n\n  /**\n   * æ³¨å†Œç»„ä»¶çš„äº¤äº’é…ç½®\n   */\n  registerComponent(componentId: string, configs: InteractionConfig[]): void {\n    this.componentConfigs.set(componentId, configs)\n    // åˆå§‹åŒ–ç»„ä»¶çŠ¶æ€\n    this.componentStates.set(componentId, {})\n  }\n\n  /**\n   * ç§»é™¤ç»„ä»¶çš„äº¤äº’é…ç½®\n   */\n  unregisterComponent(componentId: string, configs: InteractionConfig[]): void {\n    this.componentConfigs.delete(componentId)\n    this.componentStates.delete(componentId)\n    this.eventListeners.delete(componentId)\n  }\n\n  /**\n   * è§¦å‘äº¤äº’äº‹ä»¶\n   */\n  triggerEvent(componentId: string, event: InteractionEventType, data?: any): InteractionResponseResult[] {\n    const configs = this.componentConfigs.get(componentId)\n    if (!configs) {\n      return [\n        {\n          success: false,\n          componentId,\n          action: 'custom' as any,\n          error: `ç»„ä»¶ ${componentId} æœªæ³¨å†Œ`\n        }\n      ]\n    }\n\n    const results: InteractionResponseResult[] = []\n    const eventConfigs = configs.filter(config => config.event === event && config.enabled !== false)\n    // æŒ‰ä¼˜å…ˆçº§æ’åº\n    eventConfigs.sort((a, b) => (b.priority || 0) - (a.priority || 0))\n\n    for (const config of eventConfigs) {\n      // ğŸ”¥ ä¿®å¤ï¼šå¯¹äº dataChange äº‹ä»¶ï¼Œéœ€è¦æ£€æŸ¥æ¡ä»¶\n      if (event === 'dataChange' && config.condition) {\n        // æ£€æŸ¥å±æ€§å˜åŒ–æ¡ä»¶\n        const shouldExecute = this.checkDataChangeCondition(config, data)\n\n        if (!shouldExecute) {\n          continue\n        }\n      }\n\n      // ğŸ”¥ é‡ç‚¹ï¼šæ£€æŸ¥æ˜¯å¦æœ‰å“åº”åŠ¨ä½œ\n      if (!config.responses || config.responses.length === 0) {\n        continue\n      }\n\n      // æ‰§è¡Œå“åº”åŠ¨ä½œ\n      for (const response of config.responses) {\n        try {\n          const result = this.executeResponse(componentId, response)\n          results.push(result)\n        } catch (error) {\n          results.push({\n            success: false,\n            componentId,\n            action: response.action,\n            error: error instanceof Error ? error.message : String(error)\n          })\n        }\n      }\n    }\n\n    // è§¦å‘äº‹ä»¶ç›‘å¬å™¨\n    this.triggerEventListeners(componentId, event, data)\n    return results\n  }\n\n  /**\n   * æ‰§è¡Œäº¤äº’å“åº”\n   */\n  private executeResponse(componentId: string, response: InteractionResponse): InteractionResponseResult {\n    const currentState = this.componentStates.get(componentId) || {}\n    let oldValue: any\n    let newValue: any\n\n    // ğŸ”¥ ä½¿ç”¨é€‚é…å™¨ç»Ÿä¸€å¤„ç†æ–°æ—§æ ¼å¼\n    const normalizedResponse = InteractionAdapter.normalizeToNewFormat(response as any)\n    const actionType = InteractionAdapter.getUnifiedActionType(response as any)\n\n    switch (response.action) {\n      case 'changeBackgroundColor':\n        oldValue = currentState.backgroundColor\n        newValue = response.value\n        this.updateComponentState(componentId, { backgroundColor: newValue })\n        break\n\n      case 'changeTextColor':\n        oldValue = currentState.textColor\n        newValue = response.value\n        this.updateComponentState(componentId, { textColor: newValue })\n        break\n\n      case 'changeBorderColor':\n        oldValue = currentState.borderColor\n        newValue = response.value\n        this.updateComponentState(componentId, { borderColor: newValue })\n        break\n\n      case 'changeSize':\n        oldValue = { width: currentState.width, height: currentState.height }\n        newValue = response.value\n        this.updateComponentState(componentId, {\n          width: newValue.width || currentState.width,\n          height: newValue.height || currentState.height\n        })\n        break\n\n      case 'changeOpacity':\n        oldValue = currentState.opacity\n        newValue = response.value\n        this.updateComponentState(componentId, { opacity: newValue })\n        break\n\n      case 'changeTransform':\n        oldValue = currentState.transform\n        newValue = response.value\n        this.updateComponentState(componentId, { transform: newValue })\n        break\n\n      case 'changeVisibility':\n        oldValue = currentState.visibility\n        newValue = response.value\n        this.updateComponentState(componentId, { visibility: newValue })\n        break\n\n      case 'changeContent':\n        oldValue = currentState.content\n        newValue = response.value\n        this.updateComponentState(componentId, { content: newValue })\n        break\n\n      // ğŸ”¥ ç§»é™¤åŠ¨ç”»åŠŸèƒ½\n\n      // ğŸ”¥ æ–°ç‰ˆæœ¬åŠ¨ä½œç±»å‹ - jump (URLè·³è½¬)\n      case 'jump':\n        oldValue = undefined\n        if (response.jumpConfig) {\n          // ä½¿ç”¨æ–°çš„ jumpConfig ç»“æ„\n          newValue = response.jumpConfig\n          this.handleJumpAction(response.jumpConfig)\n        } else {\n          // å‘åå…¼å®¹ï¼šä»æ—§å­—æ®µæå–æ•°æ®\n          const legacyUrl = response.value as string\n          const legacyTarget = response.target || '_self'\n          newValue = { jumpType: 'external', url: legacyUrl, target: legacyTarget }\n          this.handleNavigateToUrl(response)\n        }\n        break\n\n      // ğŸ”¥ æ–°ç‰ˆæœ¬åŠ¨ä½œç±»å‹ - modify (ä¿®æ”¹ç»„ä»¶å±æ€§)\n      case 'modify':\n        oldValue = currentState\n        if (response.modifyConfig) {\n          // ä½¿ç”¨æ–°çš„ modifyConfig ç»“æ„\n          newValue = response.modifyConfig\n          this.handleModifyAction(componentId, response.modifyConfig)\n        } else {\n          // å‘åå…¼å®¹ï¼šä»æ—§å­—æ®µæå–æ•°æ®\n          newValue = response.value\n          if (response.targetComponentId) {\n            this.updateTargetComponentData(response.targetComponentId, response)\n          } else {\n            this.updateComponentState(componentId, response.value)\n          }\n        }\n        break\n\n      // ğŸ”¥ ä¿ç•™æ—§ç‰ˆæœ¬åŠ¨ä½œç±»å‹ä»¥æ”¯æŒå‘åå…¼å®¹\n      case 'navigateToUrl':\n        this.handleNavigateToUrl(response)\n        oldValue = undefined\n        newValue = response.value\n        break\n\n      case 'updateComponentData':\n        oldValue = currentState\n        newValue = response.value\n        // å¯¹äºè·¨ç»„ä»¶æ•°æ®æ›´æ–°ï¼Œéœ€è¦æ‰¾åˆ°ç›®æ ‡ç»„ä»¶\n        if (response.targetComponentId) {\n          this.updateTargetComponentData(response.targetComponentId, response)\n        } else {\n          this.updateComponentState(componentId, response.value)\n        }\n        break\n\n      case 'flashColor':\n        this.handleFlashColor(componentId, response.value)\n        oldValue = currentState.backgroundColor\n        newValue = response.value\n        break\n\n      case 'conditionalStyle':\n        oldValue = currentState\n        newValue = response.value\n        this.applyConditionalStyle(componentId, response.value)\n        break\n\n      case 'callFunction':\n        this.handleCallFunction(componentId, response.value)\n        oldValue = undefined\n        newValue = response.value\n        break\n\n      case 'custom':\n        oldValue = currentState\n        newValue = response.value\n        // è‡ªå®šä¹‰åŠ¨ä½œï¼Œç›´æ¥æ›´æ–°çŠ¶æ€\n        if (typeof response.value === 'object') {\n          this.updateComponentState(componentId, response.value)\n        }\n        break\n\n      default:\n        throw new Error(`ä¸æ”¯æŒçš„äº¤äº’åŠ¨ä½œ: ${response.action}`)\n    }\n\n    return {\n      success: true,\n      componentId,\n      action: response.action,\n      oldValue,\n      newValue\n    }\n  }\n\n  /**\n   * æ›´æ–°ç»„ä»¶çŠ¶æ€\n   */\n  private updateComponentState(componentId: string, updates: Partial<ComponentInteractionState>): void {\n    const currentState = this.componentStates.get(componentId) || {}\n    const newState = { ...currentState, ...updates }\n    this.componentStates.set(componentId, newState)\n\n    // ğŸ”¥ é€šçŸ¥ç›®æ ‡ç»„ä»¶çŠ¶æ€å˜åŒ–\n    this.notifyComponentStateChange(componentId, updates, newState)\n  }\n\n  /**\n   * é€šçŸ¥ç»„ä»¶çŠ¶æ€å˜åŒ–\n   */\n  private notifyComponentStateChange(\n    componentId: string,\n    updates: Partial<ComponentInteractionState>,\n    fullState: ComponentInteractionState\n  ): void {\n    // å°è¯•é€šè¿‡DOMäº‹ä»¶é€šçŸ¥ç»„ä»¶\n    const targetElement = document.querySelector(`[data-component-id=\"${componentId}\"]`)\n\n    if (targetElement) {\n      const customEvent = new CustomEvent('componentStateUpdate', {\n        detail: {\n          componentId,\n          updates,\n          fullState\n        },\n        bubbles: true\n      })\n\n      targetElement.dispatchEvent(customEvent)\n    }\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šé€šçŸ¥ç»„ä»¶å±æ€§æ›´æ–° - æ”¯æŒ settingConfig å±æ€§ç»‘å®š\n   * ç”¨äºè·¨ç»„ä»¶å±æ€§ç»‘å®šï¼Œå°†ä¸€ä¸ªç»„ä»¶çš„å±æ€§å˜æ›´ä¼ é€’ç»™å¦ä¸€ä¸ªç»„ä»¶\n   */\n  notifyPropertyUpdate(componentId: string, propertyPath: string, newValue: any, oldValue?: any): void {\n    // ğŸ”¥ æ–°å¢ï¼šè§¦å‘HTTPæ•°æ®æºåˆ·æ–°\n    this.triggerHttpRefreshForPropertyChange(componentId, propertyPath, newValue, oldValue)\n\n    // é€šè¿‡ DOM äº‹ä»¶é€šçŸ¥ç»„ä»¶å±æ€§æ›´æ–°\n    const targetElement = document.querySelector(`[data-component-id=\"${componentId}\"]`)\n\n    if (targetElement) {\n      const propertyUpdateEvent = new CustomEvent('componentPropertyUpdate', {\n        detail: {\n          componentId,\n          propertyPath,\n          value: newValue,\n          oldValue,\n          timestamp: Date.now()\n        },\n        bubbles: true\n      })\n\n      targetElement.dispatchEvent(propertyUpdateEvent)\n    }\n    // åŒæ—¶è§¦å‘äº¤äº’ç³»ç»Ÿçš„ dataChange äº‹ä»¶\n    this.triggerEvent(componentId, 'dataChange', {\n      property: propertyPath,\n      newValue,\n      oldValue,\n      timestamp: Date.now()\n    })\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šæ‰¹é‡å±æ€§æ›´æ–°\n   * ä¸€æ¬¡æ€§æ›´æ–°ç»„ä»¶çš„å¤šä¸ªå±æ€§\n   */\n  batchPropertyUpdate(\n    componentId: string,\n    propertyUpdates: Array<{\n      propertyPath: string\n      newValue: any\n      oldValue?: any\n    }>\n  ): void {\n    const targetElement = document.querySelector(`[data-component-id=\"${componentId}\"]`)\n\n    if (targetElement) {\n      // å‘é€æ‰¹é‡æ›´æ–°äº‹ä»¶\n      const batchUpdateEvent = new CustomEvent('componentBatchPropertyUpdate', {\n        detail: {\n          componentId,\n          updates: propertyUpdates,\n          timestamp: Date.now()\n        },\n        bubbles: true\n      })\n\n      targetElement.dispatchEvent(batchUpdateEvent)\n\n      // åŒæ—¶å‘é€å•ä¸ªæ›´æ–°äº‹ä»¶ï¼ˆå‘åå…¼å®¹ï¼‰\n      propertyUpdates.forEach(update => {\n        this.notifyPropertyUpdate(componentId, update.propertyPath, update.newValue, update.oldValue)\n      })\n    }\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„äº¤äº’çŠ¶æ€\n   */\n  getComponentState(componentId: string): ComponentInteractionState | undefined {\n    return this.componentStates.get(componentId)\n  }\n\n  /**\n   * é‡ç½®ç»„ä»¶çš„äº¤äº’çŠ¶æ€\n   */\n  resetComponentState(componentId: string): void {\n    this.componentStates.set(componentId, {})\n  }\n\n  /**\n   * æ‰¹é‡æ›´æ–°ç»„ä»¶çš„äº¤äº’é…ç½®\n   */\n  updateComponentConfigs(componentId: string, configs: InteractionConfig[]): void {\n    this.componentConfigs.set(componentId, configs)\n  }\n\n  /**\n   * æ·»åŠ äº‹ä»¶ç›‘å¬å™¨\n   */\n  addEventListener(componentId: string, callback: (data: any) => void): void {\n    if (!this.eventListeners.has(componentId)) {\n      this.eventListeners.set(componentId, new Set())\n    }\n    this.eventListeners.get(componentId)!.add(callback)\n  }\n\n  /**\n   * ç§»é™¤äº‹ä»¶ç›‘å¬å™¨\n   */\n  removeEventListener(componentId: string, callback: (data: any) => void): void {\n    const listeners = this.eventListeners.get(componentId)\n    if (listeners) {\n      listeners.delete(callback)\n    }\n  }\n\n  /**\n   * è§¦å‘äº‹ä»¶ç›‘å¬å™¨\n   */\n  private triggerEventListeners(componentId: string, event: InteractionEventType, data?: any): void {\n    const listeners = this.eventListeners.get(componentId)\n    if (listeners) {\n      listeners.forEach(callback => {\n        try {\n          callback({ event, data, componentId })\n        } catch (error) {}\n      })\n    }\n  }\n\n  /**\n   * è·å–æ‰€æœ‰å·²æ³¨å†Œçš„ç»„ä»¶ID\n   */\n  getRegisteredComponents(): string[] {\n    return Array.from(this.componentConfigs.keys())\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„äº¤äº’é…ç½®\n   */\n  getComponentConfigs(componentId: string): InteractionConfig[] | undefined {\n    return this.componentConfigs.get(componentId)\n  }\n\n  /**\n   * æ£€æŸ¥ç»„ä»¶æ˜¯å¦å·²æ³¨å†Œ\n   */\n  hasComponent(componentId: string): boolean {\n    return this.componentConfigs.has(componentId)\n  }\n\n  // ===== æ–°å¢çš„åŠ¨ä½œå¤„ç†æ–¹æ³• =====\n\n  // ===== æ–°ç‰ˆæœ¬åŠ¨ä½œå¤„ç†æ–¹æ³• =====\n\n  /**\n   * å¤„ç†è·³è½¬åŠ¨ä½œ (æ–°ç‰ˆæœ¬)\n   */\n  private handleJumpAction(jumpConfig: JumpConfig): void {\n    if (jumpConfig.jumpType === 'external') {\n      // å¤–éƒ¨URLè·³è½¬\n      if (!jumpConfig.url) {\n        return\n      }\n      this.navigateToUrl(jumpConfig.url, jumpConfig.target || '_self', jumpConfig.windowFeatures)\n    } else if (jumpConfig.jumpType === 'internal') {\n      // å†…éƒ¨èœå•è·³è½¬\n      if (!jumpConfig.internalPath) {\n        return\n      }\n      this.navigateToUrl(jumpConfig.internalPath, jumpConfig.target || '_self')\n    }\n  }\n\n  /**\n   * å¤„ç†ä¿®æ”¹åŠ¨ä½œ (æ–°ç‰ˆæœ¬)\n   */\n  private handleModifyAction(sourceComponentId: string, modifyConfig: ModifyConfig): void {\n    const { targetComponentId, targetProperty, updateValue, updateMode = 'replace' } = modifyConfig\n\n    if (!this.hasComponent(targetComponentId)) {\n      return\n    }\n\n    const currentState = this.getComponentState(targetComponentId) || {}\n    let finalValue = updateValue\n\n    // æ ¹æ®æ›´æ–°æ¨¡å¼å¤„ç†å€¼\n    const currentValue = currentState[targetProperty]\n    switch (updateMode) {\n      case 'append':\n        if (currentValue !== undefined) {\n          finalValue = String(currentValue) + String(updateValue)\n        }\n        break\n      case 'prepend':\n        if (currentValue !== undefined) {\n          finalValue = String(updateValue) + String(currentValue)\n        }\n        break\n      case 'replace':\n      default:\n        // ç›´æ¥ä½¿ç”¨æ–°å€¼\n        break\n    }\n\n    // æ›´æ–°ç›®æ ‡ç»„ä»¶çŠ¶æ€\n    const updateData: Partial<ComponentInteractionState> = {\n      [targetProperty]: finalValue\n    }\n\n    this.updateComponentState(targetComponentId, updateData)\n  }\n\n  /**\n   * é€šç”¨URLå¯¼èˆªæ–¹æ³•\n   */\n  private navigateToUrl(url: string, target: string = '_self', windowFeatures?: string): void {\n    try {\n      if (target === '_self') {\n        // å½“å‰çª—å£è·³è½¬\n        window.location.href = url\n      } else if (target === '_blank') {\n        // æ–°çª—å£æ‰“å¼€ï¼Œæ”¯æŒçª—å£ç‰¹æ€§é…ç½®\n        if (windowFeatures) {\n          window.open(url, target, windowFeatures)\n        } else {\n          window.open(url, target)\n        }\n      } else {\n        // å…¶ä»–ç›®æ ‡(_parent, _topç­‰)\n        window.open(url, target)\n      }\n    } catch (error) {\n      // å¦‚æœè·³è½¬å¤±è´¥ï¼Œå°è¯•ç®€å•çš„window.open\n      try {\n        window.open(url, '_blank')\n      } catch (fallbackError) {}\n    }\n  }\n\n  // ===== æ—§ç‰ˆæœ¬åŠ¨ä½œå¤„ç†æ–¹æ³• (ä¿ç•™å…¼å®¹æ€§) =====\n\n  /**\n   * å¤„ç†URLè·³è½¬ (æ—§ç‰ˆæœ¬)\n   */\n  private handleNavigateToUrl(response: InteractionResponse): void {\n    const url = response.value as string\n    const target = (response.target as string) || '_self'\n    const windowFeatures = (response.windowFeatures as string) || ''\n\n    if (!url) {\n      return\n    }\n\n    try {\n      if (target === '_self') {\n        // å½“å‰çª—å£è·³è½¬\n        window.location.href = url\n      } else if (target === '_blank') {\n        // æ–°çª—å£æ‰“å¼€ï¼Œæ”¯æŒçª—å£ç‰¹æ€§é…ç½®\n        if (windowFeatures) {\n          window.open(url, target, windowFeatures)\n        } else {\n          window.open(url, target)\n        }\n      } else {\n        // å…¶ä»–ç›®æ ‡(_parent, _topç­‰)\n        window.open(url, target)\n      }\n    } catch (error) {\n      // å¦‚æœè·³è½¬å¤±è´¥ï¼Œå°è¯•ç®€å•çš„window.open\n      try {\n        window.open(url, '_blank')\n      } catch (fallbackError) {}\n    }\n  }\n\n  /**\n   * å¤„ç†é—ªçƒé¢œè‰²æ•ˆæœ\n   */\n  private handleFlashColor(componentId: string, config: FlashConfig | string): void {\n    let flashConfig: FlashConfig\n\n    if (typeof config === 'string') {\n      flashConfig = {\n        color: config,\n        duration: 1000,\n        times: 3\n      }\n    } else {\n      flashConfig = config\n    }\n\n    const currentState = this.getComponentState(componentId)\n    const originalColor = currentState?.backgroundColor\n\n    let currentFlash = 0\n    const interval = setInterval(\n      () => {\n        // åˆ‡æ¢é¢œè‰²\n        const isFlashOn = currentFlash % 2 === 0\n        this.updateComponentState(componentId, {\n          backgroundColor: isFlashOn ? flashConfig.color : originalColor\n        })\n\n        currentFlash++\n        if (currentFlash >= flashConfig.times * 2) {\n          clearInterval(interval)\n          // æ¢å¤åŸå§‹é¢œè‰²\n          this.updateComponentState(componentId, {\n            backgroundColor: originalColor\n          })\n        }\n      },\n      flashConfig.duration / (flashConfig.times * 2)\n    )\n  }\n\n  /**\n   * æ›´æ–°ç›®æ ‡ç»„ä»¶æ•°æ®\n   */\n  private updateTargetComponentData(targetComponentId: string, response: InteractionResponse): void {\n    if (!this.hasComponent(targetComponentId)) {\n      return\n    }\n\n    // ä½¿ç”¨æ–°çš„InteractionResponseæ ¼å¼\n    if (response.targetProperty && response.updateValue !== undefined) {\n      const currentState = this.getComponentState(targetComponentId) || {}\n      let newValue = response.updateValue\n\n      // æ ¹æ®æ›´æ–°æ¨¡å¼å¤„ç†å€¼\n      const updateMode = response.updateMode || 'replace'\n      const targetProperty = response.targetProperty\n      const currentValue = currentState[targetProperty]\n\n      switch (updateMode) {\n        case 'append':\n          if (currentValue !== undefined) {\n            newValue = String(currentValue) + String(newValue)\n          }\n          break\n        case 'prepend':\n          if (currentValue !== undefined) {\n            newValue = String(newValue) + String(currentValue)\n          }\n          break\n        case 'replace':\n        default:\n          // ç›´æ¥ä½¿ç”¨æ–°å€¼\n          break\n      }\n\n      // ğŸ”¥ å¢å¼ºï¼šç‰¹æ®Šå¤„ç†visibilityå±æ€§ç¡®ä¿æ­£ç¡®åº”ç”¨\n      const updateData: Partial<ComponentInteractionState> = {\n        [targetProperty]: newValue\n      }\n\n      // å¦‚æœæ˜¯å¯è§æ€§å±æ€§ï¼Œç¡®ä¿ç›´æ¥åº”ç”¨åˆ°CSSæ ·å¼\n      if (targetProperty === 'visibility') {\n        updateData.visibility = newValue as string\n      }\n\n      // æ›´æ–°ç›®æ ‡ç»„ä»¶çŠ¶æ€\n      this.updateComponentState(targetComponentId, updateData)\n    } else {\n      // å¦‚æœæ²¡æœ‰æŒ‡å®štargetPropertyï¼Œç›´æ¥æ›´æ–°æ•´ä¸ªçŠ¶æ€\n      this.updateComponentState(targetComponentId, response.value)\n    }\n  }\n\n  /**\n   * åº”ç”¨æ¡ä»¶æ ·å¼\n   */\n  private applyConditionalStyle(componentId: string, styleConfig: any): void {\n    if (typeof styleConfig === 'object') {\n      this.updateComponentState(componentId, styleConfig)\n    }\n  }\n\n  /**\n   * è°ƒç”¨å‡½æ•°\n   */\n  private handleCallFunction(componentId: string, functionConfig: any): void {\n    try {\n      if (typeof functionConfig === 'string') {\n        // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå°è¯•ä½œä¸ºå‡½æ•°åè°ƒç”¨\n        if (window[functionConfig] && typeof window[functionConfig] === 'function') {\n          window[functionConfig](componentId)\n        }\n      } else if (typeof functionConfig === 'function') {\n        // ç›´æ¥è°ƒç”¨å‡½æ•°\n        functionConfig(componentId)\n      } else if (functionConfig && typeof functionConfig.name === 'string') {\n        // é…ç½®å¯¹è±¡ï¼ŒåŒ…å«å‡½æ•°åå’Œå‚æ•°\n        const funcName = functionConfig.name\n        const args = functionConfig.args || []\n        if (window[funcName] && typeof window[funcName] === 'function') {\n          window[funcName](componentId, ...args)\n        }\n      }\n    } catch (error) {}\n  }\n\n  // ===== æ¡ä»¶åˆ¤æ–­æ–¹æ³• =====\n\n  /**\n   * ğŸ”¥ æ£€æŸ¥ dataChange äº‹ä»¶çš„æ¡ä»¶\n   * ä¸“é—¨å¤„ç†å±æ€§å˜åŒ–äº‹ä»¶çš„æ¡ä»¶åˆ¤æ–­\n   */\n  private checkDataChangeCondition(config: InteractionConfig, eventData: any): boolean {\n    const condition = config.condition\n    if (!condition) return true // æ²¡æœ‰æ¡ä»¶åˆ™ç›´æ¥æ‰§è¡Œ\n\n    // æ£€æŸ¥æ˜¯å¦ä¸ºæŒ‡å®šå±æ€§çš„å˜åŒ–\n    if (condition.property && eventData?.property !== condition.property) {\n      return false\n    }\n\n    // ä½¿ç”¨æ–°å€¼è¿›è¡Œæ¡ä»¶åˆ¤æ–­\n    const valueToCheck = eventData?.newValue\n\n    // æ ¹æ®æ¡ä»¶ç±»å‹è¿›è¡Œåˆ¤æ–­\n    switch (condition.operator) {\n      case 'equals':\n        const result = String(valueToCheck) === String(condition.value)\n        return result\n\n      case 'notEquals':\n        return String(valueToCheck) !== String(condition.value)\n\n      case 'greaterThan':\n        return Number(valueToCheck) > Number(condition.value)\n\n      case 'greaterThanOrEqual':\n        return Number(valueToCheck) >= Number(condition.value)\n\n      case 'lessThan':\n        return Number(valueToCheck) < Number(condition.value)\n\n      case 'lessThanOrEqual':\n        return Number(valueToCheck) <= Number(condition.value)\n\n      case 'contains':\n        return String(valueToCheck).includes(String(condition.value))\n\n      case 'startsWith':\n        return String(valueToCheck).startsWith(String(condition.value))\n\n      case 'endsWith':\n        return String(valueToCheck).endsWith(String(condition.value))\n\n      default:\n        return false\n    }\n  }\n\n  /**\n   * è¯„ä¼°æ¡ä»¶æ˜¯å¦æ»¡è¶³\n   */\n  evaluateCondition(condition: ConditionConfig, data: any): boolean {\n    if (!condition || !data) return false\n\n    switch (condition.type) {\n      case 'comparison':\n        return this.evaluateComparison(condition, data)\n      case 'range':\n        return this.evaluateRange(condition, data)\n      case 'expression':\n        return this.evaluateExpression(condition, data)\n      default:\n        return false\n    }\n  }\n\n  /**\n   * è¯„ä¼°æ¯”è¾ƒæ¡ä»¶\n   */\n  private evaluateComparison(condition: ConditionConfig, data: any): boolean {\n    const value = condition.field ? data[condition.field] : data\n    const compareValue = condition.value\n\n    switch (condition.operator) {\n      case 'equals':\n        return value == compareValue\n      case 'notEquals':\n        return value != compareValue\n      case 'greaterThan':\n        return Number(value) > Number(compareValue)\n      case 'greaterThanOrEqual':\n        return Number(value) >= Number(compareValue)\n      case 'lessThan':\n        return Number(value) < Number(compareValue)\n      case 'lessThanOrEqual':\n        return Number(value) <= Number(compareValue)\n      case 'contains':\n        return String(value).includes(String(compareValue))\n      case 'startsWith':\n        return String(value).startsWith(String(compareValue))\n      case 'endsWith':\n        return String(value).endsWith(String(compareValue))\n      default:\n        return false\n    }\n  }\n\n  /**\n   * è¯„ä¼°èŒƒå›´æ¡ä»¶\n   */\n  private evaluateRange(condition: ConditionConfig, data: any): boolean {\n    const value = condition.field ? data[condition.field] : data\n    const numValue = Number(value)\n    const min = Number(condition.minValue)\n    const max = Number(condition.maxValue)\n\n    return numValue >= min && numValue <= max\n  }\n\n  /**\n   * è¯„ä¼°è¡¨è¾¾å¼æ¡ä»¶\n   */\n  private evaluateExpression(condition: ConditionConfig, data: any): boolean {\n    if (!condition.expression) return false\n\n    try {\n      // åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„è¯„ä¼°ç¯å¢ƒ\n      const expression = condition.expression.replace(/\\bvalue\\b/g, 'data')\n      // ç®€å•çš„è¡¨è¾¾å¼è¯„ä¼°ï¼Œå®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦æ›´å®‰å…¨çš„æ–¹å¼\n      return new Function('data', `return ${expression}`)(data)\n    } catch (error) {\n      return false\n    }\n  }\n\n  /**\n   * è§¦å‘æ¡ä»¶æ£€æŸ¥å’Œæ‰§è¡Œ\n   */\n  checkAndTriggerConditional(componentId: string, data: any): void {\n    const configs = this.componentConfigs.get(componentId)\n    if (!configs) return\n\n    // è¿‡æ»¤æ¡ä»¶è§¦å‘å’Œæ•°æ®å˜åŒ–äº‹ä»¶çš„é…ç½®\n    const conditionalConfigs = configs.filter(\n      config =>\n        (config.event === 'conditional' || config.event === 'dataChange') &&\n        config.enabled !== false &&\n        config.condition\n    )\n\n    for (const config of conditionalConfigs) {\n      if (config.condition && this.evaluateCondition(config.condition, data)) {\n        // æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œå“åº”åŠ¨ä½œ\n        for (const response of config.responses) {\n          try {\n            this.executeResponse(componentId, response)\n          } catch (error) {}\n        }\n      }\n    }\n  }\n\n  /**\n   * ç›‘å¬æ•°æ®å˜åŒ–å¹¶è§¦å‘æ¡ä»¶æ£€æŸ¥\n   */\n  onDataChange(componentId: string, dataPath: string, newValue: any): void {\n    // æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®å˜åŒ–ç›‘å¬é…ç½®\n    const configs = this.componentConfigs.get(componentId)\n    if (!configs) return\n\n    const dataChangeConfigs = configs.filter(\n      config => config.event === 'dataChange' && config.dataPath === dataPath && config.enabled !== false\n    )\n\n    for (const config of dataChangeConfigs) {\n      if (config.condition) {\n        // æœ‰æ¡ä»¶çš„æ•°æ®å˜åŒ–\n        if (this.evaluateCondition(config.condition, newValue)) {\n          this.executeConfigResponses(componentId, config)\n        }\n      } else {\n        // æ— æ¡ä»¶çš„æ•°æ®å˜åŒ–\n        this.executeConfigResponses(componentId, config)\n      }\n    }\n  }\n\n  /**\n   * æ‰§è¡Œé…ç½®çš„æ‰€æœ‰å“åº”åŠ¨ä½œ\n   */\n  private executeConfigResponses(componentId: string, config: InteractionConfig): void {\n    for (const response of config.responses) {\n      try {\n        this.executeResponse(componentId, response)\n      } catch (error) {}\n    }\n  }\n\n  // ===== ğŸ”¥ æ–°å¢ï¼šå±æ€§ç»‘å®šå’Œå‚æ•°è§£ææ”¯æŒ =====\n\n  /**\n   * è§£æå±æ€§ç»‘å®šè¡¨è¾¾å¼\n   * æ”¯æŒæ ¼å¼ï¼šcomponentId.customize.title æˆ– componentId.data.value\n   */\n  resolvePropertyBinding(bindingExpression: string): any {\n    if (!bindingExpression || typeof bindingExpression !== 'string') {\n      return undefined\n    }\n\n    // è§£æç»‘å®šè¡¨è¾¾å¼æ ¼å¼ï¼šcomponentId.propertyPath\n    const parts = bindingExpression.split('.')\n    if (parts.length < 2) {\n      return undefined\n    }\n\n    const componentId = parts[0]\n    const propertyPath = parts.slice(1).join('.')\n\n    // è·å–ç»„ä»¶çŠ¶æ€\n    const componentState = this.getComponentState(componentId)\n    if (!componentState) {\n      return undefined\n    }\n\n    // è§£æåµŒå¥—å±æ€§è·¯å¾„\n    const value = this.getNestedProperty(componentState, propertyPath)\n\n    return value\n  }\n\n  /**\n   * æ‰¹é‡è§£æå±æ€§ç»‘å®š\n   * ç”¨äº HTTP å‚æ•°ä¸­åŒ…å«å¤šä¸ªç»‘å®šè¡¨è¾¾å¼çš„æƒ…å†µ\n   */\n  resolveMultipleBindings(bindingMap: Record<string, string>): Record<string, any> {\n    const resolvedValues: Record<string, any> = {}\n\n    for (const [key, bindingExpression] of Object.entries(bindingMap)) {\n      resolvedValues[key] = this.resolvePropertyBinding(bindingExpression)\n    }\n    return resolvedValues\n  }\n\n  /**\n   * å¤„ç†åŠ¨æ€å‚æ•°è§£æ\n   * ç”¨äº HttpConfigForm ä¸­çš„å‚æ•°ç»‘å®š\n   */\n  resolveDynamicParameter(parameterConfig: any): any {\n    if (!parameterConfig) return undefined\n\n    // å¦‚æœæ˜¯ç®€å•çš„å­—ç¬¦ä¸²ç»‘å®šè¡¨è¾¾å¼\n    if (typeof parameterConfig === 'string') {\n      return this.resolvePropertyBinding(parameterConfig)\n    }\n\n    // å¦‚æœæ˜¯å¤æ‚çš„å‚æ•°é…ç½®å¯¹è±¡\n    if (\n      parameterConfig.type === 'component-property-binding' &&\n      parameterConfig.componentId &&\n      parameterConfig.propertyPath\n    ) {\n      const bindingExpression = `${parameterConfig.componentId}.${parameterConfig.propertyPath}`\n      return this.resolvePropertyBinding(bindingExpression)\n    }\n\n    // å¦‚æœæ˜¯é™æ€å€¼\n    if (parameterConfig.type === 'static' || parameterConfig.value !== undefined) {\n      return parameterConfig.value\n    }\n    return undefined\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šè®¾ç½®ç»„ä»¶å±æ€§å€¼\n   * ç”¨äºä»å¤–éƒ¨ï¼ˆå¦‚ HTTP å“åº”ï¼‰æ›´æ–°ç»„ä»¶å±æ€§\n   */\n  setComponentProperty(componentId: string, propertyPath: string, newValue: any): boolean {\n    const currentState = this.getComponentState(componentId) || {}\n    const oldValue = this.getNestedProperty(currentState, propertyPath)\n\n    // æ›´æ–°ç»„ä»¶çŠ¶æ€\n    const updatedState = this.setNestedProperty(currentState, propertyPath, newValue)\n    this.componentStates.set(componentId, updatedState)\n\n    // é€šçŸ¥ç»„ä»¶å±æ€§æ›´æ–°\n    this.notifyPropertyUpdate(componentId, propertyPath, newValue, oldValue)\n\n    return true\n  }\n\n  /**\n   * è·å–åµŒå¥—å¯¹è±¡å±æ€§\n   */\n  private getNestedProperty(obj: any, path: string): any {\n    return path.split('.').reduce((current, key) => {\n      return current && typeof current === 'object' ? current[key] : undefined\n    }, obj)\n  }\n\n  /**\n   * è®¾ç½®åµŒå¥—å¯¹è±¡å±æ€§\n   */\n  private setNestedProperty(obj: any, path: string, value: any): any {\n    const result = { ...obj }\n    const keys = path.split('.')\n    let current = result\n\n    for (let i = 0; i < keys.length - 1; i++) {\n      const key = keys[i]\n      if (!(key in current) || typeof current[key] !== 'object' || current[key] === null) {\n        current[key] = {}\n      } else {\n        current[key] = { ...current[key] }\n      }\n      current = current[key]\n    }\n\n    current[keys[keys.length - 1]] = value\n    return result\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šè·å–æ‰€æœ‰ç»„ä»¶çš„å½“å‰å±æ€§çŠ¶æ€\n   * ç”¨äºè°ƒè¯•å’Œç›‘æ§\n   */\n  getAllComponentProperties(): Record<string, ComponentInteractionState> {\n    const allProperties: Record<string, ComponentInteractionState> = {}\n\n    for (const [componentId, state] of this.componentStates.entries()) {\n      allProperties[componentId] = { ...state }\n    }\n\n    return allProperties\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šæ³¨å†ŒHTTPæ•°æ®æºæ˜ å°„\n   * ç”¨äºè¿½è¸ªå“ªäº›ç»„ä»¶æœ‰HTTPæ•°æ®æºéœ€è¦å“åº”å±æ€§å˜åŒ–\n   */\n  registerHttpDataSource(componentId: string, componentType: string, config: any): void {\n    const mappingKey = `http-${componentId}`\n    this.httpDataSourceMappings.set(mappingKey, { componentId, componentType, config })\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šç§»é™¤HTTPæ•°æ®æºæ˜ å°„\n   */\n  unregisterHttpDataSource(componentId: string): void {\n    const mappingKey = `http-${componentId}`\n    this.httpDataSourceMappings.delete(mappingKey)\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šè§¦å‘HTTPæ•°æ®æºåˆ·æ–°ï¼ˆå±æ€§å˜åŒ–æ—¶ï¼‰\n   * è¿™æ˜¯è§£å†³ç»„ä»¶å±æ€§ç»‘å®šåHTTPä¸æ›´æ–°çš„æ ¸å¿ƒæ–¹æ³•\n   */\n  private async triggerHttpRefreshForPropertyChange(\n    componentId: string,\n    propertyPath: string,\n    newValue: any,\n    oldValue?: any\n  ): Promise<void> {\n    try {\n      // ğŸ”¥ å…³é”®ä¿®å¤ï¼šæŸ¥æ‰¾æ‰€æœ‰å¯èƒ½å—åˆ°è¿™ä¸ªå±æ€§å˜åŒ–å½±å“çš„HTTPæ•°æ®æº\n      const affectedDataSources: string[] = []\n\n      // 1. æ£€æŸ¥æ˜¯å¦æœ‰ç›´æ¥ä½¿ç”¨è¿™ä¸ªç»„ä»¶å±æ€§çš„HTTPé…ç½®\n      for (const [mappingKey, mapping] of this.httpDataSourceMappings.entries()) {\n        // æ£€æŸ¥HTTPé…ç½®ä¸­æ˜¯å¦åŒ…å«å¯¹è¿™ä¸ªç»„ä»¶å±æ€§çš„ç»‘å®šå¼•ç”¨\n        if (this.configContainsPropertyBinding(mapping.config, componentId, propertyPath)) {\n          affectedDataSources.push(mapping.componentId)\n        }\n      }\n\n      // 2. å¦‚æœæ²¡æœ‰å‘ç°ç›´æ¥ç»‘å®šï¼Œå°è¯•åˆ·æ–°æ‰€æœ‰HTTPæ•°æ®æºï¼ˆä½œä¸ºåå¤‡æ–¹æ¡ˆï¼‰\n      if (affectedDataSources.length === 0) {\n        for (const [mappingKey, mapping] of this.httpDataSourceMappings.entries()) {\n          affectedDataSources.push(mapping.componentId)\n        }\n      }\n\n      // 3. åˆ·æ–°æ‰€æœ‰å—å½±å“çš„HTTPæ•°æ®æº\n      for (const targetComponentId of affectedDataSources) {\n        const mapping = this.httpDataSourceMappings.get(`http-${targetComponentId}`)\n        if (mapping) {\n          try {\n            // ä½¿ç”¨VisualEditorBridgeåˆ·æ–°æ•°æ®æº\n            const result = await this.visualEditorBridge.updateComponentExecutor(\n              mapping.componentId,\n              mapping.componentType,\n              mapping.config\n            )\n          } catch (error) {}\n        }\n      }\n    } catch (error) {}\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šæ£€æŸ¥é…ç½®æ˜¯å¦åŒ…å«ç‰¹å®šçš„å±æ€§ç»‘å®š\n   * ç”¨äºåˆ¤æ–­HTTPé…ç½®æ˜¯å¦ä¾èµ–æŸä¸ªç»„ä»¶çš„å±æ€§\n   */\n  private configContainsPropertyBinding(config: any, componentId: string, propertyPath: string): boolean {\n    if (!config) return false\n\n    const bindingPath = `${componentId}.${propertyPath}`\n    const configStr = JSON.stringify(config)\n\n    // æ£€æŸ¥é…ç½®ä¸­æ˜¯å¦åŒ…å«ç»‘å®šè·¯å¾„\n    const hasBinding = configStr.includes(bindingPath)\n\n    return hasBinding\n  }\n\n  /**\n   * ğŸ”¥ æ–°å¢ï¼šç›‘å¬ç»„ä»¶å±æ€§å˜åŒ–\n   * ç”¨äºå®ç°å±æ€§ç»‘å®šçš„å“åº”å¼æ›´æ–°\n   */\n  watchComponentProperty(\n    componentId: string,\n    propertyPath: string,\n    callback: (newValue: any, oldValue: any) => void\n  ): () => void {\n    const watchKey = `${componentId}.${propertyPath}`\n\n    // åˆ›å»ºå±æ€§å˜åŒ–ç›‘å¬å™¨\n    const propertyWatcher = (data: any) => {\n      if (data.event === 'dataChange' && data.data?.property === propertyPath) {\n        callback(data.data.newValue, data.data.oldValue)\n      }\n    }\n\n    this.addEventListener(componentId, propertyWatcher)\n\n    // è¿”å›å–æ¶ˆç›‘å¬çš„å‡½æ•°\n    return () => {\n      this.removeEventListener(componentId, propertyWatcher)\n    }\n  }\n}\n\n// åˆ›å»ºå•ä¾‹å®ä¾‹\nexport const interactionManager = new InteractionManager()\n\n// å¯¼å‡ºç±»å‹\nexport type { InteractionManager }\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\interaction-types.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'componentId' is defined but never used.","line":105,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":40},{"ruleId":"no-unused-vars","severity":1,"message":"'configs' is defined but never used.","line":105,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":72},{"ruleId":"no-unused-vars","severity":1,"message":"'componentId' is defined but never used.","line":108,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":108,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'componentId' is defined but never used.","line":111,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":111,"endColumn":35},{"ruleId":"no-unused-vars","severity":1,"message":"'event' is defined but never used.","line":111,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":111,"endColumn":64},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":111,"column":66,"nodeType":"Identifier","messageId":"unusedVar","endLine":111,"endColumn":76},{"ruleId":"no-unused-vars","severity":1,"message":"'componentId' is defined but never used.","line":114,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":114,"endColumn":40},{"ruleId":"no-unused-vars","severity":1,"message":"'componentId' is defined but never used.","line":117,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":117,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'componentId' is defined but never used.","line":120,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":45},{"ruleId":"no-unused-vars","severity":1,"message":"'configs' is defined but never used.","line":120,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":77}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card2.1 ç»„ä»¶äº¤äº’ç³»ç»Ÿç±»å‹å®šä¹‰\n * å®šä¹‰ç»„ä»¶å¦‚ä½•å“åº”å¤–éƒ¨äº¤äº’çš„ç±»å‹ç³»ç»Ÿ\n */\n\n// äº¤äº’äº‹ä»¶ç±»å‹ - ç®€åŒ–ä¸º3ç§æ ¸å¿ƒäº‹ä»¶\nexport type InteractionEventType =\n  | 'click' // ç‚¹å‡»äº‹ä»¶\n  | 'hover' // æ‚¬åœäº‹ä»¶\n  | 'dataChange' // æ•°æ®å˜åŒ–äº‹ä»¶ï¼ˆå±æ€§æ”¹å˜æ—¶ï¼‰\n\n// äº¤äº’å“åº”åŠ¨ä½œç±»å‹ - ç®€åŒ–ä¸º2ç§æ ¸å¿ƒåŠ¨ä½œ\nexport type InteractionActionType =\n  | 'jump' // URLè·³è½¬ï¼ˆåŒ…å«å¤–éƒ¨URLå’Œå†…éƒ¨èœå•ï¼‰\n  | 'modify' // ä¿®æ”¹ç›®æ ‡ç»„ä»¶å±æ€§\n\n// ğŸ”¥ ä¸ºå…¼å®¹æ€§ä¿ç•™çš„æ˜ å°„ç±»å‹ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰\nexport type LegacyInteractionActionType =\n  | 'navigateToUrl' // æ˜ å°„åˆ° jump\n  | 'updateComponentData' // æ˜ å°„åˆ° modify\n\n// è·³è½¬ç±»å‹æšä¸¾\nexport type JumpType = 'external' | 'internal'\n\n// URLè·³è½¬é…ç½®\nexport interface JumpConfig {\n  jumpType: JumpType // è·³è½¬ç±»å‹ï¼šexternal(å¤–éƒ¨URL) | internal(å†…éƒ¨èœå•)\n  url?: string // å¤–éƒ¨URLåœ°å€\n  internalPath?: string // å†…éƒ¨èœå•è·¯å¾„\n  target?: '_self' | '_blank' | '_parent' | '_top' // è·³è½¬ç›®æ ‡\n  windowFeatures?: string // æ–°çª—å£ç‰¹æ€§é…ç½®\n}\n\n// å±æ€§ä¿®æ”¹é…ç½®\nexport interface ModifyConfig {\n  targetComponentId: string // ç›®æ ‡ç»„ä»¶ID\n  targetProperty: string // ç›®æ ‡å±æ€§å\n  updateValue: any // æ›´æ–°å€¼\n  updateMode?: 'replace' | 'append' | 'prepend' // æ›´æ–°æ¨¡å¼\n}\n\n// äº¤äº’å“åº”é…ç½® - ç®€åŒ–ç‰ˆ\nexport interface InteractionResponse {\n  action: InteractionActionType\n\n  // æ ¹æ®åŠ¨ä½œç±»å‹çš„å…·ä½“é…ç½®\n  jumpConfig?: JumpConfig // jumpåŠ¨ä½œçš„é…ç½®\n  modifyConfig?: ModifyConfig // modifyåŠ¨ä½œçš„é…ç½®\n\n  // é€šç”¨å±æ€§\n  delay?: number // å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\n\n  // ğŸ”¥ ä¸ºå…¼å®¹æ€§ä¿ç•™çš„æ—§å­—æ®µï¼ˆå·²åºŸå¼ƒï¼Œä»…ä¾›å†…éƒ¨æ˜ å°„ä½¿ç”¨ï¼‰\n  value?: any\n  target?: string\n  windowFeatures?: string\n  targetComponentId?: string\n  targetProperty?: string\n  updateValue?: any\n  updateMode?: 'replace' | 'append' | 'prepend'\n}\n\n// äº¤äº’è§¦å‘ç±»å‹ - åŒºåˆ†æ˜¯èŠ‚ç‚¹è§¦å‘è¿˜æ˜¯ç»„ä»¶å†…éƒ¨è§¦å‘\nexport type InteractionTriggerType =\n  | 'node' // èŠ‚ç‚¹çº§åˆ«è§¦å‘ï¼ˆæ•´ä¸ªèŠ‚ç‚¹å“åº”äº‹ä»¶ï¼‰\n  | 'component' // ç»„ä»¶å†…éƒ¨è§¦å‘ï¼ˆç»„ä»¶å†…éƒ¨å…ƒç´ å“åº”äº‹ä»¶ï¼‰\n\n// ç®€åŒ–çš„äº¤äº’é…ç½®\nexport interface InteractionConfig {\n  event: InteractionEventType\n  responses: InteractionResponse[]\n  enabled?: boolean // æ˜¯å¦å¯ç”¨æ­¤äº¤äº’\n  priority?: number // ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜\n  name?: string // äº¤äº’é…ç½®åç§°\n\n  // dataChangeäº‹ä»¶ä¸“ç”¨é…ç½®\n  watchedProperty?: string // è¢«ç›‘å¬çš„ç»„ä»¶å±æ€§åï¼ˆä»…dataChangeäº‹ä»¶ä½¿ç”¨ï¼‰\n  condition?: DataChangeCondition // æ¡ä»¶é…ç½®ï¼ˆä»…dataChangeäº‹ä»¶ä½¿ç”¨ï¼‰\n}\n\n// æ•°æ®å˜åŒ–æ¡ä»¶ - ç®€åŒ–ç‰ˆ\nexport interface DataChangeCondition {\n  property?: string // å±æ€§å\n  operator: 'equals' | 'notEquals' | 'greaterThan' | 'lessThan' | 'contains'\n  value: any // æ¯”è¾ƒå€¼\n}\n\n// ç»„ä»¶äº¤äº’çŠ¶æ€\nexport interface ComponentInteractionState {\n  backgroundColor?: string\n  textColor?: string\n  borderColor?: string\n  width?: string | number\n  height?: string | number\n  opacity?: number\n  transform?: string\n  visibility?: 'visible' | 'hidden'\n  content?: any\n  isAnimating?: boolean\n}\n\n// äº¤äº’ç®¡ç†å™¨æ¥å£\nexport interface IInteractionManager {\n  // æ³¨å†Œç»„ä»¶çš„äº¤äº’é…ç½®\n  registerComponent(componentId: string, configs: InteractionResponse[]): void\n\n  // ç§»é™¤ç»„ä»¶çš„äº¤äº’é…ç½®\n  unregisterComponent(componentId: string): void\n\n  // è§¦å‘äº¤äº’äº‹ä»¶\n  triggerEvent(componentId: string, event: InteractionEventType, data?: any): void\n\n  // è·å–ç»„ä»¶çš„äº¤äº’çŠ¶æ€\n  getComponentState(componentId: string): ComponentInteractionState | undefined\n\n  // é‡ç½®ç»„ä»¶çš„äº¤äº’çŠ¶æ€\n  resetComponentState(componentId: string): void\n\n  // æ‰¹é‡æ›´æ–°å¤šä¸ªç»„ä»¶çš„äº¤äº’é…ç½®\n  updateComponentConfigs(componentId: string, configs: InteractionResponse[]): void\n}\n\n// äº¤äº’äº‹ä»¶æ•°æ®\nexport interface InteractionEventData {\n  source?: string // äº‹ä»¶æ¥æº\n  timestamp: Date // äº‹ä»¶æ—¶é—´æˆ³\n  data?: any // é¢å¤–æ•°æ®\n  position?: { x: number; y: number } // äº‹ä»¶ä½ç½®\n}\n\n// äº¤äº’å“åº”ç»“æœ\nexport interface InteractionResponseResult {\n  success: boolean\n  componentId: string\n  action: InteractionActionType\n  oldValue?: any\n  newValue?: any\n  error?: string\n}\n\n// æ¡ä»¶é…ç½®\nexport interface ConditionConfig {\n  type: 'comparison' | 'range' | 'expression' // æ¡ä»¶ç±»å‹\n  field?: string // ç›‘å¬çš„å­—æ®µå\n  operator?: ComparisonOperator // æ¯”è¾ƒè¿ç®—ç¬¦\n  value?: any // æ¯”è¾ƒå€¼\n  minValue?: any // èŒƒå›´æ¡ä»¶çš„æœ€å°å€¼\n  maxValue?: any // èŒƒå›´æ¡ä»¶çš„æœ€å¤§å€¼\n  expression?: string // è‡ªå®šä¹‰è¡¨è¾¾å¼\n}\n\n// æ¯”è¾ƒè¿ç®—ç¬¦\nexport type ComparisonOperator =\n  | 'equals' // ç­‰äº (==)\n  | 'notEquals' // ä¸ç­‰äº (!=)\n  | 'greaterThan' // å¤§äº (>)\n  | 'greaterThanOrEqual' // å¤§äºç­‰äº (>=)\n  | 'lessThan' // å°äº (<)\n  | 'lessThanOrEqual' // å°äºç­‰äº (<=)\n  | 'contains' // åŒ…å«\n  | 'startsWith' // ä»¥...å¼€å§‹\n  | 'endsWith' // ä»¥...ç»“æŸ\n\n// æ‰©å±•çš„äº¤äº’å“åº”é…ç½®ï¼Œæ”¯æŒè·¨ç»„ä»¶åŠ¨ä½œ\nexport interface CrossComponentResponse extends InteractionResponse {\n  targetComponentId: string // ç›®æ ‡ç»„ä»¶ID\n  targetProperty?: string // ç›®æ ‡å±æ€§åï¼ˆç”¨äºæ•°æ®ä¿®æ”¹ï¼‰\n}\n\n// é—ªçƒé…ç½®\nexport interface FlashConfig {\n  color: string // é—ªçƒé¢œè‰²\n  duration: number // æŒç»­æ—¶é—´\n  times: number // é—ªçƒæ¬¡æ•°\n}\n\n// URLè·³è½¬é…ç½®\nexport interface NavigationConfig {\n  url: string // ç›®æ ‡URL\n  target?: '_blank' | '_self' | '_parent' | '_top' // æ‰“å¼€æ–¹å¼\n}\n\n// æ•°æ®æ›´æ–°é…ç½®\nexport interface DataUpdateConfig {\n  targetProperty: string // ç›®æ ‡å±æ€§\n  updateValue: any // æ›´æ–°å€¼\n  updateMode?: 'replace' | 'append' | 'prepend' // æ›´æ–°æ¨¡å¼\n}\n\n// ============ ç»„ä»¶äº¤äº’é…ç½®ç±»å‹æ¥å£ ============\n\n// ç»„ä»¶äº¤äº’èƒ½åŠ›å£°æ˜\nexport interface ComponentInteractionCapability {\n  /** ç»„ä»¶æ”¯æŒçš„äº‹ä»¶ç±»å‹ */\n  supportedEvents: InteractionEventType[]\n\n  /** ç»„ä»¶æ”¯æŒçš„åŠ¨ä½œç±»å‹ */\n  supportedActions: InteractionActionType[]\n\n  /** é»˜è®¤äº¤äº’æƒé™ */\n  defaultPermissions: {\n    allowExternalControl: boolean\n    requirePermissionCheck: boolean\n  }\n\n  /** å¯è¢«å…¶ä»–ç»„ä»¶ç›‘å¬çš„å±æ€§åˆ—è¡¨ */\n  listenableProperties: string[]\n}\n\n// äº¤äº’é…ç½®ç¤ºä¾‹\nexport interface InteractionExample {\n  /** ç¤ºä¾‹åç§° */\n  name: string\n\n  /** ç¤ºä¾‹æè¿° */\n  description: string\n\n  /** ç¤ºä¾‹åœºæ™¯ */\n  scenario: 'click-jump' | 'hover-modify' | 'data-change-action'\n\n  /** ç¤ºä¾‹é…ç½® */\n  config: InteractionConfig\n\n  /** é€‚ç”¨ç»„ä»¶ç±»å‹ */\n  applicableComponents?: string[]\n}\n\n// ç»„ä»¶å®Œæ•´äº¤äº’å®šä¹‰ï¼ˆç”¨äºç»„ä»¶index.tsï¼‰\nexport interface ComponentInteractionDefinition {\n  /** äº¤äº’èƒ½åŠ›å£°æ˜ */\n  capability: ComponentInteractionCapability\n\n  /** äº¤äº’é…ç½®ç¤ºä¾‹ */\n  examples: InteractionExample[]\n\n  /** å±æ€§æš´éœ²é…ç½® */\n  propertyExposure: {\n    componentType: string\n    componentName: string\n    listenableProperties: Array<{\n      name: string\n      label: string\n      type: 'string' | 'number' | 'boolean' | 'object'\n      description?: string\n      group?: string\n    }>\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\mixins\\InteractionCapable.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'InteractionConfig' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InteractionConfig' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'InteractionEmits' is defined but never used.","line":16,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InteractionEmits' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'event' is defined but never used.","line":44,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'args' is defined but never used.","line":44,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":29},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":155,"column":34,"nodeType":"BlockStatement","messageId":"unexpected","endLine":156,"endColumn":6,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4235,4240],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card2.1 ç»„ä»¶äº¤äº’èƒ½åŠ›æ··å…¥\n * ä¸ºæ‰€æœ‰Card2ç»„ä»¶æä¾›ç»Ÿä¸€çš„äº¤äº’æ¥å£å’Œèƒ½åŠ›\n */\n\nimport { ref, computed, onMounted, onUnmounted, watch, nextTick } from 'vue'\nimport { interactionManager } from '../interaction-manager'\nimport type {\n  InteractionConfig,\n  InteractionEventType,\n  InteractionResponseResult,\n  ComponentInteractionState\n} from '../interaction-types'\nimport type {\n  InteractionProps,\n  InteractionEmits,\n  InteractionPermissionCheck,\n  InteractionContext,\n  InteractionCapabilityConfig\n} from '../../types/interaction-component'\n\n/**\n * é»˜è®¤äº¤äº’èƒ½åŠ›é…ç½®\n */\nconst DEFAULT_CONFIG: InteractionCapabilityConfig = {\n  enabled: true,\n  defaultPermissions: {\n    allowExternalControl: true,\n    supportedEvents: ['click', 'hover', 'dataChange', 'conditional']\n  },\n  enableDebug: false,\n  performance: {\n    debounceTime: 50,\n    maxConcurrentInteractions: 5\n  }\n}\n\n/**\n * åˆ›å»ºäº¤äº’èƒ½åŠ›æ··å…¥\n * @param config äº¤äº’èƒ½åŠ›é…ç½®\n */\nexport function useInteractionCapable(\n  props: InteractionProps,\n  emit: (event: any, ...args: any[]) => void,\n  config: Partial<InteractionCapabilityConfig> = {}\n) {\n  // åˆå¹¶é…ç½®\n  const finalConfig = { ...DEFAULT_CONFIG, ...config }\n\n  // å“åº”å¼çŠ¶æ€\n  const isInteractionEnabled = ref(finalConfig.enabled)\n  const currentInteractionState = ref<ComponentInteractionState>({})\n  const activeInteractions = ref(new Set<string>())\n  const interactionHistory = ref<InteractionContext[]>([])\n\n  // è®¡ç®—å±æ€§\n  const componentId = computed(() => props.componentId || `component-${Date.now()}`)\n\n  const allowExternalControl = computed(() => {\n    return props.allowExternalControl ?? finalConfig.defaultPermissions.allowExternalControl\n  })\n\n  const supportedEvents = computed(() => {\n    const defaultEvents = finalConfig.defaultPermissions.supportedEvents\n    const permissionEvents = props.interactionPermissions?.allowedEvents\n\n    // ğŸ”¥ ä¿®å¤ï¼šå¦‚æœæœ‰æƒé™é…ç½®ï¼Œåˆå¹¶é»˜è®¤äº‹ä»¶å’Œæƒé™äº‹ä»¶ï¼Œç¡®ä¿åŒ…å«æ ¸å¿ƒäº‹ä»¶\n    if (permissionEvents) {\n      const coreEvents = ['click', 'hover', 'dataChange', 'conditional']\n      return [...new Set([...defaultEvents, ...permissionEvents, ...coreEvents])]\n    }\n\n    return defaultEvents\n  })\n\n  const interactionConfigs = computed(() => props.interactionConfigs || [])\n\n  const hasActiveInteractions = computed(() => activeInteractions.value.size > 0)\n\n  const interactionStatusText = computed(() => {\n    if (!isInteractionEnabled.value) return 'äº¤äº’å·²ç¦ç”¨'\n    if (!allowExternalControl.value) return 'æ‹’ç»å¤–éƒ¨æ§åˆ¶'\n    if (hasActiveInteractions.value) return `æ‰§è¡Œä¸­ (${activeInteractions.value.size})`\n    return interactionConfigs.value.length > 0 ? 'å°±ç»ª' : 'æ— äº¤äº’é…ç½®'\n  })\n\n  /**\n   * æ£€æŸ¥äº¤äº’æƒé™\n   */\n  const checkInteractionPermission = (\n    sourceComponentId: string | undefined,\n    eventType: InteractionEventType\n  ): InteractionPermissionCheck => {\n    // æ£€æŸ¥æ˜¯å¦å¯ç”¨äº¤äº’\n    if (!isInteractionEnabled.value) {\n      return {\n        allowed: false,\n        reason: 'ç»„ä»¶äº¤äº’åŠŸèƒ½å·²ç¦ç”¨',\n        code: 'EXTERNAL_CONTROL_DISABLED'\n      }\n    }\n\n    // æ£€æŸ¥æ˜¯å¦å…è®¸å¤–éƒ¨æ§åˆ¶\n    if (!allowExternalControl.value && sourceComponentId) {\n      return {\n        allowed: false,\n        reason: 'ç»„ä»¶ä¸å…è®¸å¤–éƒ¨æ§åˆ¶',\n        code: 'EXTERNAL_CONTROL_DISABLED'\n      }\n    }\n\n    // æ£€æŸ¥äº‹ä»¶ç±»å‹æ”¯æŒ\n    if (!supportedEvents.value.includes(eventType)) {\n      return {\n        allowed: false,\n        reason: `ç»„ä»¶ä¸æ”¯æŒ ${eventType} äº‹ä»¶`,\n        code: 'EVENT_NOT_SUPPORTED'\n      }\n    }\n\n    // æ£€æŸ¥é»‘åå•\n    if (sourceComponentId && props.interactionPermissions?.blacklist?.includes(sourceComponentId)) {\n      return {\n        allowed: false,\n        reason: `ç»„ä»¶ ${sourceComponentId} åœ¨é»‘åå•ä¸­`,\n        code: 'COMPONENT_BLACKLISTED'\n      }\n    }\n\n    // æ£€æŸ¥ç™½åå•ï¼ˆå¦‚æœè®¾ç½®äº†ç™½åå•ï¼‰\n    if (sourceComponentId && props.interactionPermissions?.whitelist) {\n      if (!props.interactionPermissions.whitelist.includes(sourceComponentId)) {\n        return {\n          allowed: false,\n          reason: `ç»„ä»¶ ${sourceComponentId} ä¸åœ¨ç™½åå•ä¸­`,\n          code: 'COMPONENT_NOT_WHITELISTED'\n        }\n      }\n    }\n\n    return { allowed: true }\n  }\n\n  /**\n   * è®°å½•äº¤äº’å†å²\n   */\n  const recordInteraction = (context: InteractionContext) => {\n    interactionHistory.value.unshift(context)\n\n    // é™åˆ¶å†å²è®°å½•æ•°é‡\n    if (interactionHistory.value.length > 100) {\n      interactionHistory.value = interactionHistory.value.slice(0, 100)\n    }\n\n    if (finalConfig.enableDebug) {\n    }\n  }\n\n  /**\n   * è§¦å‘äº¤äº’äº‹ä»¶\n   */\n  const triggerInteractionEvent = (\n    eventType: InteractionEventType,\n    eventData?: any,\n    sourceComponentId?: string\n  ): InteractionResponseResult[] => {\n    const context: InteractionContext = {\n      sourceComponentId,\n      targetComponentId: componentId.value,\n      eventType,\n      eventData,\n      timestamp: Date.now(),\n      isUserAction: !sourceComponentId\n    }\n\n    // æƒé™æ£€æŸ¥\n    const permissionCheck = checkInteractionPermission(sourceComponentId, eventType)\n\n    if (!permissionCheck.allowed) {\n      const rejectionInfo = {\n        sourceComponentId,\n        eventType,\n        reason: permissionCheck.code as any,\n        message: permissionCheck.reason || 'æƒé™æ£€æŸ¥å¤±è´¥'\n      }\n      recordInteraction({ ...context, eventData: { ...eventData, rejected: true, reason: rejectionInfo } })\n      emit('interaction-rejected', rejectionInfo)\n\n      return [\n        {\n          success: false,\n          componentId: componentId.value,\n          action: 'custom' as any,\n          error: permissionCheck.reason\n        }\n      ]\n    }\n\n    // è®°å½•äº¤äº’\n    recordInteraction(context)\n\n    // å‘å‡ºäº¤äº’äº‹ä»¶\n    emit('interaction-event', eventType, eventData)\n\n    // æ‰§è¡Œäº¤äº’\n    const results = interactionManager.triggerEvent(componentId.value, eventType, eventData)\n\n    // å‘å‡ºäº¤äº’ç»“æœ\n    results.forEach(result => {\n      emit('interaction-result', result)\n    })\n\n    return results\n  }\n\n  /**\n   * å¤„ç†äº¤äº’çŠ¶æ€å˜åŒ–\n   */\n  const handleInteractionStateChange = (newState: Partial<ComponentInteractionState>) => {\n    currentInteractionState.value = { ...currentInteractionState.value, ...newState }\n    emit('interaction-state-change', currentInteractionState.value)\n  }\n\n  /**\n   * åº”ç”¨äº¤äº’ç»“æœåˆ°ç»„ä»¶çŠ¶æ€\n   */\n  const applyInteractionResult = (result: InteractionResponseResult) => {\n    if (!result.success) return\n\n    const stateUpdate: Partial<ComponentInteractionState> = {}\n\n    // æ ¹æ®åŠ¨ä½œç±»å‹æ›´æ–°çŠ¶æ€\n    switch (result.action) {\n      case 'changeBackgroundColor':\n        stateUpdate.backgroundColor = result.newValue\n        break\n      case 'changeTextColor':\n        stateUpdate.textColor = result.newValue\n        break\n      case 'changeBorderColor':\n        stateUpdate.borderColor = result.newValue\n        break\n      case 'changeSize':\n        if (typeof result.newValue === 'object') {\n          stateUpdate.width = result.newValue.width\n          stateUpdate.height = result.newValue.height\n        }\n        break\n      case 'changeOpacity':\n        stateUpdate.opacity = result.newValue\n        break\n      case 'changeTransform':\n        stateUpdate.transform = result.newValue\n        break\n      case 'changeVisibility':\n        stateUpdate.visibility = result.newValue\n        break\n      case 'changeContent':\n        stateUpdate.content = result.newValue\n        break\n      case 'triggerAnimation':\n        stateUpdate.isAnimating = true\n        // åŠ¨ç”»ç»“æŸåé‡ç½®\n        setTimeout(() => {\n          handleInteractionStateChange({ isAnimating: false })\n        }, 1000)\n        break\n    }\n\n    if (Object.keys(stateUpdate).length > 0) {\n      handleInteractionStateChange(stateUpdate)\n    }\n  }\n\n  /**\n   * æ³¨å†Œç»„ä»¶åˆ°äº¤äº’ç®¡ç†å™¨\n   */\n  const registerToInteractionManager = () => {\n    if (componentId.value) {\n      // ğŸ”¥ ä¿®å¤ï¼šå§‹ç»ˆæ³¨å†Œç»„ä»¶ï¼Œå³ä½¿æ²¡æœ‰äº¤äº’é…ç½®\n      // è¿™æ ·åç»­æ·»åŠ é…ç½®æ—¶å¯ä»¥æ­£å¸¸å·¥ä½œ\n      const configs = interactionConfigs.value || []\n      interactionManager.registerComponent(componentId.value, configs)\n    }\n  }\n\n  /**\n   * ä»äº¤äº’ç®¡ç†å™¨æ³¨é”€ç»„ä»¶\n   */\n  const unregisterFromInteractionManager = () => {\n    if (componentId.value) {\n      interactionManager.unregisterComponent(componentId.value, [])\n    }\n  }\n\n  /**\n   * æ›´æ–°äº¤äº’é…ç½®\n   */\n  const updateInteractionConfigs = () => {\n    if (componentId.value) {\n      // ğŸ”¥ ä¿®å¤ï¼šå§‹ç»ˆæ›´æ–°é…ç½®ï¼Œå³ä½¿é…ç½®æ•°ç»„ä¸ºç©º\n      const configs = interactionConfigs.value || []\n      interactionManager.updateComponentConfigs(componentId.value, configs)\n    }\n  }\n\n  /**\n   * é˜²æŠ–å¤„ç†çš„äº‹ä»¶è§¦å‘å™¨\n   */\n  let debounceTimers: Record<string, number> = {}\n\n  const debouncedTriggerEvent = (eventType: InteractionEventType, eventData?: any) => {\n    if (finalConfig.performance.debounceTime <= 0) {\n      return triggerInteractionEvent(eventType, eventData)\n    }\n\n    const key = `${eventType}-${JSON.stringify(eventData)}`\n\n    if (debounceTimers[key]) {\n      clearTimeout(debounceTimers[key])\n    }\n\n    debounceTimers[key] = window.setTimeout(() => {\n      triggerInteractionEvent(eventType, eventData)\n      delete debounceTimers[key]\n    }, finalConfig.performance.debounceTime)\n\n    return []\n  }\n\n  /**\n   * é€šç”¨äº‹ä»¶å¤„ç†å™¨\n   */\n  const createEventHandler = (eventType: InteractionEventType) => {\n    return (event?: Event) => {\n      if (!props.previewMode) {\n        // ç¼–è¾‘æ¨¡å¼ä¸‹ä¸è§¦å‘äº¤äº’\n        return\n      }\n\n      // æ£€æŸ¥å¹¶å‘é™åˆ¶\n      if (activeInteractions.value.size >= finalConfig.performance.maxConcurrentInteractions) {\n        return\n      }\n\n      const interactionId = `${eventType}-${Date.now()}`\n      activeInteractions.value.add(interactionId)\n\n      const results = debouncedTriggerEvent(eventType, event)\n\n      // å¼‚æ­¥æ¸…ç†æ´»è·ƒäº¤äº’æ ‡è®°\n      nextTick(() => {\n        setTimeout(() => {\n          activeInteractions.value.delete(interactionId)\n        }, 100)\n      })\n\n      return results\n    }\n  }\n\n  // ç›‘å¬äº¤äº’é…ç½®å˜åŒ–\n  watch(\n    () => interactionConfigs.value,\n    () => {\n      updateInteractionConfigs()\n    },\n    { deep: true }\n  )\n\n  // ç›‘å¬ç»„ä»¶IDå˜åŒ–\n  watch(\n    () => componentId.value,\n    (newId, oldId) => {\n      if (oldId) {\n        unregisterFromInteractionManager()\n      }\n      if (newId) {\n        registerToInteractionManager()\n      }\n    }\n  )\n\n  // ç”Ÿå‘½å‘¨æœŸé’©å­\n  onMounted(() => {\n    registerToInteractionManager()\n\n    // ç›‘å¬äº¤äº’ç®¡ç†å™¨çš„çŠ¶æ€å˜åŒ–\n    interactionManager.addEventListener(componentId.value, data => {\n      if (data.event && data.data) {\n        applyInteractionResult(data.data)\n      }\n    })\n  })\n\n  onUnmounted(() => {\n    unregisterFromInteractionManager()\n\n    // æ¸…ç†é˜²æŠ–è®¡æ—¶å™¨\n    Object.values(debounceTimers).forEach(timer => clearTimeout(timer))\n    debounceTimers = {}\n\n    // æ¸…ç†çŠ¶æ€\n    activeInteractions.value.clear()\n    interactionHistory.value = []\n  })\n\n  // è¿”å›ç»„åˆå¼å‡½æ•°æ¥å£\n  return {\n    // å“åº”å¼çŠ¶æ€\n    isInteractionEnabled,\n    currentInteractionState,\n    activeInteractions,\n    interactionHistory,\n\n    // è®¡ç®—å±æ€§\n    componentId,\n    allowExternalControl,\n    supportedEvents,\n    interactionConfigs,\n    hasActiveInteractions,\n    interactionStatusText,\n\n    // æ–¹æ³•\n    triggerInteractionEvent,\n    handleInteractionStateChange,\n    applyInteractionResult,\n    checkInteractionPermission,\n    createEventHandler,\n    registerToInteractionManager,\n    unregisterFromInteractionManager,\n    updateInteractionConfigs,\n\n    // å·¥å…·æ–¹æ³•\n    setInteractionEnabled: (enabled: boolean) => {\n      isInteractionEnabled.value = enabled\n    },\n\n    clearInteractionHistory: () => {\n      interactionHistory.value = []\n    },\n\n    getInteractionStats: () => ({\n      totalInteractions: interactionHistory.value.length,\n      activeCount: activeInteractions.value.size,\n      lastInteraction: interactionHistory.value[0],\n      supportedEvents: supportedEvents.value,\n      configCount: interactionConfigs.value.length\n    })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\permission-utils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":61,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":17},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":61,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":61,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1348,1348],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card 2.1 æƒé™éªŒè¯å·¥å…·\n * ç”¨äºç»„ä»¶æƒé™æ§åˆ¶å’Œç”¨æˆ·æƒé™éªŒè¯\n */\n\nimport type { ComponentPermission } from './types'\n\n// æƒé™ç­‰çº§å®šä¹‰ï¼ˆä»é«˜åˆ°ä½ï¼‰\nconst PERMISSION_LEVELS = {\n  SYS_ADMIN: 4,\n  TENANT_ADMIN: 3,\n  TENANT_USER: 2,\n  ä¸é™: 1\n} as const\n\n/**\n * è·å–ç”¨æˆ·æƒé™ç­‰çº§\n * @param userAuthority ç”¨æˆ·æƒé™\n * @returns æƒé™ç­‰çº§æ•°å­—\n */\nexport function getUserPermissionLevel(userAuthority: string): number {\n  return PERMISSION_LEVELS[userAuthority as keyof typeof PERMISSION_LEVELS] || 0\n}\n\n/**\n * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ç»„ä»¶\n * @param componentPermission ç»„ä»¶æƒé™è¦æ±‚\n * @param userAuthority ç”¨æˆ·æƒé™\n * @returns æ˜¯å¦æœ‰æƒé™\n */\nexport function hasComponentPermission(componentPermission: ComponentPermission, userAuthority: string): boolean {\n  // å¦‚æœç»„ä»¶æƒé™æ˜¯\"ä¸é™\"ï¼Œåˆ™æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®\n  if (componentPermission === 'ä¸é™') {\n    return true\n  }\n\n  // å¦‚æœç”¨æˆ·æƒé™æ˜¯\"ä¸é™\"ï¼Œåˆ™ä¸èƒ½è®¿é—®ä»»ä½•æœ‰æƒé™é™åˆ¶çš„ç»„ä»¶\n  if (userAuthority === 'ä¸é™') {\n    return false\n  }\n\n  // è·å–æƒé™ç­‰çº§\n  const componentLevel = PERMISSION_LEVELS[componentPermission]\n  const userLevel = getUserPermissionLevel(userAuthority)\n\n  // ç”¨æˆ·æƒé™ç­‰çº§å¿…é¡»å¤§äºç­‰äºç»„ä»¶è¦æ±‚çš„æƒé™ç­‰çº§\n  return userLevel >= componentLevel\n}\n\n/**\n * ä»æœ¬åœ°å­˜å‚¨è·å–ç”¨æˆ·ä¿¡æ¯\n * @returns ç”¨æˆ·æƒé™ä¿¡æ¯\n */\nexport function getUserAuthorityFromStorage(): string {\n  try {\n    const userInfo = localStorage.getItem('userInfo')\n    if (userInfo) {\n      const parsed = JSON.parse(userInfo)\n      return parsed.authority || 'TENANT_USER' // é»˜è®¤è¿”å›ç§Ÿæˆ·ç”¨æˆ·æƒé™\n    }\n  } catch (error) {}\n\n  return 'TENANT_USER' // é»˜è®¤è¿”å›ç§Ÿæˆ·ç”¨æˆ·æƒé™\n}\n\n/**\n * è¿‡æ»¤ç»„ä»¶åˆ—è¡¨ï¼Œåªè¿”å›ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„ç»„ä»¶\n * @param components ç»„ä»¶åˆ—è¡¨\n * @param userAuthority ç”¨æˆ·æƒé™ï¼ˆå¯é€‰ï¼Œå¦‚æœä¸æä¾›åˆ™ä»æœ¬åœ°å­˜å‚¨è·å–ï¼‰\n * @returns è¿‡æ»¤åçš„ç»„ä»¶åˆ—è¡¨\n */\nexport function filterComponentsByPermission<T extends { permission?: ComponentPermission }>(\n  components: T[],\n  userAuthority?: string\n): T[] {\n  const authority = userAuthority || getUserAuthorityFromStorage()\n\n  return components.filter(component => {\n    const permission = component.permission || 'ä¸é™'\n    return hasComponentPermission(permission, authority)\n  })\n}\n\n/**\n * è·å–æƒé™æ˜¾ç¤ºåç§°\n * @param permission æƒé™å€¼\n * @returns æ˜¾ç¤ºåç§°\n */\nexport function getPermissionDisplayName(permission: ComponentPermission): string {\n  const displayNames = {\n    ä¸é™: 'ä¸é™',\n    SYS_ADMIN: 'ç³»ç»Ÿç®¡ç†å‘˜',\n    TENANT_ADMIN: 'ç§Ÿæˆ·ç®¡ç†å‘˜',\n    TENANT_USER: 'ç§Ÿæˆ·ç”¨æˆ·'\n  }\n\n  return displayNames[permission] || permission\n}\n\n/**\n * è·å–æ‰€æœ‰å¯ç”¨æƒé™é€‰é¡¹\n * @returns æƒé™é€‰é¡¹åˆ—è¡¨\n */\nexport function getAvailablePermissions(): Array<{ value: ComponentPermission; label: string }> {\n  return [\n    { value: 'ä¸é™', label: 'ä¸é™' },\n    { value: 'SYS_ADMIN', label: 'ç³»ç»Ÿç®¡ç†å‘˜' },\n    { value: 'TENANT_ADMIN', label: 'ç§Ÿæˆ·ç®¡ç†å‘˜' },\n    { value: 'TENANT_USER', label: 'ç§Ÿæˆ·ç”¨æˆ·' }\n  ]\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\property-exposure.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":64,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":64,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ç»„ä»¶å±æ€§æš´éœ²ç³»ç»Ÿ\n * è®©ç»„ä»¶å¼€å‘è€…å¯ä»¥å£°æ˜å“ªäº›å±æ€§å¯ä»¥è¢«ç›‘å¬ï¼Œä¾›äº¤äº’é…ç½®ä½¿ç”¨\n * æ”¯æŒä» settingConfig è‡ªåŠ¨æ³¨å†Œå¯ç»‘å®šå±æ€§\n */\n\nimport type { ComponentSettingConfig } from '../types/setting-config'\nimport { inferPropertyDataType } from '../types/setting-config'\n\n// å±æ€§æ•°æ®ç±»å‹\nexport type PropertyDataType =\n  | 'string' // å­—ç¬¦ä¸²\n  | 'number' // æ•°å­—\n  | 'boolean' // å¸ƒå°”å€¼\n  | 'object' // å¯¹è±¡\n  | 'array' // æ•°ç»„\n  | 'date' // æ—¥æœŸ\n  | 'color' // é¢œè‰²\n  | 'url' // URLé“¾æ¥\n\n// å¯ç›‘å¬å±æ€§å®šä¹‰\nexport interface ListenableProperty {\n  /** å±æ€§åç§°ï¼ˆç”¨äºç¨‹åºè®¿é—®ï¼‰ */\n  name: string\n  /** æ˜¾ç¤ºæ ‡ç­¾ï¼ˆç”¨äºç”¨æˆ·ç•Œé¢ï¼‰ */\n  label: string\n  /** å±æ€§æè¿° */\n  description?: string\n  /** æ•°æ®ç±»å‹ */\n  type: PropertyDataType\n  /** é»˜è®¤å€¼ */\n  defaultValue?: any\n  /** æ˜¯å¦æ˜¯æ ¸å¿ƒå±æ€§ï¼ˆä¼˜å…ˆæ˜¾ç¤ºï¼‰ */\n  isCore?: boolean\n  /** å±æ€§åˆ†ç»„ */\n  group?: string\n  /** ç¤ºä¾‹å€¼ */\n  example?: any\n  /** å¯èƒ½çš„æšä¸¾å€¼ */\n  enum?: { label: string; value: any }[]\n}\n\n// ç»„ä»¶å±æ€§æš´éœ²é…ç½®\nexport interface ComponentPropertyExposure {\n  /** ç»„ä»¶ç±»å‹æ ‡è¯† */\n  componentType: string\n  /** ç»„ä»¶æ˜¾ç¤ºåç§° */\n  componentName: string\n  /** å¯ç›‘å¬çš„å±æ€§åˆ—è¡¨ */\n  listenableProperties: ListenableProperty[]\n  /** ç»„ä»¶ç‰ˆæœ¬ */\n  version?: string\n  /** æ›´æ–°æ—¶é—´ */\n  lastUpdated?: Date\n}\n\n// å…¨å±€å±æ€§æš´éœ²æ³¨å†Œè¡¨\nclass PropertyExposureRegistry {\n  private registrations = new Map<string, ComponentPropertyExposure>()\n\n  /**\n   * æ³¨å†Œç»„ä»¶çš„å±æ€§æš´éœ²é…ç½®\n   */\n  register(config: ComponentPropertyExposure) {}\n\n  /**\n   * è·å–ç»„ä»¶çš„å¯ç›‘å¬å±æ€§\n   */\n  getListenableProperties(componentType: string): ListenableProperty[] {\n    const config = this.registrations.get(componentType)\n    return config?.listenableProperties || []\n  }\n\n  /**\n   * è·å–ç»„ä»¶çš„å±æ€§æš´éœ²é…ç½®\n   */\n  getComponentExposure(componentType: string): ComponentPropertyExposure | undefined {\n    return this.registrations.get(componentType)\n  }\n\n  /**\n   * è·å–æ‰€æœ‰æ³¨å†Œçš„ç»„ä»¶ç±»å‹\n   */\n  getAllComponentTypes(): string[] {\n    return Array.from(this.registrations.keys())\n  }\n\n  /**\n   * è·å–å±æ€§çš„æ˜¾ç¤ºä¿¡æ¯\n   */\n  getPropertyDisplayInfo(componentType: string, propertyName: string) {\n    const config = this.registrations.get(componentType)\n    const property = config?.listenableProperties.find(p => p.name === propertyName)\n\n    if (!property) return null\n\n    return {\n      label: property.label,\n      description: property.description,\n      type: property.type,\n      example: property.example,\n      fullPath: `${componentType}.${propertyName}`\n    }\n  }\n\n  /**\n   * æŒ‰åˆ†ç»„è·å–å±æ€§\n   */\n  getPropertiesByGroup(componentType: string): Record<string, ListenableProperty[]> {\n    const properties = this.getListenableProperties(componentType)\n    const grouped: Record<string, ListenableProperty[]> = {}\n\n    properties.forEach(prop => {\n      const group = prop.group || 'åŸºç¡€å±æ€§'\n      if (!grouped[group]) {\n        grouped[group] = []\n      }\n      grouped[group].push(prop)\n    })\n\n    return grouped\n  }\n}\n\n// å…¨å±€å•ä¾‹\nexport const propertyExposureRegistry = new PropertyExposureRegistry()\n\n/**\n * ç»„ä»¶å±æ€§æš´éœ²è£…é¥°å™¨\n * ç»„ä»¶å¼€å‘è€…å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥å£°æ˜å¯ç›‘å¬çš„å±æ€§\n */\nexport function exposeProperties(config: Omit<ComponentPropertyExposure, 'lastUpdated'>) {\n  return function (target: any) {\n    // åœ¨ç»„ä»¶åŠ è½½æ—¶è‡ªåŠ¨æ³¨å†Œ\n    propertyExposureRegistry.register(config)\n    return target\n  }\n}\n\n/**\n * åˆ›å»ºå±æ€§æš´éœ²é…ç½®çš„è¾…åŠ©å‡½æ•°\n */\nexport function createPropertyExposure(\n  componentType: string,\n  componentName: string,\n  properties: ListenableProperty[]\n): ComponentPropertyExposure {\n  return {\n    componentType,\n    componentName,\n    listenableProperties: properties,\n    version: '1.0.0'\n  }\n}\n\n/**\n * åˆ›å»ºå±æ€§å®šä¹‰çš„è¾…åŠ©å‡½æ•°\n */\nexport function createProperty(\n  name: string,\n  label: string,\n  type: PropertyDataType,\n  options: Partial<ListenableProperty> = {}\n): ListenableProperty {\n  return {\n    name,\n    label,\n    type,\n    isCore: false,\n    group: 'åŸºç¡€å±æ€§',\n    ...options\n  }\n}\n\n/**\n * ä» ComponentSettingConfig è‡ªåŠ¨æ³¨å†Œå¯ç»‘å®šå±æ€§\n * æ ¸å¿ƒåŠŸèƒ½ï¼šå°† setting.vue ä¸­çš„é…ç½®é¡¹è‡ªåŠ¨è½¬æ¢ä¸ºå¯ç»‘å®šå±æ€§\n */\nexport function autoRegisterFromSettingConfig(settingConfig: ComponentSettingConfig): void {\n  // å°†æ¯ä¸ª setting è½¬æ¢ä¸ºå¯ç›‘å¬å±æ€§\n  const listenableProperties: ListenableProperty[] = settingConfig.settings.map(setting => {\n    // æ¨æ–­å±æ€§æ•°æ®ç±»å‹\n    const propertyType = inferPropertyDataType(setting)\n\n    return {\n      name: setting.field,\n      label: setting.label,\n      type: propertyType,\n      description: `é€šè¿‡è®¾ç½®é¢æ¿é…ç½®çš„ ${setting.label} å±æ€§`,\n      group: setting.group || 'è®¾ç½®å±æ€§',\n      defaultValue: setting.defaultValue,\n      isCore: true, // è®¾ç½®é¡¹éƒ½æ˜¯æ ¸å¿ƒå±æ€§\n      example: setting.defaultValue,\n      // å¦‚æœæ˜¯ä¸‹æ‹‰é€‰æ‹©ï¼Œæ·»åŠ æšä¸¾å€¼\n      enum: setting.options?.map(opt => ({\n        label: opt.label,\n        value: opt.value\n      }))\n    }\n  })\n\n  // æ³¨å†Œåˆ°å±æ€§æš´éœ²æ³¨å†Œè¡¨\n  propertyExposureRegistry.register({\n    componentType: settingConfig.componentType,\n    componentName: `${settingConfig.componentType} ç»„ä»¶`,\n    listenableProperties,\n    version: '1.0.0'\n  })\n}\n\n/**\n * è·å–å·²æ³¨å†Œç»„ä»¶çš„å±æ€§æ ‘ç»“æ„\n * ç”¨äºåœ¨ HttpConfigForm ä¸­æ˜¾ç¤ºå¯ç»‘å®šçš„ç»„ä»¶å±æ€§\n */\nexport function getComponentPropertyTree(): ComponentPropertyTreeNode[] {\n  const componentTypes = propertyExposureRegistry.getAllComponentTypes()\n\n  return componentTypes\n    .map(componentType => {\n      const exposure = propertyExposureRegistry.getComponentExposure(componentType)\n      if (!exposure) return null\n\n      const properties = exposure.listenableProperties.map(prop => ({\n        key: `${componentType}.${prop.name}`,\n        label: `${prop.label} (${prop.type})`,\n        type: 'property' as const,\n        componentId: componentType,\n        propertyName: prop.name,\n        propertyConfig: prop,\n        isLeaf: true\n      }))\n\n      return {\n        key: componentType,\n        label: exposure.componentName,\n        type: 'component' as const,\n        children: properties,\n        isLeaf: false\n      }\n    })\n    .filter(Boolean) as ComponentPropertyTreeNode[]\n}\n\n/**\n * ç»„ä»¶å±æ€§æ ‘èŠ‚ç‚¹\n */\nexport interface ComponentPropertyTreeNode {\n  key: string\n  label: string\n  type: 'component' | 'property'\n  componentId?: string\n  propertyName?: string\n  propertyConfig?: ListenableProperty\n  children?: ComponentPropertyTreeNode[]\n  isLeaf: boolean\n}\n\n// å¸¸ç”¨å±æ€§æ¨¡æ¿\nexport const CommonProperties = {\n  // æ–‡æœ¬ç›¸å…³\n  title: createProperty('title', 'æ ‡é¢˜', 'string', {\n    description: 'ç»„ä»¶çš„æ ‡é¢˜æ–‡å­—',\n    isCore: true,\n    group: 'å†…å®¹',\n    example: 'è®¾å¤‡çŠ¶æ€'\n  }),\n\n  content: createProperty('content', 'å†…å®¹', 'string', {\n    description: 'ç»„ä»¶çš„ä¸»è¦å†…å®¹',\n    isCore: true,\n    group: 'å†…å®¹',\n    example: 'å½“å‰æ¸©åº¦: 25Â°C'\n  }),\n\n  // æ•°å€¼ç›¸å…³\n  value: createProperty('value', 'æ•°å€¼', 'number', {\n    description: 'ç»„ä»¶çš„æ•°å€¼æ•°æ®',\n    isCore: true,\n    group: 'æ•°æ®',\n    example: 25.6\n  }),\n\n  count: createProperty('count', 'è®¡æ•°', 'number', {\n    description: 'è®¡æ•°å™¨æ•°å€¼',\n    isCore: true,\n    group: 'æ•°æ®',\n    example: 100\n  }),\n\n  // çŠ¶æ€ç›¸å…³\n  status: createProperty('status', 'çŠ¶æ€', 'string', {\n    description: 'ç»„ä»¶çš„å½“å‰çŠ¶æ€',\n    isCore: true,\n    group: 'çŠ¶æ€',\n    enum: [\n      { label: 'æ­£å¸¸', value: 'normal' },\n      { label: 'è­¦å‘Š', value: 'warning' },\n      { label: 'é”™è¯¯', value: 'error' },\n      { label: 'ç¦»çº¿', value: 'offline' }\n    ],\n    example: 'normal'\n  }),\n\n  isOnline: createProperty('isOnline', 'åœ¨çº¿çŠ¶æ€', 'boolean', {\n    description: 'è®¾å¤‡æ˜¯å¦åœ¨çº¿',\n    isCore: true,\n    group: 'çŠ¶æ€',\n    example: true\n  }),\n\n  // æ ·å¼ç›¸å…³\n  backgroundColor: createProperty('backgroundColor', 'èƒŒæ™¯è‰²', 'color', {\n    description: 'ç»„ä»¶èƒŒæ™¯é¢œè‰²',\n    group: 'æ ·å¼',\n    example: '#ffffff'\n  }),\n\n  textColor: createProperty('textColor', 'æ–‡å­—é¢œè‰²', 'color', {\n    description: 'æ–‡å­—é¢œè‰²',\n    group: 'æ ·å¼',\n    example: '#333333'\n  }),\n\n  // ğŸ”¥ å¯è§æ€§å±æ€§ - æ”¯æŒé€šè¿‡å±æ€§ä¿®æ”¹æ§åˆ¶æ˜¾ç¤º/éšè—\n  visibility: createProperty('visibility', 'å¯è§æ€§', 'string', {\n    description: 'æ§åˆ¶ç»„ä»¶çš„æ˜¾ç¤ºæˆ–éšè—',\n    isCore: true,\n    group: 'æ ·å¼',\n    enum: [\n      { label: 'æ˜¾ç¤º', value: 'visible' },\n      { label: 'éšè—', value: 'hidden' }\n    ],\n    example: 'visible',\n    defaultValue: 'visible'\n  }),\n\n  // æ—¶é—´ç›¸å…³\n  timestamp: createProperty('timestamp', 'æ—¶é—´æˆ³', 'date', {\n    description: 'æ•°æ®æ›´æ–°æ—¶é—´',\n    group: 'æ—¶é—´',\n    example: new Date()\n  }),\n\n  lastUpdateTime: createProperty('lastUpdateTime', 'æœ€åæ›´æ–°æ—¶é—´', 'date', {\n    description: 'æœ€åä¸€æ¬¡æ›´æ–°çš„æ—¶é—´',\n    group: 'æ—¶é—´',\n    example: new Date()\n  })\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\registry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\test-data-source-mapper.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'registered' is assigned a value but never used.","line":66,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'registered' is assigned a value but never used.","line":66,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":66,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'definition' is assigned a value but never used.","line":67,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":67,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'definition' is assigned a value but never used.","line":67,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'dataSourceKeys' is assigned a value but never used.","line":68,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":68,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dataSourceKeys' is assigned a value but never used.","line":68,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'staticParamKeys' is assigned a value but never used.","line":69,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":69,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'staticParamKeys' is assigned a value but never used.","line":69,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'result1' is assigned a value but never used.","line":82,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result1' is assigned a value but never used.","line":82,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":82,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'result2' is assigned a value but never used.","line":91,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":91,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result2' is assigned a value but never used.","line":91,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'result3' is assigned a value but never used.","line":93,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":93,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result3' is assigned a value but never used.","line":93,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'result4' is assigned a value but never used.","line":95,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result4' is assigned a value but never used.","line":95,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":95,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'validation1' is assigned a value but never used.","line":108,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":108,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validation1' is assigned a value but never used.","line":108,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'validation2' is assigned a value but never used.","line":115,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":115,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validation2' is assigned a value but never used.","line":115,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":115,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'validation3' is assigned a value but never used.","line":123,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":123,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validation3' is assigned a value but never used.","line":123,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":123,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'stats' is assigned a value but never used.","line":136,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":136,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'stats' is assigned a value but never used.","line":136,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":136,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'registryStats' is assigned a value but never used.","line":138,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":138,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'registryStats' is assigned a value but never used.","line":138,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":138,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'result1' is assigned a value but never used.","line":151,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":151,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result1' is assigned a value but never used.","line":151,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":151,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'result2' is assigned a value but never used.","line":158,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":158,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result2' is assigned a value but never used.","line":158,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":158,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'result3' is assigned a value but never used.","line":160,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":160,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result3' is assigned a value but never used.","line":160,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":160,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'avgTime' is assigned a value but never used.","line":180,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":180,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'avgTime' is assigned a value but never used.","line":180,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":180,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":34,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * æ•°æ®æºæ˜ å°„å™¨æµ‹è¯•æ–‡ä»¶\n * ç”¨äºéªŒè¯é€šç”¨æ•°æ®æºæ˜ å°„ç³»ç»Ÿçš„åŠŸèƒ½\n */\n\nimport { ComponentRegistry } from './component-registry'\nimport { DataSourceMapper } from './data-source-mapper'\nimport type { ComponentDefinition } from './types'\n\n/**\n * æµ‹è¯•æ•°æ®æºæ˜ å°„å™¨åŠŸèƒ½\n */\nexport function testDataSourceMapper(): void {\n  // 1. æµ‹è¯•ç»„ä»¶æ³¨å†Œ\n  testComponentRegistration()\n\n  // 2. æµ‹è¯•æ•°æ®æºæ˜ å°„\n  testDataSourceMapping()\n\n  // 3. æµ‹è¯•éªŒè¯åŠŸèƒ½\n  testMappingValidation()\n\n  // 4. æµ‹è¯•ç»Ÿè®¡åŠŸèƒ½\n  testMappingStats()\n}\n\n/**\n * æµ‹è¯•ç»„ä»¶æ³¨å†ŒåŠŸèƒ½\n */\nfunction testComponentRegistration(): void {\n  // åˆ›å»ºæµ‹è¯•ç»„ä»¶å®šä¹‰\n  const testComponentDefinition: ComponentDefinition = {\n    type: 'test-component',\n    name: 'æµ‹è¯•ç»„ä»¶',\n    description: 'ç”¨äºæµ‹è¯•çš„ç»„ä»¶',\n    dataSources: {\n      dataSource1: {\n        type: 'api',\n        name: 'æ•°æ®æº1',\n        required: true\n      },\n      dataSource2: {\n        type: 'static',\n        name: 'æ•°æ®æº2',\n        required: false\n      }\n    },\n    staticParams: {\n      title: {\n        type: 'string',\n        name: 'æ ‡é¢˜',\n        default: 'é»˜è®¤æ ‡é¢˜'\n      },\n      count: {\n        type: 'number',\n        name: 'æ•°é‡',\n        default: 10\n      }\n    }\n  }\n\n  // æ³¨å†Œç»„ä»¶\n  ComponentRegistry.register(testComponentDefinition)\n\n  // éªŒè¯æ³¨å†Œç»“æœ\n  const registered = ComponentRegistry.has('test-component')\n  const definition = ComponentRegistry.get('test-component')\n  const dataSourceKeys = ComponentRegistry.getDataSourceKeys('test-component')\n  const staticParamKeys = ComponentRegistry.getStaticParamKeys('test-component')\n}\n\n/**\n * æµ‹è¯•æ•°æ®æºæ˜ å°„åŠŸèƒ½\n */\nfunction testDataSourceMapping(): void {\n  // æµ‹è¯•åœºæ™¯1: ç›´æ¥æ•°æ®æºæ ¼å¼\n  const executorData1 = {\n    dataSource1: { value: 100, label: 'æ•°æ®1' },\n    dataSource2: { value: 200, label: 'æ•°æ®2' }\n  }\n\n  const result1 = DataSourceMapper.mapDataSources('test-component', executorData1)\n  // æµ‹è¯•åœºæ™¯2: mainå­—æ®µæ ¼å¼\n  const executorData2 = {\n    main: {\n      dataSource1: { value: 300, label: 'æ•°æ®3' },\n      dataSource2: { value: 400, label: 'æ•°æ®4' }\n    }\n  }\n\n  const result2 = DataSourceMapper.mapDataSources('test-component', executorData2)\n  // æµ‹è¯•åœºæ™¯3: ç©ºæ•°æ®\n  const result3 = DataSourceMapper.mapDataSources('test-component', null)\n  // æµ‹è¯•åœºæ™¯4: æœªæ³¨å†Œç»„ä»¶\n  const result4 = DataSourceMapper.mapDataSources('unknown-component', executorData1)\n}\n\n/**\n * æµ‹è¯•æ˜ å°„éªŒè¯åŠŸèƒ½\n */\nfunction testMappingValidation(): void {\n  // æµ‹è¯•æœ‰æ•ˆæ˜ å°„\n  const validMapping = {\n    dataSource1: { value: 100 },\n    dataSource2: { value: 200 }\n  }\n\n  const validation1 = DataSourceMapper.validateMapping('test-component', validMapping)\n  // æµ‹è¯•æ— æ•ˆæ˜ å°„ï¼ˆç¼ºå°‘æ•°æ®æºï¼‰\n  const invalidMapping = {\n    dataSource1: { value: 100 }\n    // ç¼ºå°‘ dataSource2\n  }\n\n  const validation2 = DataSourceMapper.validateMapping('test-component', invalidMapping)\n  // æµ‹è¯•é¢å¤–å­—æ®µæ˜ å°„\n  const extraMapping = {\n    dataSource1: { value: 100 },\n    dataSource2: { value: 200 },\n    extraField: { value: 300 }\n  }\n\n  const validation3 = DataSourceMapper.validateMapping('test-component', extraMapping)\n}\n\n/**\n * æµ‹è¯•æ˜ å°„ç»Ÿè®¡åŠŸèƒ½\n */\nfunction testMappingStats(): void {\n  const executorData = {\n    dataSource1: { value: 100 },\n    dataSource2: { value: 200 },\n    extraData: { value: 300 }\n  }\n\n  const stats = DataSourceMapper.getMappingStats('test-component', executorData)\n  // æµ‹è¯•ç»„ä»¶æ³¨å†Œè¡¨ç»Ÿè®¡\n  const registryStats = ComponentRegistry.getStats()\n}\n\n/**\n * æµ‹è¯•é™æ€å‚æ•°æ˜ å°„åŠŸèƒ½\n */\nfunction testStaticParamMapping(): void {\n  // æµ‹è¯•å®Œæ•´é™æ€å‚æ•°\n  const staticParams1 = {\n    title: 'è‡ªå®šä¹‰æ ‡é¢˜',\n    count: 20\n  }\n\n  const result1 = DataSourceMapper.mapStaticParams('test-component', staticParams1)\n  // æµ‹è¯•éƒ¨åˆ†é™æ€å‚æ•°\n  const staticParams2 = {\n    title: 'éƒ¨åˆ†æ ‡é¢˜'\n    // ç¼ºå°‘ count\n  }\n\n  const result2 = DataSourceMapper.mapStaticParams('test-component', staticParams2)\n  // æµ‹è¯•ç©ºé™æ€å‚æ•°\n  const result3 = DataSourceMapper.mapStaticParams('test-component', null)\n}\n\n/**\n * æ€§èƒ½æµ‹è¯•\n */\nfunction performanceTest(): void {\n  const executorData = {\n    dataSource1: { value: 100, data: new Array(1000).fill(0).map((_, i) => ({ id: i, value: Math.random() })) },\n    dataSource2: { value: 200, data: new Array(1000).fill(0).map((_, i) => ({ id: i, value: Math.random() })) }\n  }\n\n  const iterations = 1000\n  const startTime = performance.now()\n\n  for (let i = 0; i < iterations; i++) {\n    DataSourceMapper.mapDataSources('test-component', executorData)\n  }\n\n  const endTime = performance.now()\n  const avgTime = (endTime - startTime) / iterations\n}\n\n/**\n * æ¸…ç†æµ‹è¯•æ•°æ®\n */\nfunction cleanup(): void {\n  // æ³¨æ„ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸è¦æ¸…ç†æ³¨å†Œè¡¨\n  // ComponentRegistry.clear()\n}\n\n// å¦‚æœç›´æ¥è¿è¡Œæ­¤æ–‡ä»¶ï¼Œæ‰§è¡Œæµ‹è¯•\nif (typeof window !== 'undefined' && (window as any).__TEST_DATA_SOURCE_MAPPER__) {\n  testDataSourceMapper()\n}\n\n// å¯¼å‡ºæµ‹è¯•å‡½æ•°\nexport {\n  testComponentRegistration,\n  testDataSourceMapping,\n  testMappingValidation,\n  testMappingStats,\n  testStaticParamMapping,\n  performanceTest,\n  cleanup\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\core\\types.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":92,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'definition' is defined but never used.","line":92,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":93,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":93,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":95,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":95,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card2.1 æ ¸å¿ƒç±»å‹å®šä¹‰\n * ç®€æ´æ˜äº†çš„ç±»å‹ç³»ç»Ÿ\n */\n\nimport type { Component } from 'vue'\nimport type { ComponentInteractionDefinition } from './interaction-types'\n\n// æƒé™ç±»å‹å®šä¹‰\nexport type ComponentPermission = 'ä¸é™' | 'TENANT_ADMIN' | 'TENANT_USER' | 'SYS_ADMIN'\n\n/**\n * æŒ‡æ ‡é¡¹ç±»å‹å®šä¹‰\n * ç”¨äºå­˜å‚¨ä»è®¾å¤‡æ¨¡æ¿é…ç½®çš„æŒ‡æ ‡ä¿¡æ¯\n */\nexport interface MetricItem {\n  /** æŒ‡æ ‡å”¯ä¸€ID */\n  id: string\n  /** æŒ‡æ ‡åç§° */\n  name: string\n  /** æŒ‡æ ‡å­—æ®µé”® */\n  key: string\n  /** æŒ‡æ ‡å•ä½ */\n  unit?: string\n  /** æŒ‡æ ‡æè¿° */\n  description?: string\n  /** æ•°æ®ç±»å‹ */\n  dataType?: 'number' | 'string' | 'boolean' | 'object'\n}\n\nexport interface ComponentDefinition {\n  type: string\n  name: string\n  description: string\n  category: string\n  subCategory?: string // å­åˆ†ç±»ï¼Œç”¨äºæ›´ç»†ç²’åº¦çš„åˆ†ç»„\n  mainCategory?: string // ä¸»åˆ†ç±»ï¼šç³»ç»Ÿã€æ›²çº¿\n  icon: string // æ”¹ä¸ºstringç±»å‹ï¼Œç›´æ¥ä½¿ç”¨SVGå­—ç¬¦ä¸²\n  component: Component\n  configComponent?: Component\n  config?: Record<string, any> // ç»„ä»¶é…ç½®\n  tags?: string[] // ç»„ä»¶æ ‡ç­¾\n  version?: string // ç»„ä»¶ç‰ˆæœ¬\n  author?: string // ç»„ä»¶ä½œè€…\n  permission?: ComponentPermission // æƒé™å­—æ®µï¼šä¸é™ã€TENANT_ADMINã€TENANT_USERã€SYS_ADMIN\n  isRegistered?: boolean // æ˜¯å¦æ³¨å†Œå­—æ®µï¼štrue-æ³¨å†Œï¼Œfalse-ä¸æ³¨å†Œï¼Œé»˜è®¤true\n  supportedDataSources?: string[] // æ”¯æŒçš„æ•°æ®æºç±»å‹\n  examples?: Array<{\n    name: string\n    description: string\n    config: Record<string, any>\n  }> // ç¤ºä¾‹é…ç½®\n  documentation?: Record<string, any> // æ–‡æ¡£ä¿¡æ¯\n  properties?: Record<\n    string,\n    {\n      type: string\n      default: any\n      description: string\n      label?: string\n      placeholder?: string\n      min?: number\n      max?: number\n      step?: number\n      options?: Array<{ label: string; value: any }>\n    }\n  >\n\n  // ============ é€šç”¨å±æ€§ - æ‰€æœ‰æ–°ç»„ä»¶å¿…é¡»åŒ…å« ============\n\n  /** è®¾å¤‡ID - ç”¨äºè®¾å¤‡å…³è”å’Œæ¨¡æ¿é…ç½® (æ–°ç»„ä»¶å¿…å¡«ï¼Œç°æœ‰ç»„ä»¶å…¼å®¹) */\n  deviceId?: string\n\n  /** æŒ‡æ ‡åˆ—è¡¨ - å­˜å‚¨ä»æ¨¡æ¿é…ç½®çš„æŒ‡æ ‡ä¿¡æ¯ (æ–°ç»„ä»¶å¿…å¡«ï¼Œç°æœ‰ç»„ä»¶å…¼å®¹) */\n  metricsList?: MetricItem[]\n\n  // ============ é…ç½®é©±åŠ¨çš„åŠ¨æ€æ•°æ®æºé‡æ„æ–°å¢å­—æ®µ ============\n\n  /** é™æ€å‚æ•°éœ€æ±‚å£°æ˜ */\n  staticParams?: StaticParamRequirement[]\n\n  /** æ•°æ®æºéœ€æ±‚å£°æ˜ */\n  dataSources?: DataSourceRequirement[]\n\n  // ============ äº¤äº’ç³»ç»Ÿé…ç½® ============\n\n  /** äº¤äº’èƒ½åŠ›å®šä¹‰ */\n  interaction?: ComponentInteractionDefinition\n}\n\nexport interface IComponentRegistry {\n  register(id: string, definition: ComponentDefinition): void\n  get(id: string): ComponentDefinition | undefined\n  getAll(): ComponentDefinition[]\n  has(id: string): boolean\n}\n\nexport type IConfigComponent = Component\n\n// ä¿æŒå‘åå…¼å®¹\n// ============ é…ç½®é©±åŠ¨çš„åŠ¨æ€æ•°æ®æºé‡æ„æ–°å¢ç±»å‹ ============\n\n/**\n * é™æ€å‚æ•°éœ€æ±‚å®šä¹‰\n * ç”¨äºå£°æ˜ç»„ä»¶éœ€è¦çš„é™æ€é…ç½®å‚æ•°\n */\nexport interface StaticParamRequirement {\n  /** å‚æ•°å”¯ä¸€æ ‡è¯† */\n  key: string\n  /** å‚æ•°åç§° */\n  name: string\n  /** å‚æ•°ç±»å‹ */\n  type: 'string' | 'number' | 'boolean' | 'object' | 'array'\n  /** å‚æ•°æè¿° */\n  description: string\n  /** é»˜è®¤å€¼ */\n  defaultValue?: any\n  /** æ˜¯å¦å¿…å¡« */\n  required?: boolean\n  /** å‚æ•°éªŒè¯è§„åˆ™ */\n  validation?: {\n    min?: number\n    max?: number\n    pattern?: string\n    options?: Array<{ label: string; value: any }>\n  }\n  /** UI æ¸²æŸ“æç¤º */\n  ui?: {\n    component?: 'input' | 'select' | 'number' | 'switch' | 'textarea' | 'color' | 'slider'\n    placeholder?: string\n    label?: string\n    group?: string\n  }\n}\n\n/**\n * æ•°æ®æºéœ€æ±‚å®šä¹‰\n * ç”¨äºå£°æ˜ç»„ä»¶éœ€è¦çš„åŠ¨æ€æ•°æ®æº\n */\nexport interface DataSourceRequirement {\n  /** æ•°æ®æºå”¯ä¸€æ ‡è¯† */\n  key: string\n  /** æ•°æ®æºåç§° */\n  name: string\n  /** æ•°æ®æºæè¿° */\n  description: string\n  /** æ”¯æŒçš„æ•°æ®æºç±»å‹ */\n  supportedTypes: Array<'static' | 'api' | 'websocket' | 'mqtt' | 'database'>\n  /** å­—æ®µæ˜ å°„è§„åˆ™ */\n  fieldMappings: Record<\n    string,\n    {\n      /** ç›®æ ‡å­—æ®µå */\n      targetField: string\n      /** å­—æ®µç±»å‹ */\n      type: 'value' | 'object' | 'array'\n      /** æ˜¯å¦å¿…å¡« */\n      required: boolean\n      /** é»˜è®¤å€¼ */\n      defaultValue?: any\n      /** æ•°æ®è½¬æ¢å‡½æ•° */\n      transform?: string // å‡½æ•°å­—ç¬¦ä¸²ï¼Œç”¨äºåºåˆ—åŒ–\n    }\n  >\n  /** æ˜¯å¦å¿…å¡« */\n  required?: boolean\n}\n\n/**\n * æ•°æ®æºä¿¡æ¯æ¥å£\n * æ•°æ®æºä¸­å¿ƒçš„æ ‡å‡†å¥‘çº¦\n */\nexport interface DataSourceInfo {\n  /** æ•°æ®æºå”¯ä¸€ID */\n  id: string\n  /** æ•°æ®æºåç§° */\n  name: string\n  /** æ•°æ®æºç±»å‹ */\n  type: 'static' | 'api' | 'websocket' | 'mqtt' | 'database'\n  /** æ•°æ®æºæè¿° */\n  description?: string\n  /** æ•°æ®æºçŠ¶æ€ */\n  status: 'active' | 'inactive' | 'error'\n  /** æ•°æ®ç»“æ„ç¤ºä¾‹ */\n  schema?: Record<string, any>\n  /** é…ç½®ä¿¡æ¯ */\n  config?: Record<string, any>\n  /** æœ€åæ›´æ–°æ—¶é—´ */\n  lastUpdated?: Date\n}\n\n/**\n * ç»„ä»¶é…ç½®ç»“æ„\n * ç”¨äºå­˜å‚¨ç»„ä»¶çš„å®Œæ•´é…ç½®ä¿¡æ¯\n */\nexport interface WidgetConfiguration {\n  /** é™æ€å‚æ•°é…ç½® */\n  staticParams: Record<string, any>\n  /** æ•°æ®æºç»‘å®šé…ç½® */\n  dataSourceBindings: Record<\n    string,\n    {\n      /** ç»‘å®šçš„æ•°æ®æºID */\n      dataSourceId: string\n      /** å­—æ®µæ˜ å°„é…ç½® */\n      fieldMappings: Record<string, string>\n    }\n  >\n  /** é…ç½®å…ƒæ•°æ® */\n  metadata?: {\n    version: string\n    createdAt: Date\n    updatedAt: Date\n  }\n}\n\nexport interface IComponentDefinition extends ComponentDefinition {\n  id: string\n  meta: {\n    name: string\n    title: string\n    description: string\n    category: string\n    icon?: string\n    version: string\n    poster?: string\n  }\n  defaultSize: {\n    width: number\n    height: number\n  }\n  minSize?: {\n    width: number\n    height: number\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\debug.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\hooks\\use-interaction.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\hooks\\useComponentTree.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ComponentCategory' is defined but never used.","line":14,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ComponentCategory' is defined but never used.","line":14,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'component' is defined but never used.","line":18,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card 2.1 ç»„ä»¶æ ‘å½¢ç»“æ„ Hook\n * æä¾›ç»„ä»¶åˆ†ç±»ã€ç­›é€‰å’Œæ ‘å½¢ç»“æ„ç”ŸæˆåŠŸèƒ½\n */\n\nimport { ref, computed, onMounted, shallowRef, readonly } from 'vue'\nimport {\n  initializeCard2System,\n  getComponentTree,\n  getComponentsByCategory as getComponentsByCategoryFromIndex,\n  getCategories\n} from '../index'\nimport type { ComponentDefinition } from '../core/types'\nimport type { ComponentTree, ComponentCategory } from '../core/auto-registry'\n\nexport interface ComponentTreeOptions {\n  autoInit?: boolean\n  filter?: (component: ComponentDefinition) => boolean\n  sortBy?: 'name' | 'type' | 'category'\n  sortOrder?: 'asc' | 'desc'\n}\n\nexport interface FilteredComponentTree extends ComponentTree {\n  filteredComponents: ComponentDefinition[]\n  appliedFilters: {\n    search?: string\n    mainCategory?: string\n    subCategory?: string\n  }\n}\n\nexport function useComponentTree(options: ComponentTreeOptions = {}) {\n  const { autoInit = true, filter, sortBy = 'name', sortOrder = 'asc' } = options\n\n  // çŠ¶æ€ç®¡ç†\n  const isLoading = ref(false)\n  const error = ref<string | null>(null)\n  const componentTree = shallowRef<ComponentTree>({ categories: [], components: [], totalCount: 0 })\n\n  // ç­›é€‰çŠ¶æ€\n  const searchQuery = ref('')\n  const selectedMainCategory = ref<string>('')\n  const selectedSubCategory = ref<string>('')\n\n  /**\n   * åˆå§‹åŒ–ç»„ä»¶æ ‘\n   */\n  const initialize = async () => {\n    if (isLoading.value) return\n\n    isLoading.value = true\n    error.value = null\n\n    try {\n      await initializeCard2System()\n      const tree = getComponentTree()\n      componentTree.value = tree\n    } catch (err) {\n      error.value = err instanceof Error ? err.message : 'åˆå§‹åŒ–å¤±è´¥'\n    } finally {\n      isLoading.value = false\n    }\n  }\n\n  /**\n   * ç­›é€‰ç»„ä»¶\n   */\n  const filteredComponents = computed(() => {\n    let components = componentTree.value.components\n\n    // åº”ç”¨è‡ªå®šä¹‰ç­›é€‰å™¨\n    if (filter) {\n      components = components.filter(filter)\n    }\n\n    // åº”ç”¨æœç´¢ç­›é€‰\n    if (searchQuery.value) {\n      const query = searchQuery.value.toLowerCase()\n      components = components.filter(\n        comp =>\n          comp.name.toLowerCase().includes(query) ||\n          comp.description.toLowerCase().includes(query) ||\n          comp.type.toLowerCase().includes(query)\n      )\n    }\n\n    // åº”ç”¨åˆ†ç±»ç­›é€‰\n    if (selectedMainCategory.value) {\n      components = components.filter(comp => comp.mainCategory === selectedMainCategory.value)\n    }\n\n    if (selectedSubCategory.value) {\n      components = components.filter(comp => comp.subCategory === selectedSubCategory.value)\n    }\n\n    // æ’åº\n    components.sort((a, b) => {\n      let aValue: string\n      let bValue: string\n\n      switch (sortBy) {\n        case 'name':\n          aValue = a.name\n          bValue = b.name\n          break\n        case 'type':\n          aValue = a.type\n          bValue = b.type\n          break\n        case 'category':\n          aValue = a.mainCategory || ''\n          bValue = b.mainCategory || ''\n          break\n        default:\n          aValue = a.name\n          bValue = b.name\n      }\n\n      const comparison = aValue.localeCompare(bValue)\n      return sortOrder === 'asc' ? comparison : -comparison\n    })\n\n    return components\n  })\n\n  /**\n   * è·å–ç­›é€‰åçš„ç»„ä»¶æ ‘\n   */\n  const getFilteredTree = computed((): FilteredComponentTree => {\n    return {\n      ...componentTree.value,\n      filteredComponents: filteredComponents.value,\n      appliedFilters: {\n        search: searchQuery.value || undefined,\n        mainCategory: selectedMainCategory.value || undefined,\n        subCategory: selectedSubCategory.value || undefined\n      }\n    }\n  })\n\n  /**\n   * æŒ‰åˆ†ç±»è·å–ç»„ä»¶\n   */\n  const getComponentsByCategory = (mainCategory?: string, subCategory?: string) => {\n    return getComponentsByCategoryFromIndex(mainCategory, subCategory)\n  }\n\n  /**\n   * è·å–æ‰€æœ‰åˆ†ç±»\n   */\n  const categories = computed(() => getCategories())\n\n  /**\n   * è·å–å¯ç”¨çš„ä¸»åˆ†ç±»\n   */\n  const availableMainCategories = computed(() => {\n    const categories = new Set<string>()\n    componentTree.value.components.forEach(comp => {\n      if (comp.mainCategory) {\n        categories.add(comp.mainCategory)\n      }\n    })\n    return Array.from(categories).sort()\n  })\n\n  /**\n   * è·å–å¯ç”¨çš„å­åˆ†ç±»\n   */\n  const availableSubCategories = computed(() => {\n    const categories = new Set<string>()\n    componentTree.value.components.forEach(comp => {\n      if (comp.subCategory && (!selectedMainCategory.value || comp.mainCategory === selectedMainCategory.value)) {\n        categories.add(comp.subCategory)\n      }\n    })\n    return Array.from(categories).sort()\n  })\n\n  /**\n   * æ¸…é™¤ç­›é€‰æ¡ä»¶\n   */\n  const clearFilters = () => {\n    searchQuery.value = ''\n    selectedMainCategory.value = ''\n    selectedSubCategory.value = ''\n  }\n\n  /**\n   * é‡ç½®åˆ°åˆå§‹çŠ¶æ€\n   */\n  const reset = () => {\n    clearFilters()\n    componentTree.value = { categories: [], components: [], totalCount: 0 }\n    error.value = null\n  }\n\n  // è‡ªåŠ¨åˆå§‹åŒ–\n  if (autoInit) {\n    onMounted(() => {\n      initialize()\n    })\n  }\n\n  return {\n    // çŠ¶æ€\n    isLoading: readonly(isLoading),\n    error: readonly(error),\n    componentTree: readonly(componentTree),\n\n    // ç­›é€‰çŠ¶æ€\n    searchQuery,\n    selectedMainCategory,\n    selectedSubCategory,\n\n    // è®¡ç®—å±æ€§\n    filteredComponents,\n    getFilteredTree,\n    categories,\n    availableMainCategories,\n    availableSubCategories,\n\n    // æ–¹æ³•\n    initialize,\n    getComponentsByCategory,\n    clearFilters,\n    reset\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\hooks\\useVisualEditorIntegration.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'registerUniversalDataVizConfig' is defined but never used.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'registerUniversalDataVizConfig' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":40},{"ruleId":"no-unused-vars","severity":1,"message":"'definition' is defined but never used.","line":16,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":53},{"ruleId":"no-unused-vars","severity":1,"message":"'hasUniversalDataViz' is assigned a value but never used.","line":114,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":114,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasUniversalDataViz' is assigned a value but never used.","line":114,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":114,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card 2.1 Visual Editor é›†æˆ Hook\n * æä¾›ä¸ Visual Editor çš„æ¡¥æ¥åŠŸèƒ½\n */\n\nimport { computed, ref, readonly, onMounted } from 'vue'\nimport { initializeCard2System, getComponentRegistry } from '../index'\nimport { useComponentTree } from './useComponentTree'\nimport type { ComponentDefinition } from '../core/types'\nimport type { WidgetType, WidgetDefinition } from '@/components/visual-editor/types'\nimport { $t } from '@/locales'\nimport { registerUniversalDataVizConfig } from '../components/universal-data-viz/register-config'\n\nexport interface VisualEditorIntegrationOptions {\n  autoInit?: boolean\n  componentFilter?: (definition: ComponentDefinition) => boolean\n  enableI18n?: boolean\n}\n\nexport interface Card2Widget extends WidgetDefinition {\n  definition: ComponentDefinition\n  isCard2Component: true\n}\n\n// ç»„ä»¶IDåˆ°å›½é™…åŒ–é”®çš„æ˜ å°„\nconst COMPONENT_I18N_KEYS: Record<string, string> = {\n  // Display ç±»ç»„ä»¶\n  'version-info': 'card.version',\n  'access-num': 'card.deviceTotal',\n  'alarm-count': 'card.alarmCount',\n  'alarm-info': 'card.alarmInfo',\n  'app-download': 'card.appDownload',\n  'cpu-usage': 'card.cpuUsage',\n  'disk-usage': 'card.diskUsage',\n  'memory-usage': 'card.memoryUsage',\n  information: 'card.information',\n  news: 'card.news',\n  'off-line': 'card.offlineDeviceCount',\n  'on-line': 'card.onlineDeviceCount',\n  'operation-guide-card': 'card.operationGuide',\n  'recently-visited': 'card.recentlyVisited.title',\n  'reported-data': 'card.reportedData.title',\n  'tenant-count': 'card.tenantCount.title',\n\n  // Chart ç±»ç»„ä»¶\n  'online-trend': 'card.onlineTrend',\n  'system-metrics-history': 'card.systemMetricsHistory.title',\n  'tenant-chart': 'card.tenantChart.title',\n  'chart-bar': 'card.barChart',\n  'chart-curve': 'card.curve',\n  'chart-digit': 'card.digitalIndicator',\n\n  // Card 2.1 ç»„ä»¶\n  'digit-indicator': 'card.digitalIndicator',\n  'multi-data-test': 'å¤šæ•°æ®æµ‹è¯•',\n  'bar-chart': 'card.barChart',\n  'universal-data-viz': 'é€šç”¨æ•°æ®å¯è§†åŒ–'\n}\n\nexport function useVisualEditorIntegration(options: VisualEditorIntegrationOptions = {}) {\n  const { autoInit = true, componentFilter = () => true, enableI18n = true } = options\n\n  // ä½¿ç”¨ç»„ä»¶æ ‘ Hook\n  const componentTree = useComponentTree({\n    autoInit,\n    filter: componentFilter\n  })\n\n  // åˆå§‹åŒ–çŠ¶æ€\n  const isInitialized = ref(false)\n  const initializationError = ref<string | null>(null)\n\n  // è‡ªåŠ¨åˆå§‹åŒ–\n  if (autoInit) {\n    onMounted(() => {\n      initialize()\n    })\n  }\n\n  /**\n   * åˆå§‹åŒ–é›†æˆ\n   */\n  const initialize = async () => {\n    if (isInitialized.value) return\n\n    try {\n      await initializeCard2System()\n      await componentTree.initialize()\n\n      // æ³¨æ„ï¼šç»„ä»¶æ•°æ®éœ€æ±‚æ³¨å†Œç°åœ¨ç”± Card2.1 ç³»ç»Ÿç»Ÿä¸€å¤„ç†\n      // registerUniversalDataVizConfig() - å·²ç§»è‡³ Card2.1 ç³»ç»Ÿåˆå§‹åŒ–ä¸­\n\n      isInitialized.value = true\n    } catch (error) {\n      initializationError.value = error instanceof Error ? error.message : 'åˆå§‹åŒ–å¤±è´¥'\n      throw error\n    }\n  }\n\n  /**\n   * å°† Card 2.1 ç»„ä»¶è½¬æ¢ä¸º Visual Editor Widget\n   */\n  const availableWidgets = computed(() => {\n    if (!isInitialized.value) {\n      return []\n    }\n\n    const components = componentTree.filteredComponents.value\n    if (!Array.isArray(components)) {\n      return []\n    }\n\n    // ç‰¹åˆ«æ£€æŸ¥æ˜¯å¦åŒ…å« universal-data-viz\n    const hasUniversalDataViz = components.some(comp => comp.type === 'universal-data-viz')\n    return components.map(definition => {\n      // è·å–æ˜¾ç¤ºåç§°ï¼ˆæ”¯æŒå›½é™…åŒ–ï¼‰\n      let displayName = definition.name\n      if (enableI18n) {\n        const i18nKey = COMPONENT_I18N_KEYS[definition.type]\n        if (i18nKey) {\n          try {\n            displayName = $t(i18nKey as any) || definition.name\n          } catch {\n            // å›½é™…åŒ–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤åç§°\n            displayName = definition.name\n          }\n        }\n      }\n\n      const widget: Card2Widget = {\n        type: definition.type as WidgetType,\n        name: displayName,\n        description: definition.description || '',\n        icon: definition.icon,\n        category: definition.category,\n        version: '2.1.0',\n        source: 'card2' as const,\n        isCard2Component: true as const,\n        definition,\n\n        // âœ… æ·»åŠ  Visual Editor æ‰€éœ€çš„å¸ƒå±€é…ç½®\n        defaultLayout: {\n          canvas: {\n            width: definition.config?.style?.width || 300,\n            height: definition.config?.style?.height || 200\n          },\n          gridstack: {\n            w: Math.ceil((definition.config?.style?.width || 300) / 150), // ç½‘æ ¼å•å…ƒå®½åº¦\n            h: Math.ceil((definition.config?.style?.height || 200) / 150) // ç½‘æ ¼å•å…ƒé«˜åº¦\n          }\n        },\n\n        // âœ… æ·»åŠ é»˜è®¤å±æ€§é…ç½®\n        defaultProperties: definition.config || {},\n\n        // âœ… æ·»åŠ å…ƒæ•°æ®\n        metadata: {\n          isCard2Component: true,\n          card2ComponentId: definition.type,\n          card2Definition: definition,\n          card2Data: null // å°†åœ¨æ•°æ®ç»‘å®šæ—¶å¡«å……\n        }\n      }\n\n      return widget\n    })\n  })\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦ä¸º Card 2.1 ç»„ä»¶\n   */\n  const isCard2Component = (type: string): boolean => {\n    const components = componentTree.filteredComponents.value\n    return Array.isArray(components) && components.some(comp => comp.type === type)\n  }\n\n  /**\n   * è·å–ç»„ä»¶å®šä¹‰ - è¿”å›è½¬æ¢åçš„ WidgetDefinition\n   */\n  /**\n   * è·å–ç»„ä»¶å®ä¾‹\n   */\n  const getComponent = (type: string) => {\n    const registry = getComponentRegistry()\n    const componentDef = registry.get(type)\n    return componentDef ? componentDef.component : null\n  }\n\n  const getComponentDefinition = (type: string): Card2Widget | undefined => {\n    // âœ… ä¿®å¤ï¼šä»è½¬æ¢åçš„ availableWidgets ä¸­æŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯åŸå§‹çš„ componentTree\n    return availableWidgets.value.find(widget => widget.type === type)\n  }\n\n  /**\n   * æŒ‰åˆ†ç±»è·å–ç»„ä»¶\n   */\n  const getWidgetsByCategory = (mainCategory?: string, subCategory?: string) => {\n    const components = componentTree.getComponentsByCategory(mainCategory, subCategory)\n    if (!Array.isArray(components)) return []\n\n    return components.map(definition => {\n      const i18nKey = COMPONENT_I18N_KEYS[definition.type]\n      const displayName = enableI18n && i18nKey ? $t(i18nKey as any) : definition.name\n\n      return {\n        type: definition.type as WidgetType,\n        name: displayName,\n        description: definition.description || '',\n        icon: definition.icon,\n        category: definition.category,\n        version: '2.1.0',\n        source: 'card2' as const,\n        isCard2Component: true as const,\n        definition\n      } as Card2Widget\n    })\n  }\n\n  /**\n   * æœç´¢ç»„ä»¶\n   */\n  const searchWidgets = (query: string) => {\n    componentTree.searchQuery.value = query\n    return availableWidgets.value\n  }\n\n  /**\n   * è·å–ç»„ä»¶ç»Ÿè®¡ä¿¡æ¯\n   */\n  const getStats = computed(() => {\n    const components = componentTree.filteredComponents.value\n    const stats = {\n      total: Array.isArray(components) ? components.length : 0,\n      byCategory: {} as Record<string, number>,\n      bySubCategory: {} as Record<string, number>\n    }\n\n    if (Array.isArray(components)) {\n      components.forEach(comp => {\n        // ç»Ÿè®¡ä¸»åˆ†ç±»\n        const mainCat = comp.mainCategory || 'æœªåˆ†ç±»'\n        stats.byCategory[mainCat] = (stats.byCategory[mainCat] || 0) + 1\n\n        // ç»Ÿè®¡å­åˆ†ç±»\n        const subCat = comp.subCategory || 'æœªåˆ†ç±»'\n        stats.bySubCategory[subCat] = (stats.bySubCategory[subCat] || 0) + 1\n      })\n    }\n\n    return stats\n  })\n\n  /**\n   * è·å–é›†æˆçŠ¶æ€\n   */\n  const getStatus = () => {\n    return {\n      isInitialized: isInitialized.value,\n      isLoading: componentTree.isLoading.value,\n      error: componentTree.error.value,\n      componentCount: Array.isArray(componentTree.filteredComponents.value)\n        ? componentTree.filteredComponents.value.length\n        : 0,\n      componentTree: componentTree.componentTree.value\n    }\n  }\n\n  return {\n    // çŠ¶æ€\n    isInitialized: readonly(isInitialized),\n    initializationError: readonly(initializationError),\n    isLoading: componentTree.isLoading,\n    error: componentTree.error,\n\n    // æ•°æ®\n    availableWidgets,\n    componentTree: componentTree.componentTree,\n    filteredComponents: componentTree.filteredComponents,\n    categories: componentTree.categories,\n\n    // æ–¹æ³•\n    initialize,\n    isCard2Component,\n    getComponentDefinition,\n    getComponent,\n    getWidgetsByCategory,\n    searchWidgets,\n    getStats,\n    getStatus,\n\n    // ç­›é€‰æ§åˆ¶\n    searchQuery: componentTree.searchQuery,\n    selectedMainCategory: componentTree.selectedMainCategory,\n    selectedSubCategory: componentTree.selectedSubCategory,\n    clearFilters: componentTree.clearFilters,\n    reset: componentTree.reset\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\hooks\\useWidgetProps.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'reactive' is defined but never used.","line":7,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reactive' is defined but never used.","line":7,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":57,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":57,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":57,"endColumn":25,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1403,1403],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'transformError' is defined but never used.","line":105,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":105,"endColumn":44},{"ruleId":"no-unused-vars","severity":1,"message":"'sourceField' is assigned a value but never used.","line":136,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":136,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sourceField' is assigned a value but never used.","line":136,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":136,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":180,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":180,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":180,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":180,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5185,5185],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * useWidgetProps Hook\n * é…ç½®é©±åŠ¨çš„åŠ¨æ€æ•°æ®æºé‡æ„æ–¹æ¡ˆçš„æ ¸å¿ƒHook\n * è¿æ¥\"é…ç½®\"å’Œ\"ç»„ä»¶æ¸²æŸ“\"çš„å”¯ä¸€æ¡¥æ¢\n */\n\nimport { ref, onUnmounted, watch, reactive } from 'vue'\nimport type { Ref } from 'vue'\nimport type { ComponentDefinition, WidgetConfiguration } from '../core/types'\nimport { dataSourceCenter } from '../core/data-sources'\nimport type { DataSourceSubscription } from '../core/data-source-center'\n\n// Hook çš„è¿”å›å€¼ç»“æ„\nexport interface UseWidgetPropsReturn {\n  /** ä¼ é€’ç»™ç»„ä»¶çš„æœ€ç»ˆprops */\n  props: Ref<Record<string, any>>\n  /** æ˜¯å¦æ­£åœ¨åŠ è½½æ•°æ® */\n  isLoading: Ref<boolean>\n  /** åŠ è½½æˆ–è®¢é˜…è¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯ */\n  error: Ref<Error | null>\n  /** æ‰‹åŠ¨åˆ·æ–°æ•°æ® */\n  refresh: () => Promise<void>\n}\n\n/**\n * useWidgetProps Hook\n * @param definition ç»„ä»¶å®šä¹‰ï¼ˆå“åº”å¼ï¼‰\n * @param configuration ç»„ä»¶é…ç½®ï¼ˆå“åº”å¼ï¼‰\n * @returns Hookè¿”å›å€¼\n */\nexport function useWidgetProps(\n  definition: Ref<ComponentDefinition>,\n  configuration: Ref<WidgetConfiguration>\n): UseWidgetPropsReturn {\n  // çŠ¶æ€åˆå§‹åŒ–\n  const props = ref<Record<string, any>>({})\n  const isLoading = ref(true)\n  const error = ref<Error | null>(null)\n\n  // ç”¨äºå­˜å‚¨æ‰€æœ‰æ•°æ®æºçš„å–æ¶ˆè®¢é˜…å‡½æ•°\n  const subscriptions: DataSourceSubscription[] = []\n\n  /**\n   * æ•°æ®å¤„ç†å‡½æ•°\n   * è´Ÿè´£æ‰€æœ‰çš„æ•°æ®è§£æå’Œè®¢é˜…é€»è¾‘\n   */\n  const resolveProps = async (): Promise<void> => {\n    try {\n      // æ¸…ç©ºæ—§çŠ¶æ€\n      isLoading.value = true\n      error.value = null\n\n      // å–æ¶ˆæ‰€æœ‰æ—§çš„è®¢é˜…\n      subscriptions.forEach(subscription => {\n        try {\n          subscription.unsubscribe()\n        } catch (err) {}\n      })\n      subscriptions.length = 0 // æ¸…ç©ºæ•°ç»„\n\n      const newProps: Record<string, any> = {}\n\n      // 1. å¤„ç†é™æ€å‚æ•°ï¼ˆåŒæ­¥ï¼‰\n      const staticParams = definition.value.staticParams || []\n      for (const param of staticParams) {\n        const configValue = configuration.value.staticParams[param.key]\n        newProps[param.key] = configValue !== undefined ? configValue : param.defaultValue\n      }\n\n      // 2. å¤„ç†åŠ¨æ€æ•°æ®æºï¼ˆå¼‚æ­¥ï¼‰\n      const dataSources = definition.value.dataSources || []\n      const dataSourcePromises: Promise<void>[] = []\n\n      for (const dataSourceDef of dataSources) {\n        const bindingConfig = configuration.value.dataSourceBindings[dataSourceDef.key]\n\n        if (bindingConfig && bindingConfig.dataSourceId) {\n          const promise = new Promise<void>((resolve, reject) => {\n            const dataSource = dataSourceCenter.getDataSource(bindingConfig.dataSourceId)\n\n            if (!dataSource) {\n              // ä½¿ç”¨é»˜è®¤å€¼è€Œä¸æ˜¯æŠ¥é”™\n              for (const [sourceField, mapping] of Object.entries(dataSourceDef.fieldMappings)) {\n                const targetField = bindingConfig.fieldMappings[sourceField] || mapping.targetField\n                newProps[targetField] = mapping.defaultValue\n              }\n              resolve()\n              return\n            }\n\n            // è®¢é˜…æ•°æ®æº\n            const subscription = dataSource.subscribe(data => {\n              try {\n                // æ‰§è¡Œå­—æ®µæ˜ å°„è½¬æ¢\n                for (const [sourceField, mapping] of Object.entries(dataSourceDef.fieldMappings)) {\n                  const targetField = bindingConfig.fieldMappings[sourceField] || mapping.targetField\n                  let value = data[sourceField]\n\n                  // åº”ç”¨æ•°æ®è½¬æ¢\n                  if (mapping.transform && value !== undefined) {\n                    try {\n                      // ç®€å•çš„å‡½æ•°å­—ç¬¦ä¸²æ‰§è¡Œï¼ˆç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹å¼ï¼‰\n                      const transformFunc = new Function('value', `return ${mapping.transform}`)\n                      value = transformFunc(value)\n                    } catch (transformError) {\n                      value = mapping.defaultValue\n                    }\n                  }\n\n                  // å¦‚æœå€¼ä¸ºundefinedï¼Œä½¿ç”¨é»˜è®¤å€¼\n                  if (value === undefined) {\n                    value = mapping.defaultValue\n                  }\n\n                  newProps[targetField] = value\n                }\n\n                // æ›´æ–°propsï¼ˆè§¦å‘å“åº”å¼æ›´æ–°ï¼‰\n                props.value = { ...newProps }\n              } catch (mappingError) {\n                error.value = mappingError as Error\n              }\n            })\n\n            if (subscription) {\n              subscriptions.push(subscription)\n              resolve()\n            } else {\n              reject(new Error(`æ•°æ®æºè®¢é˜…å¤±è´¥: ${bindingConfig.dataSourceId}`))\n            }\n          })\n\n          dataSourcePromises.push(promise)\n        } else {\n          // æ²¡æœ‰ç»‘å®šé…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼\n          for (const [sourceField, mapping] of Object.entries(dataSourceDef.fieldMappings)) {\n            newProps[mapping.targetField] = mapping.defaultValue\n          }\n        }\n      }\n\n      // ç­‰å¾…æ‰€æœ‰æ•°æ®æºè®¢é˜…å®Œæˆ\n      await Promise.all(dataSourcePromises)\n\n      // åˆå§‹è®¾ç½®props\n      props.value = newProps\n\n      // åŠ è½½å®Œæˆ\n      isLoading.value = false\n    } catch (err) {\n      error.value = err as Error\n      isLoading.value = false\n    }\n  }\n\n  /**\n   * æ‰‹åŠ¨åˆ·æ–°æ•°æ®\n   */\n  const refresh = async (): Promise<void> => {\n    await resolveProps()\n  }\n\n  // ç›‘å¬é…ç½®å˜åŒ– - ä½¿ç”¨ immediate: true ç¡®ä¿ç»„ä»¶æŒ‚è½½æ—¶ç«‹å³æ‰§è¡Œ\n  watch(\n    [definition, configuration],\n    () => {\n      resolveProps()\n    },\n    {\n      deep: true,\n      immediate: true // ğŸ”‘ å…³é”®ä¿®å¤ï¼šç¡®ä¿åœ¨ç»„ä»¶æŒ‚è½½æ—¶ç«‹å³æ‰§è¡Œï¼Œè§£å†³åˆ·æ–°åæ•°æ®ä¸¢å¤±é—®é¢˜\n    }\n  )\n\n  // æ¸…ç†å‰¯ä½œç”¨\n  onUnmounted(() => {\n    subscriptions.forEach(subscription => {\n      try {\n        subscription.unsubscribe()\n      } catch (err) {}\n    })\n    subscriptions.length = 0\n  })\n\n  return {\n    props,\n    isLoading,\n    error,\n    refresh\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\index.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'stats' is assigned a value but never used.","line":44,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'stats' is assigned a value but never used.","line":44,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'registeredComponents' is assigned a value but never used.","line":47,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'registeredComponents' is assigned a value but never used.","line":47,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":33},{"ruleId":"no-unused-vars","severity":1,"message":"'componentTree' is assigned a value but never used.","line":53,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":53,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'componentTree' is assigned a value but never used.","line":53,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":26},{"ruleId":"no-useless-catch","severity":2,"message":"Unnecessary catch clause.","line":56,"column":7,"nodeType":"CatchClause","messageId":"unnecessaryCatchClause","endLine":58,"endColumn":6}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @file Card 2.1 ç³»ç»Ÿå…¥å£\n * ä½¿ç”¨è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿï¼Œæ”¯æŒç›®å½•æ‰«æå’ŒåŠ¨æ€åŠ è½½\n *\n * ğŸ“š å¼€å‘æ–‡æ¡£ï¼š\n * - README.md - å®Œæ•´å¼€å‘æŒ‡å—\n * - AI_MIGRATION_PROMPT.md - AIè¿ç§»æç¤ºè¯\n * - AI_PROMPT_TEMPLATE.md - ç®€åŒ–æç¤ºè¯æ¨¡æ¿\n * - MIGRATION_TODO.md - è¿ç§»è¿›åº¦è·Ÿè¸ª\n */\n\nimport { componentRegistry } from './core/registry'\nimport { AutoRegistry } from './core/auto-registry'\nimport { ComponentLoader } from './core/component-loader'\nimport { componentDataRequirementsRegistry } from '@/components/visual-editor/core/component-data-requirements'\n\n// åˆ›å»ºè‡ªåŠ¨æ³¨å†Œç³»ç»Ÿ\nconst autoRegistry = new AutoRegistry(componentRegistry)\nconst componentLoader = new ComponentLoader()\n\n// åˆå§‹åŒ–çŠ¶æ€\nlet isInitialized = false\nlet initializationPromise: Promise<void> | null = null\n\n/**\n * åˆå§‹åŒ– Card 2.1 ç³»ç»Ÿ\n * è‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œæ‰€æœ‰ç»„ä»¶\n */\nexport async function initializeCard2System() {\n  if (isInitialized) {\n    return\n  }\n\n  if (initializationPromise) {\n    return initializationPromise\n  }\n\n  initializationPromise = (async () => {\n    try {\n      // 1. åŠ è½½ç»„ä»¶æ¨¡å—\n      const componentModules = await componentLoader.loadComponents()\n\n      // 2. è·å–ç»„ä»¶ç»Ÿè®¡ä¿¡æ¯\n      const stats = componentLoader.getComponentStats(componentModules)\n\n      // 3. è‡ªåŠ¨æ³¨å†Œç»„ä»¶ï¼ˆåŒ…å«æƒé™è¿‡æ»¤ï¼‰\n      const registeredComponents = await autoRegistry.autoRegister(componentModules)\n\n      // 4. æ³¨å†Œé¢„è®¾çš„æ•°æ®éœ€æ±‚\n      componentDataRequirementsRegistry.registerPresets()\n\n      // 6. è·å–ç»„ä»¶æ ‘å½¢ç»“æ„\n      const componentTree = autoRegistry.getComponentTree()\n\n      isInitialized = true\n    } catch (error) {\n      throw error\n    } finally {\n      initializationPromise = null\n    }\n  })()\n\n  return initializationPromise\n}\n\n/**\n * è·å–ç»„ä»¶æ³¨å†Œè¡¨\n */\nexport function getComponentRegistry() {\n  return componentRegistry\n}\n\n/**\n * è·å–ç»„ä»¶æ ‘å½¢ç»“æ„\n */\nexport function getComponentTree() {\n  if (!isInitialized) {\n    return { categories: [], components: [], totalCount: 0 }\n  }\n  return autoRegistry.getComponentTree()\n}\n\n/**\n * æŒ‰åˆ†ç±»è·å–ç»„ä»¶\n */\nexport function getComponentsByCategory(mainCategory?: string, subCategory?: string) {\n  if (!isInitialized) {\n    return []\n  }\n  return autoRegistry.getComponentsByCategory(mainCategory, subCategory)\n}\n\n/**\n * è·å–æ‰€æœ‰åˆ†ç±»\n */\nexport function getCategories() {\n  if (!isInitialized) {\n    return []\n  }\n  return autoRegistry.getCategories()\n}\n\n/**\n * é‡æ–°åº”ç”¨æƒé™è¿‡æ»¤\n * å½“ç”¨æˆ·æƒé™å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨æ­¤å‡½æ•°\n */\nexport function reapplyPermissionFilter() {\n  if (!isInitialized) {\n    return\n  }\n  autoRegistry.reapplyPermissionFilter()\n}\n\n/**\n * è·å–æ‰€æœ‰ç»„ä»¶ï¼ˆåŒ…æ‹¬æ— æƒé™çš„ï¼Œç”¨äºè°ƒè¯•ï¼‰\n */\nexport function getAllComponents() {\n  if (!isInitialized) {\n    return []\n  }\n  return autoRegistry.getAllComponents()\n}\n\n// å¯¼å‡ºæ ¸å¿ƒæ¨¡å—\nexport { componentRegistry }\nexport { AutoRegistry, ComponentLoader }\nexport type { ComponentTree, ComponentCategory } from './core/auto-registry'\n\n// å¯¼å‡ºæƒé™ç›¸å…³å·¥å…·\nexport * from './core/permission-utils'\nexport type { ComponentPermission } from './core/types'\n\n// å¯¼å‡º Hooks\nexport * from './hooks'\n\n// é»˜è®¤å¯¼å‡ºæ³¨å†Œè¡¨ï¼ˆä¿æŒå‘åå…¼å®¹ï¼‰\nexport default componentRegistry\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\integration\\visual-editor-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\types\\interaction-component.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":112,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":112,"endColumn":33},{"ruleId":"no-unused-vars","severity":1,"message":"'state' is defined but never used.","line":112,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":112,"endColumn":67},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":117,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":117,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'eventType' is defined but never used.","line":117,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":117,"endColumn":59},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":117,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":117,"endColumn":71},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":122,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":122,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'result' is defined but never used.","line":122,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":122,"endColumn":62},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":127,"column":4,"nodeType":"Identifier","messageId":"unusedVar","endLine":127,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":127,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":127,"endColumn":84},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":133,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":133,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'reason' is defined but never used.","line":134,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":139,"endColumn":6},{"ruleId":"no-unused-vars","severity":1,"message":"'component' is defined but never used.","line":244,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":244,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":245,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":245,"endColumn":50},{"ruleId":"no-unused-vars","severity":1,"message":"'component' is defined but never used.","line":251,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":251,"endColumn":44},{"ruleId":"no-unused-vars","severity":1,"message":"'component' is defined but never used.","line":256,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":256,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card2.1 ç»„ä»¶äº¤äº’æ¥å£æ ‡å‡†åŒ–\n * å®šä¹‰æ‰€æœ‰æ”¯æŒäº¤äº’çš„Card2ç»„ä»¶å¿…é¡»å®ç°çš„æ¥å£\n */\n\nimport type {\n  InteractionConfig,\n  InteractionEventType,\n  InteractionResponseResult,\n  ComponentInteractionState\n} from '../core/interaction-types'\n\n/**\n * äº¤äº’èƒ½åŠ›ç»„ä»¶æ¥å£\n * æ‰€æœ‰æ”¯æŒäº¤äº’çš„Card2ç»„ä»¶éƒ½åº”è¯¥å®ç°æ­¤æ¥å£\n */\nexport interface InteractionCapableComponent {\n  /**\n   * ç»„ä»¶å”¯ä¸€æ ‡è¯†ç¬¦\n   */\n  componentId: string\n\n  /**\n   * æ˜¯å¦å…è®¸å¤–éƒ¨æ§åˆ¶\n   * å½“ä¸ºfalseæ—¶ï¼Œç»„ä»¶æ‹’ç»æ‰€æœ‰å¤–éƒ¨äº¤äº’\n   */\n  allowExternalControl?: boolean\n\n  /**\n   * äº¤äº’ç™½åå•\n   * åªå…è®¸åˆ—è¡¨ä¸­çš„ç»„ä»¶å¯¹æœ¬ç»„ä»¶è¿›è¡Œäº¤äº’\n   */\n  interactionWhitelist?: string[]\n\n  /**\n   * äº¤äº’é»‘åå•\n   * æ‹’ç»åˆ—è¡¨ä¸­çš„ç»„ä»¶å¯¹æœ¬ç»„ä»¶è¿›è¡Œäº¤äº’\n   */\n  interactionBlacklist?: string[]\n\n  /**\n   * æ”¯æŒçš„äº‹ä»¶ç±»å‹\n   * ç»„ä»¶å£°æ˜è‡ªå·±æ”¯æŒå“ªäº›äº¤äº’äº‹ä»¶\n   */\n  supportedEvents?: InteractionEventType[]\n\n  /**\n   * å½“å‰äº¤äº’çŠ¶æ€\n   */\n  interactionState?: ComponentInteractionState\n\n  /**\n   * äº¤äº’é…ç½®åˆ—è¡¨\n   */\n  interactionConfigs?: InteractionConfig[]\n\n  /**\n   * æ˜¯å¦æ˜¾ç¤ºäº¤äº’æŒ‡ç¤ºå™¨\n   */\n  showInteractionIndicator?: boolean\n}\n\n/**\n * äº¤äº’ç»„ä»¶æ ‡å‡†Props\n * æ‰€æœ‰äº¤äº’ç»„ä»¶éƒ½åº”è¯¥æ¥å—è¿™äº›props\n */\nexport interface InteractionProps {\n  /**\n   * ç»„ä»¶ID - ç”±Visual Editorä¼ å…¥\n   */\n  componentId?: string\n\n  /**\n   * äº¤äº’é…ç½®åˆ—è¡¨ - ä»é…ç½®ç³»ç»Ÿä¼ å…¥\n   */\n  interactionConfigs?: InteractionConfig[]\n\n  /**\n   * æ˜¯å¦å…è®¸å¤–éƒ¨æ§åˆ¶\n   */\n  allowExternalControl?: boolean\n\n  /**\n   * äº¤äº’æƒé™é…ç½®\n   */\n  interactionPermissions?: {\n    whitelist?: string[]\n    blacklist?: string[]\n    allowedEvents?: InteractionEventType[]\n  }\n\n  /**\n   * æ˜¯å¦æ˜¾ç¤ºäº¤äº’æŒ‡ç¤ºå™¨\n   */\n  showInteractionIndicator?: boolean\n\n  /**\n   * æ˜¯å¦åœ¨é¢„è§ˆæ¨¡å¼\n   * é¢„è§ˆæ¨¡å¼ä¸‹æ¿€æ´»äº¤äº’ï¼Œç¼–è¾‘æ¨¡å¼ä¸‹ç¦ç”¨\n   */\n  previewMode?: boolean\n}\n\n/**\n * äº¤äº’ç»„ä»¶æ ‡å‡†äº‹ä»¶\n * æ‰€æœ‰äº¤äº’ç»„ä»¶éƒ½åº”è¯¥å‘å‡ºè¿™äº›äº‹ä»¶\n */\nexport interface InteractionEmits {\n  /**\n   * äº¤äº’çŠ¶æ€å˜åŒ–\n   */\n  (e: 'interaction-state-change', state: ComponentInteractionState): void\n\n  /**\n   * äº¤äº’äº‹ä»¶è§¦å‘\n   */\n  (e: 'interaction-event', eventType: InteractionEventType, data?: any): void\n\n  /**\n   * äº¤äº’æ‰§è¡Œç»“æœ\n   */\n  (e: 'interaction-result', result: InteractionResponseResult): void\n\n  /**\n   * äº¤äº’é”™è¯¯\n   */\n  (e: 'interaction-error', error: { message: string; code?: string; details?: any }): void\n\n  /**\n   * äº¤äº’è¢«æ‹’ç»\n   */\n  (\n    e: 'interaction-rejected',\n    reason: {\n      sourceComponentId?: string\n      eventType: InteractionEventType\n      reason: 'permission_denied' | 'event_not_supported' | 'external_control_disabled'\n      message: string\n    }\n  ): void\n}\n\n/**\n * äº¤äº’æƒé™æ£€æŸ¥ç»“æœ\n */\nexport interface InteractionPermissionCheck {\n  /**\n   * æ˜¯å¦å…è®¸äº¤äº’\n   */\n  allowed: boolean\n\n  /**\n   * æ‹’ç»åŸå› \n   */\n  reason?: string\n\n  /**\n   * æ‹’ç»ä»£ç \n   */\n  code?: 'EXTERNAL_CONTROL_DISABLED' | 'COMPONENT_BLACKLISTED' | 'COMPONENT_NOT_WHITELISTED' | 'EVENT_NOT_SUPPORTED'\n}\n\n/**\n * äº¤äº’ä¸Šä¸‹æ–‡ä¿¡æ¯\n */\nexport interface InteractionContext {\n  /**\n   * æºç»„ä»¶IDï¼ˆè§¦å‘äº¤äº’çš„ç»„ä»¶ï¼‰\n   */\n  sourceComponentId?: string\n\n  /**\n   * ç›®æ ‡ç»„ä»¶IDï¼ˆæ¥æ”¶äº¤äº’çš„ç»„ä»¶ï¼‰\n   */\n  targetComponentId: string\n\n  /**\n   * äº‹ä»¶ç±»å‹\n   */\n  eventType: InteractionEventType\n\n  /**\n   * äº‹ä»¶æ•°æ®\n   */\n  eventData?: any\n\n  /**\n   * æ—¶é—´æˆ³\n   */\n  timestamp: number\n\n  /**\n   * æ˜¯å¦ä¸ºç”¨æˆ·ç›´æ¥æ“ä½œ\n   */\n  isUserAction: boolean\n}\n\n/**\n * äº¤äº’èƒ½åŠ›ç»„ä»¶é…ç½®\n */\nexport interface InteractionCapabilityConfig {\n  /**\n   * æ˜¯å¦å¯ç”¨äº¤äº’èƒ½åŠ›\n   */\n  enabled: boolean\n\n  /**\n   * é»˜è®¤æƒé™è®¾ç½®\n   */\n  defaultPermissions: {\n    allowExternalControl: boolean\n    supportedEvents: InteractionEventType[]\n  }\n\n  /**\n   * æ˜¯å¦å¯ç”¨äº¤äº’è°ƒè¯•\n   */\n  enableDebug: boolean\n\n  /**\n   * æ€§èƒ½é…ç½®\n   */\n  performance: {\n    /**\n     * äº‹ä»¶é˜²æŠ–æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\n     */\n    debounceTime: number\n\n    /**\n     * æœ€å¤§åŒæ—¶æ‰§è¡Œçš„äº¤äº’æ•°é‡\n     */\n    maxConcurrentInteractions: number\n  }\n}\n\n/**\n * äº¤äº’ç»„ä»¶å·¥å‚é…ç½®\n */\nexport interface InteractionComponentFactory {\n  /**\n   * åˆ›å»ºäº¤äº’èƒ½åŠ›çš„ç»„ä»¶åŒ…è£…å™¨\n   */\n  createInteractionWrapper<T extends Record<string, any>>(\n    component: T,\n    config?: Partial<InteractionCapabilityConfig>\n  ): T & InteractionCapableComponent\n\n  /**\n   * éªŒè¯ç»„ä»¶æ˜¯å¦æ”¯æŒäº¤äº’\n   */\n  validateInteractionSupport(component: any): boolean\n\n  /**\n   * è·å–ç»„ä»¶æ”¯æŒçš„äº‹ä»¶ç±»å‹\n   */\n  getSupportedEvents(component: any): InteractionEventType[]\n}\n","usedDeprecatedRules":[]},{"filePath":"E:\\wbh\\things2\\thingspanel-frontend-community\\src\\card2.1\\types\\setting-config.ts","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'INPUT' is defined but never used.","line":101,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":8},{"ruleId":"no-unused-vars","severity":1,"message":"'TEXTAREA' is defined but never used.","line":103,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":103,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'INPUT_NUMBER' is defined but never used.","line":105,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'COLOR_PICKER' is defined but never used.","line":107,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":107,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'SLIDER' is defined but never used.","line":109,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":109,"endColumn":9},{"ruleId":"no-unused-vars","severity":1,"message":"'SWITCH' is defined but never used.","line":111,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":111,"endColumn":9},{"ruleId":"no-unused-vars","severity":1,"message":"'SELECT' is defined but never used.","line":113,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":113,"endColumn":9},{"ruleId":"no-unused-vars","severity":1,"message":"'CHECKBOX' is defined but never used.","line":115,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":115,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'RADIO_GROUP' is defined but never used.","line":117,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":117,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'DATE_PICKER' is defined but never used.","line":119,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":119,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'value' is defined but never used.","line":177,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":177,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used.","line":189,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":189,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Card2.1 ç»„ä»¶è®¾ç½®é…ç½®ç±»å‹å®šä¹‰\n * å®ç°ç»Ÿä¸€çš„ä¸‰æ–‡ä»¶ç»“æ„æ ‡å‡†å’Œå±æ€§ç»‘å®šæœºåˆ¶\n */\n\n/**\n * è®¾ç½®é¡¹é…ç½®æ¥å£\n * å¯¹åº”æ‚¨æä¾›çš„ Setting è®¾è®¡ï¼Œç”¨äºå®šä¹‰ç»„ä»¶é…ç½®ç•Œé¢çš„æ¯ä¸ªè®¾ç½®é¡¹\n */\nexport interface Setting {\n  /** æ§ä»¶ç±»å‹ï¼Œå¦‚ 'input', 'color-picker', 'slider' */\n  type: string\n  /** UIä¸Šæ˜¾ç¤ºçš„æ ‡ç­¾ */\n  label: string\n  /** ç»‘å®šçš„ customConfig.customize ä¸­çš„å±æ€§è·¯å¾„ */\n  field: string\n  /** è®¾ç½®é¡¹åˆ†ç»„ */\n  group?: string\n  /** å ä½ç¬¦æ–‡æœ¬ */\n  placeholder?: string\n  /** é»˜è®¤å€¼ */\n  defaultValue?: any\n  /** æœ€å°å€¼ï¼ˆæ•°å­—ç±»å‹ï¼‰ */\n  min?: number\n  /** æœ€å¤§å€¼ï¼ˆæ•°å­—ç±»å‹ï¼‰ */\n  max?: number\n  /** æ­¥é•¿ï¼ˆæ•°å­—ç±»å‹ï¼‰ */\n  step?: number\n  /** ä¸‹æ‹‰é€‰é¡¹ */\n  options?: Array<{ label: string; value: any; description?: string }>\n  /** æ§ä»¶çš„å…¶ä»–é…ç½®ï¼Œå¦‚ placeholder, options ç­‰ */\n  [key: string]: any\n}\n\n/**\n * ç»„ä»¶çš„é»˜è®¤æ ·å¼ã€å±æ€§å’Œåˆå§‹è¡Œä¸º\n * å¯¹åº”æ‚¨æä¾›çš„ CustomConfig è®¾è®¡\n * @template T - ç»„ä»¶ç‰¹æœ‰çš„ customize å¯¹è±¡ç±»å‹\n */\nexport interface CustomConfig<T = Record<string, any>> {\n  /** ç»„ä»¶çš„å”¯ä¸€ç±»å‹æ ‡è¯†ç¬¦ */\n  type: string\n  /** ç»„ä»¶æ ¹çº§åˆ«çš„é€šç”¨å˜æ¢å±æ€§ */\n  root: {\n    transform: {\n      rotate: number\n      scale: number\n    }\n  }\n  /** ç»„ä»¶æ ¸å¿ƒçš„ã€ç‹¬ç‰¹çš„è‡ªå®šä¹‰æ ·å¼å’ŒåŠŸèƒ½å±æ€§ */\n  customize: T\n}\n\n/**\n * æœ€ç»ˆç”±æ¸²æŸ“å¼•æ“ä½¿ç”¨çš„å®Œæ•´ç»„ä»¶é…ç½®å¯¹è±¡\n * å¯¹åº”æ‚¨æä¾›çš„ DataConfig è®¾è®¡\n * @template T - ç»„ä»¶ç‰¹æœ‰çš„ customize å¯¹è±¡ç±»å‹\n */\nexport interface DataConfig<T = Record<string, any>> {\n  /** ç»„ä»¶å®ä¾‹çš„å”¯ä¸€ID */\n  id: string\n  /** ç»„ä»¶çš„æ˜¾ç¤ºåç§° */\n  name: string\n  /** Vueç»„ä»¶åç§°ï¼Œæºå­—æ®µ */\n  field: string\n  /** æ¥æ”¶è”åŠ¨çš„ç›®æ ‡ç»„ä»¶é…ç½® */\n  components: TargetComponent[]\n  /** ç»„ä»¶çš„è‡ªå®šä¹‰é…ç½® */\n  customConfig: CustomConfig<T>\n}\n\n/**\n * è”åŠ¨ä¸­çš„ç›®æ ‡ç»„ä»¶\n * å¯¹åº”æ‚¨æä¾›çš„ TargetComponent è®¾è®¡\n */\nexport interface TargetComponent {\n  /** ç›®æ ‡ç»„ä»¶çš„ID */\n  id: string\n  /** æ¥æ”¶è”åŠ¨æ•°æ®çš„å­—æ®µ */\n  field: string\n}\n\n/**\n * ç»„ä»¶è®¾ç½®é…ç½®\n * å°† Setting å’Œ CustomConfig æ•´åˆï¼Œå®šä¹‰ç»„ä»¶çš„å®Œæ•´é…ç½®ç»“æ„\n */\nexport interface ComponentSettingConfig<T = Record<string, any>> {\n  /** ç»„ä»¶ç±»å‹æ ‡è¯†ç¬¦ */\n  componentType: string\n  /** è®¾ç½®é¡¹åˆ—è¡¨ */\n  settings: Setting[]\n  /** é»˜è®¤è‡ªå®šä¹‰é…ç½® */\n  customConfig: CustomConfig<T>\n}\n\n/**\n * æ”¯æŒçš„æ§ä»¶ç±»å‹æšä¸¾\n */\nexport enum SettingControlType {\n  /** æ–‡æœ¬è¾“å…¥æ¡† */\n  INPUT = 'input',\n  /** æ–‡æœ¬åŸŸ */\n  TEXTAREA = 'textarea',\n  /** æ•°å­—è¾“å…¥æ¡† */\n  INPUT_NUMBER = 'input-number',\n  /** é¢œè‰²é€‰æ‹©å™¨ */\n  COLOR_PICKER = 'color-picker',\n  /** æ»‘å— */\n  SLIDER = 'slider',\n  /** å¼€å…³ */\n  SWITCH = 'switch',\n  /** ä¸‹æ‹‰é€‰æ‹© */\n  SELECT = 'select',\n  /** å¤šé€‰æ¡† */\n  CHECKBOX = 'checkbox',\n  /** å•é€‰æ¡†ç»„ */\n  RADIO_GROUP = 'radio-group',\n  /** æ—¥æœŸé€‰æ‹©å™¨ */\n  DATE_PICKER = 'date-picker'\n}\n\n/**\n * å±æ€§æ•°æ®ç±»å‹æ˜ å°„\n */\nexport type PropertyDataTypeFromSetting =\n  | 'string' // input, textarea, select, radio-group\n  | 'number' // input-number, slider\n  | 'boolean' // switch, checkbox\n  | 'color' // color-picker\n  | 'date' // date-picker\n\n/**\n * æ ¹æ®è®¾ç½®é¡¹ç±»å‹æ¨æ–­å±æ€§æ•°æ®ç±»å‹\n * @param setting è®¾ç½®é¡¹é…ç½®\n * @returns å±æ€§æ•°æ®ç±»å‹\n */\nexport function inferPropertyDataType(setting: Setting): PropertyDataTypeFromSetting {\n  switch (setting.type) {\n    case SettingControlType.INPUT:\n    case SettingControlType.TEXTAREA:\n    case SettingControlType.SELECT:\n    case SettingControlType.RADIO_GROUP:\n      return 'string'\n\n    case SettingControlType.INPUT_NUMBER:\n    case SettingControlType.SLIDER:\n      return 'number'\n\n    case SettingControlType.SWITCH:\n    case SettingControlType.CHECKBOX:\n      return 'boolean'\n\n    case SettingControlType.COLOR_PICKER:\n      return 'color'\n\n    case SettingControlType.DATE_PICKER:\n      return 'date'\n\n    default:\n      return 'string'\n  }\n}\n\n/**\n * è®¾ç½®é¡¹éªŒè¯è§„åˆ™\n */\nexport interface SettingValidationRule {\n  /** æ˜¯å¦å¿…å¡« */\n  required?: boolean\n  /** æœ€å°é•¿åº¦/å€¼ */\n  min?: number\n  /** æœ€å¤§é•¿åº¦/å€¼ */\n  max?: number\n  /** æ­£åˆ™è¡¨è¾¾å¼éªŒè¯ */\n  pattern?: string\n  /** è‡ªå®šä¹‰éªŒè¯å‡½æ•° */\n  validator?: (value: any) => boolean | string\n}\n\n/**\n * æ‰©å±•çš„è®¾ç½®é¡¹é…ç½®ï¼ˆåŒ…å«éªŒè¯ï¼‰\n */\nexport interface EnhancedSetting extends Setting {\n  /** éªŒè¯è§„åˆ™ */\n  validation?: SettingValidationRule\n  /** æ˜¯å¦åªè¯» */\n  readonly?: boolean\n  /** æ˜¯å¦å¯è§ */\n  visible?: boolean | ((config: any) => boolean)\n  /** å¸®åŠ©æ–‡æœ¬ */\n  helpText?: string\n}\n\n/**\n * åˆ›å»ºè®¾ç½®é¡¹çš„è¾…åŠ©å‡½æ•°\n */\nexport function createSetting(type: string, label: string, field: string, options: Partial<Setting> = {}): Setting {\n  return {\n    type,\n    label,\n    field,\n    group: options.group || 'åŸºç¡€è®¾ç½®',\n    ...options\n  }\n}\n\n/**\n * åˆ›å»ºè‡ªå®šä¹‰é…ç½®çš„è¾…åŠ©å‡½æ•°\n */\nexport function createCustomConfig<T>(\n  type: string,\n  customize: T,\n  transform: { rotate: number; scale: number } = { rotate: 0, scale: 1 }\n): CustomConfig<T> {\n  return {\n    type,\n    root: { transform },\n    customize\n  }\n}\n","usedDeprecatedRules":[]}]
